<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>开始</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_开始">1. 开始</a>
<ul class="sectlevel2">
<li><a href="#_下载">1.1. 下载</a>
<ul class="sectlevel3">
<li><a href="#_stable">1.1.1. Stable</a></li>
<li><a href="#_snapshots">1.1.2. Snapshots</a></li>
<li><a href="#_prerequisites">1.1.3. Prerequisites</a></li>
</ul>
</li>
<li><a href="#_maven_repository">1.2. Maven Repository</a></li>
<li><a href="#SDKMAN">1.3. SDKMAN! (The Software Development Kit Manager)</a></li>
<li><a href="#_other_ways_to_get_groovy">1.4. Other ways to get Groovy</a>
<ul class="sectlevel3">
<li><a href="#_installation_on_mac_os_x">1.4.1. Installation on Mac OS X</a>
<ul class="sectlevel4">
<li><a href="#_macports">1.4.1.1. MacPorts</a></li>
<li><a href="#_homebrew">1.4.1.2. Homebrew</a></li>
</ul>
</li>
<li><a href="#_installation_on_windows">1.4.2. Installation on Windows</a></li>
<li><a href="#_other_distributions">1.4.3. Other Distributions</a></li>
<li><a href="#_source_code">1.4.4. Source Code</a></li>
<li><a href="#_ide_plugin">1.4.5. IDE plugin</a></li>
</ul>
</li>
<li><a href="#_install_binary">1.5. Install Binary</a></li>
</ul>
</li>
<li><a href="#_与java的不同">2. 与Java的不同</a>
<ul class="sectlevel2">
<li><a href="#_默认的import">2.1. 默认的import</a></li>
<li><a href="#_multi_methods">2.2. Multi-methods</a></li>
<li><a href="#_数值的初始化">2.3. 数值的初始化</a></li>
<li><a href="#_包作用域可见性">2.4. 包作用域可见性</a></li>
<li><a href="#_try_with_resources">2.5. try-with-resources</a></li>
<li><a href="#_内部类">2.6. 内部类</a>
<ul class="sectlevel3">
<li><a href="#_静态内部类">2.6.1. 静态内部类</a></li>
<li><a href="#_匿名内部类">2.6.2. 匿名内部类</a></li>
<li><a href="#_创建非静态_内部类的实例">2.6.3. 创建非静态 内部类的实例</a></li>
</ul>
</li>
<li><a href="#_lambda表达式和方法应用操作符">2.7. Lambda表达式和方法应用操作符</a></li>
<li><a href="#_gstrings">2.8. GStrings</a></li>
<li><a href="#_字符串和字符字面量">2.9. 字符串和字符字面量</a></li>
<li><a href="#_的作用">2.10. `==`的作用</a></li>
<li><a href="#_基础类型和包装类">2.11. 基础类型和包装类</a>
<ul class="sectlevel3">
<li><a href="#primitive-optimisation-numbers">2.11.1. Numeric Primitive Optimisation with <code>@CompileStatic</code></a></li>
<li><a href="#zero-edge-case">2.11.2. Positive/Negative zero edge case</a></li>
</ul>
</li>
<li><a href="#_conversions">2.12. Conversions</a></li>
<li><a href="#_额外的关键字">2.13. 额外的关键字</a></li>
</ul>
</li>
<li><a href="#_groovy_development_kit">3. Groovy Development Kit</a>
<ul class="sectlevel2">
<li><a href="#_working_with_io">3.1. Working with IO</a>
<ul class="sectlevel3">
<li><a href="#_reading_files">3.1.1. Reading files</a></li>
<li><a href="#_writing_files">3.1.2. Writing files</a></li>
<li><a href="#_traversing_file_trees">3.1.3. Traversing file trees</a></li>
<li><a href="#_data_and_objects">3.1.4. Data and objects</a></li>
<li><a href="#process-management">3.1.5. Executing External Processes</a></li>
</ul>
</li>
<li><a href="#_working_with_collections">3.2. Working with collections</a>
<ul class="sectlevel3">
<li><a href="#Collections-Lists">3.2.1. Lists</a>
<ul class="sectlevel4">
<li><a href="#_list_literals">3.2.1.1. List literals</a></li>
<li><a href="#_list_as_a_boolean_expression">3.2.1.2. List as a boolean expression</a></li>
<li><a href="#_iterating_on_a_list">3.2.1.3. Iterating on a list</a></li>
<li><a href="#_manipulating_lists">3.2.1.4. Manipulating lists</a></li>
</ul>
</li>
<li><a href="#Collections-Maps">3.2.2. Maps</a>
<ul class="sectlevel4">
<li><a href="#_map_literals">3.2.2.1. Map literals</a></li>
<li><a href="#_map_property_notation">3.2.2.2. Map property notation</a></li>
<li><a href="#_iterating_on_maps">3.2.2.3. Iterating on maps</a></li>
<li><a href="#_manipulating_maps">3.2.2.4. Manipulating maps</a></li>
</ul>
</li>
<li><a href="#Collections-Ranges">3.2.3. Ranges</a></li>
<li><a href="#_syntax_enhancements_for_collections">3.2.4. Syntax enhancements for collections</a>
<ul class="sectlevel4">
<li><a href="#_gpath_support">3.2.4.1. GPath support</a></li>
<li><a href="#_spread_operator">3.2.4.2. Spread operator</a></li>
<li><a href="#Collections-Gettingefficientwiththestar-dotoperator">3.2.4.3. The star-dot `*.' operator</a></li>
<li><a href="#Collections-Slicingwiththesubscriptoperator">3.2.4.4. Slicing with the subscript operator</a></li>
</ul>
</li>
<li><a href="#Collections-EnhancedCollectionMethods">3.2.5. Enhanced Collection Methods</a></li>
</ul>
</li>
<li><a href="#_working_with_arrays">3.3. Working with arrays</a>
<ul class="sectlevel3">
<li><a href="#Arrays">3.3.1. Arrays</a>
<ul class="sectlevel4">
<li><a href="#_array_literals">3.3.1.1. Array literals</a></li>
<li><a href="#_iterating_on_a_list_2">3.3.1.2. Iterating on a list</a></li>
<li><a href="#_other_useful_methods">3.3.1.3. Other useful methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_handy_utilities">3.4. Handy utilities</a>
<ul class="sectlevel3">
<li><a href="#_configslurper">3.4.1. ConfigSlurper</a></li>
<li><a href="#_expando">3.4.2. Expando</a></li>
<li><a href="#_observable_list_map_and_set">3.4.3. Observable list, map and set</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_元编程">4. 元编程</a>
<ul class="sectlevel2">
<li><a href="#_运行时元编程">4.1. 运行时元编程</a>
<ul class="sectlevel3">
<li><a href="#_groovyobject_interface">4.1.1. GroovyObject interface</a>
<ul class="sectlevel4">
<li><a href="#_invokemethod">4.1.1.1. invokeMethod</a></li>
<li><a href="#_getsetproperty">4.1.1.2. get/setProperty</a></li>
<li><a href="#_getsetmetaclass">4.1.1.3. get/setMetaClass</a></li>
</ul>
</li>
<li><a href="#_getsetattribute">4.1.2. get/setAttribute</a></li>
<li><a href="#_methodmissing">4.1.3. methodMissing</a></li>
<li><a href="#_propertymissing">4.1.4. propertyMissing</a></li>
<li><a href="#_static_methodmissing">4.1.5. static methodMissing</a></li>
<li><a href="#_static_propertymissing">4.1.6. static propertyMissing</a></li>
<li><a href="#_groovyinterceptable">4.1.7. GroovyInterceptable</a></li>
<li><a href="#categories">4.1.8. Categories</a></li>
<li><a href="#_metaclasses">4.1.9. Metaclasses</a>
<ul class="sectlevel4">
<li><a href="#_the_default_metaclass_metaclassimpl">4.1.9.1. The default metaclass <code>MetaClassImpl</code></a></li>
<li><a href="#_custom_metaclasses">4.1.9.2. Custom metaclasses</a></li>
<li><a href="#_per_instance_metaclass">4.1.9.3. Per instance metaclass</a></li>
<li><a href="#metaprogramming_emc">4.1.9.4. ExpandoMetaClass</a></li>
</ul>
</li>
<li><a href="#_extension_modules">4.1.10. Extension modules</a>
<ul class="sectlevel4">
<li><a href="#_extending_existing_classes">4.1.10.1. Extending existing classes</a></li>
<li><a href="#_instance_methods">4.1.10.2. Instance methods</a></li>
<li><a href="#_static_methods_2">4.1.10.3. Static methods</a></li>
<li><a href="#module-descriptor">4.1.10.4. Module descriptor</a></li>
<li><a href="#_extension_modules_and_classpath">4.1.10.5. Extension modules and classpath</a></li>
<li><a href="#_compatibility_with_type_checking">4.1.10.6. Compatibility with type checking</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compile_time_metaprogramming">4.2. Compile-time metaprogramming</a>
<ul class="sectlevel3">
<li><a href="#_available_ast_transformations">4.2.1. Available AST transformations</a>
<ul class="sectlevel4">
<li><a href="#_code_generation_transformations">4.2.1.1. Code generation transformations</a></li>
<li><a href="#_class_design_annotations">4.2.1.2. Class design annotations</a></li>
<li><a href="#_logging_improvements">4.2.1.3. Logging improvements</a></li>
<li><a href="#_declarative_concurrency">4.2.1.4. Declarative concurrency</a></li>
<li><a href="#_easier_cloning_and_externalizing">4.2.1.5. Easier cloning and externalizing</a></li>
<li><a href="#_safer_scripting">4.2.1.6. Safer scripting</a></li>
<li><a href="#_compiler_directives">4.2.1.7. Compiler directives</a></li>
<li><a href="#_swing_patterns">4.2.1.8. Swing patterns</a></li>
<li><a href="#_test_assistance">4.2.1.9. Test assistance</a></li>
<li><a href="#_grape_handling">4.2.1.10. Grape handling</a></li>
</ul>
</li>
<li><a href="#developing-ast-xforms">4.2.2. Developing AST transformations</a>
<ul class="sectlevel4">
<li><a href="#_compilation_phases_guide">4.2.2.1. Compilation phases guide</a></li>
<li><a href="#transforms-local">4.2.2.2. Local transformations</a></li>
<li><a href="#transforms-global">4.2.2.3. Global transformations</a></li>
<li><a href="#_ast_api_guide">4.2.2.4. AST API guide</a></li>
<li><a href="#_macros">4.2.2.5. Macros</a></li>
<li><a href="#_testing_ast_transformations">4.2.2.6. Testing AST transformations</a></li>
<li><a href="#_external_references">4.2.2.7. External references</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#section-grape">5. Dependency management with Grape</a>
<ul class="sectlevel2">
<li><a href="#_quick_start">5.1. Quick start</a>
<ul class="sectlevel3">
<li><a href="#_add_a_dependency">5.1.1. Add a Dependency</a></li>
<li><a href="#Grape-SpecifyAdditionalRepositories">5.1.2. Specify Additional Repositories</a></li>
<li><a href="#Grape-MavenClassifiers">5.1.3. Maven Classifiers</a></li>
<li><a href="#Grape-ExcludingTransitiveDependencies">5.1.4. Excluding Transitive Dependencies</a></li>
<li><a href="#Grape-JDBCDrivers">5.1.5. JDBC Drivers</a></li>
<li><a href="#Grape-UsingGrapeFromtheGroovyShell">5.1.6. Using Grape From the Groovy Shell</a></li>
<li><a href="#Grape-Proxysettings">5.1.7. Proxy settings</a></li>
<li><a href="#Grape-Logging">5.1.8. Logging</a></li>
</ul>
</li>
<li><a href="#Grape-Detail">5.2. Detail</a></li>
<li><a href="#Grape-Usage">5.3. Usage</a>
<ul class="sectlevel3">
<li><a href="#Grape-Annotation">5.3.1. Annotation</a></li>
<li><a href="#Grape-MultipleGrapeAnnotations">5.3.2. Multiple Grape Annotations</a></li>
<li><a href="#Grape-Methodcall">5.3.3. Method call</a>
<ul class="sectlevel4">
<li><a href="#Grape-grabHashMapParameters">5.3.3.1. grab(HashMap) Parameters</a></li>
<li><a href="#Grape-ArgumentsMaparguments">5.3.3.2. Arguments Map arguments</a></li>
</ul>
</li>
<li><a href="#Grape-CommandLineTool">5.3.4. Command Line Tool</a></li>
<li><a href="#Grape-Advancedconfiguration">5.3.5. Advanced configuration</a>
<ul class="sectlevel4">
<li><a href="#Grape-RepositoryDirectory">5.3.5.1. Repository Directory</a></li>
<li><a href="#Grape-CustomizeIvysettings">5.3.5.2. Customize Ivy settings</a></li>
</ul>
</li>
<li><a href="#Grape-MoreExamples">5.3.6. More Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_测试指南">6. 测试指南</a>
<ul class="sectlevel2">
<li><a href="#_简介">6.1. 简介</a></li>
<li><a href="#_语音特性">6.2. 语音特性</a>
<ul class="sectlevel3">
<li><a href="#_强大的断言">6.2.1. 强大的断言</a></li>
<li><a href="#_mocking_and_stubbing">6.2.2. Mocking and Stubbing</a>
<ul class="sectlevel4">
<li><a href="#_map_coercion">6.2.2.1. Map Coercion</a></li>
<li><a href="#_closure_coercion">6.2.2.2. Closure Coercion</a></li>
<li><a href="#_mockfor_and_stubfor">6.2.2.3. MockFor and StubFor</a></li>
<li><a href="#testing_guide_emc">6.2.2.4. Expando Meta-Class (EMC)</a></li>
</ul>
</li>
<li><a href="#_gdk_methods">6.2.3. GDK Methods</a>
<ul class="sectlevel4">
<li><a href="#_iterablecombinations">6.2.3.1. Iterable#combinations</a></li>
<li><a href="#_iterableeachcombination">6.2.3.2. Iterable#eachCombination</a></li>
</ul>
</li>
<li><a href="#_tool_support">6.2.4. Tool Support</a>
<ul class="sectlevel4">
<li><a href="#_test_code_coverage">6.2.4.1. Test Code Coverage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing_with_junit">6.3. Testing with JUnit</a>
<ul class="sectlevel3">
<li><a href="#_junit_3">6.3.1. JUnit 3</a>
<ul class="sectlevel4">
<li><a href="#_assertion_methods">6.3.1.1. Assertion Methods</a></li>
<li><a href="#_shouldfail_methods">6.3.1.2. shouldFail Methods</a></li>
<li><a href="#_notyetimplemented_method">6.3.1.3. notYetImplemented Method</a></li>
</ul>
</li>
<li><a href="#_junit_4">6.3.2. JUnit 4</a></li>
</ul>
</li>
<li><a href="#_testing_with_spock">6.4. Testing with Spock</a>
<ul class="sectlevel3">
<li><a href="#_specifications">6.4.1. Specifications</a></li>
<li><a href="#_more_spock">6.4.2. More Spock</a></li>
</ul>
</li>
<li><a href="#_functional_tests_with_geb">6.5. Functional Tests with Geb</a>
<ul class="sectlevel3">
<li><a href="#_a_geb_script">6.5.1. A Geb Script</a></li>
<li><a href="#_more_geb">6.5.2. More Geb</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_domain_specific_languages">7. Domain-Specific Languages</a>
<ul class="sectlevel2">
<li><a href="#_command_chains">7.1. Command chains</a></li>
<li><a href="#_operator_overloading">7.2. Operator overloading</a></li>
<li><a href="#_script_base_classes">7.3. Script base classes</a>
<ul class="sectlevel3">
<li><a href="#_the_script_class">7.3.1. The Script class</a></li>
<li><a href="#dsl-basescript">7.3.2. The @BaseScript annotation</a></li>
<li><a href="#_alternate_abstract_method">7.3.3. Alternate abstract method</a></li>
</ul>
</li>
<li><a href="#_adding_properties_to_numbers">7.4. Adding properties to numbers</a></li>
<li><a href="#section-delegatesto">7.5. @DelegatesTo</a>
<ul class="sectlevel3">
<li><a href="#TheDelegatesToannotation-DSLsmadeeasy">7.5.1. Explaining delegation strategy at compile time</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTo">7.5.2. @DelegatesTo</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTomodes">7.5.3. DelegatesTo modes</a>
<ul class="sectlevel4">
<li><a href="#TheDelegatesToannotation-Simpledelegation">7.5.3.1. Simple delegation</a></li>
<li><a href="#TheDelegatesToannotation-Delegationstrategy">7.5.3.2. Delegation strategy</a></li>
<li><a href="#TheDelegatesToannotation-Delegatetoparameter">7.5.3.3. Delegate to parameter</a></li>
<li><a href="#TheDelegatesToannotation-Multipleclosures">7.5.3.4. Multiple closures</a></li>
<li><a href="#_delegating_to_a_generic_type">7.5.3.5. Delegating to a generic type</a></li>
<li><a href="#_delegating_to_an_arbitrary_type">7.5.3.6. Delegating to an arbitrary type</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compilation-customizers">7.6. Compilation customizers</a>
<ul class="sectlevel3">
<li><a href="#_introduction_2">7.6.1. Introduction</a></li>
<li><a href="#_import_customizer">7.6.2. Import customizer</a></li>
<li><a href="#_ast_transformation_customizer">7.6.3. AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer">7.6.4. Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer">7.6.5. Source aware customizer</a></li>
<li><a href="#_customizer_builder">7.6.6. Customizer builder</a>
<ul class="sectlevel4">
<li><a href="#_import_customizer_2">7.6.6.1. Import customizer</a></li>
<li><a href="#_ast_transformation_customizer_2">7.6.6.2. AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer_2">7.6.6.3. Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer_2">7.6.6.4. Source aware customizer</a></li>
<li><a href="#_inlining_a_customizer">7.6.6.5. Inlining a customizer</a></li>
<li><a href="#_multiple_customizers">7.6.6.6. Multiple customizers</a></li>
</ul>
</li>
<li><a href="#_the_configscript_commandline_parameter">7.6.7. The <code>configscript</code> commandline parameter</a>
<ul class="sectlevel4">
<li><a href="#_configscript_example_static_compilation_by_default">7.6.7.1. Configscript example: Static compilation by default</a></li>
<li><a href="#_configscript_example_setting_system_properties">7.6.7.2. Configscript example: Setting system properties</a></li>
</ul>
</li>
<li><a href="#_ast_transformations">7.6.8. AST transformations</a></li>
</ul>
</li>
<li><a href="#_custom_type_checking_extensions">7.7. Custom type checking extensions</a></li>
<li><a href="#_builders">7.8. Builders</a>
<ul class="sectlevel3">
<li><a href="#_existing_builders">7.8.1. Existing builders</a>
<ul class="sectlevel4">
<li><a href="#_markupbuilder">7.8.1.1. MarkupBuilder</a></li>
<li><a href="#_streamingmarkupbuilder">7.8.1.2. StreamingMarkupBuilder</a></li>
<li><a href="#_nodebuilder">7.8.1.3. NodeBuilder</a></li>
<li><a href="#_clibuilder">7.8.1.4. CliBuilder</a></li>
<li><a href="#_objectgraphbuilder">7.8.1.5. ObjectGraphBuilder</a></li>
<li><a href="#_jmxbuilder">7.8.1.6. JmxBuilder</a></li>
<li><a href="#_filetreebuilder">7.8.1.7. FileTreeBuilder</a></li>
</ul>
</li>
<li><a href="#_creating_a_builder">7.8.2. Creating a builder</a>
<ul class="sectlevel4">
<li><a href="#_buildersupport">7.8.2.1. BuilderSupport</a></li>
<li><a href="#_factorybuildersupport">7.8.2.2. FactoryBuilderSupport</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_集成groovy到java应用中">8. 集成Groovy到Java应用中</a>
<ul class="sectlevel2">
<li><a href="#_groovy集成机制">8.1. Groovy集成机制</a>
<ul class="sectlevel3">
<li><a href="#integ-eval">8.1.1. Eval</a></li>
<li><a href="#integ-groovyshell">8.1.2. GroovyShell</a>
<ul class="sectlevel4">
<li><a href="#_multiple_sources">8.1.2.1. Multiple sources</a></li>
<li><a href="#_sharing_data_between_a_script_and_the_application">8.1.2.2. Sharing data between a script and the application</a></li>
<li><a href="#_custom_script_class">8.1.2.3. Custom script class</a></li>
</ul>
</li>
<li><a href="#groovyclassloader">8.1.3. GroovyClassLoader</a></li>
<li><a href="#_groovyscriptengine">8.1.4. GroovyScriptEngine</a></li>
<li><a href="#_compilationunit">8.1.5. CompilationUnit</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_design_patterns_in_groovy">9. Design patterns in Groovy</a>
<ul class="sectlevel2">
<li><a href="#_patterns">9.1. Patterns</a>
<ul class="sectlevel3">
<li><a href="#_abstract_factory_pattern">9.1.1. Abstract Factory Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example">9.1.1.1. Example</a></li>
</ul>
</li>
<li><a href="#_adapter_pattern">9.1.2. Adapter Pattern</a>
<ul class="sectlevel4">
<li><a href="#_delegation_example">9.1.2.1. Delegation Example</a></li>
<li><a href="#_inheritance_example">9.1.2.2. Inheritance Example</a></li>
<li><a href="#_adapting_using_closures">9.1.2.3. Adapting using Closures</a></li>
<li><a href="#_adapting_using_the_expandometaclass">9.1.2.4. Adapting using the ExpandoMetaClass</a></li>
</ul>
</li>
<li><a href="#_bouncer_pattern">9.1.3. Bouncer Pattern</a>
<ul class="sectlevel4">
<li><a href="#_null_checking_example">9.1.3.1. Null Checking Example</a></li>
<li><a href="#_validation_example">9.1.3.2. Validation Example</a></li>
</ul>
</li>
<li><a href="#_chain_of_responsibility_pattern">9.1.4. Chain of Responsibility Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_using_traditional_classes">9.1.4.1. Example using traditional classes</a></li>
<li><a href="#_example_using_simplifying_strategies">9.1.4.2. Example using simplifying strategies</a></li>
<li><a href="#_when_not_to_use">9.1.4.3. When not to use</a></li>
<li><a href="#_going_further">9.1.4.4. Going further</a></li>
</ul>
</li>
<li><a href="#_command_pattern">9.1.5. Command Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_with_traditional_classes">9.1.5.1. Example with traditional classes</a></li>
<li><a href="#_simplifying_variations">9.1.5.2. Simplifying variations</a></li>
</ul>
</li>
<li><a href="#_composite_pattern">9.1.6. Composite Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_2">9.1.6.1. Example</a></li>
</ul>
</li>
<li><a href="#_decorator_pattern">9.1.7. Decorator Pattern</a>
<ul class="sectlevel4">
<li><a href="#_traditional_example">9.1.7.1. Traditional Example</a></li>
<li><a href="#_simplifying_with_closures_or_lambdas">9.1.7.2. Simplifying with closures or lambdas</a></li>
<li><a href="#_a_touch_of_dynamic_behaviour">9.1.7.3. A touch of dynamic behaviour</a></li>
<li><a href="#_runtime_behaviour_embellishment">9.1.7.4. Runtime behaviour embellishment</a></li>
<li><a href="#_more_dynamic_decorating">9.1.7.5. More dynamic decorating</a></li>
<li><a href="#_decorating_with_an_interceptor">9.1.7.6. Decorating with an Interceptor</a></li>
<li><a href="#_decorating_with_java_lang_reflect_proxy">9.1.7.7. Decorating with java.lang.reflect.Proxy</a></li>
<li><a href="#_decorating_with_spring">9.1.7.8. Decorating with Spring</a></li>
<li><a href="#_asynchronous_decorators_using_gpars">9.1.7.9. Asynchronous Decorators using GPars</a></li>
</ul>
</li>
<li><a href="#_delegation_pattern">9.1.8. Delegation Pattern</a>
<ul class="sectlevel4">
<li><a href="#_implement_delegation_pattern_using_expandometaclass">9.1.8.1. Implement Delegation Pattern using ExpandoMetaClass</a></li>
<li><a href="#_implement_delegation_pattern_using_delegate_annotation">9.1.8.2. Implement Delegation Pattern using @Delegate annotation</a></li>
</ul>
</li>
<li><a href="#_flyweight_pattern">9.1.9. Flyweight Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_3">9.1.9.1. Example</a></li>
</ul>
</li>
<li><a href="#_iterator_pattern">9.1.10. Iterator Pattern</a></li>
<li><a href="#_loan_my_resource_pattern">9.1.11. Loan my Resource Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_4">9.1.11.1. Example</a></li>
</ul>
</li>
<li><a href="#_using_monoids">9.1.12. Using Monoids</a>
<ul class="sectlevel4">
<li><a href="#_a_touch_of_formalism">9.1.12.1. A touch of formalism</a></li>
<li><a href="#_benefits_of_monoids">9.1.12.2. Benefits of monoids</a></li>
<li><a href="#_working_with_non_monoids">9.1.12.3. Working with Non-monoids</a></li>
</ul>
</li>
<li><a href="#_null_object_pattern">9.1.13. Null Object Pattern</a>
<ul class="sectlevel4">
<li><a href="#_simple_example">9.1.13.1. Simple Example</a></li>
<li><a href="#_tree_example">9.1.13.2. Tree Example</a></li>
</ul>
</li>
<li><a href="#_observer_pattern">9.1.14. Observer Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_5">9.1.14.1. Example</a></li>
<li><a href="#_bindable_and_vetoable">9.1.14.2. @Bindable and @Vetoable</a></li>
</ul>
</li>
<li><a href="#_pimp_my_library_pattern">9.1.15. Pimp my Library Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_6">9.1.15.1. Example</a></li>
</ul>
</li>
<li><a href="#_proxy_pattern">9.1.16. Proxy Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_7">9.1.16.1. Example</a></li>
</ul>
</li>
<li><a href="#_singleton_pattern">9.1.17. Singleton Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_the_classic_java_singleton">9.1.17.1. Example: The Classic Java Singleton</a></li>
<li><a href="#_example_singleton_via_metaprogramming">9.1.17.2. Example: Singleton via MetaProgramming</a></li>
<li><a href="#_guice_example">9.1.17.3. Guice Example</a></li>
<li><a href="#_spring_example">9.1.17.4. Spring Example</a></li>
<li><a href="#_further_information">9.1.17.5. Further information</a></li>
</ul>
</li>
<li><a href="#_state_pattern">9.1.18. State Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_8">9.1.18.1. Example</a></li>
<li><a href="#_variation_1_leveraging_interface_oriented_design">9.1.18.2. Variation 1: Leveraging Interface-Oriented Design</a></li>
<li><a href="#_variation_2_extract_state_pattern_logic">9.1.18.3. Variation 2: Extract State Pattern Logic</a></li>
<li><a href="#_variation_3_bring_on_the_dsl">9.1.18.4. Variation 3: Bring on the DSL</a></li>
</ul>
</li>
<li><a href="#_strategy_pattern">9.1.19. Strategy Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_using_traditional_class_hierarchy">9.1.19.1. Example using traditional class hierarchy</a></li>
<li><a href="#_example_using_closures">9.1.19.2. Example using closures</a></li>
<li><a href="#_example_using_lambdas">9.1.19.3. Example using lambdas</a></li>
</ul>
</li>
<li><a href="#_template_method_pattern">9.1.20. Template Method Pattern</a>
<ul class="sectlevel4">
<li><a href="#_example_with_traditional_classes_2">9.1.20.1. Example with traditional classes</a></li>
<li><a href="#_example_with_simplifying_strategies">9.1.20.2. Example with simplifying strategies</a></li>
</ul>
</li>
<li><a href="#_visitor_pattern">9.1.21. Visitor Pattern</a>
<ul class="sectlevel4">
<li><a href="#_simple_example_2">9.1.21.1. Simple Example</a></li>
<li><a href="#_advanced_example">9.1.21.2. Advanced Example</a></li>
<li><a href="#_further_information_2">9.1.21.3. Further Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">9.2. References</a></li>
</ul>
</li>
<li><a href="#_针对java开发者的groovy风格和语言特性指南">10. 针对Java开发者的Groovy风格和语言特性指南</a>
<ul class="sectlevel2">
<li><a href="#_可省略分号">10.1. 可省略分号</a></li>
<li><a href="#_return关键字可选">10.2. Return关键字可选</a></li>
<li><a href="#_def_and_type">10.3. Def and type</a></li>
<li><a href="#_默认public">10.4. 默认public</a></li>
<li><a href="#_省略括号">10.5. 省略括号</a></li>
<li><a href="#_classes_as_first_class_citizens">10.6. Classes as first-class citizens</a></li>
<li><a href="#_getters_和_setters">10.7. Getters 和 Setters</a></li>
<li><a href="#_使用默认构造函数和命名参数初始化bean">10.8. 使用默认构造函数和命名参数初始化bean</a></li>
<li><a href="#_using_with_and_tap_for_repeated_operations_on_the_same_bean">10.9. Using <code>with()</code> and <code>tap()</code> for repeated operations on the same bean</a></li>
<li><a href="#_equals_和">10.10. Equals 和 <code>==</code></a></li>
<li><a href="#_gstrings_插值_多行">10.11. GStrings (插值, 多行)</a></li>
<li><a href="#_数据结构的groovy语法">10.12. 数据结构的groovy语法</a></li>
<li><a href="#_the_groovy_development_kit">10.13. The Groovy Development Kit</a></li>
<li><a href="#_强大的switch">10.14. 强大的Switch</a></li>
<li><a href="#_import别名">10.15. Import别名</a></li>
<li><a href="#_groovy_真假">10.16. Groovy 真假</a></li>
<li><a href="#_安全的对象导航">10.17. 安全的对象导航</a></li>
<li><a href="#_断言">10.18. 断言</a></li>
<li><a href="#_elvis_operator_for_default_values">10.19. Elvis operator for default values</a></li>
<li><a href="#_捕获所有异常">10.20. 捕获所有异常</a></li>
<li><a href="#_optional_typing_advice">10.21. Optional typing advice</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_开始"><a class="link" href="#_开始">1. 开始</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_下载"><a class="link" href="#_下载">1.1. 下载</a></h3>
<div class="paragraph">
<p>From the <a href="https://groovy.apache.org/download.html">download</a> page,
you will be able to download the distribution (binary and source),
the Windows installer (a community artifact) and the documentation for <strong>Groovy</strong>.</p>
</div>
<div class="paragraph">
<p>For a quick and effortless start on Mac OSX, Linux, WSL2 or Cygwin, you can use <a href="https://sdkman.io/">SDKMAN!</a>
(The Software Development Kit Manager) to download and configure any <strong>Groovy</strong> version of your choice.
Basic <a href="#SDKMAN">instructions</a> can be found below.</p>
</div>
<div class="sect3">
<h4 id="_stable"><a class="link" href="#_stable">1.1.1. Stable</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Download zip</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-binary-{groovy-full-version}.zip"><strong>Binary Release</strong></a> | <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-src-{groovy-full-version}.zip">Source Release</a></p>
</li>
<li>
<p><strong>Download documentation</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-docs-{groovy-full-version}.zip"><strong>JavaDoc and zipped online documentation</strong></a></p>
</li>
<li>
<p><strong>Combined binary / source / documentation bundle</strong>: <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/apache-groovy-sdk-{groovy-full-version}.zip"><strong>Distribution bundle</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about this version in the <a href="https://groovy-lang.org/releasenotes/groovy-{groovy-short-version}.html">release notes</a> or in the <a href="https://groovy-lang.org/changelogs/changelog-{groovy-full-version}.html">changelog</a>.</p>
</div>
<div class="paragraph">
<p>If you plan on using invokedynamic support, <a href="invokedynamic-support.html">read those notes</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_snapshots"><a class="link" href="#_snapshots">1.1.2. Snapshots</a></h4>
<div class="paragraph">
<p>For those who want to test the very latest versions of Groovy and live on the bleeding edge, you can use our <a href="https://repository.apache.org/content/groups/snapshots/org/apache/groovy">snapshot builds</a>.
As soon as a build succeeds on our continuous integration server a snapshot is deployed to this repository.
These snapshots are not official releases and are intended for integration testing by the development
community prior to official versions being released. We welcome any feedback.</p>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites"><a class="link" href="#_prerequisites">1.1.3. Prerequisites</a></h4>
<div class="paragraph">
<p>Groovy {groovy-short-version} requires Java 8+ with support for up to Java 16.</p>
</div>
<div class="paragraph">
<p>Various Groovy CI servers run the test suite (with more than 10000 tests) across numerous versions of Java.
Those servers are also useful to look at to confirm supported Java versions for different Groovy releases.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven_repository"><a class="link" href="#_maven_repository">1.2. Maven Repository</a></h3>
<div class="paragraph">
<p>If you wish to embed Groovy in your application, you may just prefer to point your build
to your favourite maven repository or the Groovy <a href="https://groovy.jfrog.io/artifactory/libs-release-local/">artifactory instance</a>.
Please see the <a href="https://groovy.apache.org/download.html#buildtools">download page</a> for available modules for each Groovy version.</p>
</div>
</div>
<div class="sect2">
<h3 id="SDKMAN"><a class="link" href="#SDKMAN">1.3. SDKMAN! (The Software Development Kit Manager)</a></h3>
<div class="paragraph">
<p>This tool makes installing Groovy on any Bash platform (Mac OSX, Linux, Cygwin, Solaris or FreeBSD) very easy.</p>
</div>
<div class="paragraph">
<p>Simply open a new terminal and enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ curl -s get.sdkman.io | bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the instructions on-screen to complete installation.</p>
</div>
<div class="paragraph">
<p>Open a new terminal or type the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ source &quot;$HOME/.sdkman/bin/sdkman-init.sh&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the latest stable Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ sdk install groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>After installation is complete and you&#8217;ve made it your default version, test it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ groovy -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all there is to it!</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_ways_to_get_groovy"><a class="link" href="#_other_ways_to_get_groovy">1.4. Other ways to get Groovy</a></h3>
<div class="sect3">
<h4 id="_installation_on_mac_os_x"><a class="link" href="#_installation_on_mac_os_x">1.4.1. Installation on Mac OS X</a></h4>
<div class="sect4">
<h5 id="_macports"><a class="link" href="#_macports">1.4.1.1. MacPorts</a></h5>
<div class="paragraph">
<p>If you&#8217;re on macOS and have <a href="https://www.macports.org">MacPorts</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sudo port install groovy</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_homebrew"><a class="link" href="#_homebrew">1.4.1.2. Homebrew</a></h5>
<div class="paragraph">
<p>If you&#8217;re on macOS and have <a href="https://mxcl.github.com/homebrew">Homebrew</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">brew install groovy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installation_on_windows"><a class="link" href="#_installation_on_windows">1.4.2. Installation on Windows</a></h4>
<div class="paragraph">
<p>If you&#8217;re on Windows, you can also use the <a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-windows-installer/">Windows installer</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_distributions"><a class="link" href="#_other_distributions">1.4.3. Other Distributions</a></h4>
<div class="paragraph">
<p>You may download other distributions of Groovy from the ASF
<a href="https://archive.apache.org/dist/groovy/">archive repository</a>
or from the Groovy
<a href="https://groovy.jfrog.io/artifactory/dist-release-local/groovy-zips/">artifactory instance</a> (also includes pre-ASF versions).</p>
</div>
</div>
<div class="sect3">
<h4 id="_source_code"><a class="link" href="#_source_code">1.4.4. Source Code</a></h4>
<div class="paragraph">
<p>If you prefer to live on the bleeding edge, you can also grab the <a href="https://github.com/apache/groovy">source code from GitHub</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ide_plugin"><a class="link" href="#_ide_plugin">1.4.5. IDE plugin</a></h4>
<div class="paragraph">
<p>If you are an IDE user, you can just grab the latest <a href="tools-ide.html">IDE plugin</a> and follow the plugin installation instructions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_binary"><a class="link" href="#_install_binary">1.5. Install Binary</a></h3>
<div class="paragraph">
<p>These instructions describe how to install a binary distribution of <strong>Groovy</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://groovy.apache.org/download.html">Download</a> a binary distribution of Groovy and unpack it into some folder on your local file system.</p>
</li>
<li>
<p>Set your <code>GROOVY_HOME</code> environment variable to the directory where you unpacked the distribution.</p>
</li>
<li>
<p>Add <code>GROOVY_HOME/bin</code> to your <code>PATH</code> environment variable.</p>
</li>
<li>
<p>Set your <code>JAVA_HOME</code> environment variable to point to your JDK. On OS X this is <code>/Library/Java/Home</code>, on other unixes its often <code>/usr/java</code> etc. If you&#8217;ve already installed tools like Ant or Maven you&#8217;ve probably already done this step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should now have Groovy installed properly. You can test this by typing the following in a command shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">groovysh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which should create an interactive groovy shell where you can type Groovy statements. Or to run the <a href="groovy-console.html#title-heading">Swing interactive console</a> type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">groovyConsole</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a specific Groovy script type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">groovy SomeScript</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_与java的不同"><a class="link" href="#_与java的不同">2. 与Java的不同</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Groovy tries to be as natural as possible for Java developers. We’ve
tried to follow the principle of least surprise when designing Groovy,
particularly for developers learning Groovy who’ve come from a Java
background.</p>
</div>
<div class="paragraph">
<p>Here we list all the major differences between Java and Groovy.</p>
</div>
<div class="sect2">
<h3 id="_默认的import"><a class="link" href="#_默认的import">2.1. 默认的import</a></h3>
<div class="paragraph">
<p>All these packages and classes are imported by default, i.e. you do not
have to use an explicit <code>import</code> statement to use them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java.io.*</p>
</li>
<li>
<p>java.lang.*</p>
</li>
<li>
<p>java.math.BigDecimal</p>
</li>
<li>
<p>java.math.BigInteger</p>
</li>
<li>
<p>java.net.*</p>
</li>
<li>
<p>java.util.*</p>
</li>
<li>
<p>groovy.lang.*</p>
</li>
<li>
<p>groovy.util.*</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_multi_methods"><a class="link" href="#_multi_methods">2.2. Multi-methods</a></h3>
<div class="paragraph">
<p>In Groovy, the methods which will be invoked are chosen at runtime. This is called runtime dispatch or multi-methods. It
means that the method will be chosen based on the types of the arguments at runtime. In Java, this is the opposite: methods
are chosen at compile time, based on the declared types.</p>
</div>
<div class="paragraph">
<p>The following code, written as Java code, can be compiled in both Java and Groovy, but it will behave differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#339;font-weight:bold">int</span> method(<span style="color:#0a8;font-weight:bold">String</span> arg) {
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">1</span>;
}
<span style="color:#339;font-weight:bold">int</span> method(<span style="color:#0a8;font-weight:bold">Object</span> arg) {
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">2</span>;
}
<span style="color:#0a8;font-weight:bold">Object</span> o = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Object</span><span style="color:#710">&quot;</span></span>;
<span style="color:#339;font-weight:bold">int</span> result = method(o);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, you would have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">assertEquals(<span style="color:#00D">2</span>, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">assertEquals(<span style="color:#00D">1</span>, result);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is because Java will use the static information type, which is that <code>o</code> is declared as an <code>Object</code>, whereas
Groovy will choose at runtime, when the method is actually called. Since it is called with a <code>String</code>, then the
<code>String</code> version is called.</p>
</div>
</div>
<div class="sect2">
<h3 id="_数值的初始化"><a class="link" href="#_数值的初始化">2.3. 数值的初始化</a></h3>
<div class="paragraph">
<p>In Java, array initializers take either of these two forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> array = {<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>};             <span style="color:#777">// Java array initializer shorthand syntax</span>
<span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> array2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> {<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>};  <span style="color:#777">// Java array initializer long syntax</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Groovy, the <code>{ &#8230;&#8203; }</code> block is reserved for closures.
That means that you cannot create array literals using Java&#8217;s array initializer shorthand syntax.
You instead borrow Groovy&#8217;s literal list notation like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> array = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Groovy 3+, you can optionally use the Java&#8217;s array initializer long syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> array2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> {<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>} <span style="color:#777">// Groovy 3.0+ supports the Java-style array initialization long syntax</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_包作用域可见性"><a class="link" href="#_包作用域可见性">2.4. 包作用域可见性</a></h3>
<div class="paragraph">
<p>In Groovy, omitting a modifier on a field doesn&#8217;t result in a package-private field like in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, it is used to create a <em>property</em>, that is to say a <em>private field</em>, an associated <em>getter</em> and an associated
<em>setter</em>.</p>
</div>
<div class="paragraph">
<p>It is possible to create a package-private field by annotating it with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#007">@PackageScope</span> <span style="color:#0a8;font-weight:bold">String</span> name
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_try_with_resources"><a class="link" href="#_try_with_resources">2.5. try-with-resources</a></h3>
<div class="paragraph">
<p>Java 7 introduced ARM (Automatic Resource Management) blocks (also know as try-with-resources) blocks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Path file = Paths.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/path/to/file</span><span style="color:#710">&quot;</span></span>);
<span style="color:#0a8;font-weight:bold">Charset</span> charset = <span style="color:#0a8;font-weight:bold">Charset</span>.forName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">UTF-8</span><span style="color:#710">&quot;</span></span>);
<span style="color:#080;font-weight:bold">try</span> (<span style="color:#0a8;font-weight:bold">BufferedReader</span> reader = Files.newBufferedReader(file, charset)) {
    <span style="color:#0a8;font-weight:bold">String</span> line;
    <span style="color:#080;font-weight:bold">while</span> ((line = reader.readLine()) != <span style="color:#069">null</span>) {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(line);
    }

} <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">IOException</span> e) {
    e.printStackTrace();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such blocks are supported from Groovy 3+.
However, Groovy provides various methods relying on closures, which have the same effect while being more idiomatic. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/path/to/file</span><span style="color:#710">'</span></span>).eachLine(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">UTF-8</span><span style="color:#710">'</span></span>) {
   println <span style="color:#950">it</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if you want a version closer to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/path/to/file</span><span style="color:#710">'</span></span>).withReader(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">UTF-8</span><span style="color:#710">'</span></span>) { reader -&gt;
   reader.eachLine {
       println <span style="color:#950">it</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_内部类"><a class="link" href="#_内部类">2.6. 内部类</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The implementation of anonymous inner classes and nested classes follow Java closely,
but there are some differences, e.g.
local variables accessed from within such classes don&#8217;t have to be final.
We piggyback on some implementation details we use for <code>groovy.lang.Closure</code>
when generating inner class bytecode.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_静态内部类"><a class="link" href="#_静态内部类">2.6.1. 静态内部类</a></h4>
<div class="paragraph">
<p>Here&#8217;s an example of static inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">B</span> {}
}

<span style="color:#080;font-weight:bold">new</span> A.B()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The usage of static inner classes is the best supported one. If you
absolutely need an inner class, you should make it a static one.</p>
</div>
</div>
<div class="sect3">
<h4 id="_匿名内部类"><a class="link" href="#_匿名内部类">2.6.2. 匿名内部类</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.CountDownLatch</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.TimeUnit</span>

<span style="color:#0a8;font-weight:bold">CountDownLatch</span> called = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">CountDownLatch</span>(<span style="color:#00D">1</span>)

<span style="color:#0a8;font-weight:bold">Timer</span> timer = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Timer</span>()
timer.schedule(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">TimerTask</span>() {
    <span style="color:#339;font-weight:bold">void</span> run() {
        called.countDown()
    }
}, <span style="color:#00D">0</span>)

<span style="color:#080;font-weight:bold">assert</span> called.await(<span style="color:#00D">10</span>, <span style="color:#0a8;font-weight:bold">TimeUnit</span>.SECONDS)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_创建非静态_内部类的实例"><a class="link" href="#_创建非静态_内部类的实例">2.6.3. 创建非静态 内部类的实例</a></h4>
<div class="paragraph">
<p>In Java you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Y</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">X</span> {}
    <span style="color:#088;font-weight:bold">public</span> X foo() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> X();
    }
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> X createX(Y y) {
        <span style="color:#080;font-weight:bold">return</span> y.new X();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before 3.0.0, Groovy doesn&#8217;t support the <code>y.new X()</code> syntax. Instead, you have to write <code>new X(y)</code>, like in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Y</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">X</span> {}
    <span style="color:#088;font-weight:bold">public</span> X foo() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> X()
    }
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> X createX(Y y) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> X(y)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Caution though, Groovy supports calling methods with one
parameter without giving an argument. The parameter will then have the
value null. Basically the same rules apply to calling a constructor.
There is a danger that you will write new X() instead of new X(this) for
example. Since this might also be the regular way we have not yet found
a good way to prevent this problem.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Groovy 3.0.0 supports Java style syntax for creating instances of non-static inner classes.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lambda表达式和方法应用操作符"><a class="link" href="#_lambda表达式和方法应用操作符">2.7. Lambda表达式和方法应用操作符</a></h3>
<div class="paragraph">
<p>Java 8+ supports lambda expressions and the method reference operator (<code>::</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#0a8;font-weight:bold">Runnable</span> run = () -&gt; <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Run</span><span style="color:#710">&quot;</span></span>);  <span style="color:#777">// Java</span>
list.forEach(<span style="color:#0a8;font-weight:bold">System</span>.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy 3 and above also support these within the Parrot parser.
In earlier versions of Groovy you should use closures instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">Runnable</span> run = { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">run</span><span style="color:#710">'</span></span> }
list.each { println <span style="color:#950">it</span> } <span style="color:#777">// or list.each(this.&amp;println)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gstrings"><a class="link" href="#_gstrings">2.8. GStrings</a></h3>
<div class="paragraph">
<p>As double-quoted string literals are interpreted as <code>GString</code> values, Groovy may fail
with compile error or produce subtly different code if a class with <code>String</code> literal
containing a dollar character is compiled with Groovy and Java compiler.</p>
</div>
<div class="paragraph">
<p>While typically, Groovy will auto-cast between <code>GString</code> and <code>String</code> if an API declares
the type of a parameter, beware of Java APIs that accept an <code>Object</code> parameter and then
check the actual type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_字符串和字符字面量"><a class="link" href="#_字符串和字符字面量">2.9. 字符串和字符字面量</a></h3>
<div class="paragraph">
<p>Singly-quoted literals in Groovy are used for <code>String</code>, and double-quoted result in
<code>String</code> or <code>GString</code>, depending whether there is interpolation in the literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>.class == <span style="color:#0a8;font-weight:bold">String</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">c</span><span style="color:#710">&quot;</span></span>.class == <span style="color:#0a8;font-weight:bold">String</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">c</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span><span style="color:#00D">1</span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>.class <span style="color:#080;font-weight:bold">in</span> GString</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy will automatically cast a single-character <code>String</code> to <code>char</code> only when assigning to
a variable of type <code>char</code>. When calling methods with arguments of type <code>char</code> we need
to either cast explicitly or make sure the value has been cast in advance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">char</span> a = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Character</span>.digit(a, <span style="color:#00D">16</span>) == <span style="color:#00D">10</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">But Groovy does boxing</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Character</span>.digit((<span style="color:#339;font-weight:bold">char</span>) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">16</span>) == <span style="color:#00D">10</span>

<span style="color:#080;font-weight:bold">try</span> {
  <span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Character</span>.digit(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">16</span>) == <span style="color:#00D">10</span>
  <span style="color:#080;font-weight:bold">assert</span> <span style="color:#069">false</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Need explicit cast</span><span style="color:#710">'</span></span>
} <span style="color:#080;font-weight:bold">catch</span>(MissingMethodException e) {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports two styles of casting and in the case of casting to <code>char</code> there
are subtle differences when casting a multi-char strings. The Groovy style cast is
more lenient and will take the first character, while the C-style cast will fail
with exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// for single char strings, both are the same</span>
<span style="color:#080;font-weight:bold">assert</span> ((<span style="color:#339;font-weight:bold">char</span>) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">c</span><span style="color:#710">&quot;</span></span>).class == <span style="color:#0a8;font-weight:bold">Character</span>
<span style="color:#080;font-weight:bold">assert</span> (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">c</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>).class == <span style="color:#0a8;font-weight:bold">Character</span>

<span style="color:#777">// for multi char strings they are not</span>
<span style="color:#080;font-weight:bold">try</span> {
  ((<span style="color:#339;font-weight:bold">char</span>) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cx</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">assert</span> <span style="color:#069">false</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">will fail - not castable</span><span style="color:#710">'</span></span>
} <span style="color:#080;font-weight:bold">catch</span>(GroovyCastException e) {
}
<span style="color:#080;font-weight:bold">assert</span> (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cx</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cx</span><span style="color:#710">'</span></span>.asType(<span style="color:#339;font-weight:bold">char</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_的作用"><a class="link" href="#_的作用">2.10. `==`的作用</a></h3>
<div class="paragraph">
<p>In Java, <code>==</code> means equality of primitive types or identity for objects.
In Groovy, <code>==</code> means equality in all places.
For non-primitives, it translates to <code>a.compareTo(b) == 0</code>,
when evaluating equality for <code>Comparable</code> objects,
and <code>a.equals(b)</code> otherwise.</p>
</div>
<div class="paragraph">
<p>To check for identity (reference equality), use the <code>is</code> method: <code>a.is(b)</code>.
From Groovy 3, you can also use the <code>===</code> operator (or negated version): <code>a === b</code> (or <code>c !== d</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_基础类型和包装类"><a class="link" href="#_基础类型和包装类">2.11. 基础类型和包装类</a></h3>
<div class="paragraph">
<p>In a pure object-oriented language, everything would be an object.
Java takes the stance that primitive types, such as int, boolean and double,
are used very frequently and worthy of special treatment.
Primitives can be efficiently stored and manipulated but can&#8217;t be used in all contexts where an object could be used.
Luckily, Java auto boxes and unboxes primitives when they are passed as parameters or used as return types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {           <span style="color:#777">// Java</span>

   <span style="color:#339;font-weight:bold">float</span> f1 = <span style="color:#60E">1.0f</span>;
   <span style="color:#0a8;font-weight:bold">Float</span> f2 = <span style="color:#60E">2.0f</span>;

   <span style="color:#339;font-weight:bold">float</span> add(<span style="color:#0a8;font-weight:bold">Float</span> a1, <span style="color:#339;font-weight:bold">float</span> a2) { <span style="color:#080;font-weight:bold">return</span> a1 + a2; }

   <span style="color:#0a8;font-weight:bold">Float</span> calc() { <span style="color:#080;font-weight:bold">return</span> add(f1, f2); } // <b class="conum">(1)</b>

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
       <span style="color:#0a8;font-weight:bold">Float</span> calcResult = <span style="color:#080;font-weight:bold">new</span> Main().calc();
       <span style="color:#0a8;font-weight:bold">System</span>.out.println(calcResult); <span style="color:#777">// =&gt; 3.0</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>add</code> method expects wrapper then primitive type arguments,
but we are supplying parameters with a primitive then wrapper type.
Similarly, the return type from <code>add</code> is primitive, but we need the wrapper type.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Groovy does the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {

    <span style="color:#339;font-weight:bold">float</span> f1 = <span style="color:#60E">1.0f</span>
    <span style="color:#0a8;font-weight:bold">Float</span> f2 = <span style="color:#60E">2.0f</span>

    <span style="color:#339;font-weight:bold">float</span> add(<span style="color:#0a8;font-weight:bold">Float</span> a1, <span style="color:#339;font-weight:bold">float</span> a2) { a1 + a2 }

    <span style="color:#0a8;font-weight:bold">Float</span> calc() { add(f1, f2) }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Main().calc() == <span style="color:#60E">3.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy, also supports primitives and object types, however, it goes a little further
in pushing OO purity; it tries hard to treat <em>everything</em> as an object.
Any primitive typed variable or field can be treated like an object, and it
will be <a href="core-object-orientation.html#_primitive_types">auto-wrapped</a> as needed.
While primitive types might be used under the covers,
their use should be indistinguishable from normal object use whenever possible,
and they will be boxed/unboxed as needed.</p>
</div>
<div class="paragraph">
<p>Here is a little example using Java trying to (incorrectly for Java) dereference a primitive <code>float</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {           <span style="color:#777">// Java</span>

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">float</span> z1 = <span style="color:#60E">0.0f</span>;

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args){
      <span style="color:#080;font-weight:bold">new</span> Main().z1.equals(<span style="color:#60E">1.0f</span>); <span style="color:#777">// DOESN'T COMPILE, error: float cannot be dereferenced</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same example using Groovy compiles and runs successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#339;font-weight:bold">float</span> z1 = <span style="color:#60E">0.0f</span>
}
<span style="color:#080;font-weight:bold">assert</span> !(<span style="color:#080;font-weight:bold">new</span> Main().z1.equals(<span style="color:#60E">1.0f</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because of Groovy&#8217;s additional use of un/boxing, it does not follow
Java&#8217;s behavior of widening taking priority over boxing.
Here&#8217;s an example using <code>int</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">int</span> i
m(i)

<span style="color:#339;font-weight:bold">void</span> m(<span style="color:#339;font-weight:bold">long</span> l) {           //<b class="conum">(1)</b>
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">in m(long)</span><span style="color:#710">&quot;</span></span>
}

<span style="color:#339;font-weight:bold">void</span> m(<span style="color:#0a8;font-weight:bold">Integer</span> i) {        //<b class="conum">(2)</b>
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">in m(Integer)</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This is the method that Java would call, since widening has precedence over unboxing.</p>
</li>
<li>
<p>This is the method Groovy actually calls, since all primitive references use their wrapper class.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="primitive-optimisation-numbers"><a class="link" href="#primitive-optimisation-numbers">2.11.1. Numeric Primitive Optimisation with <code>@CompileStatic</code></a></h4>
<div class="paragraph">
<p>Since Groovy converts to wrapper classes in more places, you might wonder
whether it produces less efficient bytecode for numeric expressions.
Groovy has a highly optimised set of classes for doing math computations.
When using <code>@CompileStatic</code>, expressions involving only primitives
uses the same bytecode that Java would use.</p>
</div>
</div>
<div class="sect3">
<h4 id="zero-edge-case"><a class="link" href="#zero-edge-case">2.11.2. Positive/Negative zero edge case</a></h4>
<div class="paragraph">
<p>Java float/double operations for both primitives and wrapper classes follow the IEEE 754 standard
but there is an interesting edge case involving positive and negative zero.
The standard supports distinguishing between these two cases and while in many scenarios
programmers may not care about the difference, in some mathematical or data science scenarios
it is important to cater for the distinction.</p>
</div>
<div class="paragraph">
<p>For primitives, Java maps down onto a special
<a href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.dcmp_op">bytecode instruction</a>
when comparing such values which has the property that
"Positive zero and negative zero are considered equal".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">jshell&gt; float f1 = <span style="color:#60E">0.0</span>f
f1 ==&gt; <span style="color:#60E">0.0</span>

jshell&gt; float f2 = <span style="color:#60E">-0.0</span>f
f2 ==&gt; <span style="color:#60E">-0.0</span>

jshell&gt; f1 == f2
<span style="color:#d70">$3</span> ==&gt; <span style="color:#069">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the wrapper classes, e.g. jdk:java.base/java.lang.Float#equals(java.lang.Object)[Float#equals],
the result is <code>false</code> for this same case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">jshell&gt; <span style="color:#036;font-weight:bold">Float</span> f1 = <span style="color:#60E">0.0</span>f
f1 ==&gt; <span style="color:#60E">0.0</span>

jshell&gt; <span style="color:#036;font-weight:bold">Float</span> f2 = <span style="color:#60E">-0.0</span>f
f2 ==&gt; <span style="color:#60E">-0.0</span>

jshell&gt; f1.equals(f2)
<span style="color:#d70">$3</span> ==&gt; <span style="color:#069">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy on the one hand tries to follow Java behavior closely, but on the other
switches automatically between primitives and wrapped equivalents in more places.
To avoid confusion we recommend the following guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you wish to distinguish between positive and negative zero, use the <code>equals</code>
method directly or cast any primitives to their wrapper equivalent before using <code>==</code>.</p>
</li>
<li>
<p>If you wish to ignore the difference between positive and negative zero, use the <code>equalsIgnoreZeroSign</code>
method directly or cast any non-primitives to their primitive equivalent before using <code>==</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These guidelines are illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">float</span> f1 = <span style="color:#60E">0.0f</span>
<span style="color:#339;font-weight:bold">float</span> f2 = -<span style="color:#60E">0.0f</span>
<span style="color:#0a8;font-weight:bold">Float</span> f3 = <span style="color:#60E">0.0f</span>
<span style="color:#0a8;font-weight:bold">Float</span> f4 = -<span style="color:#60E">0.0f</span>

<span style="color:#080;font-weight:bold">assert</span> f1 == f2
<span style="color:#080;font-weight:bold">assert</span> (<span style="color:#0a8;font-weight:bold">Float</span>) f1 != (<span style="color:#0a8;font-weight:bold">Float</span>) f2

<span style="color:#080;font-weight:bold">assert</span> f3 != f4         //<b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">assert</span> (<span style="color:#339;font-weight:bold">float</span>) f3 == (<span style="color:#339;font-weight:bold">float</span>) f4

<span style="color:#080;font-weight:bold">assert</span> !f1.equals(f2)
<span style="color:#080;font-weight:bold">assert</span> !f3.equals(f4)

<span style="color:#080;font-weight:bold">assert</span> f1.equalsIgnoreZeroSign(f2)
<span style="color:#080;font-weight:bold">assert</span> f3.equalsIgnoreZeroSign(f4)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Recall that for non-primitives, <code>==</code> maps to <code>.equals()</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conversions"><a class="link" href="#_conversions">2.12. Conversions</a></h3>
<div class="paragraph">
<p>Java does automatic widening and narrowing
<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html">conversions</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Java Conversions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="8"><div class="content"><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>boolean</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>byte</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>short</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>char</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>int</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>long</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>float</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong>double</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>'Y' indicates a conversion Java can make<br></p>
</li>
<li>
<p>'C' indicates a conversion Java can make when there is an explicit cast<br></p>
</li>
<li>
<p>'T` indicates a conversion Java can make but data is truncated<br></p>
</li>
<li>
<p>'N' indicates a conversion Java can&#8217;t make</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy expands greatly on this.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Groovy Conversions</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="18"><div class="content"><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">boolean</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Boolean</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">byte</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Byte</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">short</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Short</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">char</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Character</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">int</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Integer</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">long</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Long</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">BigInteger</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">float</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Float</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">double</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">Double</code></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><code class="rotate">BigDecimal</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>boolean</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Boolean</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>byte</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Byte</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>short</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Short</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>char</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Character</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>int</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Integer</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>long</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Long</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>BigInteger</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>float</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Float</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>double</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>Double</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong><code>BigDecimal</code></strong></p></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>'Y' indicates a conversion Groovy can make<br></p>
</li>
<li>
<p>'D' indicates a conversion Groovy can make when compiled dynamically or explicitly cast<br></p>
</li>
<li>
<p>'T' indicates a conversion Groovy can make but data is truncated<br></p>
</li>
<li>
<p>'B' indicates a boxing/unboxing operation<br></p>
</li>
<li>
<p>'N' indicates a conversion Groovy can&#8217;t make.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The truncation uses <a href="core-semantics.html#the-groovy-truth">Groovy Truth</a> when converting to <code>boolean</code>/<code>Boolean</code>. Converting
from a number to a character casts the <code>Number.intvalue()</code> to <code>char</code>. Groovy constructs <code>BigInteger</code> and <code>BigDecimal</code>
using <code>Number.doubleValue()</code> when converting from a <code>Float</code> or <code>Double</code>, otherwise it constructs using <code>toString()</code>.
Other conversions have their behavior defined by <code>java.lang.Number</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_额外的关键字"><a class="link" href="#_额外的关键字">2.13. 额外的关键字</a></h3>
<div class="paragraph">
<p>Groovy has many of the same keywords as Java and Groovy 3 and above also has the same <code>var</code> reserved type as Java.
In addition, Groovy has the following keywords:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>as</code></p>
</li>
<li>
<p><code>def</code></p>
</li>
<li>
<p><code>in</code></p>
</li>
<li>
<p><code>trait</code></p>
</li>
<li>
<p><code>it</code> // within closures</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy is less stringent than Java in that it allows some keywords to appear in places that would be illegal in Java,
e.g. the following is valid: <code>var var = [def: 1, as: 2, in: 3, trait: 4]</code>.
Never-the-less, you are discouraged from using the above keywords in places that might cause confusion even when
the compiler might be happy. In particular, avoid using them for variable, method and class names,
so our previous <code>var var</code> example would be considered poor style.</p>
</div>
<div class="paragraph">
<p>Additional documentation is available for <a href="core-syntax.html#_keywords">keywords</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_development_kit"><a class="link" href="#_groovy_development_kit">3. Groovy Development Kit</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_working_with_io"><a class="link" href="#_working_with_io">3.1. Working with IO</a></h3>
<div class="paragraph">
<p>Groovy provides a number of
<a href="gdk.html">helper methods</a> for working
with I/O. While you could use standard Java code in Groovy to deal with those,
Groovy provides much more convenient ways to handle files, streams, readers, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>In particular, you should take a look at methods added to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>java.io.File</code> class : <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html</a></p>
</li>
<li>
<p>the <code>java.io.InputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.OutputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.Reader</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html</a></p>
</li>
<li>
<p>the <code>java.io.Writer</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html</a></p>
</li>
<li>
<p>the <code>java.nio.file.Path</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section focuses on sample idiomatic constructs using helper methods available above but is not meant
to be a complete description of all available methods. For that, please read the <a href="gdk.html">GDK API</a>.</p>
</div>
<div class="sect3">
<h4 id="_reading_files"><a class="link" href="#_reading_files">3.1.1. Reading files</a></h4>
<div class="paragraph">
<p>As a first example, let&#8217;s see how you would print all lines of a text file in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).eachLine { line -&gt;
    println line
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>eachLine</code> method is a method added to the <code>File</code> class automatically by Groovy and has many variants, for example
if you need to know the line number, you can use this variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).eachLine { line, nb -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Line </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>nb</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>line</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If for whatever reason an exception is thrown in the <code>eachLine</code> body, the method makes sure that the resource
is properly closed. This is true for all I/O resource methods that Groovy adds.</p>
</div>
<div class="paragraph">
<p>For example in some cases you will prefer to use a <code>Reader</code>, but still benefit from the automatic resource management
from Groovy. In the next example, the reader <strong>will</strong> be closed even if the exception occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> count = <span style="color:#00D">0</span>, MAXSIZE = <span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">haiku.txt</span><span style="color:#710">&quot;</span></span>).withReader { reader -&gt;
    <span style="color:#080;font-weight:bold">while</span> (reader.readLine()) {
        <span style="color:#080;font-weight:bold">if</span> (++count &gt; MAXSIZE) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Haiku should only have 3 verses</span><span style="color:#710">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need to collect the lines of a text file into a list, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).collect {<span style="color:#950">it</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can even leverage the <code>as</code> operator to get the contents of the file into an array of lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> array = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How many times did you have to get the contents of a file into a <code>byte[]</code> and how much code does it require? Groovy
makes it very easy actually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">byte</span><span style="color:#339;font-weight:bold">[]</span> contents = file.bytes</code></pre>
</div>
</div>
<div class="paragraph">
<p>Working with I/O is not limited to dealing with files. In fact, a lot of operations rely on input/output streams,
hence why Groovy adds a lot of support methods to those, as you can see in the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html">documentation</a>.</p>
</div>
<div class="paragraph">
<p>As an example, you can obtain an <code>InputStream</code> from a <code>File</code> very easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> is = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).newInputStream()
<span style="color:#777">// do something ...</span>
is.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the inputstream. In Groovy it is in general a better
idea to use the <code>withInputStream</code> idiom that will take care of that for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).withInputStream { stream -&gt;
    <span style="color:#777">// do something ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writing_files"><a class="link" href="#_writing_files">3.1.2. Writing files</a></h4>
<div class="paragraph">
<p>Of course in some cases you won&#8217;t want to read but write a file. One of the options is to use a <code>Writer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>).withWriter(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">utf-8</span><span style="color:#710">'</span></span>) { writer -&gt;
    writer.writeLine <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Into the ancient pond</span><span style="color:#710">'</span></span>
    writer.writeLine <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">A frog jumps</span><span style="color:#710">'</span></span>
    writer.writeLine <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Water’s sound!</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But for such a simple example, using the <code>&lt;&lt;</code> operator would have been enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haiku.txt</span><span style="color:#710">'</span></span>) &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">Into the ancient pond
A frog jumps
Water’s sound!</span><span style="color:#710">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we do not always deal with text contents, so you could use the <code>Writer</code> or directly write bytes as in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">file.bytes = [<span style="color:#00D">66</span>,<span style="color:#00D">22</span>,<span style="color:#00D">11</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also directly deal with output streams. For example, here is how you would create an output
stream to write into a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> os = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">data.bin</span><span style="color:#710">'</span></span>).newOutputStream()
<span style="color:#777">// do something ...</span>
os.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the output stream. Again it is in general a better
idea to use the <code>withOutputStream</code> idiom that will handle the exceptions and close the stream in any case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(baseDir,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">data.bin</span><span style="color:#710">'</span></span>).withOutputStream { stream -&gt;
    <span style="color:#777">// do something ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_traversing_file_trees"><a class="link" href="#_traversing_file_trees">3.1.3. Traversing file trees</a></h4>
<div class="paragraph">
<p>In scripting contexts it is a common task to traverse a file tree in order to find some specific files and do
something with them. Groovy provides multiple methods to do this. For example you can perform something on all files
of a directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dir.eachFile { file -&gt;                      // <b class="conum">(1)</b>
    println file.name
}
dir.eachFileMatch(~<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">.*</span><span style="color:#808">\.</span><span style="color:#808">txt</span><span style="color:#404">/</span></span>) { file -&gt;     // <b class="conum">(2)</b>
    println file.name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>executes the closure code on each file found in the directory</p>
</li>
<li>
<p>executes the closure code on files in the directory matching the specified pattern</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Often you will have to deal with a deeper hierarchy of files, in which case you can use <code>eachFileRecurse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dir.eachFileRecurse { file -&gt;                      // <b class="conum">(1)</b>
    println file.name
}

dir.eachFileRecurse(FileType.FILES) { file -&gt;      // <b class="conum">(2)</b>
    println file.name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>executes the closure code on each file or directory found in the directory, recursively</p>
</li>
<li>
<p>executes the closure code only on files, but recursively</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more complex traversal techniques you can use the <code>traverse</code> method, which requires you to set a special flag
indicating what to do with the traversal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dir.traverse { file -&gt;
    <span style="color:#080;font-weight:bold">if</span> (file.directory &amp;&amp; file.name==<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bin</span><span style="color:#710">'</span></span>) {
        FileVisitResult.TERMINATE                   // <b class="conum">(1)</b>
    } <span style="color:#080;font-weight:bold">else</span> {
        println file.name
        FileVisitResult.CONTINUE                    // <b class="conum">(2)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>if the current file is a directory and its name is <code>bin</code>, stop the traversal</p>
</li>
<li>
<p>otherwise print the file name and continue</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_data_and_objects"><a class="link" href="#_data_and_objects">3.1.4. Data and objects</a></h4>
<div class="paragraph">
<p>In Java it is not uncommon to serialize and deserialize data using the <code>java.io.DataOutputStream</code> and
<code>java.io.DataInputStream</code> classes respectively. Groovy will make it even easier to deal with them. For example, you could
serialize data into a file and deserialize it using this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">boolean</span> b = <span style="color:#069">true</span>
<span style="color:#0a8;font-weight:bold">String</span> message = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello from Groovy</span><span style="color:#710">'</span></span>
<span style="color:#777">// Serialize data into a file</span>
file.withDataOutputStream { out -&gt;
    out.writeBoolean(b)
    out.writeUTF(message)
}
<span style="color:#777">// ...</span>
<span style="color:#777">// Then read it back</span>
file.withDataInputStream { input -&gt;
    <span style="color:#080;font-weight:bold">assert</span> input.readBoolean() == b
    <span style="color:#080;font-weight:bold">assert</span> input.readUTF() == message
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And similarly, if the data you want to serialize implements the <code>Serializable</code> interface, you can proceed with
an object output stream, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>:<span style="color:#00D">76</span>)
<span style="color:#777">// Serialize data into a file</span>
file.withObjectOutputStream { out -&gt;
    out.writeObject(p)
}
<span style="color:#777">// ...</span>
<span style="color:#777">// Then read it back</span>
file.withObjectInputStream { input -&gt;
    <span style="color:#080;font-weight:bold">def</span> p2 = input.readObject()
    <span style="color:#080;font-weight:bold">assert</span> p2.name == p.name
    <span style="color:#080;font-weight:bold">assert</span> p2.age == p.age
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="process-management"><a class="link" href="#process-management">3.1.5. Executing External Processes</a></h4>
<div class="paragraph">
<p>The previous section described how easy it was to deal with files, readers or streams in Groovy. However in domains
like system administration or devops it is often required to communicate with external processes.</p>
</div>
<div class="paragraph">
<p>Groovy provides a simple way to execute command line processes. Simply
write the command line as a string and call the <code>execute()</code> method.
E.g., on a *nix machine (or a Windows machine with appropriate *nix
commands installed), you can execute this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> process = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls -l</span><span style="color:#710">&quot;</span></span>.execute()             // <b class="conum">(1)</b>
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Found text </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>process.text<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>        // <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>executes the <code>ls</code> command in an external process</p>
</li>
<li>
<p>consume the output of the command and retrieve the text</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>execute()</code> method returns a <code>java.lang.Process</code> instance which will
subsequently allow the in/out/err streams to be processed and the exit
value from the process to be inspected etc.</p>
</div>
<div class="paragraph">
<p>e.g. here is the same command as above but we will now process the
resulting stream a line at a time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> process = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls -l</span><span style="color:#710">&quot;</span></span>.execute()             // <b class="conum">(1)</b>
process.in.eachLine { line -&gt;               // <b class="conum">(2)</b>
    println line                            // <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>executes the <code>ls</code> command in an external process</p>
</li>
<li>
<p>for each line of the input stream of the process</p>
</li>
<li>
<p>print the line</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is worth noting that <code>in</code> corresponds to an input stream to the standard output of the command. <code>out</code> will refer
to a stream where you can send data to the process (its standard input).</p>
</div>
<div class="paragraph">
<p>Remember that many commands are shell built-ins and need special
handling. So if you want a listing of files in a directory on a Windows
machine and write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> process = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">dir</span><span style="color:#710">&quot;</span></span>.execute()
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>process.text<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you will receive an <code>IOException</code> saying  <em>Cannot run program "dir":
CreateProcess error=2, The system cannot find the file specified.</em></p>
</div>
<div class="paragraph">
<p>This is because <code>dir</code> is built-in to the Windows shell (<code>cmd.exe</code>) and
can’t be run as a simple executable. Instead, you will need to write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> process = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd /c dir</span><span style="color:#710">&quot;</span></span>.execute()
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>process.text<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, because this functionality currently makes use of
<code>java.lang.Process</code> undercover, the deficiencies of that class
must be taken into consideration. In particular, the javadoc
for this class says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Because some native platforms only provide limited buffer size for
standard input and output streams, failure to promptly write the input
stream or read the output stream of the subprocess may cause the
subprocess to block, and even deadlock</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Because of this, Groovy provides some additional helper methods which
make stream handling for processes easier.</p>
</div>
<div class="paragraph">
<p>Here is how to gobble all of the output (including the error stream
output) from your process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> p = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rm -f foo.tmp</span><span style="color:#710">&quot;</span></span>.execute(<span style="color:#339;font-weight:bold">[]</span>, tmpDir)
p.consumeProcessOutput()
p.waitFor()</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also variations of <code>consumeProcessOutput</code> that make use of <code>StringBuffer</code>, <code>InputStream</code>,
<code>OutputStream</code> etc&#8230;&#8203; For a complete list, please read the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Process.html">GDK API for java.lang.Process</a></p>
</div>
<div class="paragraph">
<p>In addition, there is a <code>pipeTo</code> command (mapped to <code>|</code>
to allow overloading) which lets the output stream of one process be fed
into the input stream of another process.</p>
</div>
<div class="paragraph">
<p>Here are some examples of use:</p>
</div>
<div class="listingblock">
<div class="title">Pipes in action</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">proc1 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ls</span><span style="color:#710">'</span></span>.execute()
proc2 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d o</span><span style="color:#710">'</span></span>.execute()
proc3 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d e</span><span style="color:#710">'</span></span>.execute()
proc4 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d i</span><span style="color:#710">'</span></span>.execute()
proc1 | proc2 | proc3 | proc4
proc4.waitFor()
<span style="color:#080;font-weight:bold">if</span> (proc4.exitValue()) {
    println proc4.err.text
} <span style="color:#080;font-weight:bold">else</span> {
    println proc4.text
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Consuming errors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> sout = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()
<span style="color:#080;font-weight:bold">def</span> serr = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()
proc2 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d o</span><span style="color:#710">'</span></span>.execute()
proc3 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d e</span><span style="color:#710">'</span></span>.execute()
proc4 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tr -d i</span><span style="color:#710">'</span></span>.execute()
proc4.consumeProcessOutput(sout, serr)
proc2 | proc3 | proc4
[proc2, proc3].each { <span style="color:#950">it</span>.consumeProcessErrorStream(serr) }
proc2.withWriter { writer -&gt;
    writer &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">testfile.groovy</span><span style="color:#710">'</span></span>
}
proc4.waitForOrKill(<span style="color:#00D">1000</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Standard output: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>sout</span><span style="color:#710">&quot;</span></span>
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Standard error: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>serr</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_collections"><a class="link" href="#_working_with_collections">3.2. Working with collections</a></h3>
<div class="paragraph">
<p>Groovy provides native support for various collection types, including <a href="#Collections-Lists">lists</a>,
<a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>. Most of those are based on the Java
collection types and decorated with additional methods found in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>.</p>
</div>
<div class="sect3">
<h4 id="Collections-Lists"><a class="link" href="#Collections-Lists">3.2.1. Lists</a></h4>
<div class="sect4">
<h5 id="_list_literals"><a class="link" href="#_list_literals">3.2.1.1. List literals</a></h5>
<div class="paragraph">
<p>You can create lists as follows. Notice that <code>[]</code> is the empty list
expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">8</span>]
<span style="color:#080;font-weight:bold">assert</span> list.get(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> list[<span style="color:#00D">2</span>] == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> list <span style="color:#080;font-weight:bold">instanceof</span> java.util.List

<span style="color:#080;font-weight:bold">def</span> emptyList = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#080;font-weight:bold">assert</span> emptyList.size() == <span style="color:#00D">0</span>
emptyList.add(<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">assert</span> emptyList.size() == <span style="color:#00D">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each list expression creates an implementation of <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Of course lists can be used as a source to construct another list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list1 = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]
<span style="color:#777">//construct a new list, seeded with the same items as in list1</span>
<span style="color:#080;font-weight:bold">def</span> list2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt;(list1)

<span style="color:#080;font-weight:bold">assert</span> list2 == list1 <span style="color:#777">// == checks that each corresponding element is the same</span>

<span style="color:#777">// clone() can also be called</span>
<span style="color:#080;font-weight:bold">def</span> list3 = list1.clone()
<span style="color:#080;font-weight:bold">assert</span> list3 == list1</code></pre>
</div>
</div>
<div class="paragraph">
<p>A list is an ordered collection of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">8</span>]
<span style="color:#080;font-weight:bold">assert</span> list.size() == <span style="color:#00D">4</span>
<span style="color:#080;font-weight:bold">assert</span> list.getClass() == <span style="color:#0a8;font-weight:bold">ArrayList</span>     <span style="color:#777">// the specific kind of list being used</span>

<span style="color:#080;font-weight:bold">assert</span> list[<span style="color:#00D">2</span>] == <span style="color:#00D">7</span>                     <span style="color:#777">// indexing starts at 0</span>
<span style="color:#080;font-weight:bold">assert</span> list.getAt(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>               <span style="color:#777">// equivalent method to subscript operator []</span>
<span style="color:#080;font-weight:bold">assert</span> list.get(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>                 <span style="color:#777">// alternative method</span>

list[<span style="color:#00D">2</span>] = <span style="color:#00D">9</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">9</span>, <span style="color:#00D">8</span>,]           <span style="color:#777">// trailing comma OK</span>

list.putAt(<span style="color:#00D">2</span>, <span style="color:#00D">10</span>)                       <span style="color:#777">// equivalent method to [] when value being changed</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">10</span>, <span style="color:#00D">8</span>]
<span style="color:#080;font-weight:bold">assert</span> list.set(<span style="color:#00D">2</span>, <span style="color:#00D">11</span>) == <span style="color:#00D">10</span>            <span style="color:#777">// alternative method that returns old value</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">11</span>, <span style="color:#00D">8</span>]

<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">1</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#60E">2.5</span>, <span style="color:#60E">2.5f</span>, <span style="color:#60E">2.5d</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hello</span><span style="color:#710">'</span></span>, <span style="color:#00D">7g</span>, <span style="color:#069">null</span>, <span style="color:#00D">9</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">byte</span>]
<span style="color:#777">//objects can be of different types; duplicates allowed</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>][-<span style="color:#00D">1</span>] == <span style="color:#00D">5</span>             <span style="color:#777">// use negative indices to count from the end</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>][-<span style="color:#00D">2</span>] == <span style="color:#00D">4</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>].getAt(-<span style="color:#00D">2</span>) == <span style="color:#00D">4</span>       <span style="color:#777">// getAt() available with negative index...</span>
<span style="color:#080;font-weight:bold">try</span> {
    [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>].get(-<span style="color:#00D">2</span>)                 <span style="color:#777">// but negative index not allowed with get()</span>
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#069">false</span>
} <span style="color:#080;font-weight:bold">catch</span> (e) {
    <span style="color:#080;font-weight:bold">assert</span> e <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#C00;font-weight:bold">IndexOutOfBoundsException</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_list_as_a_boolean_expression"><a class="link" href="#_list_as_a_boolean_expression">3.2.1.2. List as a boolean expression</a></h5>
<div class="paragraph">
<p>Lists can be evaluated as a <code>boolean</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> !<span style="color:#339;font-weight:bold">[]</span>             <span style="color:#777">// an empty list evaluates as false</span>

<span style="color:#777">//all other lists, irrespective of contents, evaluate as true</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>] &amp;&amp; [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>] &amp;&amp; [<span style="color:#00D">0</span>] &amp;&amp; [<span style="color:#60E">0.0</span>] &amp;&amp; [<span style="color:#069">false</span>] &amp;&amp; [<span style="color:#069">null</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterating_on_a_list"><a class="link" href="#_iterating_on_a_list">3.2.1.3. Iterating on a list</a></h5>
<div class="paragraph">
<p>Iterating on elements of a list is usually done calling the <code>each</code> and <code>eachWithIndex</code> methods, which execute code on each
item of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].each {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Item: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#950">it</span></span><span style="color:#710">&quot;</span></span> <span style="color:#777">// `it` is an implicit parameter corresponding to the current element</span>
}
[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>].eachWithIndex { <span style="color:#950">it</span>, i -&gt; <span style="color:#777">// `it` is the current element, while `i` is the index</span>
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>i</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#950">it</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to iterating, it is often useful to create a new list by transforming each of its elements into
something else. This operation, often called mapping, is done in Groovy thanks to the <code>collect</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].collect { <span style="color:#950">it</span> * <span style="color:#00D">2</span> } == [<span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>]

<span style="color:#777">// shortcut syntax instead of collect</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]*.multiply(<span style="color:#00D">2</span>) == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].collect { <span style="color:#950">it</span>.multiply(<span style="color:#00D">2</span>) }

<span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">0</span>]
<span style="color:#777">// it is possible to give `collect` the list which collects the elements</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].collect(list) { <span style="color:#950">it</span> * <span style="color:#00D">2</span> } == [<span style="color:#00D">0</span>, <span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>]
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">0</span>, <span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_manipulating_lists"><a class="link" href="#_manipulating_lists">3.2.1.4. Manipulating lists</a></h5>
<div class="sect5">
<h6 id="List-Filtering"><a class="link" href="#List-Filtering">Filtering and searching</a></h6>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains a lot of methods on collections that enhance
the standard collections with pragmatic methods, some of which are illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].find { <span style="color:#950">it</span> &gt; <span style="color:#00D">1</span> } == <span style="color:#00D">2</span>           <span style="color:#777">// find 1st element matching criteria</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].findAll { <span style="color:#950">it</span> &gt; <span style="color:#00D">1</span> } == [<span style="color:#00D">2</span>, <span style="color:#00D">3</span>]   <span style="color:#777">// find all elements matching critieria</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>].findIndexOf {      <span style="color:#777">// find index of 1st element matching criteria</span>
    <span style="color:#950">it</span> <span style="color:#080;font-weight:bold">in</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">g</span><span style="color:#710">'</span></span>]
} == <span style="color:#00D">2</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>].indexOf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>) == <span style="color:#00D">2</span>  <span style="color:#777">// index returned</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>].indexOf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>) == -<span style="color:#00D">1</span> <span style="color:#777">// index -1 means value not in list</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>].lastIndexOf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>) == <span style="color:#00D">4</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].every { <span style="color:#950">it</span> &lt; <span style="color:#00D">5</span> }               <span style="color:#777">// returns true if all elements match the predicate</span>
<span style="color:#080;font-weight:bold">assert</span> ![<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].every { <span style="color:#950">it</span> &lt; <span style="color:#00D">3</span> }
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].any { <span style="color:#950">it</span> &gt; <span style="color:#00D">2</span> }                 <span style="color:#777">// returns true if any element matches the predicate</span>
<span style="color:#080;font-weight:bold">assert</span> ![<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].any { <span style="color:#950">it</span> &gt; <span style="color:#00D">3</span> }

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>].sum() == <span style="color:#00D">21</span>                <span style="color:#777">// sum anything with a plus() method</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>].sum {
    <span style="color:#950">it</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span> ? <span style="color:#00D">1</span> : <span style="color:#950">it</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span> ? <span style="color:#00D">2</span> : <span style="color:#950">it</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span> ? <span style="color:#00D">3</span> : <span style="color:#950">it</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span> ? <span style="color:#00D">4</span> : <span style="color:#950">it</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span> ? <span style="color:#00D">5</span> : <span style="color:#00D">0</span>
    <span style="color:#777">// custom value to use in sum</span>
} == <span style="color:#00D">15</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>].sum { ((<span style="color:#339;font-weight:bold">char</span>) <span style="color:#950">it</span>) - ((<span style="color:#339;font-weight:bold">char</span>) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>) } == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>].sum() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abcde</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>]].sum() == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>]

<span style="color:#777">// an initial value can be provided</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#339;font-weight:bold">[]</span>.sum(<span style="color:#00D">1000</span>) == <span style="color:#00D">1000</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].sum(<span style="color:#00D">1000</span>) == <span style="color:#00D">1006</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1-2-3</span><span style="color:#710">'</span></span>           <span style="color:#777">// String joining</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].inject(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">counting: </span><span style="color:#710">'</span></span>) {
    str, item -&gt; str + item                     <span style="color:#777">// reduce operation</span>
} == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">counting: 123</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].inject(<span style="color:#00D">0</span>) { count, item -&gt;
    count + item
} == <span style="color:#00D">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is idiomatic Groovy code for finding the maximum and minimum in a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">9</span>, <span style="color:#00D">4</span>, <span style="color:#00D">2</span>, <span style="color:#00D">10</span>, <span style="color:#00D">5</span>]
<span style="color:#080;font-weight:bold">assert</span> list.max() == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">assert</span> list.min() == <span style="color:#00D">2</span>

<span style="color:#777">// we can also compare single characters, as anything comparable</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">y</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>].min() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>

<span style="color:#777">// we can use a closure to specify the sorting behaviour</span>
<span style="color:#080;font-weight:bold">def</span> list2 = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xyzuvw</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">321</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list2.max { <span style="color:#950">it</span>.size() } == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xyzuvw</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> list2.min { <span style="color:#950">it</span>.size() } == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to closures, you can use a <code>Comparator</code> to define the comparison criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">Comparator</span> mc = { a, b -&gt; a == b ? <span style="color:#00D">0</span> : (a &lt; b ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span>) }

<span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">7</span>, <span style="color:#00D">4</span>, <span style="color:#00D">9</span>, -<span style="color:#00D">6</span>, -<span style="color:#00D">1</span>, <span style="color:#00D">11</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, -<span style="color:#00D">9</span>, <span style="color:#00D">5</span>, -<span style="color:#00D">13</span>]
<span style="color:#080;font-weight:bold">assert</span> list.max(mc) == <span style="color:#00D">11</span>
<span style="color:#080;font-weight:bold">assert</span> list.min(mc) == -<span style="color:#00D">13</span>

<span style="color:#0a8;font-weight:bold">Comparator</span> mc2 = { a, b -&gt; a == b ? <span style="color:#00D">0</span> : (<span style="color:#0a8;font-weight:bold">Math</span>.abs(a) &lt; <span style="color:#0a8;font-weight:bold">Math</span>.abs(b)) ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span> }


<span style="color:#080;font-weight:bold">assert</span> list.max(mc2) == -<span style="color:#00D">13</span>
<span style="color:#080;font-weight:bold">assert</span> list.min(mc2) == -<span style="color:#00D">1</span>

<span style="color:#080;font-weight:bold">assert</span> list.max { a, b -&gt; a.equals(b) ? <span style="color:#00D">0</span> : <span style="color:#0a8;font-weight:bold">Math</span>.abs(a) &lt; <span style="color:#0a8;font-weight:bold">Math</span>.abs(b) ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span> } == -<span style="color:#00D">13</span>
<span style="color:#080;font-weight:bold">assert</span> list.min { a, b -&gt; a.equals(b) ? <span style="color:#00D">0</span> : <span style="color:#0a8;font-weight:bold">Math</span>.abs(a) &lt; <span style="color:#0a8;font-weight:bold">Math</span>.abs(b) ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span> } == -<span style="color:#00D">1</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adding_or_removing_elements"><a class="link" href="#_adding_or_removing_elements">Adding or removing elements</a></h6>
<div class="paragraph">
<p>We can use <code>[]</code> to assign a new empty list and <code>&lt;&lt;</code> to append items to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#080;font-weight:bold">assert</span> list.empty

list &lt;&lt; <span style="color:#00D">5</span>
<span style="color:#080;font-weight:bold">assert</span> list.size() == <span style="color:#00D">1</span>

list &lt;&lt; <span style="color:#00D">7</span> &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">i</span><span style="color:#710">'</span></span> &lt;&lt; <span style="color:#00D">11</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">5</span>, <span style="color:#00D">7</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">i</span><span style="color:#710">'</span></span>, <span style="color:#00D">11</span>]

list &lt;&lt; [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">m</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">o</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">5</span>, <span style="color:#00D">7</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">i</span><span style="color:#710">'</span></span>, <span style="color:#00D">11</span>, [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">m</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">o</span><span style="color:#710">'</span></span>]]

<span style="color:#777">//first item in chain of &lt;&lt; is target list</span>
<span style="color:#080;font-weight:bold">assert</span> ([<span style="color:#00D">1</span>, <span style="color:#00D">2</span>] &lt;&lt; <span style="color:#00D">3</span> &lt;&lt; [<span style="color:#00D">4</span>, <span style="color:#00D">5</span>] &lt;&lt; <span style="color:#00D">6</span>) == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, [<span style="color:#00D">4</span>, <span style="color:#00D">5</span>], <span style="color:#00D">6</span>]

<span style="color:#777">//using leftShift is equivalent to using &lt;&lt;</span>
<span style="color:#080;font-weight:bold">assert</span> ([<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>] &lt;&lt; <span style="color:#00D">4</span>) == ([<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].leftShift(<span style="color:#00D">4</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add to a list in many ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>] + <span style="color:#00D">3</span> + [<span style="color:#00D">4</span>, <span style="color:#00D">5</span>] + <span style="color:#00D">6</span> == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]
<span style="color:#777">// equivalent to calling the `plus` method</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>].plus(<span style="color:#00D">3</span>).plus([<span style="color:#00D">4</span>, <span style="color:#00D">5</span>]).plus(<span style="color:#00D">6</span>) == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]

<span style="color:#080;font-weight:bold">def</span> a = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
a += <span style="color:#00D">4</span>      <span style="color:#777">// creates a new list and assigns it to `a`</span>
a += [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>]
<span style="color:#080;font-weight:bold">assert</span> a == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, *[<span style="color:#00D">222</span>, <span style="color:#00D">333</span>], <span style="color:#00D">456</span>] == [<span style="color:#00D">1</span>, <span style="color:#00D">222</span>, <span style="color:#00D">333</span>, <span style="color:#00D">456</span>]
<span style="color:#080;font-weight:bold">assert</span> [*[<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]] == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, [<span style="color:#00D">2</span>, <span style="color:#00D">3</span>, [<span style="color:#00D">4</span>, <span style="color:#00D">5</span>], <span style="color:#00D">6</span>], <span style="color:#00D">7</span>, [<span style="color:#00D">8</span>, <span style="color:#00D">9</span>]].flatten() == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">8</span>, <span style="color:#00D">9</span>]

<span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>]
list.add(<span style="color:#00D">3</span>)
list.addAll([<span style="color:#00D">5</span>, <span style="color:#00D">4</span>])
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>, <span style="color:#00D">4</span>]

list = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>]
list.add(<span style="color:#00D">1</span>, <span style="color:#00D">3</span>) <span style="color:#777">// add 3 just before index 1</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>, <span style="color:#00D">3</span>, <span style="color:#00D">2</span>]

list.addAll(<span style="color:#00D">2</span>, [<span style="color:#00D">5</span>, <span style="color:#00D">4</span>]) <span style="color:#777">//add [5,4] just before index 2</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>, <span style="color:#00D">4</span>, <span style="color:#00D">2</span>]

list = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">g</span><span style="color:#710">'</span></span>]
list[<span style="color:#00D">8</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span> <span style="color:#777">// the [] operator is growing the list as needed</span>
<span style="color:#777">// nulls inserted if required</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">g</span><span style="color:#710">'</span></span>, <span style="color:#069">null</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is however important that the <code>+</code> operator on a list is <strong>not mutating</strong>. Compared to <code>&lt;&lt;</code>, it will create a new
list, which is often not what you want and can lead to performance issues.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also contains methods allowing you to easily remove elements from a list by value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>] - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span> == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>] - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span> == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>] - [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>] == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>]

<span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>,<span style="color:#00D">3</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]
list -= <span style="color:#00D">3</span>           <span style="color:#777">// creates a new list by removing `3` from the original one</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">4</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]
<span style="color:#080;font-weight:bold">assert</span> ( list -= [<span style="color:#00D">2</span>,<span style="color:#00D">4</span>] ) == [<span style="color:#00D">1</span>,<span style="color:#00D">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to remove an element by passing its index to the <code>remove</code> method, in which case the list is mutated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">f</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list.remove(<span style="color:#00D">2</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>        <span style="color:#777">// remove the third element, and return it</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">f</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you only want to remove the first element having the same value in a list, instead of removing all
elements, you can call the <code>remove</code> method passing the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list= [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list.remove(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>)             <span style="color:#777">// remove 'c', and return true because element removed</span>
<span style="color:#080;font-weight:bold">assert</span> list.remove(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>)             <span style="color:#777">// remove first 'b', and return true because element removed</span>

<span style="color:#080;font-weight:bold">assert</span> ! list.remove(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>)           <span style="color:#777">// return false because no elements removed</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are two <code>remove</code> methods available.  One that takes an integer and removes an element
by its index, and another that will remove the first element that matches the passed value.  So what should we
do when we have a list of integers?  In this case, you may wish to use <code>removeAt</code> to remove an element by its
index, and <code>removeElement</code> to remove the first element that matches a value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>,<span style="color:#00D">6</span>,<span style="color:#00D">2</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]

<span style="color:#080;font-weight:bold">assert</span> list.remove(<span style="color:#00D">2</span>) == <span style="color:#00D">3</span>          <span style="color:#777">// this removes the element at index 2, and returns it</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>,<span style="color:#00D">6</span>,<span style="color:#00D">2</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]

<span style="color:#080;font-weight:bold">assert</span> list.removeElement(<span style="color:#00D">2</span>)        <span style="color:#777">// remove first 2 and return true</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>,<span style="color:#00D">6</span>,<span style="color:#00D">2</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]

<span style="color:#080;font-weight:bold">assert</span> ! list.removeElement(<span style="color:#00D">8</span>)      <span style="color:#777">// return false because 8 is not in the list</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>,<span style="color:#00D">6</span>,<span style="color:#00D">2</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]

<span style="color:#080;font-weight:bold">assert</span> list.removeAt(<span style="color:#00D">1</span>) == <span style="color:#00D">4</span>        <span style="color:#777">// remove element at index 1, and return it</span>
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="color:#00D">1</span>,<span style="color:#00D">5</span>,<span style="color:#00D">6</span>,<span style="color:#00D">2</span>,<span style="color:#00D">2</span>,<span style="color:#00D">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, <code>removeAt</code> and <code>removeElement</code> will work with lists of any type.</p>
</div>
<div class="paragraph">
<p>Additionally, removing all the elements in a list can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list= [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="color:#00D">2</span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="color:#00D">4</span>]
list.clear()
<span style="color:#080;font-weight:bold">assert</span> list == <span style="color:#339;font-weight:bold">[]</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_set_operations"><a class="link" href="#_set_operations">Set operations</a></h6>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also includes methods making it easy to reason on sets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">in</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]             <span style="color:#777">// returns true if an element belongs to the list</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>].contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>)      <span style="color:#777">// equivalent to the `contains` method in Java</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>].containsAll([<span style="color:#00D">1</span>,<span style="color:#00D">4</span>])       <span style="color:#777">// `containsAll` will check that all elements are found</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>].count(<span style="color:#00D">3</span>) == <span style="color:#00D">4</span>  <span style="color:#777">// count the number of elements which have some value</span>
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>].count {
    <span style="color:#950">it</span>%<span style="color:#00D">2</span>==<span style="color:#00D">0</span>                             <span style="color:#777">// count the number of elements which match the predicate</span>
} == <span style="color:#00D">2</span>

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">4</span>,<span style="color:#00D">6</span>,<span style="color:#00D">8</span>,<span style="color:#00D">10</span>,<span style="color:#00D">12</span>].intersect([<span style="color:#00D">1</span>,<span style="color:#00D">3</span>,<span style="color:#00D">6</span>,<span style="color:#00D">9</span>,<span style="color:#00D">12</span>]) == [<span style="color:#00D">1</span>,<span style="color:#00D">6</span>,<span style="color:#00D">12</span>]

<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>].disjoint( [<span style="color:#00D">4</span>,<span style="color:#00D">6</span>,<span style="color:#00D">9</span>] )
<span style="color:#080;font-weight:bold">assert</span> ![<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>].disjoint( [<span style="color:#00D">2</span>,<span style="color:#00D">4</span>,<span style="color:#00D">6</span>] )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_sorting"><a class="link" href="#_sorting">Sorting</a></h6>
<div class="paragraph">
<p>Working with collections often implies sorting. Groovy offers a variety of options to sort lists,
from using closures to comparators, as in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">6</span>, <span style="color:#00D">3</span>, <span style="color:#00D">9</span>, <span style="color:#00D">2</span>, <span style="color:#00D">7</span>, <span style="color:#00D">1</span>, <span style="color:#00D">5</span>].sort() == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">9</span>]

<span style="color:#080;font-weight:bold">def</span> list = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xyzuvw</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">321</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list.sort {
    <span style="color:#950">it</span>.size()
} == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">321</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xyzuvw</span><span style="color:#710">'</span></span>]

<span style="color:#080;font-weight:bold">def</span> list2 = [<span style="color:#00D">7</span>, <span style="color:#00D">4</span>, -<span style="color:#00D">6</span>, -<span style="color:#00D">1</span>, <span style="color:#00D">11</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, -<span style="color:#00D">9</span>, <span style="color:#00D">5</span>, -<span style="color:#00D">13</span>]
<span style="color:#080;font-weight:bold">assert</span> list2.sort { a, b -&gt; a == b ? <span style="color:#00D">0</span> : <span style="color:#0a8;font-weight:bold">Math</span>.abs(a) &lt; <span style="color:#0a8;font-weight:bold">Math</span>.abs(b) ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span> } ==
        [-<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, -<span style="color:#00D">6</span>, <span style="color:#00D">7</span>, -<span style="color:#00D">9</span>, <span style="color:#00D">11</span>, -<span style="color:#00D">13</span>]

<span style="color:#0a8;font-weight:bold">Comparator</span> mc = { a, b -&gt; a == b ? <span style="color:#00D">0</span> : <span style="color:#0a8;font-weight:bold">Math</span>.abs(a) &lt; <span style="color:#0a8;font-weight:bold">Math</span>.abs(b) ? -<span style="color:#00D">1</span> : <span style="color:#00D">1</span> }

<span style="color:#777">// JDK 8+ only</span>
<span style="color:#777">// list2.sort(mc)</span>
<span style="color:#777">// assert list2 == [-1, 2, 3, 4, 5, -6, 7, -9, 11, -13]</span>

<span style="color:#080;font-weight:bold">def</span> list3 = [<span style="color:#00D">6</span>, -<span style="color:#00D">3</span>, <span style="color:#00D">9</span>, <span style="color:#00D">2</span>, -<span style="color:#00D">7</span>, <span style="color:#00D">1</span>, <span style="color:#00D">5</span>]

<span style="color:#0a8;font-weight:bold">Collections</span>.sort(list3)
<span style="color:#080;font-weight:bold">assert</span> list3 == [-<span style="color:#00D">7</span>, -<span style="color:#00D">3</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">9</span>]

<span style="color:#0a8;font-weight:bold">Collections</span>.sort(list3, mc)
<span style="color:#080;font-weight:bold">assert</span> list3 == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, -<span style="color:#00D">3</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, -<span style="color:#00D">7</span>, <span style="color:#00D">9</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_duplicating_elements"><a class="link" href="#_duplicating_elements">Duplicating elements</a></h6>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also takes advantage of operator overloading to provide methods allowing duplication of elements
of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>] * <span style="color:#00D">3</span> == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>].multiply(<span style="color:#00D">2</span>) == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Collections</span>.nCopies(<span style="color:#00D">3</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>) == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>]

<span style="color:#777">// nCopies from the JDK has different semantics than multiply for lists</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Collections</span>.nCopies(<span style="color:#00D">2</span>, [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>]) == [[<span style="color:#00D">1</span>, <span style="color:#00D">2</span>], [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>]] <span style="color:#777">//not [1,2,1,2]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Collections-Maps"><a class="link" href="#Collections-Maps">3.2.2. Maps</a></h4>
<div class="sect4">
<h5 id="_map_literals"><a class="link" href="#_map_literals">3.2.2.1. Map literals</a></h5>
<div class="paragraph">
<p>In Groovy, maps (also known as associative arrays) can be created using the map literal syntax: <code>[:]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>, <span style="color:#606">likes</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cheese</span><span style="color:#710">'</span></span>, <span style="color:#606">id</span>: <span style="color:#00D">1234</span>]
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">id</span><span style="color:#710">'</span></span>) == <span style="color:#00D">1234</span>
<span style="color:#080;font-weight:bold">assert</span> map[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> map[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">id</span><span style="color:#710">'</span></span>] == <span style="color:#00D">1234</span>
<span style="color:#080;font-weight:bold">assert</span> map <span style="color:#080;font-weight:bold">instanceof</span> java.util.Map

<span style="color:#080;font-weight:bold">def</span> emptyMap = [:]
<span style="color:#080;font-weight:bold">assert</span> emptyMap.size() == <span style="color:#00D">0</span>
emptyMap.put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">assert</span> emptyMap.size() == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> emptyMap.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span>) == <span style="color:#00D">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Map keys are strings by default: <code>[a:1]</code> is equivalent to <code>['a':1]</code>. This can be confusing if you define a variable
named <code>a</code> and that you want the <strong>value</strong> of <code>a</code> to be the key in your map. If this is the case, then you <strong>must</strong> escape
the key by adding parenthesis, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> a = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> ages = [<span style="color:#606">a</span>: <span style="color:#00D">43</span>]
<span style="color:#080;font-weight:bold">assert</span> ages[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>] == <span style="color:#069">null</span> <span style="color:#777">// `Bob` is not found</span>
<span style="color:#080;font-weight:bold">assert</span> ages[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>] == <span style="color:#00D">43</span>     <span style="color:#777">// because `a` is a literal!</span>

ages = [(a): <span style="color:#00D">43</span>]            <span style="color:#777">// now we escape `a` by using parenthesis</span>
<span style="color:#080;font-weight:bold">assert</span> ages[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>] == <span style="color:#00D">43</span>   <span style="color:#777">// and the value is found!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to map literals, it is possible, to get a new copy of a map, to clone it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [
        simple : <span style="color:#00D">123</span>,
        <span style="color:#606">complex</span>: [<span style="color:#606">a</span>: <span style="color:#00D">1</span>, <span style="color:#606">b</span>: <span style="color:#00D">2</span>]
]
<span style="color:#080;font-weight:bold">def</span> map2 = map.clone()
<span style="color:#080;font-weight:bold">assert</span> map2.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">simple</span><span style="color:#710">'</span></span>) == map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">simple</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> map2.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">complex</span><span style="color:#710">'</span></span>) == map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">complex</span><span style="color:#710">'</span></span>)
map2.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">complex</span><span style="color:#710">'</span></span>).put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>)
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">complex</span><span style="color:#710">'</span></span>).get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>) == <span style="color:#00D">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting map is a <strong>shallow</strong> copy of the original one, as illustrated in the previous example.</p>
</div>
</div>
<div class="sect4">
<h5 id="_map_property_notation"><a class="link" href="#_map_property_notation">3.2.2.2. Map property notation</a></h5>
<div class="paragraph">
<p>Maps also act like beans so you can use the property notation to get/set
items inside the <code>Map</code> as long as the keys are strings which are valid
Groovy identifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>, <span style="color:#606">likes</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cheese</span><span style="color:#710">'</span></span>, <span style="color:#606">id</span>: <span style="color:#00D">1234</span>]
<span style="color:#080;font-weight:bold">assert</span> map.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>     <span style="color:#777">// can be used instead of map.get('name')</span>
<span style="color:#080;font-weight:bold">assert</span> map.id == <span style="color:#00D">1234</span>

<span style="color:#080;font-weight:bold">def</span> emptyMap = [:]
<span style="color:#080;font-weight:bold">assert</span> emptyMap.size() == <span style="color:#00D">0</span>
emptyMap.foo = <span style="color:#00D">5</span>
<span style="color:#080;font-weight:bold">assert</span> emptyMap.size() == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> emptyMap.foo == <span style="color:#00D">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: by design <code>map.foo</code> will always look for the key <code>foo</code> in the map. This
means <code>foo.class</code> will return <code>null</code> on a map that doesn&#8217;t contain the <code>class</code> key. Should you really want to know
the class, then you must use <code>getClass()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Gromit</span><span style="color:#710">'</span></span>, <span style="color:#606">likes</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cheese</span><span style="color:#710">'</span></span>, <span style="color:#606">id</span>: <span style="color:#00D">1234</span>]
<span style="color:#080;font-weight:bold">assert</span> map.class == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class</span><span style="color:#710">'</span></span>) == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> map.getClass() == <span style="color:#0a8;font-weight:bold">LinkedHashMap</span> <span style="color:#777">// this is probably what you want</span>

map = [<span style="color:#00D">1</span>      : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,
       (<span style="color:#069">true</span>) : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">p</span><span style="color:#710">'</span></span>,
       (<span style="color:#069">false</span>): <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">q</span><span style="color:#710">'</span></span>,
       (<span style="color:#069">null</span>) : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>,
       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">null</span><span style="color:#710">'</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> map.containsKey(<span style="color:#00D">1</span>) <span style="color:#777">// 1 is not an identifier so used as is</span>
<span style="color:#080;font-weight:bold">assert</span> map.true == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> map.false == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="color:#069">true</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">p</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="color:#069">false</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">q</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> map.null == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="color:#069">null</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterating_on_maps"><a class="link" href="#_iterating_on_maps">3.2.2.3. Iterating on maps</a></h5>
<div class="paragraph">
<p>As usual in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>, idiomatic iteration on maps makes use of the <code>each</code> and <code>eachWithIndex</code> methods.
It&#8217;s worth noting that maps created using the map literal notation are <strong>ordered</strong>, that is to say that if you iterate
on map entries, it is guaranteed that the entries will be returned in the same order they were added in the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [
        Bob  : <span style="color:#00D">42</span>,
        <span style="color:#606">Alice</span>: <span style="color:#00D">54</span>,
        Max  : <span style="color:#00D">33</span>
]

<span style="color:#777">// `entry` is a map entry</span>
map.each { entry -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>entry</span><span style="color:#D20">.key Age: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>entry</span><span style="color:#D20">.value</span><span style="color:#710">&quot;</span></span>
}

<span style="color:#777">// `entry` is a map entry, `i` the index in the map</span>
map.eachWithIndex { entry, i -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>i</span><span style="color:#D20"> - Name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>entry</span><span style="color:#D20">.key Age: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>entry</span><span style="color:#D20">.value</span><span style="color:#710">&quot;</span></span>
}

<span style="color:#777">// Alternatively you can use key and value directly</span>
map.each { key, value -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>key</span><span style="color:#D20"> Age: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>value</span><span style="color:#710">&quot;</span></span>
}

<span style="color:#777">// Key, value and i as the index in the map</span>
map.eachWithIndex { key, value, i -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>i</span><span style="color:#D20"> - Name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>key</span><span style="color:#D20"> Age: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>value</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_manipulating_maps"><a class="link" href="#_manipulating_maps">3.2.2.4. Manipulating maps</a></h5>
<div class="sect5">
<h6 id="_adding_or_removing_elements_2"><a class="link" href="#_adding_or_removing_elements_2">Adding or removing elements</a></h6>
<div class="paragraph">
<p>Adding an element to a map can be done either using the <code>put</code> method, the subscript operator or using <code>putAll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> defaults = [<span style="color:#00D">1</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="color:#00D">4</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">def</span> overrides = [<span style="color:#00D">2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="color:#00D">5</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>, <span style="color:#00D">13</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>]

<span style="color:#080;font-weight:bold">def</span> result = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">LinkedHashMap</span>(defaults)
result.put(<span style="color:#00D">15</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">t</span><span style="color:#710">'</span></span>)
result[<span style="color:#00D">17</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>
result.putAll(overrides)
<span style="color:#080;font-weight:bold">assert</span> result == [<span style="color:#00D">1</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>, <span style="color:#00D">4</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, <span style="color:#00D">5</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>, <span style="color:#00D">13</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>, <span style="color:#00D">15</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">t</span><span style="color:#710">'</span></span>, <span style="color:#00D">17</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing all the elements of a map can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> m = [<span style="color:#00D">1</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> m.get(<span style="color:#00D">1</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>
m.clear()
<span style="color:#080;font-weight:bold">assert</span> m == [:]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maps generated using the map literal syntax are using the object <code>equals</code> and <code>hashcode</code> methods. This means that
you should <strong>never</strong> use an object which hash code is subject to change over time, or you wouldn&#8217;t be able to get
the associated value back.</p>
</div>
<div class="paragraph">
<p>It is also worth noting that you should <strong>never</strong> use a <code>GString</code> as the key of a map, because the hash code of a <code>GString</code>
is not the same as the hash code of an equivalent <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> key = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some key</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> map = [:]
<span style="color:#080;font-weight:bold">def</span> gstringKey = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>key.toUpperCase()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
map.put(gstringKey,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> map.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">SOME KEY</span><span style="color:#710">'</span></span>) == <span style="color:#069">null</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="JN1035-Maps-Collectionviewsofamap"><a class="link" href="#JN1035-Maps-Collectionviewsofamap">Keys, values and entries</a></h6>
<div class="paragraph">
<p>We can inspect the keys, values, and entries in a view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> map = [<span style="color:#00D">1</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]

<span style="color:#080;font-weight:bold">def</span> entries = map.entrySet()
entries.each { entry -&gt;
  <span style="color:#080;font-weight:bold">assert</span> entry.key <span style="color:#080;font-weight:bold">in</span> [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>]
  <span style="color:#080;font-weight:bold">assert</span> entry.value <span style="color:#080;font-weight:bold">in</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]
}

<span style="color:#080;font-weight:bold">def</span> keys = map.keySet()
<span style="color:#080;font-weight:bold">assert</span> keys == [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>] <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">Set</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutating values returned by the view (be it a map entry, a key or a value) is highly discouraged because success
of the operation directly depends on the type of the map being manipulated. In particular, Groovy relies on collections
from the JDK that in general make no guarantee that a collection can safely be manipulated through <code>keySet</code>, <code>entrySet</code>, or
<code>values</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_filtering_and_searching"><a class="link" href="#_filtering_and_searching">Filtering and searching</a></h6>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains filtering, searching and collecting methods similar to those found
for <a href="#List-Filtering">lists</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> people = [
    <span style="color:#00D">1</span>: [<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>: <span style="color:#00D">32</span>, <span style="color:#606">gender</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">M</span><span style="color:#710">'</span></span>],
    <span style="color:#00D">2</span>: [<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>: <span style="color:#00D">36</span>, <span style="color:#606">gender</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">M</span><span style="color:#710">'</span></span>],
    <span style="color:#00D">3</span>: [<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Claire</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>: <span style="color:#00D">21</span>, <span style="color:#606">gender</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">F</span><span style="color:#710">'</span></span>],
    <span style="color:#00D">4</span>: [<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Amy</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>: <span style="color:#00D">54</span>, <span style="color:#606">gender</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">F</span><span style="color:#710">'</span></span>]
]

<span style="color:#080;font-weight:bold">def</span> bob = people.find { <span style="color:#950">it</span>.value.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span> } <span style="color:#777">// find a single entry</span>
<span style="color:#080;font-weight:bold">def</span> females = people.findAll { <span style="color:#950">it</span>.value.gender == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">F</span><span style="color:#710">'</span></span> }

<span style="color:#777">// both return entries, but you can use collect to retrieve the ages for example</span>
<span style="color:#080;font-weight:bold">def</span> ageOfBob = bob.value.age
<span style="color:#080;font-weight:bold">def</span> agesOfFemales = females.collect {
    <span style="color:#950">it</span>.value.age
}

<span style="color:#080;font-weight:bold">assert</span> ageOfBob == <span style="color:#00D">32</span>
<span style="color:#080;font-weight:bold">assert</span> agesOfFemales == [<span style="color:#00D">21</span>,<span style="color:#00D">54</span>]

<span style="color:#777">// but you could also use a key/pair value as the parameters of the closures</span>
<span style="color:#080;font-weight:bold">def</span> agesOfMales = people.findAll { id, person -&gt;
    person.gender == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">M</span><span style="color:#710">'</span></span>
}.collect { id, person -&gt;
    person.age
}
<span style="color:#080;font-weight:bold">assert</span> agesOfMales == [<span style="color:#00D">32</span>, <span style="color:#00D">36</span>]

<span style="color:#777">// `every` returns true if all entries match the predicate</span>
<span style="color:#080;font-weight:bold">assert</span> people.every { id, person -&gt;
    person.age &gt; <span style="color:#00D">18</span>
}

<span style="color:#777">// `any` returns true if any entry matches the predicate</span>

<span style="color:#080;font-weight:bold">assert</span> people.any { id, person -&gt;
    person.age == <span style="color:#00D">54</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Maps-Grouping"><a class="link" href="#Maps-Grouping">Grouping</a></h6>
<div class="paragraph">
<p>We can group a list into a map using some criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="color:#00D">7</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, [<span style="color:#00D">2</span>, <span style="color:#00D">3</span>]].groupBy {
    <span style="color:#950">it</span>.class
} == [(<span style="color:#0a8;font-weight:bold">String</span>)   : [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>],
      (<span style="color:#0a8;font-weight:bold">Integer</span>)  : [<span style="color:#00D">7</span>],
      (<span style="color:#0a8;font-weight:bold">ArrayList</span>): [[<span style="color:#00D">2</span>, <span style="color:#00D">3</span>]]
]

<span style="color:#080;font-weight:bold">assert</span> [
        [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Clark</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">London</span><span style="color:#710">'</span></span>], [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sharma</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">London</span><span style="color:#710">'</span></span>],
        [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maradona</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LA</span><span style="color:#710">'</span></span>], [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Zhang</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>],
        [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ali</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>], [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Liu</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>],
].groupBy { <span style="color:#950">it</span>.city } == [
        <span style="color:#606">London</span>: [[<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Clark</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">London</span><span style="color:#710">'</span></span>],
                 [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sharma</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">London</span><span style="color:#710">'</span></span>]],
        LA    : [[<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Maradona</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LA</span><span style="color:#710">'</span></span>]],
        HK    : [[<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Zhang</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>],
                 [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ali</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>],
                 [<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Liu</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HK</span><span style="color:#710">'</span></span>]],
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Collections-Ranges"><a class="link" href="#Collections-Ranges">3.2.3. Ranges</a></h4>
<div class="paragraph">
<p>Ranges allow you to create a list of sequential values. These can be
used as <code>List</code> since
<a href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/Range.html">Range</a> extends
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..</code> notation are inclusive (that is the list
contains the from and to value).</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..&lt;</code> notation are half-open, they include the
first value but not the last value.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>&lt;..</code> notation are also half-open, they include the
last value but not the first value.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>&lt;..&lt;</code> notation are full-open, they do not include the
first value nor the last value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// an inclusive range</span>
<span style="color:#080;font-weight:bold">def</span> range = <span style="color:#00D">5</span>..<span style="color:#00D">8</span>
<span style="color:#080;font-weight:bold">assert</span> range.size() == <span style="color:#00D">4</span>
<span style="color:#080;font-weight:bold">assert</span> range.get(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> range[<span style="color:#00D">2</span>] == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> range <span style="color:#080;font-weight:bold">instanceof</span> java.util.List
<span style="color:#080;font-weight:bold">assert</span> range.contains(<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">assert</span> range.contains(<span style="color:#00D">8</span>)

<span style="color:#777">// lets use a half-open range</span>
range = <span style="color:#00D">5</span>..&lt;<span style="color:#00D">8</span>
<span style="color:#080;font-weight:bold">assert</span> range.size() == <span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">assert</span> range.get(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> range[<span style="color:#00D">2</span>] == <span style="color:#00D">7</span>
<span style="color:#080;font-weight:bold">assert</span> range <span style="color:#080;font-weight:bold">instanceof</span> java.util.List
<span style="color:#080;font-weight:bold">assert</span> range.contains(<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">assert</span> !range.contains(<span style="color:#00D">8</span>)

<span style="color:#777">//get the end points of the range without using indexes</span>
range = <span style="color:#00D">1</span>..<span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">assert</span> range.from == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> range.to == <span style="color:#00D">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that int ranges are implemented efficiently, creating a lightweight
Java object containing a from and to value.</p>
</div>
<div class="paragraph">
<p>Ranges can be used for any Java object which implements java.lang.Comparable
for comparison and also have methods <code>next()</code> and <code>previous()</code> to return the
next / previous item in the range. For example, you can create a range of <code>String</code> elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// an inclusive range</span>
<span style="color:#080;font-weight:bold">def</span> range = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>..<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> range.size() == <span style="color:#00D">4</span>
<span style="color:#080;font-weight:bold">assert</span> range.get(<span style="color:#00D">2</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> range[<span style="color:#00D">2</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> range <span style="color:#080;font-weight:bold">instanceof</span> java.util.List
<span style="color:#080;font-weight:bold">assert</span> range.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> range.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> !range.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can iterate on a range using a classic <code>for</code> loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">for</span> (i <span style="color:#080;font-weight:bold">in</span> <span style="color:#00D">1</span>..<span style="color:#00D">10</span>) {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>but alternatively you can achieve the same effect in a more Groovy idiomatic style, by iterating a range
with <code>each</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">(<span style="color:#00D">1</span>..<span style="color:#00D">10</span>).each { i -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ranges can be also used in the <code>switch</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">switch</span> (years) {
    <span style="color:#080;font-weight:bold">case</span> <span style="color:#00D">1</span>..<span style="color:#00D">10</span>: interestRate = <span style="color:#60E">0.076</span>; <span style="color:#080;font-weight:bold">break</span>;
    <span style="color:#080;font-weight:bold">case</span> <span style="color:#00D">11</span>..<span style="color:#00D">25</span>: interestRate = <span style="color:#60E">0.052</span>; <span style="color:#080;font-weight:bold">break</span>;
    <span style="color:#080;font-weight:bold">default</span>: interestRate = <span style="color:#60E">0.037</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_syntax_enhancements_for_collections"><a class="link" href="#_syntax_enhancements_for_collections">3.2.4. Syntax enhancements for collections</a></h4>
<div class="sect4">
<h5 id="_gpath_support"><a class="link" href="#_gpath_support">3.2.4.1. GPath support</a></h5>
<div class="paragraph">
<p>Thanks to the support of property notation for both lists and maps, Groovy provides syntactic sugar making it
really easy to deal with nested collections, as illustrated in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> listOfMaps = [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">11</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">12</span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">21</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">22</span>]]
<span style="color:#080;font-weight:bold">assert</span> listOfMaps.a == [<span style="color:#00D">11</span>, <span style="color:#00D">21</span>] <span style="color:#777">//GPath notation</span>
<span style="color:#080;font-weight:bold">assert</span> listOfMaps*.a == [<span style="color:#00D">11</span>, <span style="color:#00D">21</span>] <span style="color:#777">//spread dot notation</span>

listOfMaps = [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">11</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">12</span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">21</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">22</span>], <span style="color:#069">null</span>]
<span style="color:#080;font-weight:bold">assert</span> listOfMaps*.a == [<span style="color:#00D">11</span>, <span style="color:#00D">21</span>, <span style="color:#069">null</span>] <span style="color:#777">// caters for null values</span>
<span style="color:#080;font-weight:bold">assert</span> listOfMaps*.a == listOfMaps.collect { <span style="color:#950">it</span>?.a } <span style="color:#777">//equivalent notation</span>
<span style="color:#777">// But this will only collect non-null values</span>
<span style="color:#080;font-weight:bold">assert</span> listOfMaps.a == [<span style="color:#00D">11</span>,<span style="color:#00D">21</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spread_operator"><a class="link" href="#_spread_operator">3.2.4.2. Spread operator</a></h5>
<div class="paragraph">
<p>The spread operator can be used to "inline" a collection into another. It is syntactic sugar which often avoids calls
to <code>putAll</code> and facilitates the realization of one-liners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>: <span style="color:#00D">900</span>,
         *: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">100</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">200</span>], <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">300</span>] == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">300</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">200</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>: <span style="color:#00D">900</span>]
<span style="color:#777">//spread map notation in map definition</span>
<span style="color:#080;font-weight:bold">assert</span> [*: [<span style="color:#00D">3</span>: <span style="color:#00D">3</span>, *: [<span style="color:#00D">5</span>: <span style="color:#00D">5</span>]], <span style="color:#00D">7</span>: <span style="color:#00D">7</span>] == [<span style="color:#00D">3</span>: <span style="color:#00D">3</span>, <span style="color:#00D">5</span>: <span style="color:#00D">5</span>, <span style="color:#00D">7</span>: <span style="color:#00D">7</span>]

<span style="color:#080;font-weight:bold">def</span> f = { [<span style="color:#00D">1</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">w</span><span style="color:#710">'</span></span>] }
<span style="color:#080;font-weight:bold">assert</span> [*: f(), <span style="color:#00D">10</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">zz</span><span style="color:#710">'</span></span>] == [<span style="color:#00D">1</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>, <span style="color:#00D">10</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">zz</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">v</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">w</span><span style="color:#710">'</span></span>]
<span style="color:#777">//spread map notation in function arguments</span>
f = { map -&gt; map.c }
<span style="color:#080;font-weight:bold">assert</span> f(*: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">10</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">20</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>: <span style="color:#00D">30</span>], <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>: <span style="color:#00D">50</span>) == <span style="color:#00D">30</span>

f = { m, i, j, k -&gt; [m, i, j, k] }
<span style="color:#777">//using spread map notation with mixed unnamed and named arguments</span>
<span style="color:#080;font-weight:bold">assert</span> f(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>: <span style="color:#00D">100</span>, *[<span style="color:#00D">4</span>, <span style="color:#00D">5</span>], *: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>: <span style="color:#00D">10</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>: <span style="color:#00D">20</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>: <span style="color:#00D">30</span>], <span style="color:#00D">6</span>) ==
        [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">e</span><span style="color:#710">&quot;</span></span>: <span style="color:#00D">100</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">b</span><span style="color:#710">&quot;</span></span>: <span style="color:#00D">20</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">c</span><span style="color:#710">&quot;</span></span>: <span style="color:#00D">30</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a</span><span style="color:#710">&quot;</span></span>: <span style="color:#00D">10</span>], <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Gettingefficientwiththestar-dotoperator"><a class="link" href="#Collections-Gettingefficientwiththestar-dotoperator">3.2.4.3. The star-dot `*.' operator</a></h5>
<div class="paragraph">
<p>The "star-dot" operator is a shortcut operator allowing you to call a method or a property on all elements of a
collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">1</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>] == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">few</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">words</span><span style="color:#710">'</span></span>]*.size()

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> age
}
<span style="color:#080;font-weight:bold">def</span> persons = [<span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hugo</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>:<span style="color:#00D">17</span>), <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sandra</span><span style="color:#710">'</span></span>,<span style="color:#606">age</span>:<span style="color:#00D">19</span>)]
<span style="color:#080;font-weight:bold">assert</span> [<span style="color:#00D">17</span>, <span style="color:#00D">19</span>] == persons*.age</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Slicingwiththesubscriptoperator"><a class="link" href="#Collections-Slicingwiththesubscriptoperator">3.2.4.4. Slicing with the subscript operator</a></h5>
<div class="paragraph">
<p>You can index into lists, arrays, maps using the subscript expression. It is interesting that strings
are considered as special kinds of collections in that context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nice cheese gromit!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> x = text[<span style="color:#00D">2</span>]

<span style="color:#080;font-weight:bold">assert</span> x == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> x.class == <span style="color:#0a8;font-weight:bold">String</span>

<span style="color:#080;font-weight:bold">def</span> sub = text[<span style="color:#00D">5</span>..<span style="color:#00D">10</span>]
<span style="color:#080;font-weight:bold">assert</span> sub == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cheese</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">10</span>, <span style="color:#00D">11</span>, <span style="color:#00D">12</span>, <span style="color:#00D">13</span>]
<span style="color:#080;font-weight:bold">def</span> answer = list[<span style="color:#00D">2</span>,<span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">assert</span> answer == [<span style="color:#00D">12</span>,<span style="color:#00D">13</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you can use ranges to extract part of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">list = <span style="color:#00D">100</span>..<span style="color:#00D">200</span>
sub = list[<span style="color:#00D">1</span>, <span style="color:#00D">3</span>, <span style="color:#00D">20</span>..<span style="color:#00D">25</span>, <span style="color:#00D">33</span>]
<span style="color:#080;font-weight:bold">assert</span> sub == [<span style="color:#00D">101</span>, <span style="color:#00D">103</span>, <span style="color:#00D">120</span>, <span style="color:#00D">121</span>, <span style="color:#00D">122</span>, <span style="color:#00D">123</span>, <span style="color:#00D">124</span>, <span style="color:#00D">125</span>, <span style="color:#00D">133</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subscript operator can be used to update an existing collection (for collection type which are not immutable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">list = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>]
list[<span style="color:#00D">1</span>..<span style="color:#00D">2</span>] = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> list == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth noting that negative indices are allowed, to extract more easily from the end of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">nice cheese gromit!</span><span style="color:#710">&quot;</span></span>
x = text[-<span style="color:#00D">1</span>]
<span style="color:#080;font-weight:bold">assert</span> x == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use negative indices to count from the end of the List, array,
String etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> name = text[-<span style="color:#00D">7</span>..-<span style="color:#00D">2</span>]
<span style="color:#080;font-weight:bold">assert</span> name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">gromit</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, if you use a backwards range (the starting index is greater than
the end index), then the answer is reversed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">nice cheese gromit!</span><span style="color:#710">&quot;</span></span>
name = text[<span style="color:#00D">3</span>..<span style="color:#00D">1</span>]
<span style="color:#080;font-weight:bold">assert</span> name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">eci</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Collections-EnhancedCollectionMethods"><a class="link" href="#Collections-EnhancedCollectionMethods">3.2.5. Enhanced Collection Methods</a></h4>
<div class="paragraph">
<p>In addition to <a href="#Collections-Lists">lists</a>, <a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>, Groovy offers
a lot of additional methods for filtering, collecting, grouping, counting, &#8230;&#8203; which are directly available on either
collections or more easily iterables.</p>
</div>
<div class="paragraph">
<p>In particular, we invite you to read the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> API docs and specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>methods added to <code>Iterable</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Iterable.html">here</a></p>
</li>
<li>
<p>methods added to <code>Iterator</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Iterator.html">here</a></p>
</li>
<li>
<p>methods added to <code>Collection</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Collection.html">here</a></p>
</li>
<li>
<p>methods added to <code>List</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/List.html">here</a></p>
</li>
<li>
<p>methods added to <code>Map</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Map.html">here</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_arrays"><a class="link" href="#_working_with_arrays">3.3. Working with arrays</a></h3>
<div class="paragraph">
<p>Groovy provides array support based on Java arrays with several extensions found in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>. The overall
intention is that whether you are using an array or a collection, the code for working with the aggregate remains the same.</p>
</div>
<div class="sect3">
<h4 id="Arrays"><a class="link" href="#Arrays">3.3.1. Arrays</a></h4>
<div class="sect4">
<h5 id="_array_literals"><a class="link" href="#_array_literals">3.3.1.1. Array literals</a></h5>
<div class="paragraph">
<p>You can create arrays as follows. Notice that <code>[]</code> is also used as the empty array
expression when given an explicit array type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">Integer</span><span style="color:#339;font-weight:bold">[]</span> nums = [<span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">8</span>]
<span style="color:#080;font-weight:bold">assert</span> nums[<span style="color:#00D">1</span>] == <span style="color:#00D">6</span>
<span style="color:#080;font-weight:bold">assert</span> nums.getAt(<span style="color:#00D">2</span>) == <span style="color:#00D">7</span>                <span style="color:#777">// alternative syntax</span>
<span style="color:#080;font-weight:bold">assert</span> nums[-<span style="color:#00D">1</span>] == <span style="color:#00D">8</span>                     <span style="color:#777">// negative indices</span>
<span style="color:#080;font-weight:bold">assert</span> nums <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Integer</span><span style="color:#339;font-weight:bold">[]</span>

<span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> primes = [<span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>, <span style="color:#00D">7</span>]              <span style="color:#777">// primitives</span>
<span style="color:#080;font-weight:bold">assert</span> primes <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span>

<span style="color:#080;font-weight:bold">def</span> evens = <span style="color:#080;font-weight:bold">new</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>}           <span style="color:#777">// alt syntax 1</span>
<span style="color:#080;font-weight:bold">assert</span> evens <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span>

<span style="color:#080;font-weight:bold">def</span> odds = [<span style="color:#00D">1</span>, <span style="color:#00D">3</span>, <span style="color:#00D">5</span>] <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span>            <span style="color:#777">// alt syntax 2</span>
<span style="color:#080;font-weight:bold">assert</span> odds <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span>

<span style="color:#777">// empty array examples</span>
<span style="color:#0a8;font-weight:bold">Integer</span><span style="color:#339;font-weight:bold">[]</span> emptyNums = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#080;font-weight:bold">assert</span> emptyNums <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Integer</span><span style="color:#339;font-weight:bold">[]</span> &amp;&amp; emptyNums.size() == <span style="color:#00D">0</span>

<span style="color:#080;font-weight:bold">def</span> emptyStrings = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span>{}        <span style="color:#777">// alternative syntax 1</span>
<span style="color:#080;font-weight:bold">assert</span> emptyStrings <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> &amp;&amp; emptyStrings.size() == <span style="color:#00D">0</span>

<span style="color:#339;font-weight:bold">var</span> emptyObjects = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>]         <span style="color:#777">// alternative syntax 2</span>
<span style="color:#080;font-weight:bold">assert</span> emptyObjects <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> &amp;&amp; emptyObjects.size() == <span style="color:#00D">0</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterating_on_a_list_2"><a class="link" href="#_iterating_on_a_list_2">3.3.1.2. Iterating on a list</a></h5>
<div class="paragraph">
<p>Iterating on elements of a list is usually done calling the <code>each</code> and <code>eachWithIndex</code> methods, which execute code on each
item of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> vowels = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">e</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">i</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">o</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u</span><span style="color:#710">'</span></span>]
<span style="color:#339;font-weight:bold">var</span> result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>
vowels.each {
    result += <span style="color:#950">it</span>
}
<span style="color:#080;font-weight:bold">assert</span> result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">aeiou</span><span style="color:#710">'</span></span>
result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>
vowels.eachWithIndex { v, i -&gt;
    result += v * i         <span style="color:#777">// index starts from 0</span>
}
<span style="color:#080;font-weight:bold">assert</span> result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">eiiooouuuu</span><span style="color:#710">'</span></span>

result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>
<span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> nums = [<span style="color:#00D">0</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>]
nums.eachWithIndex { value, index -&gt;
    result += value.doubleValue()
}
<span style="color:#080;font-weight:bold">assert</span> result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0.01.02.0</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_useful_methods"><a class="link" href="#_other_useful_methods">3.3.1.3. Other useful methods</a></h5>
<div class="paragraph">
<p>There are numerous other GDK methods for working with arrays.
Just be a little careful to read the documentation.
For collections, there are some mutating methods which alter
the original collection and others which produce new collections,
leaving the original untouched.
Since arrays are of a fixed size, we wouldn&#8217;t expect mutating
methods which altered an array&#8217;s size. Often instead, such methods return
collections. Here are some interesting array GDK methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span> nums = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">def</span> doubled = nums.collect { <span style="color:#950">it</span> * <span style="color:#00D">2</span> }
<span style="color:#080;font-weight:bold">assert</span> doubled == [<span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>] &amp;&amp; doubled <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">List</span>
<span style="color:#080;font-weight:bold">def</span> tripled = nums*.multiply(<span style="color:#00D">3</span>)
<span style="color:#080;font-weight:bold">assert</span> tripled == [<span style="color:#00D">3</span>, <span style="color:#00D">6</span>, <span style="color:#00D">9</span>] &amp;&amp; doubled <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">List</span>

<span style="color:#080;font-weight:bold">assert</span> nums.any{ <span style="color:#950">it</span> &gt; <span style="color:#00D">2</span> }
<span style="color:#080;font-weight:bold">assert</span> nums.every{ <span style="color:#950">it</span> &lt; <span style="color:#00D">4</span> }
<span style="color:#080;font-weight:bold">assert</span> nums.average() == <span style="color:#00D">2</span>
<span style="color:#080;font-weight:bold">assert</span> nums.min() == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> nums.max() == <span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">assert</span> nums.sum() == <span style="color:#00D">6</span>
<span style="color:#080;font-weight:bold">assert</span> nums.indices == [<span style="color:#00D">0</span>, <span style="color:#00D">1</span>, <span style="color:#00D">2</span>]
<span style="color:#080;font-weight:bold">assert</span> nums.swap(<span style="color:#00D">0</span>, <span style="color:#00D">2</span>) == [<span style="color:#00D">3</span>, <span style="color:#00D">2</span>, <span style="color:#00D">1</span>] <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">int</span><span style="color:#339;font-weight:bold">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-gdk.adoc - include::../../../subprojects/groovy-dateutil/src/spec/doc/_working-with-dateutil-types.adoc[leveloffset=+1]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-gdk.adoc - include::../../../subprojects/groovy-datetime/src/spec/doc/_working-with-datetime-types.adoc[leveloffset=+1]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handy_utilities"><a class="link" href="#_handy_utilities">3.4. Handy utilities</a></h3>
<div class="sect3">
<h4 id="_configslurper"><a class="link" href="#_configslurper">3.4.1. ConfigSlurper</a></h4>
<div class="paragraph">
<p><code>ConfigSlurper</code> is a utility class for reading configuration files defined in the form of Groovy scripts. Like it is
the case with Java <code>*.properties</code> files, <code>ConfigSlurper</code> allows a dot notation. But in addition, it allows for Closure scoped
configuration values and arbitrary object types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper().parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    app.date = new Date()  // <b class="conum">(1)</b>
    app.age  = 42
    app {                  // <b class="conum">(2)</b>
        name = &quot;Test${42}&quot;
    }
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">assert</span> config.app.date <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Date</span>
<span style="color:#080;font-weight:bold">assert</span> config.app.age == <span style="color:#00D">42</span>
<span style="color:#080;font-weight:bold">assert</span> config.app.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test42</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Usage of the dot notation</p>
</li>
<li>
<p>Usage of Closure scopes as an alternative to the dot notation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As can be seen in the above example, the <code>parse</code> method can be used to retrieve <code>groovy.util.ConfigObject</code> instances. The
<code>ConfigObject</code> is a specialized <code>java.util.Map</code> implementation that either returns the configured value or a new <code>ConfigObject</code>
instance but never <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper().parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    app.date = new Date()
    app.age  = 42
    app.name = &quot;Test${42}&quot;
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">assert</span> config.test != <span style="color:#069">null</span>   // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>config.test</code> has not been specified yet it returns a <code>ConfigObject</code> when being called.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the case of a dot being part of a configuration variable name, it can be escaped by using single or double quotes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper().parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    app.&quot;person.age&quot;  = 42
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">assert</span> config.app.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">person.age</span><span style="color:#710">&quot;</span></span> == <span style="color:#00D">42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, <code>ConfigSlurper</code> comes with support for <code>environments</code>. The <code>environments</code> method can be used to hand over
a Closure instance that itself may consist of a several sections. Let&#8217;s say we wanted to create a particular configuration
value for the development environment. When creating the <code>ConfigSlurper</code> instance we can use the <code>ConfigSlurper(String)</code>
constructor to specify the target environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">development</span><span style="color:#710">'</span></span>).parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
  environments {
       development {
           app.port = 8080
       }

       test {
           app.port = 8082
       }

       production {
           app.port = 80
       }
  }
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">assert</span> config.app.port == <span style="color:#00D">8080</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>ConfigSlurper</code> environments aren&#8217;t restricted to any particular environment names. It solely depends on the
<code>ConfigSlurper</code> client code what value are supported and interpreted accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>environments</code> method is built-in but the <code>registerConditionalBlock</code> method can be used to register other method names
in addition to the <code>environments</code> name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> slurper = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper()
slurper.registerConditionalBlock(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myProject</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">developers</span><span style="color:#710">'</span></span>)   // <b class="conum">(1)</b>

<span style="color:#080;font-weight:bold">def</span> config = slurper.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
  sendMail = true

  myProject {
       developers {
           sendMail = false
       }
  }
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">assert</span> !config.sendMail</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Once the new block is registered <code>ConfigSlurper</code> can parse it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For Java integration purposes the <code>toProperties</code> method can be used to convert the <code>ConfigObject</code> to a <code>java.util.Properties</code>
object that might be stored to a <code>*.properties</code> text file. Be aware though that the configuration values are converted to
<code>String</code> instances during adding them to the newly created <code>Properties</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> ConfigSlurper().parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    app.date = new Date()
    app.age  = 42
    app {
        name = &quot;Test${42}&quot;
    }
</span><span style="color:#710">'''</span></span>)

<span style="color:#080;font-weight:bold">def</span> properties = config.toProperties()

<span style="color:#080;font-weight:bold">assert</span> properties.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">app.date</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">String</span>
<span style="color:#080;font-weight:bold">assert</span> properties.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">app.age</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">42</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> properties.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">app.name</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test42</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expando"><a class="link" href="#_expando">3.4.2. Expando</a></h4>
<div class="paragraph">
<p>The <code>Expando</code> class can be used to create a dynamically expandable object. Despite its name it does not use the
<code>ExpandoMetaClass</code> underneath. Each <code>Expando</code> object represents a standalone, dynamically-crafted instance that can be
extended with properties (or methods) at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> expando = <span style="color:#080;font-weight:bold">new</span> Expando()
expando.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> expando.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A special case occurs when a dynamic property registers a <code>Closure</code> code block. Once being registered it can be invoked
as it would be done with a method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> expando = <span style="color:#080;font-weight:bold">new</span> Expando()
expando.toString = { -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span> }
expando.say = { <span style="color:#0a8;font-weight:bold">String</span> s -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John says: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>s<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span> }

<span style="color:#080;font-weight:bold">assert</span> expando <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">String</span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> expando.say(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hi</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John says: Hi</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observable_list_map_and_set"><a class="link" href="#_observable_list_map_and_set">3.4.3. Observable list, map and set</a></h4>
<div class="paragraph">
<p>Groovy comes with observable lists, maps and sets. Each of these collections trigger <code>java.beans.PropertyChangeEvent</code> events when elements
are added, removed or changed. Note that a <code>PropertyChangeEvent</code> is not only signalling that a certain event has
 occurred, moreover, it holds information on the property name and the old/new value a certain property has been changed to.</p>
</div>
<div class="paragraph">
<p>Depending on the type of change that has happened, observable collections might fire more specialized <code>PropertyChangeEvent</code>
 types. For example, adding an element to an observable list fires an <code>ObservableList.ElementAddedEvent</code> event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> event                                       // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> listener = {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">it</span> <span style="color:#080;font-weight:bold">instanceof</span> ObservableList.ElementEvent)  {  // <b class="conum">(2)</b>
        event = <span style="color:#950">it</span>
    }
} <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span>


<span style="color:#080;font-weight:bold">def</span> observable = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>] <span style="color:#080;font-weight:bold">as</span> ObservableList    // <b class="conum">(3)</b>
observable.addPropertyChangeListener(listener)  // <b class="conum">(4)</b>

observable.add <span style="color:#00D">42</span>                               // <b class="conum">(5)</b>

<span style="color:#080;font-weight:bold">assert</span> event <span style="color:#080;font-weight:bold">instanceof</span> ObservableList.ElementAddedEvent

<span style="color:#080;font-weight:bold">def</span> elementAddedEvent = event <span style="color:#080;font-weight:bold">as</span> ObservableList.ElementAddedEvent
<span style="color:#080;font-weight:bold">assert</span> elementAddedEvent.changeType == ObservableList.ChangeType.ADDED
<span style="color:#080;font-weight:bold">assert</span> elementAddedEvent.index == <span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">assert</span> elementAddedEvent.oldValue == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> elementAddedEvent.newValue == <span style="color:#00D">42</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Declares a <code>PropertyChangeEventListener</code> that is capturing the fired events</p>
</li>
<li>
<p><code>ObservableList.ElementEvent</code> and its descendant types are relevant for this listener</p>
</li>
<li>
<p>Registers the listener</p>
</li>
<li>
<p>Creates an <code>ObservableList</code> from the given list</p>
</li>
<li>
<p>Triggers an <code>ObservableList.ElementAddedEvent</code> event</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be aware that adding an element in fact causes two events to be triggered. The first is of type <code>ObservableList.ElementAddedEvent</code>,
the second is a plain <code>PropertyChangeEvent</code> that informs listeners about the change of property <code>size</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ObservableList.ElementClearedEvent</code> event type is another interesting one. Whenever multiple
 elements are removed, for example when calling <code>clear()</code>, it holds the elements being removed from the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> event
<span style="color:#080;font-weight:bold">def</span> listener = {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">it</span> <span style="color:#080;font-weight:bold">instanceof</span> ObservableList.ElementEvent)  {
        event = <span style="color:#950">it</span>
    }
} <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span>


<span style="color:#080;font-weight:bold">def</span> observable = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>] <span style="color:#080;font-weight:bold">as</span> ObservableList
observable.addPropertyChangeListener(listener)

observable.clear()

<span style="color:#080;font-weight:bold">assert</span> event <span style="color:#080;font-weight:bold">instanceof</span> ObservableList.ElementClearedEvent

<span style="color:#080;font-weight:bold">def</span> elementClearedEvent = event <span style="color:#080;font-weight:bold">as</span> ObservableList.ElementClearedEvent
<span style="color:#080;font-weight:bold">assert</span> elementClearedEvent.values == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>]
<span style="color:#080;font-weight:bold">assert</span> observable.size() == <span style="color:#00D">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an overview of all the supported event types the reader is encouraged to have a look at the JavaDoc documentation
or the source code of the observable collection in use.</p>
</div>
<div class="paragraph">
<p><code>ObservableMap</code> and <code>ObservableSet</code> come with the same concepts as we have seen for <code>ObservableList</code> in this section.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_元编程"><a class="link" href="#_元编程">4. 元编程</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Groovy language supports two flavors of metaprogramming: runtime and compile-time.
The first allows altering the class model and the behavior of a program at runtime while the second only occurs
at compile-time. Both have pros and cons that we will detail in this section.</p>
</div>
<div class="sect2">
<h3 id="_运行时元编程"><a class="link" href="#_运行时元编程">4.1. 运行时元编程</a></h3>
<div class="paragraph">
<p>With runtime metaprogramming we can postpone to runtime the decision to intercept, inject and even synthesize methods of classes and interfaces. For a deep understanding of Groovy&#8217;s metaobject protocol (MOP) we need to understand Groovy objects and Groovy&#8217;s method handling.
In Groovy we work with three kinds of objects: POJO, POGO and Groovy Interceptors. Groovy allows metaprogramming for all types of objects but in a different manner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POJO - A regular Java object whose class can be written in Java or any other language for the JVM.</p>
</li>
<li>
<p>POGO - A Groovy object whose class is written in Groovy. It extends <code>java.lang.Object</code> and implements the gapi:groovy.lang.GroovyObject[] interface by default.</p>
</li>
<li>
<p>Groovy Interceptor - A Groovy object that implements the gapi:groovy.lang.GroovyInterceptable[] interface and has method-interception capability which is discussed in the <a href="#_groovyinterceptable">GroovyInterceptable</a> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every method call Groovy checks whether the object is a POJO or a POGO. For POJOs, Groovy fetches its <code>MetaClass</code> from the gapi:groovy.lang.MetaClassRegistry[] and delegates method invocation to it. For POGOs, Groovy takes more steps, as illustrated in the following figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="GroovyInterceptions.png" alt="GroovyInterceptions" width="764" height="505">
</div>
<div class="title">Figure 1. Groovy interception mechanism</div>
</div>
<div class="sect3">
<h4 id="_groovyobject_interface"><a class="link" href="#_groovyobject_interface">4.1.1. GroovyObject interface</a></h4>
<div class="paragraph">
<p>gapi:groovy.lang.GroovyObject[] is the main interface in Groovy as the <code>Object</code> class is in Java. <code>GroovyObject</code> has a default implementation in the gapi:groovy.lang.GroovyObjectSupport[] class and it is responsible to transfer invocation to the gapi:groovy.lang.MetaClass[] object. The <code>GroovyObject</code> source looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">groovy.lang</span>;

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">GroovyObject</span> {

    <span style="color:#0a8;font-weight:bold">Object</span> invokeMethod(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args);

    <span style="color:#0a8;font-weight:bold">Object</span> getProperty(<span style="color:#0a8;font-weight:bold">String</span> propertyName);

    <span style="color:#339;font-weight:bold">void</span> setProperty(<span style="color:#0a8;font-weight:bold">String</span> propertyName, <span style="color:#0a8;font-weight:bold">Object</span> newValue);

    MetaClass getMetaClass();

    <span style="color:#339;font-weight:bold">void</span> setMetaClass(MetaClass metaClass);
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_invokemethod"><a class="link" href="#_invokemethod">4.1.1.1. invokeMethod</a></h5>
<div class="paragraph">
<p>This method is primarily intended to be used in conjunction with the <a href="#_groovyinterceptable">GroovyInterceptable</a>
interface or an object&#8217;s <code>MetaClass</code> where it will intercept all method calls.</p>
</div>
<div class="paragraph">
<p>It is also invoked when the method called is not present on a Groovy object. Here is a simple example using an
overridden <code>invokeMethod()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SomeGroovyClass</span> {

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMethod</span>(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">called invokeMethod </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>args</span><span style="color:#710">&quot;</span></span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">test</span>() {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method exists</span><span style="color:#710">'</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> someGroovyClass = <span style="color:#080;font-weight:bold">new</span> SomeGroovyClass()

<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.test() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method exists</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.someMethod() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">called invokeMethod someMethod []</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the use of <code>invokeMethod</code> to intercept missing methods is discouraged.  In cases where the intent is to only
intercept method calls in the case of a failed method dispatch use <a href="#_methodmissing">methodMissing</a>
instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="_getsetproperty"><a class="link" href="#_getsetproperty">4.1.1.2. get/setProperty</a></h5>
<div class="paragraph">
<p>Every read access to a property can be intercepted by overriding the <code>getProperty()</code> method of the current object.
Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SomeGroovyClass</span> {

    <span style="color:#080;font-weight:bold">def</span> property1 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> field2 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> field4 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hu</span><span style="color:#710">'</span></span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getField1</span>() {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getHa</span><span style="color:#710">'</span></span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getProperty</span>(<span style="color:#0a8;font-weight:bold">String</span> name) {
        <span style="color:#080;font-weight:bold">if</span> (name != <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field3</span><span style="color:#710">'</span></span>)
            <span style="color:#080;font-weight:bold">return</span> metaClass.getProperty(<span style="color:#950">this</span>, name) // <b class="conum">(1)</b>
        <span style="color:#080;font-weight:bold">else</span>
            <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field3</span><span style="color:#710">'</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> someGroovyClass = <span style="color:#080;font-weight:bold">new</span> SomeGroovyClass()

<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.field1 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getHa</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.field2 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.field3 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field3</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.field4 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hu</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Forwards the request to the getter for all properties except <code>field3</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can intercept write access to properties by overriding the <code>setProperty()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">POGO</span> {

    <span style="color:#0a8;font-weight:bold">String</span> property 

    <span style="color:#339;font-weight:bold">void</span> setProperty(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> value) {
        <span style="color:#950">this</span>.@<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#710">&quot;</span></span> = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">overridden</span><span style="color:#710">'</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> pogo = <span style="color:#080;font-weight:bold">new</span> POGO()
pogo.property = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> pogo.property == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">overridden</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_getsetmetaclass"><a class="link" href="#_getsetmetaclass">4.1.1.3. get/setMetaClass</a></h5>
<div class="paragraph">
<p>You can access an object&#8217;s <code>metaClass</code> or set your own <code>MetaClass</code> implementation for changing the default interception mechanism. For example, you can write your own implementation of the <code>MetaClass</code> interface and assign it to objects in order to change the interception mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// getMetaclass</span>
someObject.metaClass

<span style="color:#777">// setMetaClass</span>
someObject.metaClass = <span style="color:#080;font-weight:bold">new</span> OwnMetaClassImplementation()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can find an additional example in the <a href="#_groovyinterceptable">GroovyInterceptable</a> topic.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getsetattribute"><a class="link" href="#_getsetattribute">4.1.2. get/setAttribute</a></h4>
<div class="paragraph">
<p>This functionality is related to the <code>MetaClass</code> implementation. In the default implementation you can access fields without invoking their getters and setters. The examples below demonstrates this approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SomeGroovyClass</span> {

    <span style="color:#080;font-weight:bold">def</span> field1 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> field2 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getField1</span>() {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getHa</span><span style="color:#710">'</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> someGroovyClass = <span style="color:#080;font-weight:bold">new</span> SomeGroovyClass()

<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.metaClass.getAttribute(someGroovyClass, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field1</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> someGroovyClass.metaClass.getAttribute(someGroovyClass, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field2</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">POGO</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> field
    <span style="color:#0a8;font-weight:bold">String</span> property1

    <span style="color:#339;font-weight:bold">void</span> setProperty1(<span style="color:#0a8;font-weight:bold">String</span> property1) {
        <span style="color:#950">this</span>.property1 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">setProperty1</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> pogo = <span style="color:#080;font-weight:bold">new</span> POGO()
pogo.metaClass.setAttribute(pogo, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">field</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>)
pogo.metaClass.setAttribute(pogo, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">property1</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> pogo.field == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> pogo.property1 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ho</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_methodmissing"><a class="link" href="#_methodmissing">4.1.3. methodMissing</a></h4>
<div class="paragraph">
<p>Groovy supports the concept of <code>methodMissing</code>. This method differs from <code>invokeMethod</code> in that it
is only invoked in the case of a failed method dispatch when no method can be found for the given name and/or the
given arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {

   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">methodMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#080;font-weight:bold">def</span> args) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">this is me</span><span style="color:#710">&quot;</span></span>
   }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Foo().someUnknownMethod(<span style="color:#00D">42l</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">this is me</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically when using <code>methodMissing</code> it is possible to cache the result for the next time the same method is called.</p>
</div>
<div class="paragraph">
<p>For example, consider dynamic finders in GORM. These are implemented in terms of <code>methodMissing</code>. The code resembles
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GORM</span> {

   <span style="color:#080;font-weight:bold">def</span> dynamicMethods = [...] <span style="color:#777">// an array of dynamic methods that use regex</span>

   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">methodMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name, args) {
       <span style="color:#080;font-weight:bold">def</span> method = dynamicMethods.find { <span style="color:#950">it</span>.match(name) }
       <span style="color:#080;font-weight:bold">if</span>(method) {
          GORM.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#710">&quot;</span></span> = { <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> varArgs -&gt;
             method.invoke(delegate, name, varArgs)
          }
          <span style="color:#080;font-weight:bold">return</span> method.invoke(delegate,name, args)
       }
       <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> MissingMethodException(name, delegate, args)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how, if we find a method to invoke, we then dynamically register a new method on the fly using <a href="#metaprogramming_emc">ExpandoMetaClass</a>.
This is so that the next time the same method is called it is more efficient. This way of using <code>methodMissing</code> does not have
the overhead of <code>invokeMethod</code> <em>and</em> is not expensive from the second call on.</p>
</div>
</div>
<div class="sect3">
<h4 id="_propertymissing"><a class="link" href="#_propertymissing">4.1.4. propertyMissing</a></h4>
<div class="paragraph">
<p>Groovy supports the concept of <code>propertyMissing</code> for intercepting otherwise failing property resolution attempts. In the
case of a getter method, <code>propertyMissing</code> takes a single <code>String</code> argument containing the property name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">propertyMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name) { name }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Foo().boo == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">boo</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>propertyMissing(String)</code> method is only called when no getter method for the given property can be found by the Groovy
runtime.</p>
</div>
<div class="paragraph">
<p>For setter methods a second <code>propertyMissing</code> definition can be added that takes an additional value argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
   <span style="color:#080;font-weight:bold">def</span> storage = [:]
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">propertyMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name, value) { storage[name] = value }
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">propertyMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name) { storage[name] }
}

<span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> Foo()
f.foo = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>

<span style="color:#080;font-weight:bold">assert</span> f.foo == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>methodMissing</code> it is best practice to dynamically register new properties at runtime to improve the overall lookup
performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_static_methodmissing"><a class="link" href="#_static_methodmissing">4.1.5. static methodMissing</a></h4>
<div class="paragraph">
<p>Static variant of <code>methodMissing</code> method can be added via the <a href="#metaprogramming_emc">ExpandoMetaClass</a>
or can be implemented at the class level with <code>$static_methodMissing</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#F00;background-color:#FAA">$</span><span style="color:#06B;font-weight:bold">static_methodMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Missing static method name is </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">assert</span> Foo.bar() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Missing static method name is bar</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_static_propertymissing"><a class="link" href="#_static_propertymissing">4.1.6. static propertyMissing</a></h4>
<div class="paragraph">
<p>Static variant of <code>propertyMissing</code> method can be added via the <a href="#metaprogramming_emc">ExpandoMetaClass</a>
or can be implemented at the class level with <code>$static_propertyMissing</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#F00;background-color:#FAA">$</span><span style="color:#06B;font-weight:bold">static_propertyMissing</span>(<span style="color:#0a8;font-weight:bold">String</span> name) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Missing static property name is </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">assert</span> Foo.foobar == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Missing static property name is foobar</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groovyinterceptable"><a class="link" href="#_groovyinterceptable">4.1.7. GroovyInterceptable</a></h4>
<div class="paragraph">
<p>The gapi:groovy.lang.GroovyInterceptable[] interface is marker interface that extends <code>GroovyObject</code> and is used to notify the Groovy runtime that all methods should be intercepted through the method dispatcher mechanism of the Groovy runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">groovy.lang</span>;

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">GroovyInterceptable</span> <span style="color:#088;font-weight:bold">extends</span> GroovyObject {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a Groovy object implements the <code>GroovyInterceptable</code> interface, its <code>invokeMethod()</code> is called for any method calls. Below you can see a simple example of an object of this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Interception</span> <span style="color:#088;font-weight:bold">implements</span> GroovyInterceptable {

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">definedMethod</span>() { }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMethod</span>(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invokedMethod</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next piece of code is a test which shows that both calls to existing and non-existing methods will return the same value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">InterceptableTest</span> <span style="color:#088;font-weight:bold">extends</span> GroovyTestCase {

    <span style="color:#339;font-weight:bold">void</span> testCheckInterception() {
        <span style="color:#080;font-weight:bold">def</span> interception = <span style="color:#080;font-weight:bold">new</span> Interception()

        <span style="color:#080;font-weight:bold">assert</span> interception.definedMethod() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invokedMethod</span><span style="color:#710">'</span></span>
        <span style="color:#080;font-weight:bold">assert</span> interception.someMethod() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invokedMethod</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We cannot use default groovy methods like <code>println</code> because these methods are injected into all Groovy objects so they will be intercepted too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we want to intercept all method calls but do not want to implement the <code>GroovyInterceptable</code> interface we can implement <code>invokeMethod()</code> on an object&#8217;s <code>MetaClass</code>.
This approach works for both POGOs and POJOs, as shown by this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">InterceptionThroughMetaClassTest</span> <span style="color:#088;font-weight:bold">extends</span> GroovyTestCase {

    <span style="color:#339;font-weight:bold">void</span> testPOJOMetaClassInterception() {
        <span style="color:#0a8;font-weight:bold">String</span> invoking = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ha</span><span style="color:#710">'</span></span>
        invoking.metaClass.invokeMethod = { <span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args -&gt;
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
        }

        <span style="color:#080;font-weight:bold">assert</span> invoking.length() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
        <span style="color:#080;font-weight:bold">assert</span> invoking.someMethod() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
    }

    <span style="color:#339;font-weight:bold">void</span> testPOGOMetaClassInterception() {
        <span style="color:#0a8;font-weight:bold">Entity</span> entity = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Entity</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>)
        entity.metaClass.invokeMethod = { <span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> args -&gt;
            <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
        }

        <span style="color:#080;font-weight:bold">assert</span> entity.build(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>()) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
        <span style="color:#080;font-weight:bold">assert</span> entity.someMethod() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">invoked</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Additional information about <code>MetaClass</code> can be found in the <a href="#_metaclasses">MetaClasses</a> section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="categories"><a class="link" href="#categories">4.1.8. Categories</a></h4>
<div class="paragraph">
<p>There are situations where it is useful if a class <em>not</em> under control had additional methods. In order to enable this
capability, Groovy implements a feature borrowed from Objective-C, called <em>Categories</em>.</p>
</div>
<div class="paragraph">
<p>Categories are implemented with so-called <em>category classes</em>. A category class is special in that it needs to meet certain
pre-defined rules for defining extension methods.</p>
</div>
<div class="paragraph">
<p>There are a few categories that are included in the system for adding functionality to classes that make them more
usable within the Groovy environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gapi:groovy.time.TimeCategory[]</p>
</li>
<li>
<p>gapi:groovy.servlet.ServletCategory[]</p>
</li>
<li>
<p>gapi:groovy.xml.dom.DOMCategory[]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Category classes aren&#8217;t enabled by default. To use the methods defined in a category class it is necessary to apply
the scoped <code>use</code> method that is provided by the GDK and available from inside every Groovy object instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">use(TimeCategory)  {
    println <span style="color:#00D">1</span>.minute.from.now       // <b class="conum">(1)</b>
    println <span style="color:#00D">10</span>.hours.ago

    <span style="color:#080;font-weight:bold">def</span> someDate = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()       // <b class="conum">(2)</b>
    println someDate - <span style="color:#00D">3</span>.months
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>TimeCategory</code> adds methods to <code>Integer</code></p>
</li>
<li>
<p><code>TimeCategory</code> adds methods to <code>Date</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>use</code> method takes the category class as its first parameter and a closure code block as second parameter. Inside the
<code>Closure</code> access to the category methods is available. As can be seen in the example above even JDK classes
like <code>java.lang.Integer</code> or <code>java.util.Date</code> can be enriched with user-defined methods.</p>
</div>
<div class="paragraph">
<p>A category needs not to be directly exposed to the user code, the following will also do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JPACategory</span>{
  <span style="color:#777">// Let's enhance JPA EntityManager without getting into the JSR committee</span>
  <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> persistAll(EntityManager em , <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> entities) { <span style="color:#777">//add an interface to save all</span>
    entities?.each { em.persist(<span style="color:#950">it</span>) }
  }
}

<span style="color:#080;font-weight:bold">def</span> transactionContext = {
  EntityManager em, Closure c -&gt;
  <span style="color:#080;font-weight:bold">def</span> tx = em.transaction
  <span style="color:#080;font-weight:bold">try</span> {
    tx.begin()
    use(JPACategory) {
      c()
    }
    tx.commit()
  } <span style="color:#080;font-weight:bold">catch</span> (e) {
    tx.rollback()
  } <span style="color:#080;font-weight:bold">finally</span> {
    <span style="color:#777">//cleanup your resource here</span>
  }
}

<span style="color:#777">// user code, they always forget to close resource in exception, some even forget to commit, let's not rely on them.</span>
EntityManager em; <span style="color:#777">//probably injected</span>
transactionContext (em) {
 em.persistAll(obj1, obj2, obj3)
 <span style="color:#777">// let's do some logics here to make the example sensible</span>
 em.persistAll(obj2, obj4, obj6)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have a look at the <code>groovy.time.TimeCategory</code> class we see that the extension methods are all declared as <code>static</code>
methods. In fact, this is one of the requirements that must be met by category classes for its methods to be successfully added to
a class inside the <code>use</code> code block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TimeCategory</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Date</span> plus(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Date</span> date, <span style="color:#088;font-weight:bold">final</span> BaseDuration duration) {
        <span style="color:#080;font-weight:bold">return</span> duration.plus(date);
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Date</span> minus(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Date</span> date, <span style="color:#088;font-weight:bold">final</span> BaseDuration duration) {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Calendar</span> cal = <span style="color:#0a8;font-weight:bold">Calendar</span>.getInstance();

        cal.setTime(date);
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.YEAR, -duration.getYears());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.MONTH, -duration.getMonths());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.DAY_OF_YEAR, -duration.getDays());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.HOUR_OF_DAY, -duration.getHours());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.MINUTE, -duration.getMinutes());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.SECOND, -duration.getSeconds());
        cal.add(<span style="color:#0a8;font-weight:bold">Calendar</span>.MILLISECOND, -duration.getMillis());

        <span style="color:#080;font-weight:bold">return</span> cal.getTime();
    }

    <span style="color:#777">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another requirement is the first argument of the static method must define the type the method is attached to once being activated. The
other arguments are the normal arguments the method will take as parameters.</p>
</div>
<div class="paragraph">
<p>Because of the parameter and static method convention, category method definitions may be a bit less intuitive than
normal method definitions. As an alternative Groovy comes with a <code>@Category</code> annotation that transforms annotated classes
into category classes at compile-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Distance</span> {
    <span style="color:#080;font-weight:bold">def</span> number
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>number<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">m</span><span style="color:#710">&quot;</span></span> }
}

<span style="color:#007">@Category</span>(<span style="color:#0a8;font-weight:bold">Number</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NumberCategory</span> {
    Distance getMeters() {
        <span style="color:#080;font-weight:bold">new</span> Distance(<span style="color:#606">number</span>: <span style="color:#950">this</span>)
    }
}

use (NumberCategory)  {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">42</span>.meters.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">42m</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the <code>@Category</code> annotation has the advantage of being able to use instance methods without the target type as a
first parameter. The target type class is given as an argument to the annotation instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is a distinct section on <code>@Category</code> in the <a href="#xform-Category">compile-time metaprogramming section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_metaclasses"><a class="link" href="#_metaclasses">4.1.9. Metaclasses</a></h4>
<div class="paragraph">
<p>As explained earlier, Metaclasses play a central role in method resolution.
For every method invocation from groovy code, Groovy will find the <code>MetaClass</code> for the given object
and delegate the method resolution to the metaclass via
gapid:groovy.lang.MetaClass#invokeMethod(java.lang.Class,java.lang.Object,java.lang.String,java.lang.Object,boolean,boolean)[MetaClass#invokeMethod]
which should not be confused with
gapid:groovy.lang.GroovyObject#invokeMethod(java.lang.String,java.lang.Object)[GroovyObject#invokeMethod]
which happens to be a method that the metaclass may eventually call.</p>
</div>
<div class="sect4">
<h5 id="_the_default_metaclass_metaclassimpl"><a class="link" href="#_the_default_metaclass_metaclassimpl">4.1.9.1. The default metaclass <code>MetaClassImpl</code></a></h5>
<div class="paragraph">
<p>By default, objects get an instance of <code>MetaClassImpl</code> that implements the default method lookup.
This method lookup includes looking up of the method in the object class ("regular" method) but also if no
method is found this way it will resort to calling <code>methodMissing</code> and ultimately
gapid:groovy.lang.GroovyObject#invokeMethod(java.lang.String,java.lang.Object)[GroovyObject#invokeMethod]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {}

<span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> Foo()

<span style="color:#080;font-weight:bold">assert</span> f.metaClass =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">MetaClassImpl</span><span style="color:#404">/</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_metaclasses"><a class="link" href="#_custom_metaclasses">4.1.9.2. Custom metaclasses</a></h5>
<div class="paragraph">
<p>You can change the metaclass of any object or class and replace it with a
custom implementation of the <code>MetaClass</code> gapi:groovy.lang.MetaClass[interface].
Usually you will want to extend one of the existing metaclasses such as
<code>MetaClassImpl</code>, <code>DelegatingMetaClass</code>, <code>ExpandoMetaClass</code>, or <code>ProxyMetaClass</code>;
otherwise you will need to implement the complete method lookup logic.
Before using a new metaclass instance you should call
gapid:groovy.lang.MetaClass#initialize()[],
otherwise the metaclass may or may not behave as expected.</p>
</div>
<div class="sect5">
<h6 id="_delegating_metaclass"><a class="link" href="#_delegating_metaclass">Delegating metaclass</a></h6>
<div class="paragraph">
<p>If you only need to decorate an existing metaclass the <code>DelegatingMetaClass</code> simplifies that use case.
The old metaclass implementation is still accessible via <code>super</code> making it easy to apply
pretransformations to the inputs, routing to other methods and postprocessing the outputs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> { <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span> } }

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyFooMetaClass</span> <span style="color:#088;font-weight:bold">extends</span> DelegatingMetaClass {
  MyFooMetaClass(MetaClass metaClass) { <span style="color:#950">super</span>(metaClass) }
  MyFooMetaClass(<span style="color:#0a8;font-weight:bold">Class</span> theClass) { <span style="color:#950">super</span>(theClass) }

  <span style="color:#0a8;font-weight:bold">Object</span> invokeMethod(<span style="color:#0a8;font-weight:bold">Object</span> object, <span style="color:#0a8;font-weight:bold">String</span> methodName, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> args) {
     <span style="color:#080;font-weight:bold">def</span> result = <span style="color:#950">super</span>.invokeMethod(object,methodName.toLowerCase(), args)
     result.toUpperCase();
  }
}


<span style="color:#080;font-weight:bold">def</span> mc =  <span style="color:#080;font-weight:bold">new</span> MyFooMetaClass(Foo.metaClass)
mc.initialize()

Foo.metaClass = mc
<span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> Foo()

<span style="color:#080;font-weight:bold">assert</span> f.BAR() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">BAR</span><span style="color:#710">&quot;</span></span> <span style="color:#777">// the new metaclass routes .BAR() to .bar() and uppercases the result</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_magic_package"><a class="link" href="#_magic_package">Magic package</a></h6>
<div class="paragraph">
<p>It is possible to change the metaclass at startup time by giving the metaclass a specially crafted (magic) class name  and package name. In order to change the metaclass for <code>java.lang.Integer</code> it&#8217;s enough to put a class <code>groovy.runtime.metaclass.java.lang.IntegerMetaClass</code> in the classpath. This is useful, for example,  when working with frameworks if you want to do metaclass changes before your code is executed by the framework. The general form of the magic package is <code>groovy.runtime.metaclass.[package].[class]MetaClass</code>. In the example below the <code>[package]</code> is <code>java.lang</code> and the <code>[class]</code> is <code>Integer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// file: IntegerMetaClass.groovy</span>
<span style="color:#080;font-weight:bold">package</span> groovy.runtime.metaclass.java.lang;

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">IntegerMetaClass</span> <span style="color:#088;font-weight:bold">extends</span> DelegatingMetaClass {
  IntegerMetaClass(MetaClass metaClass) { <span style="color:#950">super</span>(metaClass) }
  IntegerMetaClass(<span style="color:#0a8;font-weight:bold">Class</span> theClass) { <span style="color:#950">super</span>(theClass) }
  <span style="color:#0a8;font-weight:bold">Object</span> invokeMethod(<span style="color:#0a8;font-weight:bold">Object</span> object, <span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> args) {
    <span style="color:#080;font-weight:bold">if</span> (name =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">isBiggerThan</span><span style="color:#404">/</span></span>) {
      <span style="color:#080;font-weight:bold">def</span> other = name.split(<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">isBiggerThan</span><span style="color:#404">/</span></span>)[<span style="color:#00D">1</span>].toInteger()
      object &gt; other
    } <span style="color:#080;font-weight:bold">else</span> {
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">super</span>.invokeMethod(object,name, args);
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By compiling the above file with <code>groovyc IntegerMetaClass.groovy</code> a <code>./groovy/runtime/metaclass/java/lang/IntegerMetaClass.class</code> will be generated. The example below will use this new metaclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// File testInteger.groovy</span>
<span style="color:#080;font-weight:bold">def</span> i = <span style="color:#00D">10</span>

<span style="color:#080;font-weight:bold">assert</span> i.isBiggerThan5()
<span style="color:#080;font-weight:bold">assert</span> !i.isBiggerThan15()

println i.isBiggerThan5()</code></pre>
</div>
</div>
<div class="paragraph">
<p>By running that file with <code>groovy -cp . testInteger.groovy</code> the <code>IntegerMetaClass</code> will be in the classpath and therefore it will become the metaclass for <code>java.lang.Integer</code> intercepting the method calls to <code>isBiggerThan*()</code> methods.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_per_instance_metaclass"><a class="link" href="#_per_instance_metaclass">4.1.9.3. Per instance metaclass</a></h5>
<div class="paragraph">
<p>You can change the metaclass of individual objects separately, so it&#8217;s possible to have multiple object of the same class with different metaclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> { <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span> }}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FooMetaClass</span> <span style="color:#088;font-weight:bold">extends</span> DelegatingMetaClass {
  FooMetaClass(MetaClass metaClass) { <span style="color:#950">super</span>(metaClass) }
  <span style="color:#0a8;font-weight:bold">Object</span> invokeMethod(<span style="color:#0a8;font-weight:bold">Object</span> object, <span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> args) {
      <span style="color:#950">super</span>.invokeMethod(object,name,args).toUpperCase()
  }
}

<span style="color:#080;font-weight:bold">def</span> f1 = <span style="color:#080;font-weight:bold">new</span> Foo()
<span style="color:#080;font-weight:bold">def</span> f2 = <span style="color:#080;font-weight:bold">new</span> Foo()
f2.metaClass = <span style="color:#080;font-weight:bold">new</span> FooMetaClass(f2.metaClass)

<span style="color:#080;font-weight:bold">assert</span> f1.bar() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> f2.bar() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">BAR</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> f1.metaClass =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">MetaClassImpl</span><span style="color:#404">/</span></span>
<span style="color:#080;font-weight:bold">assert</span> f2.metaClass =~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">FooMetaClass</span><span style="color:#404">/</span></span>
<span style="color:#080;font-weight:bold">assert</span> f1.class.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">class Foo</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> f2.class.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">class Foo</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="metaprogramming_emc"><a class="link" href="#metaprogramming_emc">4.1.9.4. ExpandoMetaClass</a></h5>
<div class="paragraph">
<p>Groovy comes with a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code>. It is special in that it allows for dynamically
adding or changing methods, constructors, properties and even static methods by using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Applying those modifications can be especially useful in mocking or stubbing scenarios as shown in the <a href="core-testing-guide.html#testing_guide_emc">Testing Guide</a>.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied by Groovy with a special <code>metaClass</code> property that will give you a reference to an
<code>ExpandoMetaClass</code> instance. This instance can then be used to add methods or change the behaviour of already existing
ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default <code>ExpandoMetaClass</code> doesn&#8217;t do inheritance. To enable this you must call <code>ExpandoMetaClass#enableGlobally()</code>
before your app starts such as in the main method or servlet bootstrap.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sections go into detail on how <code>ExpandoMetaClass</code> can be used in various scenarios.</p>
</div>
<div class="sect5">
<h6 id="_methods"><a class="link" href="#_methods">Methods</a></h6>
<div class="paragraph">
<p>Once the <code>ExpandoMetaClass</code> is accessed by calling the <code>metaClass</code> property, methods can be added by using either the left shift
<code>&lt;&lt;</code> or the <code>=</code> operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Note that the left shift operator is used to <em>append</em> a new method. If a public method with the same name and
parameter types is declared by the class or interface, including those inherited from superclasses and superinterfaces
but excluding those added to the <code>metaClass</code> at runtime, an exception will be thrown. If you want to <em>replace</em> a
method declared by the class or interface you can use the <code>=</code> operator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operators are applied on a non-existent property of <code>metaClass</code> passing an instance of a <code>Closure</code> code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
   <span style="color:#0a8;font-weight:bold">String</span> title
}

<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.titleInUpperCase &lt;&lt; {-&gt; title.toUpperCase() }

<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The Stand</span><span style="color:#710">&quot;</span></span>)

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">THE STAND</span><span style="color:#710">&quot;</span></span> == b.titleInUpperCase()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows how a new method can be added to a class by accessing the <code>metaClass</code> property and using the <code>&lt;&lt;</code> or
 <code>=</code> operator to assign a <code>Closure</code> code block. The <code>Closure</code> parameters are interpreted as method parameters. Parameterless methods
 can be added by using the <code>{&#8594; &#8230;&#8203;}</code> syntax.</p>
</div>
</div>
<div class="sect5">
<h6 id="_properties"><a class="link" href="#_properties">Properties</a></h6>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> supports two mechanisms for adding or overriding properties.</p>
</div>
<div class="paragraph">
<p>Firstly, it has support for declaring a <em>mutable property</em> by simply assigning a value to a property of <code>metaClass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
   <span style="color:#0a8;font-weight:bold">String</span> title
}

<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.author = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Stephen King</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Stephen King</span><span style="color:#710">&quot;</span></span> == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way is to add getter and/or setter methods by using the standard mechanisms for adding instance methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
  <span style="color:#0a8;font-weight:bold">String</span> title
}
<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.getAuthor &lt;&lt; {-&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Stephen King</span><span style="color:#710">&quot;</span></span> }

<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Stephen King</span><span style="color:#710">&quot;</span></span> == b.author</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the source code example above the property is dictated by the closure and is a read-only property. It is feasible to add
an equivalent setter method but then the property value needs to be stored for later usage. This could be done as
shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
  <span style="color:#0a8;font-weight:bold">String</span> title
}

<span style="color:#080;font-weight:bold">def</span> properties = <span style="color:#0a8;font-weight:bold">Collections</span>.synchronizedMap([:])

<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.setAuthor = { <span style="color:#0a8;font-weight:bold">String</span> value -&gt;
   properties[<span style="color:#0a8;font-weight:bold">System</span>.identityHashCode(delegate) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">author</span><span style="color:#710">&quot;</span></span>] = value
}
<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.getAuthor = {-&gt;
   properties[<span style="color:#0a8;font-weight:bold">System</span>.identityHashCode(delegate) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">author</span><span style="color:#710">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not the only technique however. For example in a servlet container one way might be to store the values in
the currently executing request as request attributes (as is done in some cases in Grails).</p>
</div>
</div>
<div class="sect5">
<h6 id="_constructors"><a class="link" href="#_constructors">Constructors</a></h6>
<div class="paragraph">
<p>Constructors can be added by using a special <code>constructor</code> property. Either the <code>&lt;&lt;</code> or <code>=</code> operator can be used
to assign a <code>Closure</code> code block. The <code>Closure</code> arguments will become the constructor arguments when the code is
executed at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> title
}
<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.constructor &lt;&lt; { <span style="color:#0a8;font-weight:bold">String</span> title -&gt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>:title) }

<span style="color:#080;font-weight:bold">def</span> book = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Groovy in Action - 2nd Edition</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> book.title == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Groovy in Action - 2nd Edition</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be careful when adding constructors however, as it is very easy to get into stack overflow troubles.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_static_methods"><a class="link" href="#_static_methods">Static Methods</a></h6>
<div class="paragraph">
<p>Static methods can be added using the same technique as instance methods with the addition of the <code>static</code> qualifier
before the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
   <span style="color:#0a8;font-weight:bold">String</span> title
}

<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.static.create &lt;&lt; { <span style="color:#0a8;font-weight:bold">String</span> title -&gt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>:title) }

<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#0a8;font-weight:bold">Book</span>.create(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The Stand</span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_borrowing_methods"><a class="link" href="#_borrowing_methods">Borrowing Methods</a></h6>
<div class="paragraph">
<p>With <code>ExpandoMetaClass</code> it is possible to use Groovy&#8217;s method pointer syntax to borrow methods from other classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MortgageLender</span> {
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">borrowMoney</span>() {
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">buy house</span><span style="color:#710">&quot;</span></span>
   }
}

<span style="color:#080;font-weight:bold">def</span> lender = <span style="color:#080;font-weight:bold">new</span> MortgageLender()

Person.metaClass.buyHouse = lender.&amp;borrowMoney

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">buy house</span><span style="color:#710">&quot;</span></span> == p.buyHouse()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dynamic_method_names"><a class="link" href="#_dynamic_method_names">Dynamic Method Names</a></h6>
<div class="paragraph">
<p>Since Groovy allows you to use Strings as property names this in turns allows you to dynamically create method and
property names at runtime. To create a method with a dynamic name simply use the language feature of reference property
names as strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
   <span style="color:#0a8;font-weight:bold">String</span> name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Fred</span><span style="color:#710">&quot;</span></span>
}

<span style="color:#080;font-weight:bold">def</span> methodName = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Bob</span><span style="color:#710">&quot;</span></span>

Person.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">changeNameTo</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>methodName<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span> = {-&gt; delegate.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Bob</span><span style="color:#710">&quot;</span></span> }

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Fred</span><span style="color:#710">&quot;</span></span> == p.name

p.changeNameToBob()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Bob</span><span style="color:#710">&quot;</span></span> == p.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same concept can be applied to static methods and properties.</p>
</div>
<div class="paragraph">
<p>One application of dynamic method names can be found in the Grails web application framework. The concept of "dynamic
codecs" is implemented by using dynamic method names.</p>
</div>
<div class="listingblock">
<div class="title"><code>HTMLCodec</code> Class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">HTMLCodec</span> {
    <span style="color:#088;font-weight:bold">static</span> encode = { theTarget -&gt;
        HtmlUtils.htmlEscape(theTarget.toString())
    }

    <span style="color:#088;font-weight:bold">static</span> decode = { theTarget -&gt;
            HtmlUtils.htmlUnescape(theTarget.toString())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a codec implementation. Grails comes with various codec implementations each defined in a single class.
At runtime there will be multiple codec classes in the application classpath. At application startup the framework adds
a <code>encodeXXX</code> and a <code>decodeXXX</code> method to certain metaclasses where <code>XXX</code> is the first part of the codec class name (e.g.
<code>encodeHTML</code>). This mechanism is in the following shown in some Groovy pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> codecs = classes.findAll { <span style="color:#950">it</span>.name.endsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Codec</span><span style="color:#710">'</span></span>) }

codecs.each { codec -&gt;
    <span style="color:#0a8;font-weight:bold">Object</span>.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">encodeAs</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>codec.name-<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Codec</span><span style="color:#710">'</span></span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span> = { codec.newInstance().encode(delegate) }
    <span style="color:#0a8;font-weight:bold">Object</span>.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">decodeFrom</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>codec.name-<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Codec</span><span style="color:#710">'</span></span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span> = { codec.newInstance().decode(delegate) }
}


<span style="color:#080;font-weight:bold">def</span> html = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;</span><span style="color:#710">'</span></span> == html.encodeAsHTML()</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_runtime_discovery"><a class="link" href="#_runtime_discovery">Runtime Discovery</a></h6>
<div class="paragraph">
<p>At runtime it is often useful to know what other methods or properties exist at the time the method is executed. <code>ExpandoMetaClass</code>
provides the following methods as of this writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getMetaMethod</code></p>
</li>
<li>
<p><code>hasMetaMethod</code></p>
</li>
<li>
<p><code>getMetaProperty</code></p>
</li>
<li>
<p><code>hasMetaProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why can&#8217;t you just use reflection? Well because Groovy is different, it has the methods that are "real" methods and
methods that are available only at runtime. These are sometimes (but not always) represented as MetaMethods. The
MetaMethods tell you what methods are available at runtime, thus your code can adapt.</p>
</div>
<div class="paragraph">
<p>This is of particular use when overriding <code>invokeMethod</code>, <code>getProperty</code> and/or <code>setProperty</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_groovyobject_methods"><a class="link" href="#_groovyobject_methods">GroovyObject Methods</a></h6>
<div class="paragraph">
<p>Another feature of <code>ExpandoMetaClass</code> is that it allows to override the methods <code>invokeMethod</code>, <code>getProperty</code> and
<code>setProperty</code>, all of them can be found in the <code>groovy.lang.GroovyObject</code> class.</p>
</div>
<div class="paragraph">
<p>The following example shows how to override <code>invokeMethod</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Stuff</span> {
   <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMe</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span> }
}

Stuff.metaClass.invokeMethod = { <span style="color:#0a8;font-weight:bold">String</span> name, args -&gt;
   <span style="color:#080;font-weight:bold">def</span> metaMethod = Stuff.metaClass.getMetaMethod(name, args)
   <span style="color:#080;font-weight:bold">def</span> result
   <span style="color:#080;font-weight:bold">if</span>(metaMethod) result = metaMethod.invoke(delegate,args)
   <span style="color:#080;font-weight:bold">else</span> {
      result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>
   }
   result
}

<span style="color:#080;font-weight:bold">def</span> stf = <span style="color:#080;font-weight:bold">new</span> Stuff()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span> == stf.invokeMe()
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span> == stf.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step in the <code>Closure</code> code is to look up the <code>MetaMethod</code> for the given name and arguments. If the method
can be found everything is fine and it is delegated to. If not, a dummy value is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A <code>MetaMethod</code> is a method that is known to exist on the <code>MetaClass</code> whether added at runtime or at compile-time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same logic can be used to override <code>setProperty</code> or <code>getProperty</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
   <span style="color:#0a8;font-weight:bold">String</span> name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Fred</span><span style="color:#710">&quot;</span></span>
}

Person.metaClass.getProperty = { <span style="color:#0a8;font-weight:bold">String</span> name -&gt;
   <span style="color:#080;font-weight:bold">def</span> metaProperty = Person.metaClass.getMetaProperty(name)
   <span style="color:#080;font-weight:bold">def</span> result
   <span style="color:#080;font-weight:bold">if</span>(metaProperty) result = metaProperty.getProperty(delegate)
   <span style="color:#080;font-weight:bold">else</span> {
      result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Flintstone</span><span style="color:#710">&quot;</span></span>
   }
   result
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Fred</span><span style="color:#710">&quot;</span></span> == p.name
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Flintstone</span><span style="color:#710">&quot;</span></span> == p.other</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important thing to note here is that instead of a <code>MetaMethod</code> a <code>MetaProperty</code> instance is looked up. If that exists
the <code>getProperty</code> method of the <code>MetaProperty</code> is called, passing the delegate.</p>
</div>
</div>
<div class="sect5">
<h6 id="_overriding_static_invokemethod"><a class="link" href="#_overriding_static_invokemethod">Overriding Static invokeMethod</a></h6>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> even allows for overriding static method with a special <code>invokeMethod</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Stuff</span> {
   <span style="color:#088;font-weight:bold">static</span> invokeMe() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span> }
}

Stuff.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">static</span><span style="color:#710">'</span></span>.invokeMethod = { <span style="color:#0a8;font-weight:bold">String</span> name, args -&gt;
   <span style="color:#080;font-weight:bold">def</span> metaMethod = Stuff.metaClass.getStaticMetaMethod(name, args)
   <span style="color:#080;font-weight:bold">def</span> result
   <span style="color:#080;font-weight:bold">if</span>(metaMethod) result = metaMethod.invoke(delegate,args)
   <span style="color:#080;font-weight:bold">else</span> {
      result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>
   }
   result
}

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span> == Stuff.invokeMe()
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span> == Stuff.doStuff()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic that is used for overriding the static method is the same as we&#8217;ve seen before for overriding instance methods. The
only difference is the access to the <code>metaClass.static</code> property and the call to <code>getStaticMethodName</code> for retrieving
the static <code>MetaMethod</code> instance.</p>
</div>
</div>
<div class="sect5">
<h6 id="_extending_interfaces"><a class="link" href="#_extending_interfaces">Extending Interfaces</a></h6>
<div class="paragraph">
<p>It is possible to add methods onto interfaces with <code>ExpandoMetaClass</code>. To do this however, it <strong>must</strong> be enabled
globally using the <code>ExpandoMetaClass.enableGlobally()</code> method before application start-up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">List</span>.metaClass.sizeDoubled = {-&gt; delegate.size() * <span style="color:#00D">2</span> }

<span style="color:#080;font-weight:bold">def</span> list = <span style="color:#339;font-weight:bold">[]</span>

list &lt;&lt; <span style="color:#00D">1</span>
list &lt;&lt; <span style="color:#00D">2</span>

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span> == list.sizeDoubled()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extension_modules"><a class="link" href="#_extension_modules">4.1.10. Extension modules</a></h4>
<div class="sect4">
<h5 id="_extending_existing_classes"><a class="link" href="#_extending_existing_classes">4.1.10.1. Extending existing classes</a></h5>
<div class="paragraph">
<p>An extension module allows you to add new methods to existing classes, including classes which are precompiled, like
classes from the JDK. Those new methods, unlike those defined through a metaclass or using a category, are available
globally. For example, when you write:</p>
</div>
<div class="listingblock">
<div class="title">Standard extension method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> file = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(...)
<span style="color:#080;font-weight:bold">def</span> contents = file.getText(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">utf-8</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getText</code> method doesn’t exist on the <code>File</code> class. However, Groovy knows it because it is defined in a special
class, <code>ResourceGroovyMethods</code>:</p>
</div>
<div class="listingblock">
<div class="title">ResourceGroovyMethods.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">String</span> getText(<span style="color:#0a8;font-weight:bold">File</span> file, <span style="color:#0a8;font-weight:bold">String</span> charset) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
 <span style="color:#080;font-weight:bold">return</span> IOGroovyMethods.getText(newReader(file, charset));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may notice that the extension method is defined using a static method in a helper class (where various extension
methods are defined). The first argument of the <code>getText</code> method corresponds to the receiver, while additional parameters
correspond to the arguments of the extension method. So here, we are defining a method called <em>getText</em> on
the <code>File</code> class (because the first argument is of type <code>File</code>), which takes a single argument as a parameter (the encoding <code>String</code>).</p>
</div>
<div class="paragraph">
<p>The process of creating an extension module is simple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write an extension class like above</p>
</li>
<li>
<p>write a module descriptor file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you have to make the extension module visible to Groovy, which is as simple as having the extension module classes
and descriptor available on classpath. This means that you have the choice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either provide the classes and module descriptor directly on classpath</p>
</li>
<li>
<p>or bundle your extension module into a jar for reusability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An extension module may add two kind of methods to a class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>instance methods (to be called on an instance of a class)</p>
</li>
<li>
<p>static methods (to be called on the class itself)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_instance_methods"><a class="link" href="#_instance_methods">4.1.10.2. Instance methods</a></h5>
<div class="paragraph">
<p>To add an instance method to an existing class, you need to create an extension class. For example, let&#8217;s say you
want to add a <code>maxRetries</code> method on <code>Integer</code> which accepts a closure and executes it at most <em>n</em> times until no
exception is thrown. To do that, you only need to write the following:</p>
</div>
<div class="listingblock">
<div class="title">MaxRetriesExtension.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MaxRetriesExtension</span> {                                     // <b class="conum">(1)</b>
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> maxRetries(<span style="color:#0a8;font-weight:bold">Integer</span> self, Closure code) {        // <b class="conum">(2)</b>
        <span style="color:#080;font-weight:bold">assert</span> self &gt;= <span style="color:#00D">0</span>
        <span style="color:#339;font-weight:bold">int</span> retries = self
        <span style="color:#0a8;font-weight:bold">Throwable</span> e = <span style="color:#069">null</span>
        <span style="color:#080;font-weight:bold">while</span> (retries &gt; <span style="color:#00D">0</span>) {
            <span style="color:#080;font-weight:bold">try</span> {
                code.call()
                <span style="color:#080;font-weight:bold">break</span>
            } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#0a8;font-weight:bold">Throwable</span> err) {
                e = err
                retries--
            }
        }
        <span style="color:#080;font-weight:bold">if</span> (retries == <span style="color:#00D">0</span> &amp;&amp; e) {
            <span style="color:#080;font-weight:bold">throw</span> e
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The extension class</p>
</li>
<li>
<p>First argument of the static method corresponds to the receiver of the message, that is to say the extended instance</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, after <a href="#module-descriptor">having declared your extension class</a>, you can call it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">int</span> i=<span style="color:#00D">0</span>
<span style="color:#00D">5</span>.maxRetries {
    i++
}
<span style="color:#080;font-weight:bold">assert</span> i == <span style="color:#00D">1</span>
i=<span style="color:#00D">0</span>
<span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#00D">5</span>.maxRetries {
        i++
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">oops</span><span style="color:#710">&quot;</span></span>)
    }
} <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">RuntimeException</span> e) {
    <span style="color:#080;font-weight:bold">assert</span> i == <span style="color:#00D">5</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_methods_2"><a class="link" href="#_static_methods_2">4.1.10.3. Static methods</a></h5>
<div class="paragraph">
<p>It is also possible to add static methods to a class. In that case, the static method needs to be defined in its <strong>own</strong>
file. Static and instance extension methods <strong>cannot</strong> be present in the same class.</p>
</div>
<div class="listingblock">
<div class="title">StaticStringExtension.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">StaticStringExtension</span> {                                       // <b class="conum">(1)</b>
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> self) {                           // <b class="conum">(2)</b>
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The static extension class</p>
</li>
<li>
<p>First argument of the static method corresponds to the class being extended and is <strong>unused</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In which case you can call it directly on the <code>String</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">String</span>.greeting() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="module-descriptor"><a class="link" href="#module-descriptor">4.1.10.4. Module descriptor</a></h5>
<div class="paragraph">
<p>For Groovy to be able to load your extension methods, you must declare
your extension helper classes. You must create a file named
<code>org.codehaus.groovy.runtime.ExtensionModule</code> into the
<code>META-INF/groovy</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">org.codehaus.groovy.runtime.ExtensionModule</div>
<div class="content">
<pre>moduleName=Test module for specifications
moduleVersion=1.0-test
extensionClasses=support.MaxRetriesExtension
staticExtensionClasses=support.StaticStringExtension</pre>
</div>
</div>
<div class="paragraph">
<p>The module descriptor requires 4 keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>moduleName</em> : the name of your module</p>
</li>
<li>
<p><em>moduleVersion</em>: the version of your module. Note that version number
is only used to check that you don’t load the same module in two
different versions.</p>
</li>
<li>
<p><em>extensionClasses</em>: the list of extension helper classes for instance
methods. You can provide several classes, given that they are comma
separated.</p>
</li>
<li>
<p><em>staticExtensionClasses</em>: the list of extension helper classes for
static methods. You can provide several classes, given that they are
comma separated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that it is not required for a module to define both static helpers
and instance helpers, and that you may add several classes to a single
module. You can also extend different classes in a single module without
problem. It is even possible to use different classes in a single
extension class, but it is recommended to group extension methods into
classes by feature set.</p>
</div>
</div>
<div class="sect4">
<h5 id="_extension_modules_and_classpath"><a class="link" href="#_extension_modules_and_classpath">4.1.10.5. Extension modules and classpath</a></h5>
<div class="paragraph">
<p>It&#8217;s worth noting that you can&#8217;t use an extension which is compiled at the same time as code using it. That means that
to use an extension, it <strong>has</strong> to be available on classpath, as compiled classes, before the code using it gets compiled.
Usually, this means that you can&#8217;t have the <em>test</em> classes in the same source unit as the extension class itself. Since
in general, test sources are separated from normal sources and executed in another step of the build, this is not an issue.</p>
</div>
</div>
<div class="sect4">
<h5 id="_compatibility_with_type_checking"><a class="link" href="#_compatibility_with_type_checking">4.1.10.6. Compatibility with type checking</a></h5>
<div class="paragraph">
<p>Unlike categories, extension modules are compatible with type checking: if they are found on classpath, then the type
checker is aware of the extension methods and will not complain when you call them. It is also compatible with static
compilation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compile_time_metaprogramming"><a class="link" href="#_compile_time_metaprogramming">4.2. Compile-time metaprogramming</a></h3>
<div class="paragraph">
<p>Compile-time metaprogramming in Groovy allows code generation at compile-time. Those transformations are altering the
Abstract Syntax Tree (AST) of a program, which is why in Groovy we call it AST transformations. AST transformations
allow you to hook into the compilation process, modify the AST and continue the compilation process to generate regular
bytecode. Compared to runtime metaprogramming, this has the advantage of making the changes visible in the class file
itself (that is to say, in the bytecode). Making it visible in the bytecode is important for example if you want the
transformations to be part of the class contract (implementing interfaces, extending abstract classes, &#8230;&#8203;) or even
if you need your class to be callable from Java (or other JVM languages). For example, an AST transformation can add
methods to a class. If you do it with runtime metaprogramming, the new method would only be visible from Groovy. If you
do the same using compile-time metaprogramming, the method would be visible from Java too. Last but not least, performance
would likely be better with compile-time metaprogramming (because no initialization phase is required).</p>
</div>
<div class="paragraph">
<p>In this section, we will start with explaining the various compile-time transformations that are bundled with the Groovy
distribution. In a subsequent section, we will describe how you can <a href="#developing-ast-xforms">implement your own AST transformations</a>
and what are the disadvantages of this technique.</p>
</div>
<div class="sect3">
<h4 id="_available_ast_transformations"><a class="link" href="#_available_ast_transformations">4.2.1. Available AST transformations</a></h4>
<div class="paragraph">
<p>Groovy comes with various AST transformations covering different needs: reducing boilerplate (code generation), implementing
design patterns (delegation, &#8230;&#8203;), logging, declarative concurrency, cloning, safer scripting, tweaking the compilation,
implementing Swing patterns, testing and eventually managing dependencies. If none of those AST transformations cover
your needs, you can still implement your own, as show in section <a href="#developing-ast-xforms">Developing your own AST transformations</a>.</p>
</div>
<div class="paragraph">
<p>AST transformations can be separated into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>global AST transformations are applied transparently, globally, as soon as they are found on compile classpath</p>
</li>
<li>
<p>local AST transformations are applied by annotating the source code with markers. Unlike global AST transformations,
local AST transformations may support parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy doesn&#8217;t ship with any global AST transformation, but you can find a list of local AST transformations
available for you to use in your code here:</p>
</div>
<div class="sect4">
<h5 id="_code_generation_transformations"><a class="link" href="#_code_generation_transformations">4.2.1.1. Code generation transformations</a></h5>
<div class="paragraph">
<p>This category of transformation includes AST transformations which help removing boilerplate code. This is typically
code that you have to write but that does not carry any useful information. By autogenerating this boilerplate code,
the code you have to write is left clean and concise and the chance of introducing an error by getting such
boilerplate code incorrect is reduced.</p>
</div>
<div class="sect5">
<h6 id="xform-ToString"><a class="link" href="#xform-ToString"><code>@groovy.transform.ToString</code></a></h6>
<div class="paragraph">
<p>The <code>@ToString</code> AST transformation generates a human-readable <code>toString</code> representation of the class. For example,
annotating the <code>Person</code> class like below will automatically generate the <code>toString</code> method for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ToString</span>

<span style="color:#007">@ToString</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, then the following assertion passes, meaning that a <code>toString</code> method taking the field values from
the class and printing them out has been generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ToString</code> annotation accepts several parameters which are summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firstName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker list (indicates all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should superclass be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Id</span> { <span style="color:#339;font-weight:bold">long</span> id }

<span style="color:#007">@ToString</span>(includeSuper=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> <span style="color:#088;font-weight:bold">extends</span> Id {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">id</span>:<span style="color:#00D">1</span>, <span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson, Id(1))</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include names of properties in generated toString.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includeNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(firstName:Jack, lastName:Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in toString, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includeFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> age
    <span style="color:#339;font-weight:bold">void</span> test() {
       age = <span style="color:#00D">42</span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
p.test()
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson, 42)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#007">@ToString</span>(includeSuperProperties = <span style="color:#069">true</span>, includeNames = <span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BandMember</span> <span style="color:#088;font-weight:bold">extends</span> Person {
    <span style="color:#0a8;font-weight:bold">String</span> bandName
}

<span style="color:#080;font-weight:bold">def</span> bono = <span style="color:#080;font-weight:bold">new</span> BandMember(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bono</span><span style="color:#710">'</span></span>, <span style="color:#606">bandName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">U2</span><span style="color:#710">'</span></span>).toString()

<span style="color:#080;font-weight:bold">assert</span> bono.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">BandMember(bandName:U2, name:Bono)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should visible super fields be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#007">@ToString</span>(includeSuperFields = <span style="color:#069">true</span>, includeNames = <span style="color:#069">true</span>)
<span style="color:#007">@MapConstructor</span>(includeSuperFields = <span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BandMember</span> <span style="color:#088;font-weight:bold">extends</span> Person {
    <span style="color:#0a8;font-weight:bold">String</span> bandName
}

<span style="color:#080;font-weight:bold">def</span> bono = <span style="color:#080;font-weight:bold">new</span> BandMember(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bono</span><span style="color:#710">'</span></span>, <span style="color:#606">bandName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">U2</span><span style="color:#710">'</span></span>).toString()

<span style="color:#080;font-weight:bold">assert</span> bono.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">BandMember(bandName:U2, name:Bono)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreNulls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties/fields with null value be displayed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(ignoreNulls=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includePackage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use fully qualified class name instead of simple name in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includePackage=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">acme.Person(Jack, Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include all JavaBean properties in toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includeNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> getLastName() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span> }
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">acme.Person(firstName:Jack, lastName:Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the toString string. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(cache=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> s1 = p.toString()
<span style="color:#080;font-weight:bold">def</span> s2 = p.toString()
<span style="color:#080;font-weight:bold">assert</span> s1 == s2
<span style="color:#080;font-weight:bold">assert</span> s1 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> s1.is(s2) <span style="color:#777">// same instance</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included in the generated toString</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(allNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> <span style="color:#F00;background-color:#FAA">$</span>firstName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#F00;background-color:#FAA">$</span><span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jack</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">acme.Person(Jack)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-EqualsAndHashCode"><a class="link" href="#xform-EqualsAndHashCode"><code>@groovy.transform.EqualsAndHashCode</code></a></h6>
<div class="paragraph">
<p>The <code>@EqualsAndHashCode</code> AST transformation aims at generating <code>equals</code> and <code>hashCode</code> methods for you. The generated
hashcode follows the best practices as described in <em>Effective Java</em> by <em>Josh Bloch</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1==p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several options available to tweak the behavior of <code>@EqualsAndHashCode</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firstName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1==p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker list (indicating all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>(includes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1==p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() == p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the hashCode computation. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>

<span style="color:#007">@Immutable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SlowHashCode</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> SLEEP_PERIOD = <span style="color:#00D">500</span>

    <span style="color:#339;font-weight:bold">int</span> hashCode() {
        sleep SLEEP_PERIOD
        <span style="color:#00D">127</span>
    }
}

<span style="color:#007">@EqualsAndHashCode</span>(cache=<span style="color:#069">true</span>)
<span style="color:#007">@Immutable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    SlowHashCode slowHashCode = <span style="color:#080;font-weight:bold">new</span> SlowHashCode()
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()
p.hashCode()

<span style="color:#080;font-weight:bold">def</span> start = <span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis()
p.hashCode()
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis() - start &lt; SlowHashCode.SLEEP_PERIOD</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include super in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Living</span> {
    <span style="color:#0a8;font-weight:bold">String</span> race
}

<span style="color:#007">@EqualsAndHashCode</span>(callSuper=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> <span style="color:#088;font-weight:bold">extends</span> Living {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">race</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Human</span><span style="color:#710">'</span></span>, <span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">race</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Human being</span><span style="color:#710">'</span></span>, <span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1!=p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() != p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in equals/hashCode, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>(includeFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> firstName

    Person(<span style="color:#0a8;font-weight:bold">String</span> firstName) {
        <span style="color:#950">this</span>.firstName = firstName
    }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1 == p2
<span style="color:#080;font-weight:bold">assert</span> p1 != p3</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useCanEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should equals call canEqual helper method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>See <a href="http://www.artima.com/lejava/articles/equality.html" class="bare">http://www.artima.com/lejava/articles/equality.html</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties be included in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@EqualsAndHashCode</span>(allProperties=<span style="color:#069">true</span>, excludes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">first, last</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first, last
    <span style="color:#0a8;font-weight:bold">String</span> getInitials() { first[<span style="color:#00D">0</span>] + last[<span style="color:#00D">0</span>] }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Spratt</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1 == p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() == p2.hashCode()
<span style="color:#080;font-weight:bold">assert</span> p1 != p3
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() != p3.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.EqualsAndHashCode</span>

<span style="color:#007">@EqualsAndHashCode</span>(allNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> <span style="color:#F00;background-color:#FAA">$</span>firstName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#F00;background-color:#FAA">$</span><span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#F00;background-color:#FAA">$</span><span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1 != p2
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode() != p2.hashCode()</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-TupleConstructor"><a class="link" href="#xform-TupleConstructor"><code>@groovy.transform.TupleConstructor</code></a></h6>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> annotation aims at eliminating boilerplate code by generating constructors for you. A tuple
constructor is created having a parameter for each property (and possibly each field). Each parameter has a default value
(using the initial value of the property if present or otherwise Java&#8217;s default value according to the properties type).</p>
</div>
</div>
<div class="sect5">
<h6 id="_implementation_details"><a class="link" href="#_implementation_details">Implementation Details</a></h6>
<div class="paragraph">
<p>Normally you don&#8217;t need to understand the implementation details of the generated constructor(s); you just use them in the normal way.
However, if you want to add multiple constructors, understand Java integration options or meet requirements of some
dependency injection frameworks, then some details are useful.</p>
</div>
<div class="paragraph">
<p>As previously mentioned, the generated constructor has default values applied. In later compilation phases,
the Groovy compiler&#8217;s standard default value processing behavior is then applied.
The end result is that multiple constructors are placed within the bytecode of your class.
This provides a well understood semantics and is also useful for Java integration purposes. As an example, the
following code will generate 3 constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#777">// traditional map-style constructor</span>
<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#777">// generated tuple constructor</span>
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#777">// generated tuple constructor with default value for second property</span>
<span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first constructor is a no-arg constructor which allows the traditional map-style construction so long as
you don&#8217;t have final properties. Groovy calls the no-arg constructor and then the relevant setters under the covers.
It is worth noting that if the first property (or field) has type LinkedHashMap or if there is a single Map,
AbstractMap or HashMap property (or field), then the map-style named arguments won&#8217;t be available.</p>
</div>
<div class="paragraph">
<p>The other constructors are generated by taking the properties in the order they are defined. Groovy will generate as
many constructors as there are properties (or fields, depending on the options).</p>
</div>
<div class="paragraph">
<p>Setting the <code>defaults</code> attribute (see the available configuration options table) to <code>false</code>, disables the normal default values behavior which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exactly one constructor will be produced</p>
</li>
<li>
<p>Attempting to use an initial value will produce an error</p>
</li>
<li>
<p>Map-style named arguments won&#8217;t be available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This attribute is normally only used in situations where another Java framework is
expecting exactly one constructor, e.g. injection frameworks or JUnit parameterized runners.</p>
</div>
</div>
<div class="sect5">
<h6 id="_immutability_support"><a class="link" href="#_immutability_support">Immutability support</a></h6>
<div class="paragraph">
<p>If the <code>@PropertyOptions</code> annotation is also found on the class with the <code>@TupleConstructor</code> annotation,
then the generated constructor may contain custom property handling logic.
The <code>propertyHandler</code> attribute on the <code>@PropertyOptions</code> annotation could for instance be set to
<code>ImmutablePropertyHandler</code> which will result in the addition of the necessary logic for immutable classes
(defensive copy in, cloning, etc.). This normally would happen automatically behind the scenes when you use
the <code>@Immutable</code> meta-annotation.
Some of the annotation attributes might not be supported by all property handlers.</p>
</div>
</div>
<div class="sect5">
<h6 id="_customization_options"><a class="link" href="#_customization_options">Customization options</a></h6>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> AST transformation accepts several annotation attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#777">// will fail because the second property is excluded</span>
    <span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
} <span style="color:#080;font-weight:bold">catch</span> (e) {
    <span style="color:#080;font-weight:bold">assert</span> e.message.contains (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Could not find matching constructor</span><span style="color:#710">'</span></span>)
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined list (indicates all fields)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(includes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firstName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#777">// will fail because the second property is not included</span>
    <span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
} <span style="color:#080;font-weight:bold">catch</span> (e) {
    <span style="color:#080;font-weight:bold">assert</span> e.message.contains (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Could not find matching constructor</span><span style="color:#710">'</span></span>)
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(includeProperties=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
} <span style="color:#080;font-weight:bold">catch</span>(e) {
    <span style="color:#777">// will fail because properties are not included</span>
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in tuple constructor generation, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(includeFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> occupation
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>firstName</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>lastName</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>occupation</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>, <span style="color:#606">occupation</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Actor</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Actor</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1.firstName == p2.firstName
<span style="color:#080;font-weight:bold">assert</span> p1.lastName == p2.lastName
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: Actor</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == p2.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Base</span> {
    <span style="color:#0a8;font-weight:bold">String</span> occupation
}

<span style="color:#007">@TupleConstructor</span>(includeSuperProperties=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> <span style="color:#088;font-weight:bold">extends</span> Base {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>firstName</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>lastName</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>occupation</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Actor</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1.firstName == p2.firstName
<span style="color:#080;font-weight:bold">assert</span> p1.lastName == p2.lastName
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: null</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: Actor</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Base</span> {
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">String</span> occupation
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> occupation() { <span style="color:#950">this</span>.occupation }
}

<span style="color:#007">@TupleConstructor</span>(includeSuperFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> <span style="color:#088;font-weight:bold">extends</span> Base {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>firstName</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>lastName</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>occupation()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>, <span style="color:#606">occupation</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Actor</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Actor</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1.firstName == p2.firstName
<span style="color:#080;font-weight:bold">assert</span> p1.lastName == p2.lastName
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: Actor</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == p1.toString()</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be called within a call to the parent constructor rather than set as properties</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Base</span> {
    <span style="color:#0a8;font-weight:bold">String</span> occupation
    Base() {}
    Base(<span style="color:#0a8;font-weight:bold">String</span> job) { occupation = job?.toLowerCase() }
}

<span style="color:#007">@TupleConstructor</span>(includeSuperProperties = <span style="color:#069">true</span>, callSuper=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> <span style="color:#088;font-weight:bold">extends</span> Base {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>firstName</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>lastName</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>occupation</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ACTOR</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p1.firstName == p2.firstName
<span style="color:#080;font-weight:bold">assert</span> p1.lastName == p2.lastName
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: null</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Nicholson: actor</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will do nothing if a constructor is already defined. Setting this attribute to
true, the constructor will be generated and it&#8217;s your responsibility to ensure that no duplicate constructor is defined.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@ToString</span> <span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>)
<span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#777">// explicit constructor would normally disable tuple constructor</span>
    Person(<span style="color:#0a8;font-weight:bold">String</span> first, <span style="color:#0a8;font-weight:bold">String</span> last) { <span style="color:#950">this</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>first</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>last</span><span style="color:#710">&quot;</span></span>) }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john smith</span><span style="color:#710">'</span></span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(john smith)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">smith</span><span style="color:#710">'</span></span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(john smith)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaults</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that default value processing is enabled for constructor parameters.
Set to false to obtain exactly one constructor but with initial value support and named-arguments disabled.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>
<span style="color:#007">@TupleConstructor</span>(defaults=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Musician</span> {
  <span style="color:#0a8;font-weight:bold">String</span> name
  <span style="color:#0a8;font-weight:bold">String</span> instrument
  <span style="color:#339;font-weight:bold">int</span> born
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Musician(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jimi</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Guitar</span><span style="color:#710">'</span></span>, <span style="color:#00D">1942</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Musician(Jimi, Guitar, 1942)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> Musician.constructors.size() == <span style="color:#00D">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useSetters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will directly set the backing field of each property
from its corresponding constructor parameter. Setting this attribute to true, the constructor will instead call setters if
they exist. It&#8217;s usually deemed bad style from within a constructor to call setters that can be overridden. It&#8217;s your
responsibility to avoid such bad style.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@ToString</span> <span style="color:#007">@TupleConstructor</span>(useSetters=<span style="color:#069">true</span>)
<span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
    <span style="color:#0a8;font-weight:bold">String</span> bar
    <span style="color:#339;font-weight:bold">void</span> setBar(<span style="color:#0a8;font-weight:bold">String</span> bar) {
        <span style="color:#950">this</span>.bar = bar?.toUpperCase() <span style="color:#777">// null-safe</span>
    }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Foo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cat</span><span style="color:#710">'</span></span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo(CAT)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Foo(<span style="color:#606">bar</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cat</span><span style="color:#710">'</span></span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo(CAT)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields and/or properties with internal names be included within the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(allNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> <span style="color:#F00;background-color:#FAA">$</span>firstName
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p.<span style="color:#F00;background-color:#FAA">$</span>firstName == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties be included within the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TupleConstructor</span>(allProperties=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#339;font-weight:bold">void</span> setLast(<span style="color:#0a8;font-weight:bold">String</span> last) {
        <span style="color:#950">this</span>.last = last
    }
    <span style="color:#0a8;font-weight:bold">String</span> getName() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>first</span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>last</span><span style="color:#710">&quot;</span></span> }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">smith</span><span style="color:#710">'</span></span>).name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john smith</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A closure containing statements to be inserted at the start of the generated constructor(s)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>(pre={ first = first?.toLowerCase() })
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">assert</span> p.first == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jack</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A closure containing statements to be inserted at the end of the generated constructor(s)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovy.test.GroovyAssert.shouldFail</span>

<span style="color:#007">@TupleConstructor</span>(post={ <span style="color:#080;font-weight:bold">assert</span> first })
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
}

<span style="color:#080;font-weight:bold">def</span> jack = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>)
shouldFail {
  <span style="color:#080;font-weight:bold">def</span> unknown = <span style="color:#080;font-weight:bold">new</span> Person()
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting the <code>defaults</code> annotation attribute to <code>false</code> and the <code>force</code> annotation attribute to <code>true</code> allows
multiple tuple constructors to be created by using different customization options for the different cases
(provided each case has a different type signature) as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Named</span> {
  <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#007">@ToString</span>(includeSuperProperties=<span style="color:#069">true</span>, ignoreNulls=<span style="color:#069">true</span>, includeNames=<span style="color:#069">true</span>, includeFields=<span style="color:#069">true</span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>, includeFields=<span style="color:#069">true</span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>, includeSuperProperties=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> <span style="color:#088;font-weight:bold">extends</span> Named {
  <span style="color:#0a8;font-weight:bold">Integer</span> published
  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Boolean</span> fiction
  <span style="color:#0a8;font-weight:bold">Book</span>() {}
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Regina</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">2015</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(published:2015, name:Regina)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#00D">2015</span>, <span style="color:#069">false</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(published:2015, fiction:false)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#00D">2015</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(published:2015)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>().toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book()</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Book</span>.constructors.size() == <span style="color:#00D">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, here is another example using different options for <code>includes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ToString</span>(includeSuperProperties=<span style="color:#069">true</span>, ignoreNulls=<span style="color:#069">true</span>, includeNames=<span style="color:#069">true</span>, includeFields=<span style="color:#069">true</span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>, includes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name,year</span><span style="color:#710">'</span></span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>, includes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">year,fiction</span><span style="color:#710">'</span></span>)
<span style="color:#007">@TupleConstructor</span>(force=<span style="color:#069">true</span>, defaults=<span style="color:#069">false</span>, includes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name,fiction</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#0a8;font-weight:bold">Integer</span> year
    <span style="color:#0a8;font-weight:bold">Boolean</span> fiction
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Regina</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">2015</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(name:Regina, year:2015)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#00D">2015</span>, <span style="color:#069">false</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(year:2015, fiction:false)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Regina</span><span style="color:#710">&quot;</span></span>, <span style="color:#069">false</span>).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Book(name:Regina, fiction:false)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Book</span>.constructors.size() == <span style="color:#00D">3</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-MapConstructor"><a class="link" href="#xform-MapConstructor"><code>@groovy.transform.MapConstructor</code></a></h6>
<div class="paragraph">
<p>The <code>@MapConstructor</code> annotation aims at eliminating boilerplate code by generating a map constructor for you. A map
constructor is created such that each property in the class is set based on the value in the supplied map
having the key with the name of the property. Usage is as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@ToString</span>
<span style="color:#007">@MapConstructor</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}

<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated constructor will be roughly like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> Person(<span style="color:#0a8;font-weight:bold">Map</span> args) {
    <span style="color:#080;font-weight:bold">if</span> (args.containsKey(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firstName</span><span style="color:#710">'</span></span>)) {
        <span style="color:#950">this</span>.firstName = args.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">firstName</span><span style="color:#710">'</span></span>)
    }
    <span style="color:#080;font-weight:bold">if</span> (args.containsKey(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>)) {
        <span style="color:#950">this</span>.lastName = args.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-Canonical"><a class="link" href="#xform-Canonical"><code>@groovy.transform.Canonical</code></a></h6>
<div class="paragraph">
<p>The <code>@Canonical</code> meta-annotation combines the <a href="#xform-ToString">@ToString</a>,
<a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a> and <a href="#xform-TupleConstructor">@TupleConstructor</a>
annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Canonical</span>

<span style="color:#007">@Canonical</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}
<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson)</span><span style="color:#710">'</span></span> <span style="color:#777">// Effect of @ToString</span>

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>) <span style="color:#777">// Effect of @TupleConstructor</span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack, Nicholson)</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> p1==p2 <span style="color:#777">// Effect of @EqualsAndHashCode</span>
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode()==p2.hashCode() <span style="color:#777">// Effect of @EqualsAndHashCode</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A similar immutable class can be generated using the <a href="#xform-Immutable">@Immutable</a> meta-annotation instead.
The <code>@Canonical</code> meta-annotation supports the configuration options found in the annotations
it aggregates. See those annotations for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Canonical</span>

<span style="color:#007">@Canonical</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}
<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack)</span><span style="color:#710">'</span></span> <span style="color:#777">// Effect of @ToString(excludes=['lastName'])</span>

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>) <span style="color:#777">// Effect of @TupleConstructor(excludes=['lastName'])</span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack)</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> p1==p2 <span style="color:#777">// Effect of @EqualsAndHashCode(excludes=['lastName'])</span>
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode()==p2.hashCode() <span style="color:#777">// Effect of @EqualsAndHashCode(excludes=['lastName'])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Canonical</code> meta-annotation can be used in conjunction with an explicit use one or more of its
component annotations, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Canonical</span>

<span style="color:#007">@Canonical</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lastName</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
}
<span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">firstName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>, <span style="color:#606">lastName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Nicholson</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> p1.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack)</span><span style="color:#710">'</span></span> <span style="color:#777">// Effect of @ToString(excludes=['lastName'])</span>

<span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack</span><span style="color:#710">'</span></span>) <span style="color:#777">// Effect of @TupleConstructor(excludes=['lastName'])</span>
<span style="color:#080;font-weight:bold">assert</span> p2.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Jack)</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">assert</span> p1==p2 <span style="color:#777">// Effect of @EqualsAndHashCode(excludes=['lastName'])</span>
<span style="color:#080;font-weight:bold">assert</span> p1.hashCode()==p2.hashCode() <span style="color:#777">// Effect of @EqualsAndHashCode(excludes=['lastName'])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any applicable annotation attributes from <code>@Canonical</code> are passed along to the explicit annotation but
attributes already existing in the explicit annotation take precedence.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-InheritConstructors"><a class="link" href="#xform-InheritConstructors"><code>@groovy.transform.InheritConstructors</code></a></h6>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation aims at generating constructors matching super constructors for you. This
is in particular useful when overriding exception classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.InheritConstructors</span>

<span style="color:#007">@InheritConstructors</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomException</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#C00;font-weight:bold">Exception</span> {}

<span style="color:#777">// all those are generated constructors</span>
<span style="color:#080;font-weight:bold">new</span> CustomException()
<span style="color:#080;font-weight:bold">new</span> CustomException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">A custom message</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">new</span> CustomException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">A custom message</span><span style="color:#710">&quot;</span></span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>())
<span style="color:#080;font-weight:bold">new</span> CustomException(<span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>())

<span style="color:#777">// Java 7 only</span>
<span style="color:#777">// new CustomException(&quot;A custom message&quot;, new RuntimeException(), false, true)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constructorAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor during copying</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.RUNTIME)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.CONSTRUCTOR])
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> ConsAnno {}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Base</span> {
  <span style="color:#007">@ConsAnno</span> Base() {}
}

<span style="color:#007">@InheritConstructors</span>(constructorAnnotations=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Child</span> <span style="color:#088;font-weight:bold">extends</span> Base {}

<span style="color:#080;font-weight:bold">assert</span> Child.constructors[<span style="color:#00D">0</span>].annotations[<span style="color:#00D">0</span>].annotationType().name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">groovy.transform.Generated</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> Child.constructors[<span style="color:#00D">0</span>].annotations[<span style="color:#00D">1</span>].annotationType().name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ConsAnno</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor parameters when copying the constructor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.RUNTIME)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.PARAMETER])
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> ParamAnno {}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Base</span> {
  Base(<span style="color:#007">@ParamAnno</span> <span style="color:#0a8;font-weight:bold">String</span> name) {}
}

<span style="color:#007">@InheritConstructors</span>(parameterAnnotations=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Child</span> <span style="color:#088;font-weight:bold">extends</span> Base {}

<span style="color:#080;font-weight:bold">assert</span> Child.constructors[<span style="color:#00D">0</span>].parameterAnnotations[<span style="color:#00D">0</span>][<span style="color:#00D">0</span>].annotationType().name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ParamAnno</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-Category"><a class="link" href="#xform-Category"><code>@groovy.lang.Category</code></a></h6>
<div class="paragraph">
<p>The <code>@Category</code> AST transformation simplifies the creation of Groovy categories. Historically, a Groovy category was
written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TripleCategory</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Integer</span> triple(<span style="color:#0a8;font-weight:bold">Integer</span> self) {
        <span style="color:#00D">3</span>*self
    }
}
use (TripleCategory) {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">9</span> == <span style="color:#00D">3</span>.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Category</code> transformation lets you write the same using an instance-style class, rather than a static class style.
This removes the need for having the first argument of each method being the receiver. The category can be written like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Category</span>(<span style="color:#0a8;font-weight:bold">Integer</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TripleCategory</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Integer</span> triple() { <span style="color:#00D">3</span>*<span style="color:#950">this</span> }
}
use (TripleCategory) {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">9</span> == <span style="color:#00D">3</span>.triple()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the mixed in class can be referenced using <code>this</code> instead. It&#8217;s also worth noting that using instance fields
in a category class is inherently unsafe: categories are not stateful (like traits).</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-IndexedProperty"><a class="link" href="#xform-IndexedProperty"><code>@groovy.transform.IndexedProperty</code></a></h6>
<div class="paragraph">
<p>The <code>@IndexedProperty</code> annotation aims at generating indexed getters/setters for properties of list/array types.
This is in particular useful if you want to use a Groovy class from Java. While Groovy supports GPath to access properties,
this is not available from Java. The <code>@IndexedProperty</code> annotation will generate indexed properties of the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SomeBean</span> {
    <span style="color:#007">@IndexedProperty</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> someArray = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">String</span>[<span style="color:#00D">2</span>]
    <span style="color:#007">@IndexedProperty</span> <span style="color:#0a8;font-weight:bold">List</span> someList = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#080;font-weight:bold">def</span> bean = <span style="color:#080;font-weight:bold">new</span> SomeBean()
bean.setSomeArray(<span style="color:#00D">0</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>)
bean.setSomeList(<span style="color:#00D">0</span>, <span style="color:#00D">123</span>)

<span style="color:#080;font-weight:bold">assert</span> bean.someArray[<span style="color:#00D">0</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> bean.someList == [<span style="color:#00D">123</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-Lazy"><a class="link" href="#xform-Lazy"><code>@groovy.lang.Lazy</code></a></h6>
<div class="paragraph">
<p>The <code>@Lazy</code> AST transformation implements lazy initialization of fields. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SomeBean</span> {
    <span style="color:#007">@Lazy</span> <span style="color:#0a8;font-weight:bold">LinkedList</span> myField
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will produce the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">List</span> <span style="color:#F00;background-color:#FAA">$</span>myField
<span style="color:#0a8;font-weight:bold">List</span> getMyField() {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#F00;background-color:#FAA">$</span>myField!=<span style="color:#069">null</span>) { <span style="color:#080;font-weight:bold">return</span> <span style="color:#F00;background-color:#FAA">$</span>myField }
    <span style="color:#080;font-weight:bold">else</span> {
        <span style="color:#F00;background-color:#FAA">$</span>myField = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">LinkedList</span>()
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#F00;background-color:#FAA">$</span>myField
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value which is used to initialize the field is the default constructor of the declaration type. It is possible
to define a default value by using a closure on the right hand side of the property assignment, as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class SomeBean {
    @Lazy LinkedList myField = { ['a','b','c']}()
}</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the generated code looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = { ['a','b','c']}()
        return $myField
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the field is declared volatile then initialization will be synchronized using the
<a href="http://en.wikipedia.org/wiki/Double-checked_locking">double-checked locking</a> pattern.</p>
</div>
<div class="paragraph">
<p>Using the <code>soft=true</code> parameter, the helper field will use a <code>SoftReference</code> instead, providing a simple way to
implement caching. In that case, if the garbage collector decides to collect the reference, initialization will occur
the next time the field is accessed.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Newify"><a class="link" href="#xform-Newify"><code>@groovy.lang.Newify</code></a></h6>
<div class="paragraph">
<p>The <code>@Newify</code> AST transformation is used to bring alternative syntaxes to construct objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>Python</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree(Leaf('A'),Leaf('B'),Tree(Leaf('C')))
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>or using the <code>Ruby</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree.new(Leaf.new('A'),Leaf.new('B'),Tree.new(Leaf.new('C')))
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Ruby</code> version can be disabled by setting the <code>auto</code> flag to <code>false</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Sortable"><a class="link" href="#xform-Sortable"><code>@groovy.transform.Sortable</code></a></h6>
<div class="paragraph">
<p>The <code>@Sortable</code> AST transformation is used to help write classes that are <code>Comparable</code> and easily sorted
typically by numerous properties. It is easy to use as shown in the following example where we annotate
the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Sortable</span>

<span style="color:#007">@Sortable</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#0a8;font-weight:bold">Integer</span> born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated class has the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it implements the <code>Comparable</code> interface</p>
</li>
<li>
<p>it contains a <code>compareTo</code> method with an implementation based on the natural ordering of the <code>first</code>, <code>last</code> and <code>born</code> properties</p>
</li>
<li>
<p>it has three methods returning comparators: <code>comparatorByFirst</code>, <code>comparatorByLast</code> and <code>comparatorByBorn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">int</span> compareTo(java.lang.Object obj) {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.is(obj)) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
    }
    <span style="color:#080;font-weight:bold">if</span> (!(obj <span style="color:#080;font-weight:bold">instanceof</span> Person)) {
        <span style="color:#080;font-weight:bold">return</span> -<span style="color:#00D">1</span>
    }
    java.lang.Integer value = <span style="color:#950">this</span>.first &lt;=&gt; obj.first
    <span style="color:#080;font-weight:bold">if</span> (value != <span style="color:#00D">0</span>) {
        <span style="color:#080;font-weight:bold">return</span> value
    }
    value = <span style="color:#950">this</span>.last &lt;=&gt; obj.last
    <span style="color:#080;font-weight:bold">if</span> (value != <span style="color:#00D">0</span>) {
        <span style="color:#080;font-weight:bold">return</span> value
    }
    value = <span style="color:#950">this</span>.born &lt;=&gt; obj.born
    <span style="color:#080;font-weight:bold">if</span> (value != <span style="color:#00D">0</span>) {
        <span style="color:#080;font-weight:bold">return</span> value
    }
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of the generated comparators, the <code>comparatorByFirst</code> comparator will have a <code>compare</code> method that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">int</span> compare(java.lang.Object arg0, java.lang.Object arg1) {
    <span style="color:#080;font-weight:bold">if</span> (arg0 == arg1) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
    }
    <span style="color:#080;font-weight:bold">if</span> (arg0 != <span style="color:#069">null</span> &amp;&amp; arg1 == <span style="color:#069">null</span>) {
        <span style="color:#080;font-weight:bold">return</span> -<span style="color:#00D">1</span>
    }
    <span style="color:#080;font-weight:bold">if</span> (arg0 == <span style="color:#069">null</span> &amp;&amp; arg1 != <span style="color:#069">null</span>) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">1</span>
    }
    <span style="color:#080;font-weight:bold">return</span> arg0.first &lt;=&gt; arg1.first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> class can be used wherever a <code>Comparable</code> is expected and the generated comparators
wherever a <code>Comparator</code> is expected as shown by these examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> people = [
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1963</span>),
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Keira</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Knightley</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1985</span>),
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Geoffrey</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rush</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1951</span>),
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Orlando</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bloom</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1977</span>)
]

<span style="color:#080;font-weight:bold">assert</span> people[<span style="color:#00D">0</span>] &gt; people[<span style="color:#00D">2</span>]
<span style="color:#080;font-weight:bold">assert</span> people.sort()*.last == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rush</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Knightley</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bloom</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> people.sort(<span style="color:#069">false</span>, Person.comparatorByFirst())*.first == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Geoffrey</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Keira</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Orlando</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> people.sort(<span style="color:#069">false</span>, Person.comparatorByLast())*.last == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bloom</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Knightley</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rush</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> people.sort(<span style="color:#069">false</span>, Person.comparatorByBorn())*.last == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rush</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bloom</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Knightley</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, all properties are used in the generated <code>compareTo</code> method in the priority order in which they are defined.
You can include or exclude certain properties from the generated <code>compareTo</code> method by giving a list of property names
in the <code>includes</code> or <code>excludes</code> annotation attributes. If using <code>includes</code>, the order of the property names given will
determine the priority of properties when comparing. To illustrate, consider the following <code>Person</code> class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Sortable</span>(includes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">first,born</span><span style="color:#710">'</span></span>) <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#339;font-weight:bold">int</span> born
    <span style="color:#0a8;font-weight:bold">String</span> first
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will have two comparator methods <code>comparatorByFirst</code> and <code>comparatorByBorn</code> and the generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">int</span> compareTo(java.lang.Object obj) {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.is(obj)) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
    }
    <span style="color:#080;font-weight:bold">if</span> (!(obj <span style="color:#080;font-weight:bold">instanceof</span> Person)) {
        <span style="color:#080;font-weight:bold">return</span> -<span style="color:#00D">1</span>
    }
    java.lang.Integer value = <span style="color:#950">this</span>.first &lt;=&gt; obj.first
    <span style="color:#080;font-weight:bold">if</span> (value != <span style="color:#00D">0</span>) {
        <span style="color:#080;font-weight:bold">return</span> value
    }
    value = <span style="color:#950">this</span>.born &lt;=&gt; obj.born
    <span style="color:#080;font-weight:bold">if</span> (value != <span style="color:#00D">0</span>) {
        <span style="color:#080;font-weight:bold">return</span> value
    }
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Person</code> class can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> people = [
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ben</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Affleck</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1972</span>),
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Ben</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Stiller</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1965</span>)
]

<span style="color:#080;font-weight:bold">assert</span> people.sort()*.last == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Stiller</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Affleck</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Sortable</code> AST transformation can be further changed using the following additional parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should JavaBean properties (ordered after native properties) be used</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@Canonical</span>(includeFields = <span style="color:#069">true</span>)
<span style="color:#007">@Sortable</span>(allProperties = <span style="color:#069">true</span>, includes = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nameSize</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Player</span> {
  <span style="color:#0a8;font-weight:bold">String</span> name
  <span style="color:#339;font-weight:bold">int</span> getNameSize() { name.size() }
}

<span style="color:#080;font-weight:bold">def</span> finalists = [
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Serena</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Venus</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CoCo</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mirjana</span><span style="color:#710">'</span></span>)
]

<span style="color:#080;font-weight:bold">assert</span> finalists.sort()*.name == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CoCo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Venus</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Serena</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mirjana</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties with "internal" names be used</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@Canonical</span>(allNames = <span style="color:#069">true</span>)
<span style="color:#007">@Sortable</span>(allNames = <span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Player</span> {
  <span style="color:#0a8;font-weight:bold">String</span> <span style="color:#F00;background-color:#FAA">$</span>country
  <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#080;font-weight:bold">def</span> finalists = [
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USA</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Serena</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USA</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Venus</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USA</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CoCo</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Player(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Croatian</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mirjana</span><span style="color:#710">'</span></span>)
]

<span style="color:#080;font-weight:bold">assert</span> finalists.sort()*.name == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mirjana</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CoCo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Serena</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Venus</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties also be used (ordered first)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
  <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#007">@Canonical</span>(includeSuperProperties = <span style="color:#069">true</span>)
<span style="color:#007">@Sortable</span>(includeSuperProperties = <span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Citizen</span> <span style="color:#088;font-weight:bold">extends</span> Person {
  <span style="color:#0a8;font-weight:bold">String</span> country
}

<span style="color:#080;font-weight:bold">def</span> people = [
  <span style="color:#080;font-weight:bold">new</span> Citizen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Italy</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Citizen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Cathy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hungary</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Citizen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Cathy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Egypt</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Citizen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Germany</span><span style="color:#710">'</span></span>),
  <span style="color:#080;font-weight:bold">new</span> Citizen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Alan</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">France</span><span style="color:#710">'</span></span>)
]

<span style="color:#080;font-weight:bold">assert</span> people.sort()*.name == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Alan</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Cathy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Cathy</span><span style="color:#710">'</span></span>]
<span style="color:#080;font-weight:bold">assert</span> people.sort()*.country == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">France</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Germany</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Italy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Egypt</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hungary</span><span style="color:#710">'</span></span>]</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-Builder"><a class="link" href="#xform-Builder"><code>@groovy.transform.builder.Builder</code></a></h6>
<div class="paragraph">
<p>The <code>@Builder</code> AST transformation is used to help write classes that can be created using <em>fluent</em> api calls.
The transform supports multiple building strategies to cover a range of cases and there are a number
of configuration options to customize the building process. If you&#8217;re an AST hacker, you can also define your own
strategy class. The following table lists the available strategies that are bundled with Groovy and the
configuration options each strategy supports.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes/excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained setters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "set"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExternalStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">explicit builder class, class being built untouched</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "builder"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitializerStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class providing type-safe fluent creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "createInitializer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "create" but usually only used internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">SimpleStrategy</div>
<p>To use the <code>SimpleStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>

<span style="color:#007">@Builder</span>(builderStrategy=SimpleStrategy)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#0a8;font-weight:bold">Integer</span> born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, just call the setters in a chained fashion as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> p1 = <span style="color:#080;font-weight:bold">new</span> Person().setFirst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).setLast(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).setBorn(<span style="color:#00D">1963</span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p1</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p1</span><span style="color:#D20">.last</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For each property, a generated setter will be created which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> Person setFirst(java.lang.String first) {
    <span style="color:#950">this</span>.first = first
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a prefix as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>

<span style="color:#007">@Builder</span>(builderStrategy=SimpleStrategy, prefix=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#0a8;font-weight:bold">Integer</span> born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And calling the chained setters would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person().first(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).last(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).born(<span style="color:#00D">1963</span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.last</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>SimpleStrategy</code> in conjunction with <code>@TupleConstructor</code>. If your <code>@Builder</code>
annotation doesn&#8217;t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@TupleConstructor</code>
annotation does, the ones from <code>@TupleConstructor</code> will be re-used for <code>@Builder</code>. The same applies for any
annotation aliases which combine <code>@TupleConstructor</code> such as <code>@Canonical</code>.</p>
</div>
<div class="paragraph">
<p>The annotation attribute <code>useSetters</code> can be used if you have a setter which you want called as part of the
construction process. See the JavaDoc for details.</p>
</div>
<div class="paragraph">
<p>The annotation attributes <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>forClass</code> and <code>includeSuperProperties</code> are not supported for this strategy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Groovy already has built-in building mechanisms. Don&#8217;t rush to using <code>@Builder</code> if the built-in mechanisms meet your needs. Some examples:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> p2 = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Keira</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Knightley</span><span style="color:#710">'</span></span>, <span style="color:#606">born</span>: <span style="color:#00D">1985</span>)
<span style="color:#080;font-weight:bold">def</span> p3 = <span style="color:#080;font-weight:bold">new</span> Person().tap {
    first = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Geoffrey</span><span style="color:#710">'</span></span>
    last = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rush</span><span style="color:#710">'</span></span>
    born = <span style="color:#00D">1951</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">ExternalStrategy</div>
<p>To use the <code>ExternalStrategy</code>, create and annotate a Groovy builder class using the <code>@Builder</code> annotation, specify the
class the builder is for using <code>forClass</code> and indicate use of the <code>ExternalStrategy</code>.
Suppose you have the following class you would like a builder for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#339;font-weight:bold">int</span> born
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you explicitly create and use your builder class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>

<span style="color:#007">@Builder</span>(builderStrategy=ExternalStrategy, forClass=Person)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PersonBuilder</span> { }

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> PersonBuilder().first(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).last(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).born(<span style="color:#00D">1963</span>).build()
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.last</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the (normally empty) builder class you provide will be filled in with appropriate setters and a build method.
The generated build method will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> Person build() {
    Person _thePerson = <span style="color:#080;font-weight:bold">new</span> Person()
    _thePerson.first = first
    _thePerson.last = last
    _thePerson.born = born
    <span style="color:#080;font-weight:bold">return</span> _thePerson
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class you are creating the builder for can be any Java or Groovy class following the normal JavaBean conventions,
e.g. a no-arg constructor and setters for the properties. Here is an example using a Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>

<span style="color:#007">@Builder</span>(builderStrategy=ExternalStrategy, forClass=javax.swing.DefaultButtonModel)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ButtonModelBuilder</span> {}

<span style="color:#080;font-weight:bold">def</span> model = <span style="color:#080;font-weight:bold">new</span> ButtonModelBuilder().enabled(<span style="color:#069">true</span>).pressed(<span style="color:#069">true</span>).armed(<span style="color:#069">true</span>).rollover(<span style="color:#069">true</span>).selected(<span style="color:#069">true</span>).build()
<span style="color:#080;font-weight:bold">assert</span> model.isArmed()
<span style="color:#080;font-weight:bold">assert</span> model.isPressed()
<span style="color:#080;font-weight:bold">assert</span> model.isEnabled()
<span style="color:#080;font-weight:bold">assert</span> model.isSelected()
<span style="color:#080;font-weight:bold">assert</span> model.isRollover()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated builder can be customised using the <code>prefix</code>, <code>includes</code>, <code>excludes</code> and <code>buildMethodName</code> annotation attributes.
Here is an example illustrating various customisations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Canonical</span>

<span style="color:#007">@Canonical</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#339;font-weight:bold">int</span> born
}

<span style="color:#007">@Builder</span>(builderStrategy=ExternalStrategy, forClass=Person, includes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">first</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">last</span><span style="color:#710">'</span></span>], buildMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">create</span><span style="color:#710">'</span></span>, prefix=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">with</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PersonBuilder</span> { }

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> PersonBuilder().withFirst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).withLast(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).create()
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.last</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>builderMethodName</code> and <code>builderClassName</code> annotation attributes for <code>@Builder</code> aren&#8217;t applicable for this strategy.</p>
</div>
<div class="paragraph">
<p>You can use the <code>ExternalStrategy</code> in conjunction with <code>@TupleConstructor</code>. If your <code>@Builder</code> annotation doesn&#8217;t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but the <code>@TupleConstructor</code> annotation of the class you are creating
the builder for does, the ones from <code>@TupleConstructor</code> will be re-used for <code>@Builder</code>. The same applies for any
annotation aliases which combine <code>@TupleConstructor</code> such as <code>@Canonical</code>.</p>
</div>
<div class="paragraph">
<div class="title">DefaultStrategy</div>
<p>To use the <code>DefaultStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.Builder</span>

<span style="color:#007">@Builder</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#339;font-weight:bold">int</span> age
}

<span style="color:#080;font-weight:bold">def</span> person = Person.builder().firstName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Robert</span><span style="color:#710">&quot;</span></span>).lastName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lewandowski</span><span style="color:#710">&quot;</span></span>).age(<span style="color:#00D">21</span>).build()
<span style="color:#080;font-weight:bold">assert</span> person.firstName == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Robert</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> person.lastName == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lewandowski</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> person.age == <span style="color:#00D">21</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want, you can customize various aspects of the building process
using the <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>prefix</code>, <code>includes</code> and <code>excludes</code> annotation attributes,
some of which are used in the example here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.Builder</span>

<span style="color:#007">@Builder</span>(buildMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">make</span><span style="color:#710">'</span></span>, builderMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">maker</span><span style="color:#710">'</span></span>, prefix=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">with</span><span style="color:#710">'</span></span>, excludes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#339;font-weight:bold">int</span> age
}

<span style="color:#080;font-weight:bold">def</span> p = Person.maker().withFirstName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Robert</span><span style="color:#710">&quot;</span></span>).withLastName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lewandowski</span><span style="color:#710">&quot;</span></span>).make()
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.firstName </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.lastName</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Robert Lewandowski</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
Here is an example highlighting method and constructor usage (and also illustrating the renaming required for unique names).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@ToString</span>
<span style="color:#007">@Builder</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
  <span style="color:#0a8;font-weight:bold">String</span> first, last
  <span style="color:#339;font-weight:bold">int</span> born

  Person(){}

  <span style="color:#007">@Builder</span>(builderClassName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MovieBuilder</span><span style="color:#710">'</span></span>, builderMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">byRoleBuilder</span><span style="color:#710">'</span></span>)
  Person(<span style="color:#0a8;font-weight:bold">String</span> roleName) {
     <span style="color:#080;font-weight:bold">if</span> (roleName == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jack Sparrow</span><span style="color:#710">'</span></span>) {
         <span style="color:#950">this</span>.first = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>; <span style="color:#950">this</span>.last = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>; <span style="color:#950">this</span>.born = <span style="color:#00D">1963</span>
     }
  }

  <span style="color:#007">@Builder</span>(builderClassName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">NameBuilder</span><span style="color:#710">'</span></span>, builderMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nameBuilder</span><span style="color:#710">'</span></span>, prefix=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">having</span><span style="color:#710">'</span></span>, buildMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fullName</span><span style="color:#710">'</span></span>)
  <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">String</span> join(<span style="color:#0a8;font-weight:bold">String</span> first, <span style="color:#0a8;font-weight:bold">String</span> last) {
      first + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span> + last
  }

  <span style="color:#007">@Builder</span>(builderClassName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">SplitBuilder</span><span style="color:#710">'</span></span>, builderMethodName=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">splitBuilder</span><span style="color:#710">'</span></span>)
  <span style="color:#088;font-weight:bold">static</span> Person split(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#339;font-weight:bold">int</span> year) {
      <span style="color:#080;font-weight:bold">def</span> parts = name.split(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>)
      <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>: parts[<span style="color:#00D">0</span>], <span style="color:#606">last</span>: parts[<span style="color:#00D">1</span>], <span style="color:#606">born</span>: year)
  }
}

<span style="color:#080;font-weight:bold">assert</span> Person.splitBuilder().name(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">&quot;</span></span>).year(<span style="color:#00D">1963</span>).build().toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Johnny, Depp, 1963)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> Person.byRoleBuilder().roleName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jack Sparrow</span><span style="color:#710">&quot;</span></span>).build().toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Johnny, Depp, 1963)</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> Person.nameBuilder().havingFirst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).havingLast(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).fullName() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> Person.builder().first(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Johnny</span><span style="color:#710">&quot;</span></span>).last(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).born(<span style="color:#00D">1963</span>).build().toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(Johnny, Depp, 1963)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forClass</code> annotation attribute is not supported for this strategy.</p>
</div>
<div class="paragraph">
<div class="title">InitializerStrategy</div>
<p>To use the <code>InitializerStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>

<span style="color:#007">@ToString</span>
<span style="color:#007">@Builder</span>(builderStrategy=InitializerStrategy)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> firstName
    <span style="color:#0a8;font-weight:bold">String</span> lastName
    <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your class will be locked down to have a single public constructor taking a "fully set" initializer.
It will also have a factory method to create the initializer. These are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">firstLastAge</span>() {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Person(Person.createInitializer().firstName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>).lastName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Smith</span><span style="color:#710">&quot;</span></span>).age(<span style="color:#00D">21</span>)).toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person(John, Smith, 21)</span><span style="color:#710">'</span></span>
}
firstLastAge()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any attempt to use the initializer which doesn&#8217;t involve setting all the properties (though order is not important) will result in
a compilation error. If you don&#8217;t need this level of strictness, you don&#8217;t need to use <code>@CompileStatic</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>InitializerStrategy</code> in conjunction with <code>@Canonical</code> and <code>@Immutable</code>. If your <code>@Builder</code> annotation
doesn&#8217;t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>. Here is an example using <code>@Builder</code> with <code>@Immutable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.builder.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovy.transform.options.Visibility.PRIVATE</span>

<span style="color:#007">@Builder</span>(builderStrategy=InitializerStrategy)
<span style="color:#007">@Immutable</span>
<span style="color:#007">@VisibilityOptions</span>(PRIVATE)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#339;font-weight:bold">int</span> born
}

<span style="color:#080;font-weight:bold">def</span> publicCons = Person.constructors
<span style="color:#080;font-weight:bold">assert</span> publicCons.size() == <span style="color:#00D">1</span>

<span style="color:#007">@CompileStatic</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">createFirstLastBorn</span>() {
  <span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person(Person.createInitializer().first(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny</span><span style="color:#710">'</span></span>).last(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Depp</span><span style="color:#710">'</span></span>).born(<span style="color:#00D">1963</span>))
  <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.last </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>p</span><span style="color:#D20">.born</span><span style="color:#710">&quot;</span></span> == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Johnny Depp 1963</span><span style="color:#710">'</span></span>
}

createFirstLastBorn()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation attribute <code>useSetters</code> can be used if you have a setter which you want called as part of the
construction process. See the JavaDoc for details.</p>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
For an example of method and constructor usage but using the <code>DefaultStrategy</code> strategy, consult that strategy&#8217;s
documentation.</p>
</div>
<div class="paragraph">
<p>The annotation attribute <code>forClass</code> is not supported for this strategy.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-AutoImplement"><a class="link" href="#xform-AutoImplement"><code>@groovy.transform.AutoImplement</code></a></h6>
<div class="paragraph">
<p>The <code>@AutoImplement</code> AST transformation supplies dummy implementations for any found abstract methods from
superclasses or interfaces. The dummy implementation is the same for all abstract methods found and can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>essentially empty (exactly true for void methods and for methods with a return type, returns the default value for
that type)</p>
</li>
<li>
<p>a statement that throws a specified exception (with optional message)</p>
</li>
<li>
<p>some user supplied code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first example illustrates the default case. Our class is annotated with <code>@AutoImplement</code>,
has a superclass and a single interface as can be seen here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoImplement</span>

<span style="color:#007">@AutoImplement</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyNames</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">AbstractList</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Closeable</span> { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>void close()</code> method from the
<code>Closeable</code> interface is supplied and left empty. Implementations are also supplied
for the three abstract methods from the super class. The <code>get</code>, <code>addAll</code> and <code>size</code> methods
have return types of <code>String</code>, <code>boolean</code> and <code>int</code> respectively with default values
<code>null</code>, <code>false</code> and <code>0</code>. We can use our class (and check the expected return type for one
of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> MyNames().size() == <span style="color:#00D">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyNames</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Closeable</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">AbstractList</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; {

    <span style="color:#0a8;font-weight:bold">String</span> get(<span style="color:#339;font-weight:bold">int</span> param0) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">null</span>
    }

    <span style="color:#339;font-weight:bold">boolean</span> addAll(<span style="color:#0a8;font-weight:bold">Collection</span>&lt;? <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">String</span>&gt; param0) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">false</span>
    }

    <span style="color:#339;font-weight:bold">void</span> close() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
    }

    <span style="color:#339;font-weight:bold">int</span> size() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second example illustrates the simplest exception case. Our class is annotated with <code>@AutoImplement</code>,
has a superclass and an annotation attribute indicates that an <code>IOException</code> should be thrown if any of
our "dummy" methods are called. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@AutoImplement</span>(exception=<span style="color:#C00;font-weight:bold">IOException</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyWriter</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Writer</span> { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown for one
of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovy.test.GroovyAssert.shouldFail</span>

shouldFail(<span style="color:#C00;font-weight:bold">IOException</span>) {
  <span style="color:#080;font-weight:bold">new</span> MyWriter().flush()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where three void methods
have been provided all of which throw the supplied exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyWriter</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Writer</span> {

    <span style="color:#339;font-weight:bold">void</span> flush() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IOException</span>()
    }

    <span style="color:#339;font-weight:bold">void</span> write(<span style="color:#339;font-weight:bold">char</span><span style="color:#339;font-weight:bold">[]</span> param0, <span style="color:#339;font-weight:bold">int</span> param1, <span style="color:#339;font-weight:bold">int</span> param2) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IOException</span>()
    }

    <span style="color:#339;font-weight:bold">void</span> close() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">Exception</span> {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IOException</span>()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third example illustrates the exception case with a supplied message. Our class is annotated with <code>@AutoImplement</code>,
implements an interface, and has annotation attributes to indicate that an <code>UnsupportedOperationException</code> with
<code>Not supported by MyIterator</code> as the message should be thrown for any supplied methods. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@AutoImplement</span>(exception=<span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>, message=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Not supported by MyIterator</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyIterator</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Iterator</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown and has the correct message
for one of the methods) using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> ex = shouldFail(<span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>) {
     <span style="color:#080;font-weight:bold">new</span> MyIterator().hasNext()
}
<span style="color:#080;font-weight:bold">assert</span> ex.message == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Not supported by MyIterator</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where three void methods
have been provided all of which throw the supplied exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyIterator</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Iterator</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; {

    <span style="color:#339;font-weight:bold">boolean</span> hasNext() {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Not supported by MyIterator</span><span style="color:#710">'</span></span>)
    }

    <span style="color:#0a8;font-weight:bold">String</span> next() {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Not supported by MyIterator</span><span style="color:#710">'</span></span>)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fourth example illustrates the case of user supplied code. Our class is annotated with <code>@AutoImplement</code>,
implements an interface, has an explicitly overridden <code>hasNext</code> method, and has an annotation attribute containing the
supplied code for any supplied methods. Here is the class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@AutoImplement</span>(code = { <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Should never be called but was called on </span><span style="color:#710">'</span></span> + <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()) })
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">EmptyIterator</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Iterator</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; {
    <span style="color:#339;font-weight:bold">boolean</span> hasNext() { <span style="color:#069">false</span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the class (and check the expected exception is thrown and has a message of the expected form)
using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> ex = shouldFail(<span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>) {
     <span style="color:#080;font-weight:bold">new</span> EmptyIterator().next()
}
<span style="color:#080;font-weight:bold">assert</span> ex.message.startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Should never be called but was called on </span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also worthwhile examining the equivalent generated code where the <code>next</code> method has been supplied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">EmptyIterator</span> <span style="color:#088;font-weight:bold">implements</span> java.util.Iterator&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; {

    <span style="color:#339;font-weight:bold">boolean</span> hasNext() {
        <span style="color:#069">false</span>
    }

    <span style="color:#0a8;font-weight:bold">String</span> next() {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">UnsupportedOperationException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Should never be called but was called on </span><span style="color:#710">'</span></span> + <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>())
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-NullCheck"><a class="link" href="#xform-NullCheck"><code>@groovy.transform.NullCheck</code></a></h6>
<div class="paragraph">
<p>The <code>@NullCheck</code> AST transformation adds null-check guard statements to constructors and methods
which cause those methods to fail early when supplied with null arguments.
It can be seen as a form of defensive programming.
The annotation can be added to individual methods or constructors, or to the class
in which case it will apply to all methods/constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@NullCheck</span>
<span style="color:#0a8;font-weight:bold">String</span> longerOf(<span style="color:#0a8;font-weight:bold">String</span> first, <span style="color:#0a8;font-weight:bold">String</span> second) {
    first.size() &gt;= second.size() ? first : second
}

<span style="color:#080;font-weight:bold">assert</span> longerOf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cat</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">canary</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">canary</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> ex = shouldFail(<span style="color:#C00;font-weight:bold">IllegalArgumentException</span>) {
    longerOf(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cat</span><span style="color:#710">'</span></span>, <span style="color:#069">null</span>)
}
<span style="color:#080;font-weight:bold">assert</span> ex.message == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">second cannot be null</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_class_design_annotations"><a class="link" href="#_class_design_annotations">4.2.1.2. Class design annotations</a></h5>
<div class="paragraph">
<p>This category of annotations are aimed at simplifying the implementation of well-known design patterns (delegation,
singleton, &#8230;&#8203;) by using a declarative style.</p>
</div>
<div class="sect5">
<h6 id="xform-BaseScript"><a class="link" href="#xform-BaseScript"><code>@groovy.transform.BaseScript</code></a></h6>
<div class="paragraph">
<p><code>@BaseScript</code> is used within scripts to indicate that the script should
extend from a custom script base class rather than <code>groovy.lang.Script</code>.
See the documentation for <a href="core-domain-specific-languages.html#dsl-basescript">domain specific languages</a> for further details.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Delegate"><a class="link" href="#xform-Delegate"><code>@groovy.lang.Delegate</code></a></h6>
<div class="paragraph">
<p>The <code>@Delegate</code> AST transformation aims at implementing the delegation design pattern. In the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Event</span> {
    <span style="color:#007">@Delegate</span> <span style="color:#0a8;font-weight:bold">Date</span> when
    <span style="color:#0a8;font-weight:bold">String</span> title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>when</code> property is annotated with <code>@Delegate</code>, meaning that the <code>Event</code> class will delegate calls to <code>Date</code> methods
to the <code>when</code> property. In this case, the generated code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Event</span> {
    <span style="color:#0a8;font-weight:bold">Date</span> when
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#339;font-weight:bold">boolean</span> before(<span style="color:#0a8;font-weight:bold">Date</span> other) {
        when.before(other)
    }
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call the <code>before</code> method, for example, directly on the <code>Event</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> ev = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Event</span>(<span style="color:#606">title</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Groovy keynote</span><span style="color:#710">'</span></span>, <span style="color:#606">when</span>: <span style="color:#0a8;font-weight:bold">Date</span>.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">yyyy/MM/dd</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2013/09/10</span><span style="color:#710">'</span></span>))
<span style="color:#080;font-weight:bold">def</span> now = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()
<span style="color:#080;font-weight:bold">assert</span> ev.before(now)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of annotating a property (or field), you can also annotate a method.
In this case, the method can be thought of as a getter or factory method for the delegate.
As an example, here is a class which (rather unusually) has a pool of delegates which are
accessed in a round-robin fashion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Test</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> robinCount = <span style="color:#00D">0</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">List</span>&gt; items = [[<span style="color:#00D">0</span>], [<span style="color:#00D">1</span>], [<span style="color:#00D">2</span>]]

    <span style="color:#007">@Delegate</span>
    <span style="color:#0a8;font-weight:bold">List</span> getRoundRobinList() {
        items[robinCount++ % items.size()]
    }

    <span style="color:#339;font-weight:bold">void</span> checkItems(<span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">List</span>&gt; testValue) {
        <span style="color:#080;font-weight:bold">assert</span> items == testValue
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example usage of that class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> t = <span style="color:#080;font-weight:bold">new</span> Test()
t &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fee</span><span style="color:#710">'</span></span>
t &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fi</span><span style="color:#710">'</span></span>
t &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fo</span><span style="color:#710">'</span></span>
t &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fum</span><span style="color:#710">'</span></span>
t.checkItems([[<span style="color:#00D">0</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fee</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fum</span><span style="color:#710">'</span></span>], [<span style="color:#00D">1</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fi</span><span style="color:#710">'</span></span>], [<span style="color:#00D">2</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">fo</span><span style="color:#710">'</span></span>]])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a standard list in this round-robin fashion would violate many expected properties of lists, so
don&#8217;t expect the above class to do anything useful beyond this trivial example.</p>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Delegate</code> AST transformation can be changed using the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the interfaces implemented by the field be implemented by the class too</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Greeter { <span style="color:#339;font-weight:bold">void</span> sayHello() }
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyGreeter</span> <span style="color:#088;font-weight:bold">implements</span> Greeter { <span style="color:#339;font-weight:bold">void</span> sayHello() { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello!</span><span style="color:#710">'</span></span>} }

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DelegatingGreeter</span> { <span style="color:#777">// no explicit interface</span>
    <span style="color:#007">@Delegate</span> MyGreeter greeter = <span style="color:#080;font-weight:bold">new</span> MyGreeter()
}
<span style="color:#080;font-weight:bold">def</span> greeter = <span style="color:#080;font-weight:bold">new</span> DelegatingGreeter()
<span style="color:#080;font-weight:bold">assert</span> greeter <span style="color:#080;font-weight:bold">instanceof</span> Greeter <span style="color:#777">// interface was added transparently</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, also delegates methods annotated with @Deprecated</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithDeprecation</span> {
    <span style="color:#007">@Deprecated</span>
    <span style="color:#339;font-weight:bold">void</span> foo() {}
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithoutDeprecation</span> {
    <span style="color:#007">@Deprecated</span>
    <span style="color:#339;font-weight:bold">void</span> bar() {}
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Delegating</span> {
    <span style="color:#007">@Delegate</span>(deprecated=<span style="color:#069">true</span>) WithDeprecation with = <span style="color:#080;font-weight:bold">new</span> WithDeprecation()
    <span style="color:#007">@Delegate</span> WithoutDeprecation without = <span style="color:#080;font-weight:bold">new</span> WithoutDeprecation()
}
<span style="color:#080;font-weight:bold">def</span> d = <span style="color:#080;font-weight:bold">new</span> Delegating()
d.foo() <span style="color:#777">// passes thanks to deprecated=true</span>
d.bar() <span style="color:#777">// fails because of @Deprecated</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">methodAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the methods of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithAnnotations</span> {
    <span style="color:#007">@Transactional</span>
    <span style="color:#339;font-weight:bold">void</span> method() {
    }
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DelegatingWithoutAnnotations</span> {
    <span style="color:#007">@Delegate</span> WithAnnotations delegate
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DelegatingWithAnnotations</span> {
    <span style="color:#007">@Delegate</span>(methodAnnotations = <span style="color:#069">true</span>) WithAnnotations delegate
}
<span style="color:#080;font-weight:bold">def</span> d1 = <span style="color:#080;font-weight:bold">new</span> DelegatingWithoutAnnotations()
<span style="color:#080;font-weight:bold">def</span> d2 = <span style="color:#080;font-weight:bold">new</span> DelegatingWithAnnotations()
<span style="color:#080;font-weight:bold">assert</span> d1.class.getDeclaredMethod(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method</span><span style="color:#710">'</span></span>).annotations.length==<span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> d2.class.getDeclaredMethod(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method</span><span style="color:#710">'</span></span>).annotations.length==<span style="color:#00D">2</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the method parameters of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithAnnotations</span> {
    <span style="color:#339;font-weight:bold">void</span> method(<span style="color:#007">@NotNull</span> <span style="color:#0a8;font-weight:bold">String</span> str) {
    }
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DelegatingWithoutAnnotations</span> {
    <span style="color:#007">@Delegate</span> WithAnnotations delegate
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DelegatingWithAnnotations</span> {
    <span style="color:#007">@Delegate</span>(parameterAnnotations = <span style="color:#069">true</span>) WithAnnotations delegate
}
<span style="color:#080;font-weight:bold">def</span> d1 = <span style="color:#080;font-weight:bold">new</span> DelegatingWithoutAnnotations()
<span style="color:#080;font-weight:bold">def</span> d2 = <span style="color:#080;font-weight:bold">new</span> DelegatingWithAnnotations()
<span style="color:#080;font-weight:bold">assert</span> d1.class.getDeclaredMethod(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method</span><span style="color:#710">'</span></span>,<span style="color:#0a8;font-weight:bold">String</span>).parameterAnnotations[<span style="color:#00D">0</span>].length==<span style="color:#00D">0</span>
<span style="color:#080;font-weight:bold">assert</span> d2.class.getDeclaredMethod(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">method</span><span style="color:#710">'</span></span>,<span style="color:#0a8;font-weight:bold">String</span>).parameterAnnotations[<span style="color:#00D">0</span>].length==<span style="color:#00D">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be excluded from delegation. For more fine-grained control, see also <code>excludeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Worker</span> {
    <span style="color:#339;font-weight:bold">void</span> task1() {}
    <span style="color:#339;font-weight:bold">void</span> task2() {}
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Delegating</span> {
    <span style="color:#007">@Delegate</span>(excludes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">task2</span><span style="color:#710">'</span></span>]) Worker worker = <span style="color:#080;font-weight:bold">new</span> Worker()
}
<span style="color:#080;font-weight:bold">def</span> d = <span style="color:#080;font-weight:bold">new</span> Delegating()
d.task1() <span style="color:#777">// passes</span>
d.task2() <span style="color:#777">// fails because method is excluded</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker array (indicates all methods)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be included in delegation. For more
fine-grained
control, see also <code>includeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Worker</span> {
    <span style="color:#339;font-weight:bold">void</span> task1() {}
    <span style="color:#339;font-weight:bold">void</span> task2() {}
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Delegating</span> {
    <span style="color:#007">@Delegate</span>(includes=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">task1</span><span style="color:#710">'</span></span>]) Worker worker = <span style="color:#080;font-weight:bold">new</span> Worker()
}
<span style="color:#080;font-weight:bold">def</span> d = <span style="color:#080;font-weight:bold">new</span> Delegating()
d.task1() <span style="color:#777">// passes</span>
d.task2() <span style="color:#777">// fails because method is not included</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be excluded from delegation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> AppendStringSelector {
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> append(<span style="color:#0a8;font-weight:bold">String</span> str)
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UpperStringBuilder</span> {
    <span style="color:#007">@Delegate</span>(excludeTypes=AppendStringSelector)
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> sb1 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()

    <span style="color:#007">@Delegate</span>(includeTypes=AppendStringSelector)
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> sb2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()

    <span style="color:#0a8;font-weight:bold">String</span> toString() { sb1.toString() + sb2.toString().toUpperCase() }
}
<span style="color:#080;font-weight:bold">def</span> usb = <span style="color:#080;font-weight:bold">new</span> UpperStringBuilder()
usb.append(<span style="color:#60E">3.5d</span>)
usb.append(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hello</span><span style="color:#710">'</span></span>)
usb.append(<span style="color:#069">true</span>)
<span style="color:#080;font-weight:bold">assert</span> usb.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3.5trueHELLO</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undefined marker array (indicates no list be default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to
 be included in delegation</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> AppendBooleanSelector {
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> append(<span style="color:#339;font-weight:bold">boolean</span> b)
}
<span style="color:#339;font-weight:bold">interface</span> AppendFloatSelector {
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> append(<span style="color:#339;font-weight:bold">float</span> b)
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NumberBooleanBuilder</span> {
    <span style="color:#007">@Delegate</span>(includeTypes=AppendBooleanSelector, interfaces=<span style="color:#069">false</span>)
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> nums = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()
    <span style="color:#007">@Delegate</span>(includeTypes=[AppendFloatSelector], interfaces=<span style="color:#069">false</span>)
    <span style="color:#0a8;font-weight:bold">StringBuilder</span> bools = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuilder</span>()
    <span style="color:#0a8;font-weight:bold">String</span> result() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>nums.toString()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> ~ </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>bools.toString()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span> }
}
<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> NumberBooleanBuilder()
b.append(<span style="color:#069">true</span>)
b.append(<span style="color:#60E">3.14f</span>)
b.append(<span style="color:#069">false</span>)
b.append(<span style="color:#60E">0.0f</span>)
<span style="color:#080;font-weight:bold">assert</span> b.result() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">truefalse ~ 3.140.0</span><span style="color:#710">&quot;</span></span>
b.append(<span style="color:#60E">3.5d</span>) <span style="color:#777">// would fail because we didn't include append(double)</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the delegate pattern be also applied to methods with internal names</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Worker</span> {
    <span style="color:#339;font-weight:bold">void</span> task<span style="color:#F00;background-color:#FAA">$</span>() {}
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Delegating</span> {
    <span style="color:#007">@Delegate</span>(allNames=<span style="color:#069">true</span>) Worker worker = <span style="color:#080;font-weight:bold">new</span> Worker()
}
<span style="color:#080;font-weight:bold">def</span> d = <span style="color:#080;font-weight:bold">new</span> Delegating()
d.task<span style="color:#F00;background-color:#FAA">$</span>() <span style="color:#777">//passes</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-Immutable"><a class="link" href="#xform-Immutable"><code>@groovy.transform.Immutable</code></a></h6>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation combines the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#xform-ToString">@ToString</a></p>
</li>
<li>
<p><a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a></p>
</li>
<li>
<p><a href="#xform-TupleConstructor">@TupleConstructor</a></p>
</li>
<li>
<p><a href="#xform-MapConstructor">@MapConstructor</a></p>
</li>
<li>
<p><a href="#xform-Final">@Final</a></p>
</li>
<li>
<p><a href="#xform-ImmutableBase">@ImmutableBase</a></p>
</li>
<li>
<p><a href="#xform-ImmutableOptions">@ImmutableOptions</a></p>
</li>
<li>
<p><a href="#xform-PropertyOptions">@PropertyOptions</a></p>
</li>
<li>
<p><a href="#xform-KnownImmutable">@KnownImmutable</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation simplifies the creation of immutable classes. Immutable classes are useful
since they are often easier to reason about and are inherently thread-safe.
See <a href="http://www.informit.com/store/effective-java-9780134685991">Effective Java, Minimize Mutability</a> for all the details
about how to achieve immutable classes in Java. The <code>@Immutable</code> meta-annotation does most of the things described
in <em>Effective Java</em> for you automatically.
To use the meta-annotation, all you have to do is annotate the class like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>

<span style="color:#007">@Immutable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Point</span> {
    <span style="color:#339;font-weight:bold">int</span> x
    <span style="color:#339;font-weight:bold">int</span> y
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the requirements for immutable classes is that there is no way to modify any state information within the class.
One requirement to achieve this is to use immutable classes for each property or alternatively perform special coding
such as defensive copy in and defensive copy out for any mutable properties within the constructors
and property getters. Between <code>@ImmutableBase</code>, <code>@MapConstructor</code> and <code>@TupleConstructor</code> properties
are either identified as immutable or the special coding for numerous known cases is handled automatically.
Various mechanisms are provided for you to extend the handled property types which are allowed. See
<code>@ImmutableOptions</code> and <code>@KnownImmutable</code> for details.</p>
</div>
<div class="paragraph">
<p>The results of applying <code>@Immutable</code> to a class are pretty similar to those of
applying the <a href="#xform-Canonical">@Canonical</a> meta-annotation but the generated class will have extra
logic to handle immutability. You will observe this by, for instance, trying to modify a property
which will result in a <code>ReadOnlyPropertyException</code> being thrown since the backing field for the property
will have been automatically made final.</p>
</div>
<div class="paragraph">
<p>The <code>@Immutable</code> meta-annotation supports the configuration options found in the annotations
it aggregates. See those annotations for more details.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-ImmutableBase"><a class="link" href="#xform-ImmutableBase"><code>@groovy.transform.ImmutableBase</code></a></h6>
<div class="paragraph">
<p>Immutable classes generated with <code>@ImmutableBase</code> are automatically made final. Also, the type of each property is checked
and various checks are made on the class, for example, public instance fields currently aren&#8217;t allowed. It also generates
a <code>copyWith</code> constructor if desired.</p>
</div>
<div class="paragraph">
<p>The following annotation attribute is supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean whether to generate a <code>copyWith( Map )</code> method.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>

<span style="color:#007">@Immutable</span>( copyWith=<span style="color:#069">true</span> )
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">User</span> {
    <span style="color:#0a8;font-weight:bold">String</span>  name
    <span style="color:#0a8;font-weight:bold">Integer</span> age
}

<span style="color:#080;font-weight:bold">def</span> bob   = <span style="color:#080;font-weight:bold">new</span> User( <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bob</span><span style="color:#710">'</span></span>, <span style="color:#00D">43</span> )
<span style="color:#080;font-weight:bold">def</span> alice = bob.copyWith( <span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">alice</span><span style="color:#710">'</span></span> )
<span style="color:#080;font-weight:bold">assert</span> alice.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">alice</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> alice.age  == <span style="color:#00D">43</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-PropertyOptions"><a class="link" href="#xform-PropertyOptions"><code>@groovy.transform.PropertyOptions</code></a></h6>
<div class="paragraph">
<p>This annotation allows you to specify a custom property handler to be used by transformations
during class construction. It is ignored by the main Groovy compiler but is referenced by other transformations
like <code>@TupleConstructor</code>, <code>@MapConstructor</code>, and <code>@ImmutableBase</code>. It is frequently used behind the
scenes by the <code>@Immutable</code> meta-annotation.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-VisibilityOptions"><a class="link" href="#xform-VisibilityOptions"><code>@groovy.transform.VisibilityOptions</code></a></h6>
<div class="paragraph">
<p>This annotation allows you to specify a custom visibility for a construct generated by another transformation.
It is ignored by the main Groovy compiler but is referenced by other transformations
like <code>@TupleConstructor</code>, <code>@MapConstructor</code>, and <code>@NamedVariant</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-ImmutableOptions"><a class="link" href="#xform-ImmutableOptions"><code>@groovy.transform.ImmutableOptions</code></a></h6>
<div class="paragraph">
<p>Groovy&#8217;s immutability support relies on a predefined list of known immutable classes (like <code>java.net.URI</code> or <code>java.lang.String</code>
and fails if you use a type which is not in that list, you are allowed to add to the list of known immutable types
thanks to the following annotation attributes of the <code>@ImmutableOptions</code> annotation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutableClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of classes which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>
<span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Point</span> {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> x
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> y
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">(</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>x</span><span style="color:#D20">,</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>y</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span> }
}

<span style="color:#007">@Immutable</span>(knownImmutableClasses=[<span style="color:#0a8;font-weight:bold">Point</span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Triangle</span> {
    <span style="color:#0a8;font-weight:bold">Point</span> a,b,c
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property names which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TupleConstructor</span>

<span style="color:#007">@TupleConstructor</span>
<span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Point</span> {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> x
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> y
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">(</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>x</span><span style="color:#D20">,</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>y</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span> }
}

<span style="color:#007">@Immutable</span>(knownImmutables=[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Triangle</span> {
    <span style="color:#0a8;font-weight:bold">Point</span> a,b,c
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you deem a type as immutable and it isn&#8217;t one of the ones automatically handled, then it is up to you
to correctly code that class to ensure immutability.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-KnownImmutable"><a class="link" href="#xform-KnownImmutable"><code>@groovy.transform.KnownImmutable</code></a></h6>
<div class="paragraph">
<p>The <code>@KnownImmutable</code> annotation isn&#8217;t actually one that triggers any AST transformations. It is simply
a marker annotation. You can annotate your classes with the annotation (including Java classes) and they
will be recognized as acceptable types for members within an immutable class. This saves you having to
explicitly use the <code>knownImmutables</code> or <code>knownImmutableClasses</code> annotation attributes from <code>@ImmutableOptions</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Memoized"><a class="link" href="#xform-Memoized"><code>@groovy.transform.Memoized</code></a></h6>
<div class="paragraph">
<p>The <code>@Memoized</code> AST transformations simplifies the implementation of caching by allowing the result of method calls
to be cached just by annotating the method with <code>@Memoized</code>. Let&#8217;s imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">long</span> longComputation(<span style="color:#339;font-weight:bold">int</span> seed) {
    <span style="color:#777">// slow computation</span>
    <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">100</span>*seed)
    <span style="color:#0a8;font-weight:bold">System</span>.nanoTime()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This emulates a long computation, based on the actual parameters of the method. Without <code>@Memoized</code>, each method call
would take several seconds plus it would return a random result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> x = longComputation(<span style="color:#00D">1</span>)
<span style="color:#080;font-weight:bold">def</span> y = longComputation(<span style="color:#00D">1</span>)
<span style="color:#080;font-weight:bold">assert</span> x!=y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding <code>@Memoized</code> changes the semantics of the method by adding caching, based on the parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Memoized</span>
<span style="color:#339;font-weight:bold">long</span> longComputation(<span style="color:#339;font-weight:bold">int</span> seed) {
    <span style="color:#777">// slow computation</span>
    <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">100</span>*seed)
    <span style="color:#0a8;font-weight:bold">System</span>.nanoTime()
}

<span style="color:#080;font-weight:bold">def</span> x = longComputation(<span style="color:#00D">1</span>) <span style="color:#777">// returns after 100 milliseconds</span>
<span style="color:#080;font-weight:bold">def</span> y = longComputation(<span style="color:#00D">1</span>) <span style="color:#777">// returns immediately</span>
<span style="color:#080;font-weight:bold">def</span> z = longComputation(<span style="color:#00D">2</span>) <span style="color:#777">// returns after 200 milliseconds</span>
<span style="color:#080;font-weight:bold">assert</span> x==y
<span style="color:#080;font-weight:bold">assert</span> x!=z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The size of the cache can be configured using two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>protectedCacheSize</em>: the number of results which are guaranteed not to be cleared after garbage collection</p>
</li>
<li>
<p><em>maxCacheSize</em>: the maximum number of results that can be kept in memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the size of the cache is unlimited and no cache result is protected from garbage collection. Setting a
<em>protectedCacheSize&gt;0</em> would create an unlimited cache with some results protected. Setting <em>maxCacheSize&gt;0</em> would
 create a limited cache but without any protection from garbage protection. Setting both would create a limited,
 protected cache.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-TailRecursive"><a class="link" href="#xform-TailRecursive"><code>@groovy.transform.TailRecursive</code></a></h6>
<div class="paragraph">
<p>The <code>@TailRecursive</code> annotation can be used to automatically transform a recursive call at the end of a method
into an equivalent iterative version of the same code. This avoids stack overflow due to too many recursive calls.
Below is an example of use when calculating factorial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.CompileStatic</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.TailRecursive</span>

<span style="color:#007">@CompileStatic</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Factorial</span> {

    <span style="color:#007">@TailRecursive</span>
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">BigInteger</span> factorial( <span style="color:#0a8;font-weight:bold">BigInteger</span> i, <span style="color:#0a8;font-weight:bold">BigInteger</span> product = <span style="color:#00D">1</span>) {
        <span style="color:#080;font-weight:bold">if</span>( i == <span style="color:#00D">1</span>) {
            <span style="color:#080;font-weight:bold">return</span> product
        }
        <span style="color:#080;font-weight:bold">return</span> factorial(i-<span style="color:#00D">1</span>, product*i)
    }
}

<span style="color:#080;font-weight:bold">assert</span> Factorial.factorial(<span style="color:#00D">1</span>) == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> Factorial.factorial(<span style="color:#00D">3</span>) == <span style="color:#00D">6</span>
<span style="color:#080;font-weight:bold">assert</span> Factorial.factorial(<span style="color:#00D">5</span>) == <span style="color:#00D">120</span>
<span style="color:#080;font-weight:bold">assert</span> Factorial.factorial(<span style="color:#00D">50000</span>).toString().size() == <span style="color:#00D">213237</span> <span style="color:#777">// Big number and no Stack Overflow</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, the annotation will only work for self-recursive method calls, i.e. a single recursive call to the exact same method again.
Consider using Closures and <code>trampoline()</code> if you have a scenario involving simple mutual recursion.
Also note that only non-void methods are currently handled (void calls will result in a compilation error).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Currently, some forms of method overloading can trick the compiler,
and some non-tail recursive calls are erroneously treated as tail recursive.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="xform-Singleton"><a class="link" href="#xform-Singleton"><code>@groovy.lang.Singleton</code></a></h6>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation can be used to implement the singleton design pattern on a class. The singleton instance
is defined eagerly by default, using class initialization, or lazily, in which case the field is initialized using
double-checked locking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Singleton</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GreetingService</span> {
    <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> name) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> }
}
<span style="color:#080;font-weight:bold">assert</span> GreetingService.instance.greeting(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, Bob!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the singleton is created eagerly when the class is initialized and available through the <code>instance</code> property.
It is possible to change the name of the singleton using the <code>property</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Singleton</span>(property=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">theOne</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GreetingService</span> {
    <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> name) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> }
}

<span style="color:#080;font-weight:bold">assert</span> GreetingService.theOne.greeting(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, Bob!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And it is also possible to make initialization lazy using the <code>lazy</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Collaborator</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">boolean</span> init = <span style="color:#069">false</span>
}
<span style="color:#007">@Singleton</span>(lazy=<span style="color:#069">true</span>,strict=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GreetingService</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> init() {}
    GreetingService() {
        Collaborator.init = <span style="color:#069">true</span>
    }
    <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> name) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> }
}
GreetingService.init() <span style="color:#777">// make sure class is initialized</span>
<span style="color:#080;font-weight:bold">assert</span> Collaborator.init == <span style="color:#069">false</span>
GreetingService.instance
<span style="color:#080;font-weight:bold">assert</span> Collaborator.init == <span style="color:#069">true</span>
<span style="color:#080;font-weight:bold">assert</span> GreetingService.instance.greeting(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, Bob!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we also set the <code>strict</code> parameter to false, which allows us to define our own constructor.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Mixin"><a class="link" href="#xform-Mixin"><code>@groovy.lang.Mixin</code></a></h6>
<div class="paragraph">
<p>Deprecated. Consider using traits instead.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_logging_improvements"><a class="link" href="#_logging_improvements">4.2.1.3. Logging improvements</a></h5>
<div class="paragraph">
<p>Groovy provides a family of AST transformations that help with integration of the most widely
used logging frameworks. There is a transform and associated annotation for each of the common frameworks.
These transforms provide a streamlined declarative approach to using the logging framework.
In each case, the transform will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add a static final <code>log</code> field to the annotated class corresponding to the logger</p>
</li>
<li>
<p>wrap all calls to <code>log.level()</code> into the appropriate <code>log.isLevelEnabled</code> guard, depending on the underlying framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those transformations support two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> (default <code>log</code>) corresponds to the name of the logger field</p>
</li>
<li>
<p><code>category</code> (defaults to the class name) is the name of the logger category</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s worth noting that annotating a class with one of those annotations doesn&#8217;t
prevent you from using the logging framework using the normal long-hand approach.</p>
</div>
<div class="sect5">
<h6 id="xform-Log"><a class="link" href="#xform-Log"><code>@groovy.util.logging.Log</code></a></h6>
<div class="paragraph">
<p>The first logging AST transformation available is the <code>@Log</code> annotation which relies on the JDK logging framework. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.Log
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.info <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.logging.Level</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.logging.Logger</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Logger</span> log = <span style="color:#0a8;font-weight:bold">Logger</span>.getLogger(Greeter.name)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        <span style="color:#080;font-weight:bold">if</span> (log.isLoggable(<span style="color:#0a8;font-weight:bold">Level</span>.INFO)) {
            log.info <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        }
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-Commons"><a class="link" href="#xform-Commons"><code>@groovy.util.logging.Commons</code></a></h6>
<div class="paragraph">
<p>Groovy supports the <a href="http://commons.apache.org/proper/commons-logging/">Apache Commons Logging</a> framework using the
<code>@Commons</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.Commons
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.commons.logging.LogFactory</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.commons.logging.Log</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> Log log = LogFactory.getLog(Greeter)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        <span style="color:#080;font-weight:bold">if</span> (log.isDebugEnabled()) {
            log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        }
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate commons-logging jar to your classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Log4j"><a class="link" href="#xform-Log4j"><code>@groovy.util.logging.Log4j</code></a></h6>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/1.2/">Apache Log4j 1.x</a> framework using the
<code>@Log4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.Log4j
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.log4j.Logger</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Logger</span> log = <span style="color:#0a8;font-weight:bold">Logger</span>.getLogger(Greeter)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        <span style="color:#080;font-weight:bold">if</span> (log.isDebugEnabled()) {
            log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        }
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate log4j jar to your classpath.
This annotation can also be used with the compatible <a href="https://reload4j.qos.ch/">reload4j</a> log4j
drop-in replacement, just use the jar from that project instead of a log4j jar.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Log4j2"><a class="link" href="#xform-Log4j2"><code>@groovy.util.logging.Log4j2</code></a></h6>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2.x</a> framework using the
<code>@Log4j2</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.Log4j2
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.logging.log4j.LogManager</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.logging.log4j.Logger</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Logger</span> log = <span style="color:#0a8;font-weight:bold">LogManager</span>.getLogger(Greeter)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        <span style="color:#080;font-weight:bold">if</span> (log.isDebugEnabled()) {
            log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        }
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate log4j2 jar to your classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Slf4j"><a class="link" href="#xform-Slf4j"><code>@groovy.util.logging.Slf4j</code></a></h6>
<div class="paragraph">
<p>Groovy supports the <a href="http://www.slf4j.org/">Simple Logging Facade for Java (SLF4J)</a> framework using the
<code>@Slf4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.Slf4j
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.slf4j.LoggerFactory</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.slf4j.Logger</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Logger</span> log = LoggerFactory.getLogger(Greeter)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        <span style="color:#080;font-weight:bold">if</span> (log.isDebugEnabled()) {
            log.debug <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        }
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You still need to add the appropriate slf4j jar(s) to your classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-PlatformLog"><a class="link" href="#xform-PlatformLog"><code>@groovy.util.logging.PlatformLog</code></a></h6>
<div class="paragraph">
<p>Groovy supports the <a href="https://openjdk.java.net/jeps/264">Java Platform Logging API and Service</a>
framework using the <code>@PlatformLog</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.util.logging.PlatformLog
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.info <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.System.Logger</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.System.LoggerFinder</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">java.lang.System.Logger.Level.INFO</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#088;font-weight:bold">transient</span> <span style="color:#0a8;font-weight:bold">Logger</span> log =
        LoggerFinder.loggerFinder.getLogger(Greeter.class.name, Greeter.class.module)
    <span style="color:#339;font-weight:bold">void</span> greet() {
        log.log INFO, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Called greeter</span><span style="color:#710">'</span></span>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, world!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to be using JDK 9+ to use this capability.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_declarative_concurrency"><a class="link" href="#_declarative_concurrency">4.2.1.4. Declarative concurrency</a></h5>
<div class="paragraph">
<p>The Groovy language provides a set of annotations aimed at simplifying common concurrency patterns in a declarative
approach.</p>
</div>
<div class="sect5">
<h6 id="xform-Synchronized"><a class="link" href="#xform-Synchronized"><code>@groovy.transform.Synchronized</code></a></h6>
<div class="paragraph">
<p>The <code>@Synchronized</code> AST transformations works in a similar way to the <code>synchronized</code> keyword but locks on different
objects for safer concurrency. It can be applied on any method or static method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Synchronized</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.Executors</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.TimeUnit</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counter</span> {
    <span style="color:#339;font-weight:bold">int</span> cpt
    <span style="color:#007">@Synchronized</span>
    <span style="color:#339;font-weight:bold">int</span> incrementAndGet() {
        cpt++
    }
    <span style="color:#339;font-weight:bold">int</span> get() {
        cpt
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing this is equivalent to creating a lock object and wrapping the whole method into a synchronized block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counter</span> {
    <span style="color:#339;font-weight:bold">int</span> cpt
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Object</span> <span style="color:#F00;background-color:#FAA">$</span>lock = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>()

    <span style="color:#339;font-weight:bold">int</span> incrementAndGet() {
        <span style="color:#088;font-weight:bold">synchronized</span>(<span style="color:#F00;background-color:#FAA">$</span>lock) {
            cpt++
        }
    }
    <span style="color:#339;font-weight:bold">int</span> get() {
        cpt
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>@Synchronized</code> creates a field named <code>$lock</code> (or <code>$LOCK</code> for a static method) but you can make it use any
field you want by specifying the value attribute, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Synchronized</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.Executors</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.TimeUnit</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counter</span> {
    <span style="color:#339;font-weight:bold">int</span> cpt
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Object</span> myLock = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>()

    <span style="color:#007">@Synchronized</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myLock</span><span style="color:#710">'</span></span>)
    <span style="color:#339;font-weight:bold">int</span> incrementAndGet() {
        cpt++
    }
    <span style="color:#339;font-weight:bold">int</span> get() {
        cpt
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-WithReadLock"><a class="link" href="#xform-WithReadLock"><code>@groovy.transform.WithReadLock</code> and <code>@groovy.transform.WithWriteLock</code></a></h6>
<div class="paragraph">
<p>The <code>@WithReadLock</code> AST transformation works in conjunction with the <code>@WithWriteLock</code> transformation
to provide read/write synchronization using the <code>ReentrantReadWriteLock</code> facility that the JDK provides. The annotation
can be added to a method or a static method. It will transparently create a <code>$reentrantLock</code> final field (or
<code>$REENTRANTLOCK</code> for a static method) and proper synchronization code will be added. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithReadLock</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithWriteLock</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counters</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>,<span style="color:#0a8;font-weight:bold">Integer</span>&gt; map = [:].withDefault { <span style="color:#00D">0</span> }

    <span style="color:#007">@WithReadLock</span>
    <span style="color:#339;font-weight:bold">int</span> get(<span style="color:#0a8;font-weight:bold">String</span> id) {
        map.get(id)
    }

    <span style="color:#007">@WithWriteLock</span>
    <span style="color:#339;font-weight:bold">void</span> add(<span style="color:#0a8;font-weight:bold">String</span> id, <span style="color:#339;font-weight:bold">int</span> num) {
        <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">200</span>) <span style="color:#777">// emulate long computation</span>
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithReadLock</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">WithReadLock</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithWriteLock</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">WithWriteLock</span>

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counters</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">Integer</span>&gt; map
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> java.util.concurrent.locks.ReentrantReadWriteLock <span style="color:#F00;background-color:#FAA">$</span>reentrantlock

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">int</span> get(java.lang.String id) {
        <span style="color:#F00;background-color:#FAA">$</span>reentrantlock.readLock().lock()
        <span style="color:#080;font-weight:bold">try</span> {
            map.get(id)
        }
        <span style="color:#080;font-weight:bold">finally</span> {
            <span style="color:#F00;background-color:#FAA">$</span>reentrantlock.readLock().unlock()
        }
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> add(java.lang.String id, <span style="color:#339;font-weight:bold">int</span> num) {
        <span style="color:#F00;background-color:#FAA">$</span>reentrantlock.writeLock().lock()
        <span style="color:#080;font-weight:bold">try</span> {
            java.lang.Thread.sleep(<span style="color:#00D">200</span>)
            map.put(id, map.get(id) + num )
        }
        <span style="color:#080;font-weight:bold">finally</span> {
            <span style="color:#F00;background-color:#FAA">$</span>reentrantlock.writeLock().unlock()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>@WithReadLock</code> and <code>@WithWriteLock</code> support specifying an alternative lock object. In that case, the referenced
 field must be declared by the user, like in the following alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithReadLock</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.WithWriteLock</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.concurrent.locks.ReentrantReadWriteLock</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Counters</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>,<span style="color:#0a8;font-weight:bold">Integer</span>&gt; map = [:].withDefault { <span style="color:#00D">0</span> }
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">ReentrantReadWriteLock</span> customLock = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ReentrantReadWriteLock</span>()

    <span style="color:#007">@WithReadLock</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">customLock</span><span style="color:#710">'</span></span>)
    <span style="color:#339;font-weight:bold">int</span> get(<span style="color:#0a8;font-weight:bold">String</span> id) {
        map.get(id)
    }

    <span style="color:#007">@WithWriteLock</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">customLock</span><span style="color:#710">'</span></span>)
    <span style="color:#339;font-weight:bold">void</span> add(<span style="color:#0a8;font-weight:bold">String</span> id, <span style="color:#339;font-weight:bold">int</span> num) {
        <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">200</span>) <span style="color:#777">// emulate long computation</span>
        map.put(id, map.get(id)+num)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See Javadoc for gapi:groovy.transform.WithReadLock[]</p>
</li>
<li>
<p>See Javadoc for gapi:groovy.transform.WithWriteLock[]</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_easier_cloning_and_externalizing"><a class="link" href="#_easier_cloning_and_externalizing">4.2.1.5. Easier cloning and externalizing</a></h5>
<div class="paragraph">
<p>Groovy provides two annotations aimed at facilitating the implementation of <code>Cloneable</code> and <code>Externalizable</code> interfaces,
respectively named <code>@AutoClone</code> and <code>@AutoExternalize</code>.</p>
</div>
<div class="sect5">
<h6 id="xform-AutoClone"><a class="link" href="#xform-AutoClone"><code>@groovy.transform.AutoClone</code></a></h6>
<div class="paragraph">
<p>The <code>@AutoClone</code> annotation is aimed at implementing the <code>@java.lang.Cloneable</code> interface using various strategies, thanks to the <code>style</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the default <code>AutoCloneStyle.CLONE</code> strategy calls <code>super.clone()</code> first then <code>clone()</code> on each cloneable property</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SIMPLE</code> strategy uses a regular constructor call and copies properties from the source to the clone</p>
</li>
<li>
<p>the <code>AutoCloneStyle.COPY_CONSTRUCTOR</code> strategy creates and uses a copy constructor</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SERIALIZATION</code> strategy uses serialization (or externalization) to clone the object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of those strategies have pros and cons which are discussed in the Javadoc for gapi:groovy.transform.AutoClone[] and gapi:groovy.transform.AutoCloneStyle[] .</p>
</div>
<div class="paragraph">
<p>For example, the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoClone</span>

<span style="color:#007">@AutoClone</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; authors
    <span style="color:#0a8;font-weight:bold">Date</span> publicationDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Cloneable</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; authors
    <span style="color:#0a8;font-weight:bold">Date</span> publicationDate

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Book</span> clone() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">CloneNotSupportedException</span> {
        <span style="color:#0a8;font-weight:bold">Book</span> result = <span style="color:#950">super</span>.clone()
        result.authors = authors <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Cloneable</span> ? (<span style="color:#0a8;font-weight:bold">List</span>) authors.clone() : authors
        result.publicationDate = publicationDate.clone()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the String properties aren&#8217;t explicitly handled because Strings are immutable and the <code>clone()</code> method from <code>Object</code> will copy the String references. The same would apply to primitive fields and most of the concrete subclasses of <code>java.lang.Number</code>.</p>
</div>
<div class="paragraph">
<p>In addition to cloning styles, <code>@AutoClone</code> supports multiple options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from cloning. A string consisting of a comma-separated field/property names is also allowed.
See gapi:groovy.transform.AutoClone#excludes[] for details</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoClone</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoCloneStyle</span>

<span style="color:#007">@AutoClone</span>(style=AutoCloneStyle.SIMPLE,excludes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">authors</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#0a8;font-weight:bold">List</span> authors
    <span style="color:#0a8;font-weight:bold">Date</span> publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are cloned. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoClone</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoCloneStyle</span>

<span style="color:#007">@AutoClone</span>(style=AutoCloneStyle.SIMPLE,includeFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#0a8;font-weight:bold">List</span> authors
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#0a8;font-weight:bold">Date</span> publicationDate
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-AutoExternalize"><a class="link" href="#xform-AutoExternalize"><code>@groovy.transform.AutoExternalize</code></a></h6>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> AST transformation will assist in the creation of <code>java.io.Externalizable</code> classes. It will
automatically add the interface to the class and generate the <code>writeExternal</code> and <code>readExternal</code> methods. For example, this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoExternalize</span>

<span style="color:#007">@AutoExternalize</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#339;font-weight:bold">float</span> price
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> <span style="color:#088;font-weight:bold">implements</span> java.io.Externalizable {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#339;font-weight:bold">float</span> price

    <span style="color:#339;font-weight:bold">void</span> writeExternal(<span style="color:#0a8;font-weight:bold">ObjectOutput</span> out) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">IOException</span> {
        out.writeObject(isbn)
        out.writeObject(title)
        out.writeFloat( price )
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> readExternal(<span style="color:#0a8;font-weight:bold">ObjectInput</span> oin) {
        isbn = (<span style="color:#0a8;font-weight:bold">String</span>) oin.readObject()
        title = (<span style="color:#0a8;font-weight:bold">String</span>) oin.readObject()
        price = oin.readFloat()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> annotation supports two parameters which will let you slightly customize its behavior:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property or field names that need to be excluded from externalizing. A string consisting of a comma-separated field/property names is also allowed.
See gapi:groovy.transform.AutoExternalize#excludes[] for details</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoExternalize</span>

<span style="color:#007">@AutoExternalize</span>(excludes=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">price</span><span style="color:#710">'</span></span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#339;font-weight:bold">float</span> price
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are externalized. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoExternalize</span>

<span style="color:#007">@AutoExternalize</span>(includeFields=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> isbn
    <span style="color:#0a8;font-weight:bold">String</span> title
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#339;font-weight:bold">float</span> price
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_safer_scripting"><a class="link" href="#_safer_scripting">4.2.1.6. Safer scripting</a></h5>
<div class="paragraph">
<p>The Groovy language makes it easy to execute user scripts at runtime (for example using gapi:groovy.lang.GroovyShell[]),
but how do you make sure that a script won&#8217;t eat all CPU (infinite loops) or that concurrent scripts won&#8217;t slowly consume
all available threads of a thread pool? Groovy provides several annotations which are aimed towards safer scripting,
generating code which will for example allow you to interrupt execution automatically.</p>
</div>
<div class="sect5">
<h6 id="xform-ThreadInterrupt"><a class="link" href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a></h6>
<div class="paragraph">
<p>One complicated situation in the JVM world is when a thread can&#8217;t be stopped. The <code>Thread#stop</code> method exists but is
deprecated (and isn&#8217;t reliable) so your only chance lies in <code>Thread#interrupt</code>. Calling the latter will set the
<code>interrupt</code> flag on the thread, but it will <strong>not</strong> stop the execution of the thread. This is problematic because it&#8217;s the
responsibility of the code executing in the thread to check the interrupt flag and properly exit. This makes sense when
you, as a developer, know that the code you are executing is meant to be run in an independent thread, but in general,
you don&#8217;t know it. It&#8217;s even worse with user scripts, who might not even know what a thread is (think of DSLs).</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> simplifies this by adding thread interruption checks at critical places in the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loops (for, while)</p>
</li>
<li>
<p>first instruction of a method</p>
</li>
<li>
<p>first instruction of a closure body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine the following user script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">while</span> (<span style="color:#069">true</span>) {
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an obvious infinite loop. If this code executes in its own thread, interrupting wouldn&#8217;t help: if you <code>join</code> on
the thread, then the calling code would be able to continue, but the thread would still be alive, running in background
without any ability for you to stop it, slowly causing thread starvation.</p>
</div>
<div class="paragraph">
<p>One possibility to work around this is to set up your shell this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
config.addCompilationCustomizers(
        <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(ThreadInterrupt)
)
<span style="color:#080;font-weight:bold">def</span> binding = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">i</span>:<span style="color:#00D">0</span>)
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell is then configured to automatically apply the <code>@ThreadInterrupt</code> AST transformations on all scripts. This allows
you to execute user scripts this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    shell.evaluate(userCode)
}
t.join(<span style="color:#00D">1000</span>) <span style="color:#777">// give at most 1000ms for the script to complete</span>
<span style="color:#080;font-weight:bold">if</span> (t.alive) {
    t.interrupt()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation automatically modified user code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">while</span> (<span style="color:#069">true</span>) {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a8;font-weight:bold">Thread</span>.currentThread().interrupted) {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">InterruptedException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The current thread has been interrupted.</span><span style="color:#710">'</span></span>)
    }
    i++
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The check which is introduced inside the loop guarantees that if the <code>interrupt</code> flag is set on the current thread, an
exception will be thrown, interrupting the execution of the thread.</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if the thread is interrupted.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BadException</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#C00;font-weight:bold">Exception</span> {
    BadException(<span style="color:#0a8;font-weight:bold">String</span> message) { <span style="color:#950">super</span>(message) }
}

<span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
config.addCompilationCustomizers(
        <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(<span style="color:#606">thrown</span>:BadException, ThreadInterrupt)
)
<span style="color:#080;font-weight:bold">def</span> binding = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">i</span>:<span style="color:#00D">0</span>)
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(<span style="color:#950">this</span>.class.classLoader,binding,config)

<span style="color:#080;font-weight:bold">def</span> userCode = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">
try {
    while (true) {
        i++
    }
} catch (BadException e) {
    i = -1
}
</span><span style="color:#710">&quot;&quot;&quot;</span></span>

<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    shell.evaluate(userCode)
}
t.join(<span style="color:#00D">1000</span>) <span style="color:#777">// give at most 1s for the script to complete</span>
<span style="color:#080;font-weight:bold">assert</span> binding.i &gt; <span style="color:#00D">0</span>
<span style="color:#080;font-weight:bold">if</span> (t.alive) {
    t.interrupt()
}
<span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">500</span>)
<span style="color:#080;font-weight:bold">assert</span> binding.i == -<span style="color:#00D">1</span><span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See gapi:groovy.transform.ThreadInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ThreadInterrupt</span>(checkOnMethodStart=<span style="color:#069">false</span>)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See gapi:groovy.transform.ThreadInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ThreadInterrupt</span>(applyToAllClasses=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> { ... } <span style="color:#777">// interrupt checks added</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">B</span> { ... } <span style="color:#777">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See gapi:groovy.transform.ThreadInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> {
    <span style="color:#007">@ThreadInterrupt</span>(applyToAllMembers=<span style="color:#069">false</span>)
    <span style="color:#339;font-weight:bold">void</span> method1() { ... } <span style="color:#777">// interrupt checked added</span>
    <span style="color:#339;font-weight:bold">void</span> method2() { ... } <span style="color:#777">// no interrupt checks</span>
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-TimedInterrupt"><a class="link" href="#xform-TimedInterrupt"><code>@groovy.transform.TimedInterrupt</code></a></h6>
<div class="paragraph">
<p>The <code>@TimedInterrupt</code> AST transformation tries to solve a slightly different problem from <a href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a>: instead of checking the <code>interrupt</code> flag of the thread, it will automatically
throw an exception if the thread has been running for too long.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This annotation does <strong>not</strong> spawn a monitoring thread. Instead, it works in a similar manner as <code>@ThreadInterrupt</code> by placing checks at appropriate places in the code. This means that if you
have a thread blocked by I/O, it will <strong>not</strong> be interrupted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Imagine the following user code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fib</span>(<span style="color:#339;font-weight:bold">int</span> n) { n&lt;<span style="color:#00D">2</span>?n:fib(n-<span style="color:#00D">1</span>)+fib(n-<span style="color:#00D">2</span>) }

result = fib(<span style="color:#00D">600</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the famous Fibonacci number computation here is far from optimized. If it is called with a high <code>n</code> value, it can take minutes to answer. With <code>@TimedInterrupt</code>, you can
choose how long a script is allowed to run. The following setup code will allow the user script to run for 1 second at max:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
config.addCompilationCustomizers(
        <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(<span style="color:#606">value</span>:<span style="color:#00D">1</span>, TimedInterrupt)
)
<span style="color:#080;font-weight:bold">def</span> binding = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">result</span>:<span style="color:#00D">0</span>)
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(<span style="color:#950">this</span>.class.classLoader, binding,config)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is equivalent to annotating a class with <code>@TimedInterrupt</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(value=<span style="color:#00D">1</span>, unit=<span style="color:#0a8;font-weight:bold">TimeUnit</span>.SECONDS)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyClass</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fib</span>(<span style="color:#339;font-weight:bold">int</span> n) {
        n&lt;<span style="color:#00D">2</span>?n:fib(n-<span style="color:#00D">1</span>)+fib(n-<span style="color:#00D">2</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TimedInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>unit</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(value=<span style="color:#00D">500L</span>, unit= <span style="color:#0a8;font-weight:bold">TimeUnit</span>.MILLISECONDS, applyToAllClasses = <span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Slow</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fib</span>(n) { n&lt;<span style="color:#00D">2</span>?n:fib(n-<span style="color:#00D">1</span>)+fib(n-<span style="color:#00D">2</span>) }
}
<span style="color:#080;font-weight:bold">def</span> result
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    result = <span style="color:#080;font-weight:bold">new</span> Slow().fib(<span style="color:#00D">500</span>)
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> result == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit.SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>value</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(value=<span style="color:#00D">500L</span>, unit= <span style="color:#0a8;font-weight:bold">TimeUnit</span>.MILLISECONDS, applyToAllClasses = <span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Slow</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fib</span>(n) { n&lt;<span style="color:#00D">2</span>?n:fib(n-<span style="color:#00D">1</span>)+fib(n-<span style="color:#00D">2</span>) }
}
<span style="color:#080;font-weight:bold">def</span> result
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    result = <span style="color:#080;font-weight:bold">new</span> Slow().fib(<span style="color:#00D">500</span>)
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> result == <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> !t.alive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.concurrent.TimeoutException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if timeout is reached.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(thrown=TooLongException, applyToAllClasses = <span style="color:#069">false</span>, value=<span style="color:#00D">1L</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Slow</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fib</span>(n) { <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">100</span>); n&lt;<span style="color:#00D">2</span>?n:fib(n-<span style="color:#00D">1</span>)+fib(n-<span style="color:#00D">2</span>) }
}
<span style="color:#080;font-weight:bold">def</span> result
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    <span style="color:#080;font-weight:bold">try</span> {
        result = <span style="color:#080;font-weight:bold">new</span> Slow().fib(<span style="color:#00D">50</span>)
    } <span style="color:#080;font-weight:bold">catch</span> (TooLongException e) {
        result = -<span style="color:#00D">1</span>
    }
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> result == -<span style="color:#00D">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See gapi:groovy.transform.TimedInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(checkOnMethodStart=<span style="color:#069">false</span>)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See gapi:groovy.transform.TimedInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TimedInterrupt</span>(applyToAllClasses=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> { ... } <span style="color:#777">// interrupt checks added</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">B</span> { ... } <span style="color:#777">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See gapi:groovy.transform.TimedInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> {
    <span style="color:#007">@TimedInterrupt</span>(applyToAllMembers=<span style="color:#069">false</span>)
    <span style="color:#339;font-weight:bold">void</span> method1() { ... } <span style="color:#777">// interrupt checked added</span>
    <span style="color:#339;font-weight:bold">void</span> method2() { ... } <span style="color:#777">// no interrupt checks</span>
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>@TimedInterrupt</code> is currently not compatible with static methods!
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="xform-ConditionalInterrupt"><a class="link" href="#xform-ConditionalInterrupt"><code>@groovy.transform.ConditionalInterrupt</code></a></h6>
<div class="paragraph">
<p>The last annotation for safer scripting is the base annotation when you want to interrupt a script using a custom strategy. In particular, this is the annotation of choice if you
want to use resource management (limit the number of calls to an API, &#8230;&#8203;). In the following example, user code is using an infinite loop, but <code>@ConditionalInterrupt</code> will allow us
to check a quota manager and interrupt automatically the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ConditionalInterrupt</span>({Quotas.disallow(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>)})
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UserCode</span> {
    <span style="color:#339;font-weight:bold">void</span> doSomething() {
        <span style="color:#339;font-weight:bold">int</span> i=<span style="color:#00D">0</span>
        <span style="color:#080;font-weight:bold">while</span> (<span style="color:#069">true</span>) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Consuming resources </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>++i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The quota checking is very basic here, but it can be any code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Quotas</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> quotas = [:].withDefault { <span style="color:#00D">10</span> }
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">boolean</span> disallow(<span style="color:#0a8;font-weight:bold">String</span> userName) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Checking quota for </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>userName</span><span style="color:#710">&quot;</span></span>
        (quotas[userName]--)&lt;<span style="color:#00D">0</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can make sure <code>@ConditionalInterrupt</code> works properly using this test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    <span style="color:#080;font-weight:bold">new</span> UserCode().doSomething()
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> !t.alive
<span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] &lt; <span style="color:#00D">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, in practice, it is unlikely that <code>@ConditionalInterrupt</code> will be itself added by hand on user code. It can be injected in a similar manner as the example shown in the
<a href="#xform-ThreadInterrupt">ThreadInterrupt</a> section, using the gapi:org.codehaus.groovy.control.customizers.ASTTransformationCustomizer[] :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
<span style="color:#080;font-weight:bold">def</span> checkExpression = <span style="color:#080;font-weight:bold">new</span> ClosureExpression(
        Parameter.EMPTY_ARRAY,
        <span style="color:#080;font-weight:bold">new</span> ExpressionStatement(
                <span style="color:#080;font-weight:bold">new</span> MethodCallExpression(<span style="color:#080;font-weight:bold">new</span> ClassExpression(ClassHelper.make(Quotas)), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">disallow</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">new</span> ConstantExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>))
        )
)
config.addCompilationCustomizers(
        <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(<span style="color:#606">value</span>: checkExpression, ConditionalInterrupt)
)

<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(<span style="color:#950">this</span>.class.classLoader,<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(),config)

<span style="color:#080;font-weight:bold">def</span> userCode = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">
        int i=0
        while (true) {
            println &quot;Consuming resources </span><span style="color:#b0b">\\</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>++i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&quot;
        }
</span><span style="color:#710">&quot;&quot;&quot;</span></span>

<span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    shell.evaluate(userCode)
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> !t.alive
<span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] &lt; <span style="color:#00D">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ConditionalInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The closure which will be called to check if execution is allowed. If the closure returns false, execution is allowed. If it returns true, then an exception will be thrown.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ConditionalInterrupt</span>({ ... })</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if execution should be aborted.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">config.addCompilationCustomizers(
        <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(<span style="color:#606">thrown</span>: QuotaExceededException,<span style="color:#606">value</span>: checkExpression, ConditionalInterrupt)
)
<span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">def</span> t = <span style="color:#0a8;font-weight:bold">Thread</span>.start {
    <span style="color:#080;font-weight:bold">try</span> {
        shell.evaluate(userCode)
    } <span style="color:#080;font-weight:bold">catch</span> (QuotaExceededException) {
        Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Quota exceeded</span><span style="color:#710">'</span></span>
    }
}
t.join(<span style="color:#00D">5000</span>)
<span style="color:#080;font-weight:bold">assert</span> !t.alive
<span style="color:#080;font-weight:bold">assert</span> Quotas.quotas[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">user</span><span style="color:#710">'</span></span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Quota exceeded</span><span style="color:#710">'</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See gapi:groovy.transform.ConditionalInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ConditionalInterrupt</span>(checkOnMethodStart=<span style="color:#069">false</span>)</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See gapi:groovy.transform.ConditionalInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@ConditionalInterrupt</span>(applyToAllClasses=<span style="color:#069">false</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> { ... } <span style="color:#777">// interrupt checks added</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">B</span> { ... } <span style="color:#777">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See gapi:groovy.transform.ConditionalInterrupt[] for details.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span> {
    <span style="color:#007">@ConditionalInterrupt</span>(applyToAllMembers=<span style="color:#069">false</span>)
    <span style="color:#339;font-weight:bold">void</span> method1() { ... } <span style="color:#777">// interrupt checked added</span>
    <span style="color:#339;font-weight:bold">void</span> method2() { ... } <span style="color:#777">// no interrupt checks</span>
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_compiler_directives"><a class="link" href="#_compiler_directives">4.2.1.7. Compiler directives</a></h5>
<div class="paragraph">
<p>This category of AST transformations groups annotations which have a direct impact on the semantics of the code, rather
than focusing on code generation. With that regards, they can be seen as compiler directives that either change the
behavior of a program at compile time or runtime.</p>
</div>
<div class="sect5">
<h6 id="xform-Field"><a class="link" href="#xform-Field"><code>@groovy.transform.Field</code></a></h6>
<div class="paragraph">
<p>The <code>@Field</code> annotation only makes sense in the context of a script and aims at solving a common scoping error with
scripts. The following example will for example fail at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> x

<span style="color:#0a8;font-weight:bold">String</span> line() {
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=</span><span style="color:#710">&quot;</span></span>*x
}

x=<span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">===</span><span style="color:#710">&quot;</span></span> == line()
x=<span style="color:#00D">5</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=====</span><span style="color:#710">&quot;</span></span> == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The error that is thrown may be difficult to interpret: groovy.lang.MissingPropertyException: No such property: x. The reason is that scripts are compiled
to classes and the script body is itself compiled as a single <em>run()</em> method. Methods which are defined in the scripts are independent, so the code above is
equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyScript</span> <span style="color:#088;font-weight:bold">extends</span> Script {

    <span style="color:#0a8;font-weight:bold">String</span> line() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=</span><span style="color:#710">&quot;</span></span>*x
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">run</span>() {
        <span style="color:#080;font-weight:bold">def</span> x
        x=<span style="color:#00D">3</span>
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">===</span><span style="color:#710">&quot;</span></span> == line()
        x=<span style="color:#00D">5</span>
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=====</span><span style="color:#710">&quot;</span></span> == line()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>def x</code> is effectively interpreted as a local variable, outside of the scope of the <code>line</code> method. The <code>@Field</code> AST transformation aims at fixing this
by changing the scope of the variable to a field of the enclosing script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Field</span> <span style="color:#080;font-weight:bold">def</span> x

<span style="color:#0a8;font-weight:bold">String</span> line() {
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=</span><span style="color:#710">&quot;</span></span>*x
}

x=<span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">===</span><span style="color:#710">&quot;</span></span> == line()
x=<span style="color:#00D">5</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=====</span><span style="color:#710">&quot;</span></span> == line()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting, equivalent, code is now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyScript</span> <span style="color:#088;font-weight:bold">extends</span> Script {

    <span style="color:#080;font-weight:bold">def</span> x

    <span style="color:#0a8;font-weight:bold">String</span> line() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=</span><span style="color:#710">&quot;</span></span>*x
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">run</span>() {
        x=<span style="color:#00D">3</span>
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">===</span><span style="color:#710">&quot;</span></span> == line()
        x=<span style="color:#00D">5</span>
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">=====</span><span style="color:#710">&quot;</span></span> == line()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-PackageScope"><a class="link" href="#xform-PackageScope"><code>@groovy.transform.PackageScope</code></a></h6>
<div class="paragraph">
<p>By default, Groovy visibility rules imply that if you create a field without specifying a modifier, then the field is interpreted as a property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name <span style="color:#777">// this is a property</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you want to create a package private field instead of a property (private field+getter/setter), then annotate your field with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#007">@PackageScope</span> <span style="color:#0a8;font-weight:bold">String</span> name <span style="color:#777">// not a property anymore</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation can also be used for classes, methods and constructors. In addition, by specifying a list
of <code>PackageScopeTarget</code> values as the annotation attribute at the class level, all members within that class that don&#8217;t
have an explicit modifier and match the provided <code>PackageScopeTarget</code> will remain package protected. For example to apply
to fields within a class use the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovy.transform.PackageScopeTarget.FIELDS</span>
<span style="color:#007">@PackageScope</span>(FIELDS)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
  <span style="color:#0a8;font-weight:bold">String</span> name     <span style="color:#777">// not a property, package protected</span>
  <span style="color:#0a8;font-weight:bold">Date</span> dob        <span style="color:#777">// not a property, package protected</span>
  <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> age <span style="color:#777">// explicit modifier, so won't be touched</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation is seldom used as part of normal Groovy conventions but is sometimes useful
for factory methods that should be visible internally within a package or for methods or constructors provided
for testing purposes, or when integrating with third-party libraries which require such visibility conventions.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-Final"><a class="link" href="#xform-Final"><code>@groovy.transform.Final</code></a></h6>
<div class="paragraph">
<p><code>@Final</code> is essentially an alias for the <code>final</code> modifier.
The intention is that you would almost never use the <code>@Final</code> annotation directly (just use <code>final</code>).
However, when creating meta-annotations that should apply
the final modifier to the node being annotated, you can mix in <code>@Final</code>, e.g..</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@AnnotationCollector</span>([Singleton,Final]) <span style="color:#007">@interface</span> MySingleton {}

<span style="color:#007">@MySingleton</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GreetingService</span> {
    <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> name) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> }
}
<span style="color:#080;font-weight:bold">assert</span> GreetingService.instance.greeting(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, Bob!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#0a8;font-weight:bold">Modifier</span>.isFinal(GreetingService.modifiers)</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-AutoFinal"><a class="link" href="#xform-AutoFinal"><code>@groovy.transform.AutoFinal</code></a></h6>
<div class="paragraph">
<p>The <code>@AutoFinal</code> annotation instructs the compiler to automatically insert the final modifier
in numerous places within the annotated node. If applied on a method (or constructor), the parameters
for that method (or constructor) will be marked as final. If applied on a class definition, the same
treatment will occur for all declared methods and constructors within that class.</p>
</div>
<div class="paragraph">
<p>It is often considered bad practice to reassign parameters of a method or constructor with its body.
By adding the final modifier to all parameter declarations you can avoid this practice entirely.
Some programmers feel that adding final everywhere increases the amount of boilerplate code and makes the
method signatures somewhat noisy. An alternative might instead be to use a code review process or apply
a <a href="http://codenarc.org">codenarc</a> <a href="https://codenarc.github.io/CodeNarc/codenarc-rules-convention.html#parameterreassignment-rule">rule</a>
to give warnings if that practice is observed but these alternatives might lead to delayed feedback during
quality checking rather than within the IDE or during compilation. The <code>@AutoFinal</code> annotation aims to
maximise compiler/IDE feedback while retaining succinct code with minimum boilerplate noise.</p>
</div>
<div class="paragraph">
<p>The following example illustrates applying the annotation at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.AutoFinal</span>

<span style="color:#007">@AutoFinal</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> first, last

    Person(<span style="color:#0a8;font-weight:bold">String</span> first, <span style="color:#0a8;font-weight:bold">String</span> last) {
        <span style="color:#950">this</span>.first = first
        <span style="color:#950">this</span>.last = last
    }

    <span style="color:#0a8;font-weight:bold">String</span> fullName(<span style="color:#0a8;font-weight:bold">String</span> separator) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>first</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>separator</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>last</span><span style="color:#710">&quot;</span></span>
    }

    <span style="color:#0a8;font-weight:bold">String</span> greeting(<span style="color:#0a8;font-weight:bold">String</span> salutation) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>salutation</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>first</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the two parameters for the constructor and the single parameter for
both the <code>fullname</code> and <code>greeting</code> methods will be final. Attempts to modify those parameters within the
constructor or method bodies will be flagged by the compiler.</p>
</div>
<div class="paragraph">
<p>The following example illustrates applying the annotation at the method level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Calc</span> {
    <span style="color:#007">@AutoFinal</span>
    <span style="color:#339;font-weight:bold">int</span> add(<span style="color:#339;font-weight:bold">int</span> a, <span style="color:#339;font-weight:bold">int</span> b) { a + b }

    <span style="color:#339;font-weight:bold">int</span> mult(<span style="color:#339;font-weight:bold">int</span> a, <span style="color:#339;font-weight:bold">int</span> b) { a * b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>add</code> method will have final parameters but the <code>mult</code> method will remain unchanged.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-AnnotationCollector"><a class="link" href="#xform-AnnotationCollector"><code>@groovy.transform.AnnotationCollector</code></a></h6>
<div class="paragraph">
<p><code>@AnnotationCollector</code> allows the creation of meta-annotations, which are described in a <a href="core-object-orientation.html#_meta_annotations">dedicated section</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-TypeChecked"><a class="link" href="#xform-TypeChecked"><code>@groovy.transform.TypeChecked</code></a></h6>
<div class="paragraph">
<p><code>@TypeChecked</code> activates compile-time type checking on your Groovy code. See <a href="core-semantics.html#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-CompileStatic"><a class="link" href="#xform-CompileStatic"><code>@groovy.transform.CompileStatic</code></a></h6>
<div class="paragraph">
<p><code>@CompileStatic</code> activates static compilation on your Groovy code. See <a href="core-semantics.html#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-CompileDynamic"><a class="link" href="#xform-CompileDynamic"><code>@groovy.transform.CompileDynamic</code></a></h6>
<div class="paragraph">
<p><code>@CompileDynamic</code> disables static compilation on parts of your Groovy code. See <a href="core-semantics.html#static-type-checking">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-DelegatesTo"><a class="link" href="#xform-DelegatesTo"><code>@groovy.lang.DelegatesTo</code></a></h6>
<div class="paragraph">
<p><code>@DelegatesTo</code> is not, technically speaking, an AST transformation. It is aimed at documenting code and helping the compiler in case you are
using <a href="#xform-TypeChecked">type checking</a> or <a href="#xform-CompileStatic">static compilation</a>. The annotation is described thoroughly in the
<a href="core-domain-specific-languages.html#section-delegatesto">DSL section</a> of this guide.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-SelfType"><a class="link" href="#xform-SelfType"><code>@groovy.transform.SelfType</code></a></h6>
<div class="paragraph">
<p><code>@SelfType</code> is not an AST transformation but rather a marker interface used
with traits. See the <a href="core-domain-specific-languages.html#traits-selftype">traits documentation</a> for further details.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_swing_patterns"><a class="link" href="#_swing_patterns">4.2.1.8. Swing patterns</a></h5>
<div class="sect5">
<h6 id="xform-Bindable"><a class="link" href="#xform-Bindable"><code>@groovy.beans.Bindable</code></a></h6>
<div class="paragraph">
<p><code>@Bindable</code> is an AST transformation that transforms a regular property into a bound property (according to the <a href="http://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans specification</a>).
The <code>@Bindable</code> annotation can be placed on a property or a class. To convert all properties of a class into bound properties, on can annotate the class like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.Bindable</span>

<span style="color:#007">@Bindable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.beans.PropertyChangeListener</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.beans.PropertyChangeSupport</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">PropertyChangeSupport</span> <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport

    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> age

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> addPropertyChangeListener(<span style="color:#0a8;font-weight:bold">PropertyChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.addPropertyChangeListener(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> addPropertyChangeListener(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.addPropertyChangeListener(name, listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> removePropertyChangeListener(<span style="color:#0a8;font-weight:bold">PropertyChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.removePropertyChangeListener(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> removePropertyChangeListener(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.removePropertyChangeListener(name, listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> firePropertyChange(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> oldValue, <span style="color:#0a8;font-weight:bold">Object</span> newValue) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.firePropertyChange(name, oldValue, newValue)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span><span style="color:#339;font-weight:bold">[]</span> getPropertyChangeListeners() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.getPropertyChangeListeners()
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">PropertyChangeListener</span><span style="color:#339;font-weight:bold">[]</span> getPropertyChangeListeners(<span style="color:#0a8;font-weight:bold">String</span> name) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>propertyChangeSupport.getPropertyChangeListeners(name)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> therefore removes a lot of boilerplate from your class, dramatically increasing readability. If the annotation is put on a single property, only that property is bound:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.Bindable</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#007">@Bindable</span> <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="xform-ListenerList"><a class="link" href="#xform-ListenerList"><code>@groovy.beans.ListenerList</code></a></h6>
<div class="paragraph">
<p>The <code>@ListenerList</code> AST transformation generates code for adding, removing and getting the list of listeners to a class, just by annotating a collection property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.awt.event.ActionListener</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.ListenerList</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Component</span> {
    <span style="color:#007">@ListenerList</span>
    <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt; listeners;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transform will generate the appropriate add/remove methods based on the generic type of the list. In addition, it will also create <code>fireXXX</code> methods based on the public methods declared on the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.awt.event.ActionEvent</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.awt.event.ActionListener</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">ActionListener</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.ListenerList</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">ListenerList</span>

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Component</span> {

    <span style="color:#007">@ListenerList</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt; listeners

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> addActionListener(<span style="color:#0a8;font-weight:bold">ActionListener</span> listener) {
        <span style="color:#080;font-weight:bold">if</span> ( listener == <span style="color:#069">null</span>) {
            <span style="color:#080;font-weight:bold">return</span>
        }
        <span style="color:#080;font-weight:bold">if</span> ( listeners == <span style="color:#069">null</span>) {
            listeners = <span style="color:#339;font-weight:bold">[]</span>
        }
        listeners.add(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> removeActionListener(<span style="color:#0a8;font-weight:bold">ActionListener</span> listener) {
        <span style="color:#080;font-weight:bold">if</span> ( listener == <span style="color:#069">null</span>) {
            <span style="color:#080;font-weight:bold">return</span>
        }
        <span style="color:#080;font-weight:bold">if</span> ( listeners == <span style="color:#069">null</span>) {
            listeners = <span style="color:#339;font-weight:bold">[]</span>
        }
        listeners.remove(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">ActionListener</span><span style="color:#339;font-weight:bold">[]</span> getActionListeners() {
        <span style="color:#0a8;font-weight:bold">Object</span> __result = <span style="color:#339;font-weight:bold">[]</span>
        <span style="color:#080;font-weight:bold">if</span> ( listeners != <span style="color:#069">null</span>) {
            __result.addAll(listeners)
        }
        <span style="color:#080;font-weight:bold">return</span> (( __result ) <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">ActionListener</span><span style="color:#339;font-weight:bold">[]</span>)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> fireActionPerformed(<span style="color:#0a8;font-weight:bold">ActionEvent</span> param0) {
        <span style="color:#080;font-weight:bold">if</span> ( listeners != <span style="color:#069">null</span>) {
            <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt; __list = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt;(listeners)
            <span style="color:#080;font-weight:bold">for</span> (<span style="color:#080;font-weight:bold">def</span> listener : __list ) {
                listener.actionPerformed(param0)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the suffix which will be appended to add/remove/&#8230;&#8203; methods is the simple class name of the generic type of the list.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Component</span> {
    <span style="color:#007">@ListenerList</span>(name=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">item</span><span style="color:#710">'</span></span>)
    <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, generated methods will be synchronized</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Component</span> {
    <span style="color:#007">@ListenerList</span>(synchronize = <span style="color:#069">true</span>)
    <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">ActionListener</span>&gt; listeners;
}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="xform-Vetoable"><a class="link" href="#xform-Vetoable"><code>@groovy.beans.Vetoable</code></a></h6>
<div class="paragraph">
<p>The <code>@Vetoable</code> annotation works in a similar manner to <code>@Bindable</code> but generates constrained property according to the JavaBeans specification, instead of bound properties. The annotation
can be placed on a class, meaning that all properties will be converted to constrained properties, or on a single property. For example, annotating this class with <code>@Vetoable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.Vetoable</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.beans.PropertyVetoException</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.beans.VetoableChangeListener</span>

<span style="color:#007">@Vetoable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> age
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#088;font-weight:bold">private</span> java.beans.VetoableChangeSupport <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> addVetoableChangeListener(<span style="color:#0a8;font-weight:bold">VetoableChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.addVetoableChangeListener(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> addVetoableChangeListener(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">VetoableChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.addVetoableChangeListener(name, listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> removeVetoableChangeListener(<span style="color:#0a8;font-weight:bold">VetoableChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.removeVetoableChangeListener(listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> removeVetoableChangeListener(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">VetoableChangeListener</span> listener) {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.removeVetoableChangeListener(name, listener)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> fireVetoableChange(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> oldValue, <span style="color:#0a8;font-weight:bold">Object</span> newValue) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">PropertyVetoException</span> {
        <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.fireVetoableChange(name, oldValue, newValue)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">VetoableChangeListener</span><span style="color:#339;font-weight:bold">[]</span> getVetoableChangeListeners() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.getVetoableChangeListeners()
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">VetoableChangeListener</span><span style="color:#339;font-weight:bold">[]</span> getVetoableChangeListeners(<span style="color:#0a8;font-weight:bold">String</span> name) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span><span style="color:#F00;background-color:#FAA">$</span>vetoableChangeSupport.getVetoableChangeListeners(name)
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setName(<span style="color:#0a8;font-weight:bold">String</span> value) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">PropertyVetoException</span> {
        <span style="color:#950">this</span>.fireVetoableChange(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span>, name, value)
        name = value
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setAge(<span style="color:#339;font-weight:bold">int</span> value) <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">PropertyVetoException</span> {
        <span style="color:#950">this</span>.fireVetoableChange(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span>, age, value)
        age = value
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the annotation is put on a single property, only that property is made vetoable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.Vetoable</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#007">@Vetoable</span> <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_test_assistance"><a class="link" href="#_test_assistance">4.2.1.9. Test assistance</a></h5>
<div class="sect5">
<h6 id="xform-NotYetImplemented"><a class="link" href="#xform-NotYetImplemented"><code>@groovy.test.NotYetImplemented</code></a></h6>
<div class="paragraph">
<p><code>@NotYetImplemented</code> is used to invert the result of a JUnit 3/4 test case. It is in particular useful if a feature is not yet implemented but the test is. In that case, it is expected
that the test fails. Marking it with <code>@NotYetImplemented</code> will inverse the result of the test, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.test.GroovyTestCase</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.test.NotYetImplemented</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Maths</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">int</span> fib(<span style="color:#339;font-weight:bold">int</span> n) {
        <span style="color:#777">// todo: implement later</span>
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MathsTest</span> <span style="color:#088;font-weight:bold">extends</span> GroovyTestCase {
    <span style="color:#007">@NotYetImplemented</span>
    <span style="color:#339;font-weight:bold">void</span> testFib() {
        <span style="color:#080;font-weight:bold">def</span> dataTable = [
                <span style="color:#00D">1</span>:<span style="color:#00D">1</span>,
                <span style="color:#00D">2</span>:<span style="color:#00D">1</span>,
                <span style="color:#00D">3</span>:<span style="color:#00D">2</span>,
                <span style="color:#00D">4</span>:<span style="color:#00D">3</span>,
                <span style="color:#00D">5</span>:<span style="color:#00D">5</span>,
                <span style="color:#00D">6</span>:<span style="color:#00D">8</span>,
                <span style="color:#00D">7</span>:<span style="color:#00D">13</span>
        ]
        dataTable.each { i, r -&gt;
            <span style="color:#080;font-weight:bold">assert</span> Maths.fib(i) == r
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another advantage of using this technique is that you can write test cases for bugs before knowing how to fix them. If some time in the future, a modification in the code fixes a bug by side effect,
you&#8217;ll be notified because a test which was expected to fail passed.</p>
</div>
</div>
<div class="sect5">
<h6 id="xform-ASTTest"><a class="link" href="#xform-ASTTest"><code>@groovy.transform.ASTTest</code></a></h6>
<div class="paragraph">
<p><code>@ASTTest</code> is a special AST transformation meant to help debugging other AST transformations or the Groovy compiler itself. It will let the developer "explore" the AST during compilation and
perform assertions on the AST rather than on the result of compilation. This means that this AST transformations gives access to the AST before the bytecode is produced. <code>@ASTTest</code> can be
placed on any annotable node and requires two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>phase</em>: sets at which phase at which <code>@ASTTest</code> will be triggered. The test code will work on the AST tree at the end of this phase.</p>
</li>
<li>
<p><em>value</em>: the code which will be executed once the phase is reached, on the annotated node</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Compile phase has to be chosen from one of gapi:org.codehaus.groovy.control.CompilePhase[] . However, since it is not possible to annotate a node twice with the same annotation, you will
not be able to use <code>@ASTTest</code> on the same node at two distinct compile phases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>value</code> is a closure expression which has access to a special variable <code>node</code> corresponding to the annotated node, and a helper <code>lookup</code> method which will be discussed <a href="#asttest-lookup">here</a>.
For example, you can annotate a class node like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ASTTest</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.ClassNode</span>

<span style="color:#007">@ASTTest</span>(phase=CONVERSION, value={   // <b class="conum">(1)</b>
    <span style="color:#080;font-weight:bold">assert</span> node <span style="color:#080;font-weight:bold">instanceof</span> ClassNode // <b class="conum">(2)</b>
    <span style="color:#080;font-weight:bold">assert</span> node.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Person</span><span style="color:#710">'</span></span>     // <b class="conum">(3)</b>
})
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>we&#8217;re checking the state of the Abstract Syntax Tree after the CONVERSION phase</p>
</li>
<li>
<p>node refers to the AST node which is annotated by @ASTTest</p>
</li>
<li>
<p>it can be used to perform assertions at compile time</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>One interesting feature of <code>@ASTTest</code> is that if an assertion fails, then <strong>compilation will fail</strong>. Now imagine that we want to check the behavior of an AST transformation at compile time.
We will take <code>@PackageScope</code> here, and we will want to verify that a property annotated with <code>@PackageScope</code> becomes a package private field. For this, we have to know at which phase the
transform runs, which can be found in gapi:org.codehaus.groovy.transform.PackageScopeASTTransformation[] : semantic analysis. Then a test can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ASTTest</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.PackageScope</span>

<span style="color:#007">@ASTTest</span>(phase=SEMANTIC_ANALYSIS, value={
    <span style="color:#080;font-weight:bold">def</span> nameNode = node.properties.find { <span style="color:#950">it</span>.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span> }
    <span style="color:#080;font-weight:bold">def</span> ageNode = node.properties.find { <span style="color:#950">it</span>.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span> }
    <span style="color:#080;font-weight:bold">assert</span> nameNode
    <span style="color:#080;font-weight:bold">assert</span> ageNode == <span style="color:#069">null</span> <span style="color:#777">// shouldn't be a property anymore</span>
    <span style="color:#080;font-weight:bold">def</span> ageField = node.getDeclaredField <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">assert</span> ageField.modifiers == <span style="color:#00D">0</span>
})
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#007">@PackageScope</span> <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
<div id="asttest-lookup" class="paragraph">
<p>The <code>@ASTTest</code> annotation can only be placed wherever the grammar allows it. Sometimes, you would like to test the contents of an AST node which is not annotable. In this case,
<code>@ASTTest</code> provides a convenient <code>lookup</code> method which will search the AST for nodes which are labelled with a special token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">anchor</span><span style="color:#710">'</span></span>) <b class="conum">(1)</b>
<span style="color:#0a8;font-weight:bold">Statement</span> stmt = list[<span style="color:#00D">0</span>] <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>returns the list of AST nodes which label is 'anchor'</p>
</li>
<li>
<p>it is always necessary to choose which element to process since lookup always returns a list</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Imagine, for example, that you want to test the declared type of a for loop variable. Then you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ASTTest</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.PackageScope</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.ClassHelper</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.expr.DeclarationExpression</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.stmt.ForStatement</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Something</span> {
    <span style="color:#007">@ASTTest</span>(phase=SEMANTIC_ANALYSIS, value={
        <span style="color:#080;font-weight:bold">def</span> forLoop = lookup(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">anchor</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]
        <span style="color:#080;font-weight:bold">assert</span> forLoop <span style="color:#080;font-weight:bold">instanceof</span> ForStatement
        <span style="color:#080;font-weight:bold">def</span> decl = forLoop.collectionExpression.expressions[<span style="color:#00D">0</span>]
        <span style="color:#080;font-weight:bold">assert</span> decl <span style="color:#080;font-weight:bold">instanceof</span> DeclarationExpression
        <span style="color:#080;font-weight:bold">assert</span> decl.variableExpression.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">i</span><span style="color:#710">'</span></span>
        <span style="color:#080;font-weight:bold">assert</span> decl.variableExpression.originType == ClassHelper.int_TYPE
    })
    <span style="color:#339;font-weight:bold">void</span> someMethod() {
        <span style="color:#339;font-weight:bold">int</span> x = <span style="color:#00D">1</span>;
        <span style="color:#339;font-weight:bold">int</span> y = <span style="color:#00D">10</span>;
        <span style="color:#606">anchor</span>: <span style="color:#080;font-weight:bold">for</span> (<span style="color:#339;font-weight:bold">int</span> i=<span style="color:#00D">0</span>; i&lt;x+y; i++) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>i</span><span style="color:#710">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ASTTest</code> also exposes those variables inside the test closure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>node</code> corresponds to the annotated node, as usual</p>
</li>
<li>
<p><code>compilationUnit</code> gives access to the current <code>org.codehaus.groovy.control.CompilationUnit</code></p>
</li>
<li>
<p><code>compilePhase</code> returns the current compile phase (<code>org.codehaus.groovy.control.CompilePhase</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is interesting if you don&#8217;t specify the <code>phase</code> attribute. In that case, the closure will be executed after
each compile phase after (and including) <code>SEMANTIC_ANALYSIS</code>. The context of the transformation is kept after each phase,
giving you a chance to check what changed between two phases.</p>
</div>
<div class="paragraph">
<p>As an example, here is how you could dump the list of AST transformations registered on a class node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ASTTest</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.CompileStatic</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.Immutable</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.ClassNode</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.CompilePhase</span>

<span style="color:#007">@ASTTest</span>(value={
    <span style="color:#0a8;font-weight:bold">System</span>.err.println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Compile phase: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>compilePhase</span><span style="color:#710">&quot;</span></span>
    ClassNode cn = node
    <span style="color:#0a8;font-weight:bold">System</span>.err.println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Global AST xforms: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>compilationUnit?.ASTTransformationsContext?.globalTransformNames<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    CompilePhase.values().each {
        <span style="color:#080;font-weight:bold">def</span> transforms = cn.getTransforms(<span style="color:#950">it</span>)
        <span style="color:#080;font-weight:bold">if</span> (transforms) {
            <span style="color:#0a8;font-weight:bold">System</span>.err.println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Ast xforms for phase </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#950">it</span></span><span style="color:#D20">:</span><span style="color:#710">&quot;</span></span>
            transforms.each { map -&gt;
                <span style="color:#0a8;font-weight:bold">System</span>.err.println(map)
            }
        }
    }
})
<span style="color:#007">@CompileStatic</span>
<span style="color:#007">@Immutable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how you can memorize variables for testing between two phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ASTTest</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.ToString</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.ast.ClassNode</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.CompilePhase</span>

<span style="color:#007">@ASTTest</span>(value={
    <span style="color:#080;font-weight:bold">if</span> (compilePhase == CompilePhase.INSTRUCTION_SELECTION) {           // <b class="conum">(1)</b>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">toString() was added at phase: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>added<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">assert</span> added == CompilePhase.CANONICALIZATION                   // <b class="conum">(2)</b>
    } <span style="color:#080;font-weight:bold">else</span> {
        <span style="color:#080;font-weight:bold">if</span> (node.getDeclaredMethods(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">toString</span><span style="color:#710">'</span></span>) &amp;&amp; added == <span style="color:#069">null</span>) {     // <b class="conum">(3)</b>
            added = compilePhase                                        // <b class="conum">(4)</b>
        }
    }
})
<span style="color:#007">@ToString</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>if the current compile phase is instruction selection</p>
</li>
<li>
<p>then we want to make sure <code>toString</code> was added at <code>CANONICALIZATION</code></p>
</li>
<li>
<p>otherwise, if <code>toString</code> exists and that the variable from the context, <code>added</code> is null</p>
</li>
<li>
<p>then it means that this compile phase is the one where <code>toString</code> was added</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_grape_handling"><a class="link" href="#_grape_handling">4.2.1.10. Grape handling</a></h5>
<div class="sect5">
<h6 id="xform-Grab"><a class="link" href="#xform-Grab"><code>@groovy.lang.Grab</code></a></h6>

</div>
<div class="sect5">
<h6 id="xform-GrabConfig"><a class="link" href="#xform-GrabConfig"><code>@groovy.lang.GrabConfig</code></a></h6>

</div>
<div class="sect5">
<h6 id="xform-GrabExclude"><a class="link" href="#xform-GrabExclude"><code>@groovy.lang.GrabExclude</code></a></h6>

</div>
<div class="sect5">
<h6 id="xform-GrabResolver"><a class="link" href="#xform-GrabResolver"><code>@groovy.lang.GrabResolver</code></a></h6>

</div>
<div class="sect5">
<h6 id="xform-Grapes"><a class="link" href="#xform-Grapes"><code>@groovy.lang.Grapes</code></a></h6>
<div class="paragraph">
<p><code>Grape</code> is a dependency management engine embedded into Groovy, relying on several annotations which are described
thoroughly in this <a href="grape.html#section-grape">section of the guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="developing-ast-xforms"><a class="link" href="#developing-ast-xforms">4.2.2. Developing AST transformations</a></h4>
<div class="paragraph">
<p>There are two kinds of transformations: global and local transformations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#transforms-global">Global transformations</a> are applied to by the compiler on the code being compiled,
wherever the transformation apply. Compiled classes that implement global transformations
are in a JAR added to the classpath of the compiler and contain service locator file
<code>META-INF/services/org.codehaus.groovy.transform.ASTTransformation</code> with a line with the name of the
transformation class. The transformation class must have a no-arg constructor and implement the
<code>org.codehaus.groovy.transform.ASTTransformation</code> interface.
It will be run against <strong>every source in the compilation</strong>, so be sure to not create transformations which
scan all the AST in an expansive and time-consuming manner, to keep the compiler fast.</p>
</li>
<li>
<p><a href="#transforms-local">Local transformations</a> are transformations applied locally by annotating code elements you want to
transform. For this, we reuse the annotation notation, and those annotations should implement
<code>org.codehaus.groovy.transform.ASTTransformation</code>. The compiler will discover them and apply the
transformation on these code elements.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_compilation_phases_guide"><a class="link" href="#_compilation_phases_guide">4.2.2.1. Compilation phases guide</a></h5>
<div class="paragraph">
<p>Groovy AST transformations must be performed in one of the nine defined
compilation phases (gapi:org.codehaus.groovy.control.CompilePhase[]).</p>
</div>
<div class="paragraph">
<p>Global transformations may be applied in any phase, but local
transformations may only be applied in the semantic analysis phase or
later. Briefly, the compiler phases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Initialization</em>: source files are opened and environment configured</p>
</li>
<li>
<p><em>Parsing</em>: the grammar is used to produce tree of tokens representing
the source code</p>
</li>
<li>
<p><em>Conversion</em>: An abstract syntax tree (AST) is created from token trees.</p>
</li>
<li>
<p><em>Semantic Analysis</em>: Performs consistency and validity checks that the
grammar can’t check for, and resolves classes.</p>
</li>
<li>
<p><em>Canonicalization</em>: Complete building the AST</p>
</li>
<li>
<p><em>Instruction Selection</em>: instruction set is chosen, for example Java 6 or Java 7 bytecode level</p>
</li>
<li>
<p><em>Class Generation</em>: creates the bytecode of the class in memory</p>
</li>
<li>
<p><em>Output</em>: write the binary output to the file system</p>
</li>
<li>
<p><em>Finalization</em>: Perform any last cleanup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generally speaking, there is more type information available later in
the phases. If your transformation is concerned with reading the AST,
then a later phase where information is more plentiful might be a good
choice. If your transformation is concerned with writing AST, then an
earlier phase where the tree is more sparse might be more convenient.</p>
</div>
</div>
<div class="sect4">
<h5 id="transforms-local"><a class="link" href="#transforms-local">4.2.2.2. Local transformations</a></h5>
<div class="paragraph">
<p>Local AST transformations are relative to the context they are applied to. In
most cases, the context is defined by an annotation that will define the scope
of the transform. For example, annotating a field would mean that the transformation
<em>applies to</em> the field, while annotating the class would mean that the transformation
<em>applies to</em> the whole class.</p>
</div>
<div class="paragraph">
<p>As a naive and simple example, consider wanting to write a <code>@WithLogging</code>
transformation that would add console messages at the start and end of a
method invocation. So the following "Hello World" example would
actually print "Hello World" along with a start and stop message:</p>
</div>
<div class="listingblock">
<div class="title">Poor man&#8217;s aspect oriented programming</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@WithLogging</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">greet</span>() {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello World</span><span style="color:#710">&quot;</span></span>
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>A local AST transformation is an easy way to do this. It requires two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a definition of the <code>@WithLogging</code> annotation</p>
</li>
<li>
<p>an implementation of gapi:org.codehaus.groovy.transform.ASTTransformation[] that adds the logging
expressions to the method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>ASTTransformation</code> is a callback that gives you access to the
gapi:org.codehaus.groovy.control.SourceUnit[],
through which you can get a reference to the
gapi:org.codehaus.groovy.ast.ModuleNode[] (AST).</p>
</div>
<div class="paragraph">
<p>The AST (Abstract Syntax Tree) is a tree structure consisting mostly of
gapi:org.codehaus.groovy.ast.expr.Expression[] (expressions) or
gapi:org.codehaus.groovy.ast.expr.Statement[] (statements). An easy way to
learn about the AST is to explore it in a debugger. Once you have the AST,
you can analyze it to find out information about the code or rewrite it to add
new functionality.</p>
</div>
<div class="paragraph">
<p>The local transformation annotation is the simple part. Here is the
<code>@WithLogging</code> one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.transform.GroovyASTTransformationClass</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.annotation.ElementType</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.annotation.Retention</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.annotation.RetentionPolicy</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.lang.annotation.Target</span>

<span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.SOURCE)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.METHOD])
<span style="color:#007">@GroovyASTTransformationClass</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">gep.WithLoggingASTTransformation</span><span style="color:#710">&quot;</span></span>])
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> WithLogging {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation retention can be <code>SOURCE</code> because you won’t need the annotation
past that. The element type here is <code>METHOD</code>, the <code>@WithLogging</code> because the annotation
applies to methods.</p>
</div>
<div class="paragraph">
<p>But the most important part is the
<code>@GroovyASTTransformationClass</code> annotation. This links the <code>@WithLogging</code>
annotation to the <code>ASTTransformation</code> class you will write.
<code>gep.WithLoggingASTTransformation</code> is the fully qualified class name of the
<code>ASTTransformation</code> we are going to write. This line wires the annotation to the transformation.</p>
</div>
<div class="paragraph">
<p>With this in place, the Groovy compiler is going to invoke
<code>gep.WithLoggingASTTransformation</code> every time an <code>@WithLogging</code> is found in a
source unit. Any breakpoint set within <code>LoggingASTTransformation</code> will now
be hit within the IDE when running the sample script.</p>
</div>
<div class="paragraph">
<p>The <code>ASTTransformation</code> class is a little more complex. Here is the
very simple, and very naive, transformation to add a method start and
stop message for <code>@WithLogging</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>                                                                  // <b class="conum">(1)</b>
<span style="color:#007">@GroovyASTTransformation</span>(phase=CompilePhase.SEMANTIC_ANALYSIS)                  // <b class="conum">(2)</b>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithLoggingASTTransformation</span> <span style="color:#088;font-weight:bold">implements</span> ASTTransformation {               // <b class="conum">(3)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit sourceUnit) {                        // <b class="conum">(4)</b>
        MethodNode method = (MethodNode) nodes[<span style="color:#00D">1</span>]                               // <b class="conum">(5)</b>

        <span style="color:#080;font-weight:bold">def</span> startMessage = createPrintlnAst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Starting </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>method</span><span style="color:#D20">.name</span><span style="color:#710">&quot;</span></span>)            // <b class="conum">(6)</b>
        <span style="color:#080;font-weight:bold">def</span> endMessage = createPrintlnAst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Ending </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>method</span><span style="color:#D20">.name</span><span style="color:#710">&quot;</span></span>)                // <b class="conum">(7)</b>

        <span style="color:#080;font-weight:bold">def</span> existingStatements = ((BlockStatement)method.code).statements       // <b class="conum">(8)</b>
        existingStatements.add(<span style="color:#00D">0</span>, startMessage)                                 // <b class="conum">(9)</b>
        existingStatements.add(endMessage)                                      // <b class="conum">(10)</b>

    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Statement</span> createPrintlnAst(<span style="color:#0a8;font-weight:bold">String</span> message) {                 // <b class="conum">(11)</b>
        <span style="color:#080;font-weight:bold">new</span> ExpressionStatement(
            <span style="color:#080;font-weight:bold">new</span> MethodCallExpression(
                <span style="color:#080;font-weight:bold">new</span> VariableExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">this</span><span style="color:#710">&quot;</span></span>),
                <span style="color:#080;font-weight:bold">new</span> ConstantExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">println</span><span style="color:#710">&quot;</span></span>),
                <span style="color:#080;font-weight:bold">new</span> ArgumentListExpression(
                    <span style="color:#080;font-weight:bold">new</span> ConstantExpression(message)
                )
            )
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</p>
</li>
<li>
<p>annotate with gapi:org.codehaus.groovy.transform.GroovyASTTransformation[] to tell at which compilation phase the
transform needs to run. Here, it&#8217;s at the <em>semantic analysis</em> phase.</p>
</li>
<li>
<p>implement the <code>ASTTransformation</code> interface</p>
</li>
<li>
<p>which only has a single <code>visit</code> method</p>
</li>
<li>
<p>the <code>nodes</code> parameter is a 2 AST node array, for which the first one is the annotation node (<code>@WithLogging</code>) and
the second one is the annotated node (the method node)</p>
</li>
<li>
<p>create a statement that will print a message when we enter the method</p>
</li>
<li>
<p>create a statement that will print a message when we exit the method</p>
</li>
<li>
<p>get the method body, which in this case is a <code>BlockStatement</code></p>
</li>
<li>
<p>add the enter method message before the first statement of existing code</p>
</li>
<li>
<p>append the exit method message after the last statement of existing code</p>
</li>
<li>
<p>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is important to notice that for the brevity of this example, we didn&#8217;t make the necessary checks, such as checking
that the annotated node is really a <code>MethodNode</code>, or that the method body is an instance of <code>BlockStatement</code>. This
exercise is left to the reader.</p>
</div>
<div class="paragraph">
<p>Note the creation of the new println statements in the
<code>createPrintlnAst(String)</code> method. Creating AST for code is not always
simple. In this case we need to construct a new method call, passing in
the receiver/variable, the name of the method, and an argument list.
When creating AST, it might be helpful to write the code you’re trying
to create in a Groovy file and then inspect the AST of that code in the
debugger to learn what to create. Then write a function like
<code>createPrintlnAst</code> using what you learned through the debugger.</p>
</div>
<div class="paragraph">
<p>In the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@WithLogging</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">greet</span>() {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello World</span><span style="color:#710">&quot;</span></span>
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Starting greet
Hello World
Ending greet</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is important to note that an AST transformation participates directly in the compilation process. A common
error by beginners is to have the AST transformation code in the same source tree as a class that uses the transformation.
Being in the same source tree in general means that they are compiled at the same time. Since the transformation itself
is going to be compiled in phases and that each compile phase processes all files of the same source unit before going
to the next one, there&#8217;s a direct consequence: the transformation will not be compiled before the class that uses it! In
conclusion, AST transformations need to be precompiled before you can use them. In general, it is as easy as having them
in a separate source tree.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="transforms-global"><a class="link" href="#transforms-global">4.2.2.3. Global transformations</a></h5>
<div class="paragraph">
<p>Global AST transformation are similar to local one with a major difference: they do not need an annotation, meaning that
they are applied <em>globally</em>, that is to say on each class being compiled. It is therefore very important to limit their
use to last resort, because it can have a significant impact on the compiler performance.</p>
</div>
<div class="paragraph">
<p>Following the example of the <a href="#transforms-local">local AST transformation</a>, imagine that we would like to trace all
methods, and not only those which are annotated with <code>@WithLogging</code>. Basically, we need this code to behave the same
as the one annotated with <code>@WithLogging</code> before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">greet</span>() {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello World</span><span style="color:#710">&quot;</span></span>
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work, there are two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create the <code>org.codehaus.groovy.transform.ASTTransformation</code> descriptor inside the <code>META-INF/services</code> directory</p>
</li>
<li>
<p>create the <code>ASTTransformation</code> implementation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The descriptor file is required and must be found on classpath. It will contain a single line:</p>
</div>
<div class="listingblock">
<div class="title">META-INF/services/org.codehaus.groovy.transform.ASTTransformation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gep.WithLoggingASTTransformation</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for the transformation looks similar to the local case, but instead of using the <code>ASTNode[]</code> parameter, we need
to use the <code>SourceUnit</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">gep/WithLoggingASTTransformation.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>                                                                  // <b class="conum">(1)</b>
<span style="color:#007">@GroovyASTTransformation</span>(phase=CompilePhase.SEMANTIC_ANALYSIS)                  // <b class="conum">(2)</b>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WithLoggingASTTransformation</span> <span style="color:#088;font-weight:bold">implements</span> ASTTransformation {               // <b class="conum">(3)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit sourceUnit) {                        // <b class="conum">(4)</b>
        <span style="color:#080;font-weight:bold">def</span> methods = sourceUnit.AST.methods                                    // <b class="conum">(5)</b>
        methods.each { method -&gt;                                                // <b class="conum">(6)</b>
            <span style="color:#080;font-weight:bold">def</span> startMessage = createPrintlnAst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Starting </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>method</span><span style="color:#D20">.name</span><span style="color:#710">&quot;</span></span>)        // <b class="conum">(7)</b>
            <span style="color:#080;font-weight:bold">def</span> endMessage = createPrintlnAst(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Ending </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>method</span><span style="color:#D20">.name</span><span style="color:#710">&quot;</span></span>)            // <b class="conum">(8)</b>

            <span style="color:#080;font-weight:bold">def</span> existingStatements = ((BlockStatement)method.code).statements   // <b class="conum">(9)</b>
            existingStatements.add(<span style="color:#00D">0</span>, startMessage)                             // <b class="conum">(10)</b>
            existingStatements.add(endMessage)                                  // <b class="conum">(11)</b>
        }
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Statement</span> createPrintlnAst(<span style="color:#0a8;font-weight:bold">String</span> message) {                 // <b class="conum">(12)</b>
        <span style="color:#080;font-weight:bold">new</span> ExpressionStatement(
            <span style="color:#080;font-weight:bold">new</span> MethodCallExpression(
                <span style="color:#080;font-weight:bold">new</span> VariableExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">this</span><span style="color:#710">&quot;</span></span>),
                <span style="color:#080;font-weight:bold">new</span> ConstantExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">println</span><span style="color:#710">&quot;</span></span>),
                <span style="color:#080;font-weight:bold">new</span> ArgumentListExpression(
                    <span style="color:#080;font-weight:bold">new</span> ConstantExpression(message)
                )
            )
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</p>
</li>
<li>
<p>annotate with gapi:org.codehaus.groovy.transform.GroovyASTTransformation[] to tell at which compilation phase the
transform needs to run. Here, it&#8217;s at the <em>semantic analysis</em> phase.</p>
</li>
<li>
<p>implement the <code>ASTTransformation</code> interface</p>
</li>
<li>
<p>which only has a single <code>visit</code> method</p>
</li>
<li>
<p>the <code>sourceUnit</code> parameter gives access to the source being compiled, so we get the AST of the current source
and retrieve the list of methods from this file</p>
</li>
<li>
<p>we iterate on each method from the source file</p>
</li>
<li>
<p>create a statement that will print a message when we enter the method</p>
</li>
<li>
<p>create a statement that will print a message when we exit the method</p>
</li>
<li>
<p>get the method body, which in this case is a <code>BlockStatement</code></p>
</li>
<li>
<p>add the enter method message before the first statement of existing code</p>
</li>
<li>
<p>append the exit method message after the last statement of existing code</p>
</li>
<li>
<p>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_ast_api_guide"><a class="link" href="#_ast_api_guide">4.2.2.4. AST API guide</a></h5>
<div class="sect5">
<h6 id="_abstractasttransformation"><a class="link" href="#_abstractasttransformation">AbstractASTTransformation</a></h6>
<div class="paragraph">
<p>While you have seen that you can directly implement the <code>ASTTransformation</code> interface, in almost all cases you will not
do this but extend the gapi:org.codehaus.groovy.transform.AbstractASTTransformation[] class. This class provides several
utility methods that make AST transformations easier to write. Almost all AST transformations included in Groovy
extend this class.</p>
</div>
</div>
<div class="sect5">
<h6 id="_classcodeexpressiontransformer"><a class="link" href="#_classcodeexpressiontransformer">ClassCodeExpressionTransformer</a></h6>
<div class="paragraph">
<p>It is a common use case to be able to transform an expression into another. Groovy provides a class which makes it
very easy to do this: gapi:org.codehaus.groovy.ast.ClassCodeExpressionTransformer[]</p>
</div>
<div class="paragraph">
<p>To illustrate this, let&#8217;s create a <code>@Shout</code> transformation that will transform all <code>String</code> constants in method call
arguments into their uppercase version. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Shout</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">greet</span>() {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello World</span><span style="color:#710">&quot;</span></span>
}

greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>should print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HELLO WORLD</pre>
</div>
</div>
<div class="paragraph">
<p>Then the code for the transformation can use the <code>ClassCodeExpressionTransformer</code> to make this easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>
<span style="color:#007">@GroovyASTTransformation</span>(phase=CompilePhase.SEMANTIC_ANALYSIS)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ShoutASTTransformation</span> <span style="color:#088;font-weight:bold">implements</span> ASTTransformation {

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit sourceUnit) {
        ClassCodeExpressionTransformer trn = <span style="color:#080;font-weight:bold">new</span> ClassCodeExpressionTransformer() {         // <b class="conum">(1)</b>
            <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">boolean</span> inArgList = <span style="color:#069">false</span>
            <span style="color:#007">@Override</span>
            <span style="color:#088;font-weight:bold">protected</span> SourceUnit getSourceUnit() {
                sourceUnit                                                                  // <b class="conum">(2)</b>
            }

            <span style="color:#007">@Override</span>
            <span style="color:#0a8;font-weight:bold">Expression</span> transform(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Expression</span> exp) {
                <span style="color:#080;font-weight:bold">if</span> (exp <span style="color:#080;font-weight:bold">instanceof</span> ArgumentListExpression) {
                    inArgList = <span style="color:#069">true</span>
                } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (inArgList &amp;&amp;
                    exp <span style="color:#080;font-weight:bold">instanceof</span> ConstantExpression &amp;&amp; exp.value <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">String</span>) {
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> ConstantExpression(exp.value.toUpperCase())                  // <b class="conum">(3)</b>
                }
                <span style="color:#080;font-weight:bold">def</span> trn = <span style="color:#950">super</span>.transform(exp)
                inArgList = <span style="color:#069">false</span>
                trn
            }
        }
        trn.visitMethod((MethodNode)nodes[<span style="color:#00D">1</span>])                                               // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Internally the transformation creates a <code>ClassCodeExpressionTransformer</code></p>
</li>
<li>
<p>The transformer needs to return the source unit</p>
</li>
<li>
<p>if a constant expression of type string is detected inside an argument list, transform it into its upper case version</p>
</li>
<li>
<p>call the transformer on the method being annotated</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_ast_nodes"><a class="link" href="#_ast_nodes">AST Nodes</a></h6>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Writing an AST transformation requires a deep knowledge of the internal Groovy API. In particular it requires
knowledge about the AST classes. Since those classes are internal, there are chances that the API will change in the
future, meaning that your transformations <em>could</em> break. Despite that warning, the AST has been very stable over time
and such a thing rarely happens.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Classes of the Abstract Syntax Tree belong to the <code>org.codehaus.groovy.ast</code> package. It is recommended to the reader
to use the Groovy Console, in particular the AST browser tool, to gain knowledge about those classes. However, a good
resource for learning is the <a href="https://github.com/apache/groovy/tree/master/src/test/org/codehaus/groovy/ast/builder">AST Builder</a>
test suite.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_macros"><a class="link" href="#_macros">4.2.2.5. Macros</a></h5>
<div class="sect5">
<h6 id="_introduction"><a class="link" href="#_introduction">Introduction</a></h6>
<div class="paragraph">
<p>Until version 2.5.0, when developing AST transformations, developers should have a deep knowledge about how the AST
(Abstract Syntax Tree) was built by the compiler in order to know how to add new expressions or statements during
compile time.</p>
</div>
<div class="paragraph">
<p>Although the use of <code>org.codehaus.groovy.ast.tool.GeneralUtils</code> static methods could mitigate the burden of creating
expressions and statements, it&#8217;s still a low-level way of writing those AST nodes directly.
We needed something to abstract us from writing the AST directly and that&#8217;s exactly what Groovy macros were made for.
They allow you to directly add code during compilation, without having to translate the code you had in mind to the
<code>org.codehaus.groovy.ast.*</code> node related classes.</p>
</div>
</div>
<div class="sect5">
<h6 id="_statements_and_expressions"><a class="link" href="#_statements_and_expressions">Statements and expressions</a></h6>
<div class="paragraph">
<p>Let&#8217;s see an example, lets create a local AST transformation: <code>@AddMessageMethod</code>. When applied to a given class it
will add a new method called <code>getMessage</code> to that class. The method will return "42". The annotation is pretty
straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.SOURCE)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.TYPE])
<span style="color:#007">@GroovyASTTransformationClass</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">metaprogramming.AddMethodASTTransformation</span><span style="color:#710">&quot;</span></span>])
<span style="color:#007">@interface</span> AddMethod { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What would the AST transformation look like without the use of a macro ? Something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AddMethodASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {
    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[<span style="color:#00D">1</span>]

        ReturnStatement code =
                <span style="color:#080;font-weight:bold">new</span> ReturnStatement(                              // <b class="conum">(1)</b>
                        <span style="color:#080;font-weight:bold">new</span> ConstantExpression(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">42</span><span style="color:#710">&quot;</span></span>))             // <b class="conum">(2)</b>

        MethodNode methodNode =
                <span style="color:#080;font-weight:bold">new</span> MethodNode(
                        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">getMessage</span><span style="color:#710">&quot;</span></span>,
                        ACC_PUBLIC,
                        ClassHelper.make(<span style="color:#0a8;font-weight:bold">String</span>),
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> Parameter<span style="color:#339;font-weight:bold">[]</span>,
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> ClassNode<span style="color:#339;font-weight:bold">[]</span>,
                        code)                                     // <b class="conum">(3)</b>

        classNode.addMethod(methodNode)                           // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a return statement</p>
</li>
<li>
<p>Create a constant expression "42"</p>
</li>
<li>
<p>Adding the code to the new method</p>
</li>
<li>
<p>Adding the new method to the annotated class</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you&#8217;re not used to the AST API, that definitely doesn&#8217;t look like the code you had in mind. Now look how the
previous code simplifies with the use of macros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AddMethodWithMacrosASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {
    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[<span style="color:#00D">1</span>]

        ReturnStatement simplestCode = macro { <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">42</span><span style="color:#710">&quot;</span></span> }   // <b class="conum">(1)</b>

        MethodNode methodNode =
                <span style="color:#080;font-weight:bold">new</span> MethodNode(
                        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">getMessage</span><span style="color:#710">&quot;</span></span>,
                        ACC_PUBLIC,
                        ClassHelper.make(<span style="color:#0a8;font-weight:bold">String</span>),
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> Parameter<span style="color:#339;font-weight:bold">[]</span>,
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> ClassNode<span style="color:#339;font-weight:bold">[]</span>,
                        simplestCode)                          // <b class="conum">(2)</b>

        classNode.addMethod(methodNode)                        // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Much simpler. You wanted to add a return statement that returned "42" and that&#8217;s exactly what you can read inside
the <code>macro</code> utility method. Your plain code will be translated for you to a <code>org.codehaus.groovy.ast.stmt.ReturnStatement</code></p>
</li>
<li>
<p>Adding the return statement to the new method</p>
</li>
<li>
<p>Adding the new code to the annotated class</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Although the <code>macro</code> method is used in this example to create a <strong>statement</strong> the <code>macro</code> method could also be used to create
<strong>expressions</strong> as well, it depends on which <code>macro</code> signature you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>macro(Closure)</code>: Create a given statement with the code inside the closure.</p>
</li>
<li>
<p><code>macro(Boolean,Closure)</code>: if <strong>true</strong> wrap expressions inside the closure inside a statement, if <strong>false</strong> then return
an expression</p>
</li>
<li>
<p><code>macro(CompilePhase, Closure)</code>: Create a given statement with the code inside the closure in a specific compile phase</p>
</li>
<li>
<p><code>macro(CompilePhase, Boolean, Closure)</code>: Create a statement or an expression (true == statement, false == expression)
in a specific compilation phase.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All these signatures can be found at <code>org.codehaus.groovy.macro.runtime.MacroGroovyMethods</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes we could be only interested in creating a given expression, not the whole statement, in order to do that we
should use any of the <code>macro</code> invocations with a boolean parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AddGetTwoASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {

    BinaryExpression onePlusOne() {
        <span style="color:#080;font-weight:bold">return</span> macro(<span style="color:#069">false</span>) { <span style="color:#00D">1</span> + <span style="color:#00D">1</span> }                                      // <b class="conum">(1)</b>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        ClassNode classNode = nodes[<span style="color:#00D">1</span>]
        BinaryExpression expression = onePlusOne()                         // <b class="conum">(2)</b>
        ReturnStatement returnStatement = GeneralUtils.returnS(expression) // <b class="conum">(3)</b>

        MethodNode methodNode =
                <span style="color:#080;font-weight:bold">new</span> MethodNode(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">getTwo</span><span style="color:#710">&quot;</span></span>,
                        ACC_PUBLIC,
                        ClassHelper.Integer_TYPE,
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> Parameter<span style="color:#339;font-weight:bold">[]</span>,
                        <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> ClassNode<span style="color:#339;font-weight:bold">[]</span>,
                        returnStatement                                    // <b class="conum">(4)</b>
                )

        classNode.addMethod(methodNode)                                    // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We&#8217;re telling macro not to wrap the expression in a statement, we&#8217;re only interested in the expression</p>
</li>
<li>
<p>Assigning the expression</p>
</li>
<li>
<p>Creating a <code>ReturnStatement</code> using a method from <code>GeneralUtils</code> and returning the expression</p>
</li>
<li>
<p>Adding the code to the new method</p>
</li>
<li>
<p>Adding the method to the class</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_variable_substitution"><a class="link" href="#_variable_substitution">Variable substitution</a></h6>
<div class="paragraph">
<p>Macros are great but we can&#8217;t create anything useful or reusable if our macros couldn&#8217;t receive parameters or resolve
surrounding variables.</p>
</div>
<div class="paragraph">
<p>In the following example we&#8217;re creating an AST transformation <code>@MD5</code> that when applied to a given String field will
add a method returning the MD5 value of that field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.SOURCE)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.FIELD])
<span style="color:#007">@GroovyASTTransformationClass</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">metaprogramming.MD5ASTTransformation</span><span style="color:#710">&quot;</span></span>])
<span style="color:#007">@interface</span> MD5 { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the transformation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.CANONICALIZATION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MD5ASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        FieldNode fieldNode = nodes[<span style="color:#00D">1</span>]
        ClassNode classNode = fieldNode.declaringClass
        <span style="color:#0a8;font-weight:bold">String</span> capitalizedName = fieldNode.name.capitalize()
        MethodNode methodNode = <span style="color:#080;font-weight:bold">new</span> MethodNode(
                <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">get</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>capitalizedName<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">MD5</span><span style="color:#710">&quot;</span></span>,
                ACC_PUBLIC,
                ClassHelper.STRING_TYPE,
                <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> Parameter<span style="color:#339;font-weight:bold">[]</span>,
                <span style="color:#339;font-weight:bold">[]</span> <span style="color:#080;font-weight:bold">as</span> ClassNode<span style="color:#339;font-weight:bold">[]</span>,
                buildMD5MethodCode(fieldNode))

        classNode.addMethod(methodNode)
    }

    BlockStatement buildMD5MethodCode(FieldNode fieldNode) {
        VariableExpression fieldVar = GeneralUtils.varX(fieldNode.name) // <b class="conum">(1)</b>

        <span style="color:#080;font-weight:bold">return</span> macro(CompilePhase.SEMANTIC_ANALYSIS, <span style="color:#069">true</span>) {            // <b class="conum">(2)</b>
            <span style="color:#080;font-weight:bold">return</span> java.security.MessageDigest
                    .getInstance(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MD5</span><span style="color:#710">'</span></span>)
                    .digest(<span style="color:#F00;background-color:#FAA">$</span>v { fieldVar }.getBytes())                 // <b class="conum">(3)</b>
                    .encodeHex()
                    .toString()
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We need a reference to a variable expression</p>
</li>
<li>
<p>If using a class outside the standard packages we should add any needed imports or use the qualified name. When
using the qualified name of a given static method you need to make sure it&#8217;s resolved in the proper compile phase. In
this particular case we&#8217;re instructing the macro to resolve it at the SEMANTIC_ANALYSIS phase, which is the first compile phase
with type information.</p>
</li>
<li>
<p>In order to substitute any <code>expression</code> inside the macro we need to use the <code>$v</code> method. <code>$v</code> receives a closure as an
argument, and the closure is only allowed to substitute expressions, meaning classes inheriting
<code>org.codehaus.groovy.ast.expr.Expression</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_macroclass"><a class="link" href="#_macroclass">MacroClass</a></h6>
<div class="paragraph">
<p>As we mentioned earlier, the <code>macro</code> method is only capable of producing <code>statements</code> and <code>expressions</code>. But what if we
want to produce other types of nodes, such as a method, a field and so on?</p>
</div>
<div class="paragraph">
<p><code>org.codehaus.groovy.macro.transform.MacroClass</code> can be used to create <strong>classes</strong> (ClassNode instances) in our
transformations the same way we created statements and expressions with the <code>macro</code> method before.</p>
</div>
<div class="paragraph">
<p>The next example is a local transformation <code>@Statistics</code>. When applied to a given class, it will add two methods
<strong>getMethodCount()</strong> and <strong>getFieldCount()</strong> which return how many methods and fields within the class respectively. Here
is the marker annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.SOURCE)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.TYPE])
<span style="color:#007">@GroovyASTTransformationClass</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">metaprogramming.StatisticsASTTransformation</span><span style="color:#710">&quot;</span></span>])
<span style="color:#007">@interface</span> Statistics {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the AST transformation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>
<span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">StatisticsASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[<span style="color:#00D">1</span>]
        ClassNode templateClass = buildTemplateClass(classNode)  // <b class="conum">(1)</b>

        templateClass.methods.each { MethodNode node -&gt;          // <b class="conum">(2)</b>
            classNode.addMethod(node)
        }
    }

    <span style="color:#007">@CompileDynamic</span>
    ClassNode buildTemplateClass(ClassNode reference) {          // <b class="conum">(3)</b>
        <span style="color:#080;font-weight:bold">def</span> methodCount = constX(reference.methods.size())       // <b class="conum">(4)</b>
        <span style="color:#080;font-weight:bold">def</span> fieldCount = constX(reference.fields.size())         // <b class="conum">(5)</b>

        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> MacroClass() {
            <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Statistics</span> {
                java.lang.Integer getMethodCount() {             // <b class="conum">(6)</b>
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#F00;background-color:#FAA">$</span>v { methodCount }
                }

                java.lang.Integer getFieldCount() {              // <b class="conum">(7)</b>
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#F00;background-color:#FAA">$</span>v { fieldCount }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creating a template class</p>
</li>
<li>
<p>Adding template class methods to the annotated class</p>
</li>
<li>
<p>Passing the reference class</p>
</li>
<li>
<p>Extracting reference class method count value expression</p>
</li>
<li>
<p>Extracting reference class field count value expression</p>
</li>
<li>
<p>Building the <strong>getMethodCount()</strong> method using reference&#8217;s method count value expression</p>
</li>
<li>
<p>Building the <strong>getFieldCount()</strong> method using reference&#8217;s field count value expression</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Basically we&#8217;ve created the <strong>Statistics</strong> class as a template to avoid writing low level AST API, then we
copied methods created in the template class to their final destination.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Types inside the <code>MacroClass</code> implementation should be resolved inside, that&#8217;s why we had to write
<code>java.lang.Integer</code> instead of simply writing <code>Integer</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Notice that we&#8217;re using <code>@CompileDynamic</code>. That&#8217;s because the way we use <code>MacroClass</code> is like we
were actually implementing it. So if you were using <code>@CompileStatic</code> it will complain because an implementation of
an abstract class can&#8217;t be another different class.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_macro_methods"><a class="link" href="#_macro_methods">@Macro methods</a></h6>
<div class="paragraph">
<p>You have seen that by using <code>macro</code> you can save yourself a lot of work but you might wonder where
that method came from. You didn&#8217;t declare it or static import it. You can think of it as a special
global method (or if you prefer, a method on every <code>Object</code>). This is much like how the <code>println</code>
extension method is defined. But unlike <code>println</code> which becomes a method selected for execution
later in the compilation process, <code>macro</code> expansion is done early in the compilation process.
The declaration of <code>macro</code> as one of the available methods for this early expansion is done
by annotating a <code>macro</code> method definition with the <code>@Macro</code> annotation and making that method
available using a similar mechanism for extension modules. Such methods are known as <em>macro</em> methods
and the good news is you can define your own.</p>
</div>
<div class="paragraph">
<p>To define your own macro method, create a class in a similar way to an extension module and
add a method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ExampleMacroMethods</span> {

    <span style="color:#007">@Macro</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">Expression</span> safe(MacroContext macroContext, MethodCallExpression callExpression) {
        <span style="color:#080;font-weight:bold">return</span> ternaryX(
                notNullX(callExpression.getObjectExpression()),
                callExpression,
                constX(<span style="color:#069">null</span>)
        );
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you would register this as an extension module using a <code>org.codehaus.groovy.runtime.ExtensionModule</code>
file within the <code>META-INF/groovy</code> directory.</p>
</div>
<div class="paragraph">
<p>Now, assuming that the class and meta info file are on your classpath, you can use the
macro method in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> nullObject = <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#069">null</span> == safe(safe(nullObject.hashcode()).toString())</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_ast_transformations"><a class="link" href="#_testing_ast_transformations">4.2.2.6. Testing AST transformations</a></h5>
<div class="sect5">
<h6 id="_separating_source_trees"><a class="link" href="#_separating_source_trees">Separating source trees</a></h6>
<div class="paragraph">
<p>This section is about good practices in regard to testing AST transformations. Previous sections highlighted the fact
that to be able to execute an AST transformation, it has to be precompiled. It might sound obvious but a lot of people
get caught on this, trying to use an AST transformation in the same source tree as where it is defined.</p>
</div>
<div class="paragraph">
<p>The first tip for testing AST transformation is therefore to separate test sources from the sources of the transform.
Again, this is nothing but best practices, but you must make sure that your build too does actually compile them separately.
This is the case by default with both <a href="http://maven.apache.org">Apache Maven</a> and <a href="http://gradle.org">Gradle</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_debugging_ast_transformations"><a class="link" href="#_debugging_ast_transformations">Debugging AST transformations</a></h6>
<div class="paragraph">
<p>It is very handy to be able to put a breakpoint in an AST transformation, so that you can debug your code in the IDE.
However, you might be surprised to see that your IDE doesn&#8217;t stop on the breakpoint. The reason is actually simple: if
your IDE uses the Groovy compiler to compile the unit tests for your AST transformation, then the compilation is triggered
from the IDE, but the process which will compile the files doesn&#8217;t have debugging options. It&#8217;s only when the test case
is executed that the debugging options are set on the virtual machine. In short: it is too late, the class has been compiled
already, and your transformation is already applied.</p>
</div>
<div class="paragraph">
<p>A very easy workaround is to use the <code>GroovyTestCase</code> class which provides an <code>assertScript</code> method. This means that
instead of writing this in a test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Subject</span> {
    <span style="color:#007">@MyTransformToDebug</span>
    <span style="color:#339;font-weight:bold">void</span> methodToBeTested() {}
}

<span style="color:#339;font-weight:bold">void</span> testMyTransform() {
    <span style="color:#080;font-weight:bold">def</span> c = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>()
    c.methodToBeTested()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testMyTransformWithBreakpoint() {
    assertScript <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        import metaprogramming.MyTransformToDebug

        class Subject {
            @MyTransformToDebug
            void methodToBeTested() {}
        }
        def c = new Subject()
        c.methodToBeTested()
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is that when you use <code>assertScript</code>, the code in the <code>assertScript</code> block is compiled <strong>when the
unit test is executed</strong>. That is to say that this time, the <code>Subject</code> class will be compiled with debugging active, and
the breakpoint is going to be hit.</p>
</div>
</div>
<div class="sect5">
<h6 id="_astmatcher"><a class="link" href="#_astmatcher">ASTMatcher</a></h6>
<div class="paragraph">
<p>Sometimes you may want to make assertions over AST nodes; perhaps to filter the nodes, or to make sure a given
transformation has built the expected AST node.</p>
</div>
<div class="paragraph">
<p><strong>Filtering nodes</strong></p>
</div>
<div class="paragraph">
<p>For instance if you would like to apply a given transformation only to a specific set of AST nodes, you could
use <strong>ASTMatcher</strong> to filter these nodes. The following example shows how to transform a given expression to
another. Using <strong>ASTMatcher</strong> it looks for a specific expression <code>1 + 1</code> and it transforms it to <code>3</code>. That&#8217;s why
we called it the <code>@Joking</code> example.</p>
</div>
<div class="paragraph">
<p>First we create the <code>@Joking</code> annotation that only can be applied to methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Retention</span>(<span style="color:#0a8;font-weight:bold">RetentionPolicy</span>.SOURCE)
<span style="color:#007">@Target</span>([<span style="color:#0a8;font-weight:bold">ElementType</span>.METHOD])
<span style="color:#007">@GroovyASTTransformationClass</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">metaprogramming.JokingASTTransformation</span><span style="color:#710">&quot;</span></span>])
<span style="color:#007">@interface</span> Joking { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the transformation, that only applies an instance of <code>org.codehaus.groovy.ast.ClassCodeExpressionTransformer</code>
to all the expressions within the method code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@CompileStatic</span>
<span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JokingASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {
    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        MethodNode methodNode = (MethodNode) nodes[<span style="color:#00D">1</span>]

        methodNode
            .getCode()
            .visit(<span style="color:#080;font-weight:bold">new</span> ConvertOnePlusOneToThree(source))  // <b class="conum">(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get the method&#8217;s code statement and apply the expression transformer</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And this is when the <strong>ASTMatcher</strong> is used to apply the transformation only to those expressions matching
the expression <code>1 + 1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ConvertOnePlusOneToThree</span> <span style="color:#088;font-weight:bold">extends</span> ClassCodeExpressionTransformer {
    SourceUnit sourceUnit

    ConvertOnePlusOneToThree(SourceUnit sourceUnit) {
        <span style="color:#950">this</span>.sourceUnit = sourceUnit
    }

    <span style="color:#007">@Override</span>
    <span style="color:#0a8;font-weight:bold">Expression</span> transform(<span style="color:#0a8;font-weight:bold">Expression</span> exp) {
        <span style="color:#0a8;font-weight:bold">Expression</span> ref = macro { <span style="color:#00D">1</span> + <span style="color:#00D">1</span> }     // <b class="conum">(1)</b>

        <span style="color:#080;font-weight:bold">if</span> (ASTMatcher.matches(ref, exp)) {  // <b class="conum">(2)</b>
            <span style="color:#080;font-weight:bold">return</span> macro { <span style="color:#00D">3</span> }               // <b class="conum">(3)</b>
        }

        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">super</span>.transform(exp)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Builds the expression used as reference pattern</p>
</li>
<li>
<p>Checks the current expression evaluated matches the reference expression</p>
</li>
<li>
<p>If it matches then replaces the current expression with the expression built with <code>macro</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then you could test the implementation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">package</span> metaprogramming

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Something</span> {
    <span style="color:#007">@Joking</span>
    <span style="color:#0a8;font-weight:bold">Integer</span> getResult() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">1</span> + <span style="color:#00D">1</span>
    }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> Something().result == <span style="color:#00D">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Unit testing AST transforms</strong></p>
</div>
<div class="paragraph">
<p>Normally we test AST transformations just checking that the final use of the transformation does what we expect. But
it would be great if we could have an easy way to check, for example, that the nodes the transformation adds are what
we expected from the beginning.</p>
</div>
<div class="paragraph">
<p>The following transformation adds a new method <code>giveMeTwo</code> to an annotated class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GroovyASTTransformation</span>(phase = CompilePhase.INSTRUCTION_SELECTION)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TwiceASTTransformation</span> <span style="color:#088;font-weight:bold">extends</span> AbstractASTTransformation {

    <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> VAR_X = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>

    <span style="color:#007">@Override</span>
    <span style="color:#339;font-weight:bold">void</span> visit(ASTNode<span style="color:#339;font-weight:bold">[]</span> nodes, SourceUnit source) {
        ClassNode classNode = (ClassNode) nodes[<span style="color:#00D">1</span>]
        MethodNode giveMeTwo = getTemplateClass(sumExpression)
            .getDeclaredMethods(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">giveMeTwo</span><span style="color:#710">'</span></span>)
            .first()

        classNode.addMethod(giveMeTwo)                  // <b class="conum">(1)</b>
    }

    BinaryExpression getSumExpression() {               // <b class="conum">(2)</b>
        <span style="color:#080;font-weight:bold">return</span> macro {
            <span style="color:#F00;background-color:#FAA">$</span>v{ varX(VAR_X) } +
            <span style="color:#F00;background-color:#FAA">$</span>v{ varX(VAR_X) }
        }
    }

    ClassNode getTemplateClass(<span style="color:#0a8;font-weight:bold">Expression</span> expression) { // <b class="conum">(3)</b>
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> MacroClass() {
            <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Template</span> {
                java.lang.Integer giveMeTwo(java.lang.Integer x) {
                    <span style="color:#080;font-weight:bold">return</span> <span style="color:#F00;background-color:#FAA">$</span>v { expression }
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Adding the method to the annotated class</p>
</li>
<li>
<p>Building a binary expression. The binary expression uses the same variable expression in both
sides of the <code>+</code> token (check <code>varX</code> method at <strong>org.codehaus.groovy.ast.tool.GeneralUtils</strong>).</p>
</li>
<li>
<p>Builds a new <strong>ClassNode</strong> with a method called <code>giveMeTwo</code> which returns the result of an expression
passed as parameter.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now instead of creating a test executing the transformation over a given sample code. I would like to check that
the construction of the binary expression is done properly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testTestingSumExpression() {
    use(ASTMatcher) {                 // <b class="conum">(1)</b>
        TwiceASTTransformation sample = <span style="color:#080;font-weight:bold">new</span> TwiceASTTransformation()
        <span style="color:#0a8;font-weight:bold">Expression</span> referenceNode = macro {
            a + a                     // <b class="conum">(2)</b>
        }.withConstraints {           // <b class="conum">(3)</b>
            placeholder <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>           // <b class="conum">(4)</b>
        }

        <span style="color:#080;font-weight:bold">assert</span> sample
            .sumExpression
            .matches(referenceNode)   // <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Using ASTMatcher as a category</p>
</li>
<li>
<p>Build a template node</p>
</li>
<li>
<p>Apply some constraints to that template node</p>
</li>
<li>
<p>Tells compiler that <code>a</code> is a placeholder.</p>
</li>
<li>
<p>Asserts reference node and current node are equal</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Of course you can/should always check the actual execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testASTBehavior() {
    assertScript <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    package metaprogramming

    @Twice
    class AAA {

    }

    assert new AAA().giveMeTwo(1) == 2
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_asttest"><a class="link" href="#_asttest">ASTTest</a></h6>
<div class="paragraph">
<p>Last but not least, testing an AST transformation is also about testing the state of the AST <strong>during compilation</strong>. Groovy
provides a tool named <code>@ASTTest</code> for this: it is an annotation that will let you add assertions on an abstract syntax
tree. Please check the <a href="#xform-ASTTest">documentation for ASTTest</a> for more details.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_external_references"><a class="link" href="#_external_references">4.2.2.7. External references</a></h5>
<div class="paragraph">
<p>If you are interested in a step-by-step tutorial about writing AST transformations, you can follow
<a href="http://melix.github.io/ast-workshop/">this workshop</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="section-grape"><a class="link" href="#section-grape">5. Dependency management with Grape</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_quick_start"><a class="link" href="#_quick_start">5.1. Quick start</a></h3>
<div class="sect3">
<h4 id="_add_a_dependency"><a class="link" href="#_add_a_dependency">5.1.1. Add a Dependency</a></h4>
<div class="paragraph">
<p>Grape is a JAR dependency manager embedded into Groovy. Grape lets you quickly add maven repository dependencies to your
classpath, making scripting even easier. The simplest use is as simple as adding an annotation to your script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">spring-orm</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">5.2.8.RELEASE</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.jdbc.core.JdbcTemplate</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Grab</code> also supports a shorthand notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework:spring-orm:5.2.8.RELEASE</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.jdbc.core.JdbcTemplate</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we are using an annotated import here, which is the recommended way. You can also search for
dependencies on <a href="http://mvnrepository.com">mvnrepository.com</a> and it will
provide you the <code>@Grab</code> annotation form of the <code>pom.xml</code> entry.</p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-SpecifyAdditionalRepositories"><a class="link" href="#Grape-SpecifyAdditionalRepositories">5.1.2. Specify Additional Repositories</a></h4>
<div class="paragraph">
<p>Not all dependencies are in maven central. You can add new ones like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GrabResolver</span>(name=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">restlet</span><span style="color:#710">'</span></span>, root=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://maven.restlet.org/</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.restlet</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.restlet</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.1.6</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-MavenClassifiers"><a class="link" href="#Grape-MavenClassifiers">5.1.3. Maven Classifiers</a></h4>
<div class="paragraph">
<p>Some maven dependencies need classifiers in order to be able to resolve.
You can fix that like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">net.sf.json-lib</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">json-lib</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2.2.3</span><span style="color:#710">'</span></span>, classifier=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jdk15</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-ExcludingTransitiveDependencies"><a class="link" href="#Grape-ExcludingTransitiveDependencies">5.1.4. Excluding Transitive Dependencies</a></h4>
<div class="paragraph">
<p>Sometimes you will want to exclude transitive dependencies as you might
be already using a slightly different but compatible version of some
artifact. You can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">net.sourceforge.htmlunit:htmlunit:2.8</span><span style="color:#710">'</span></span>)
<span style="color:#007">@GrabExclude</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xml-apis:xml-apis</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-JDBCDrivers"><a class="link" href="#Grape-JDBCDrivers">5.1.5. JDBC Drivers</a></h4>
<div class="paragraph">
<p>Because of the way JDBC drivers are loaded, you’ll need to configure
Grape to attach JDBC driver dependencies to the system class loader.
I.e:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GrabConfig</span>(systemClassLoader=<span style="color:#069">true</span>)
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mysql-connector-java</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">5.1.6</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-UsingGrapeFromtheGroovyShell"><a class="link" href="#Grape-UsingGrapeFromtheGroovyShell">5.1.6. Using Grape From the Groovy Shell</a></h4>
<div class="paragraph">
<p>From groovysh use the method call variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">groovy.grape.Grape.grab(<span style="color:#606">group</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework</span><span style="color:#710">'</span></span>, <span style="color:#606">module</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">spring</span><span style="color:#710">'</span></span>, <span style="color:#606">version</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2.5.6</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Proxysettings"><a class="link" href="#Grape-Proxysettings">5.1.7. Proxy settings</a></h4>
<div class="paragraph">
<p>If you are behind a firewall and/or need to use Groovy/Grape through a
proxy server, you can specify those settings on the command like via the
<code>http.proxyHost</code> and <code>http.proxyPort</code> system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 yourscript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>Or you can make this system-wide by adding these properties to your
JAVA_OPTS environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS = -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Logging"><a class="link" href="#Grape-Logging">5.1.8. Logging</a></h4>
<div class="paragraph">
<p>If you want to see what Grape is doing set the system property
<code>groovy.grape.report.downloads</code> to <code>true</code> (e.g. add
<code>-Dgroovy.grape.report.downloads=true</code> to invocation or JAVA_OPTS) and Grape will
print the following infos to System.error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starting resolve of a dependency</p>
</li>
<li>
<p>Starting download of an artifact</p>
</li>
<li>
<p>Retrying download of an artifact</p>
</li>
<li>
<p>Download size and time for downloaded artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To log with even more verbosity, increase the Ivy log level
(defaults to <code>-1</code>). For example <code>-Divy.message.logger.level=4</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Grape-Detail"><a class="link" href="#Grape-Detail">5.2. Detail</a></h3>
<div class="paragraph">
<p>Grape (The <em>Groovy Adaptable Packaging Engine</em> or <em>Groovy Advanced
Packaging Engine</em>) is the infrastructure enabling the grab() calls in
Groovy, a set of classes leveraging <a href="http://ant.apache.org/ivy/">Ivy</a> to allow for a repository driven
module system for Groovy. This allows a developer to write a script with
an essentially arbitrary library requirement, and ship just the script.
Grape will, at runtime, download as needed and link the named libraries
and all dependencies forming a transitive closure when the script is run
from existing repositories such as Maven Central.</p>
</div>
<div class="paragraph">
<p>Grape follows the Ivy conventions for module version identification,
with naming change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code> - Which module group the module comes from. Translates
directly to a Maven groupId or an Ivy Organization. Any group matching
<code>/groovy[x][\..*]^/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module</code> - The name of the module to load. Translated directly to a
Maven artifactId or an Ivy artifact.</p>
</li>
<li>
<p><code>version</code> - The version of the module to use. Either a literal version
`1.1-RC3' or an Ivy Range `[2.2.1,)' meaning 2.2.1 or any greater
version).</p>
</li>
<li>
<p><code>classifier</code> - The optional classifier to use (for example, <em>jdk15</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The downloaded modules will be stored according to Ivy’s standard
mechanism with a cache root of <code>~/.groovy/grapes</code></p>
</div>
</div>
<div class="sect2">
<h3 id="Grape-Usage"><a class="link" href="#Grape-Usage">5.3. Usage</a></h3>
<div class="sect3">
<h4 id="Grape-Annotation"><a class="link" href="#Grape-Annotation">5.3.1. Annotation</a></h4>
<div class="paragraph">
<p>One or more <code>groovy.lang.Grab</code> annotations can be added at any place that
annotations are accepted to tell the compiler that this code relies on
the specific library. This will have the effect of adding the library to
the classloader of the groovy compiler. This annotation is detected and
evaluated before any other resolution of classes in the script, so
imported classes can be properly resolved by a <code>@Grab</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.jidesoft.swing.JideSplitButton</span>
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.jidesoft</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jide-oss</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">[2.2.1,2.3.0)</span><span style="color:#710">'</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TestClassAnnotation</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a8;font-weight:bold">String</span> testMethod () {
        <span style="color:#080;font-weight:bold">return</span> JideSplitButton.class.name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An appropriate <code>grab(&#8230;&#8203;)</code> call will be added to the static initializer
of the class of the containing class (or script class in the case of an
annotated script element).</p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-MultipleGrapeAnnotations"><a class="link" href="#Grape-MultipleGrapeAnnotations">5.3.2. Multiple Grape Annotations</a></h4>
<div class="paragraph">
<p>In early versions of Groovy, if you wanted to use a Grab annotation multiple times
on the same node you had to use the <code>@Grapes</code> annotation, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grapes</span>([
   <span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">commons-primitives</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">commons-primitives</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.0</span><span style="color:#710">'</span></span>),
   <span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.ccil.cowan.tagsoup</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tagsoup</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0.9.7</span><span style="color:#710">'</span></span>)])
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Example</span> {
<span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise you’d encounter the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot specify duplicate annotation on the same member</pre>
</div>
</div>
<div class="paragraph">
<p>But in recent versions, @Grapes is purely optional.</p>
</div>
<div class="paragraph">
<p>Technical notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Originally, Groovy stored the Grab annotations for access at runtime
and duplicates aren&#8217;t allowed in the bytecode. In current versions, @Grab has only
SOURCE retention, so the multiple occurrences aren&#8217;t an issue.</p>
</li>
<li>
<p>Future versions of Grape may support using the Grapes annotation to
provide a level of structuring, e.g. allowing a GrabExclude or GrabResolver
annotation to apply to only a subset of the Grab annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Methodcall"><a class="link" href="#Grape-Methodcall">5.3.3. Method call</a></h4>
<div class="paragraph">
<p>Typically a call to grab will occur early in the script or in class
initialization. This is to ensure that the libraries are made available
to the ClassLoader before the groovy code relies on the code. A couple
of typical calls may appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.grape.Grape</span>
<span style="color:#777">// random maven library</span>
Grape.grab(<span style="color:#606">group</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.jidesoft</span><span style="color:#710">'</span></span>, <span style="color:#606">module</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">jide-oss</span><span style="color:#710">'</span></span>, <span style="color:#606">version</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">[2.2.0,)</span><span style="color:#710">'</span></span>)
Grape.grab([<span style="color:#606">group</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.apache.ivy</span><span style="color:#710">'</span></span>, <span style="color:#606">module</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ivy</span><span style="color:#710">'</span></span>, <span style="color:#606">version</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2.0.0-beta1</span><span style="color:#710">'</span></span>, <span style="color:#606">conf</span>:[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">optional</span><span style="color:#710">'</span></span>]],
     [<span style="color:#606">group</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.apache.ant</span><span style="color:#710">'</span></span>, <span style="color:#606">module</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ant</span><span style="color:#710">'</span></span>, <span style="color:#606">version</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.7.0</span><span style="color:#710">'</span></span>])</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple calls to grab in the same context with the same parameters
should be idempotent. However, if the same code is called with a
different <code>ClassLoader</code> context then resolution may be re-run.</p>
</li>
<li>
<p>If the <code>args</code> map passed into the <code>grab</code> call has an attribute
<code>noExceptions</code> that evaluates true no exceptions will be thrown.</p>
</li>
<li>
<p><code>grab</code> requires that a <code>RootLoader</code> or <code>GroovyClassLoader</code> be specified or
be in the <code>ClassLoader</code> chain of the calling class. By default failure to
have such a <code>ClassLoader</code> available will result in module resolution and
an exception being thrown</p>
<div class="ulist">
<ul>
<li>
<p>The ClassLoader passed in via the <code>classLoader:</code> argument and its
parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the object passed in as the <code>referenceObject:</code>
argument, and its parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the class issuing the call to <code>grab</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Grape-grabHashMapParameters"><a class="link" href="#Grape-grabHashMapParameters">5.3.3.1. grab(HashMap) Parameters</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>group:</code> - &lt;String&gt; - Which module group the module comes from.
Translates directly to a Maven groupId. Any group matching
<code>/groovy(|\..|x|x\..)/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module:</code> - &lt;String&gt; - The name of the module to load. Translated
directly to a Maven artifactId.</p>
</li>
<li>
<p><code>version:</code> - &lt;String&gt; and possibly &lt;Range&gt; - The version of the module
to use. Either a literal version `1.1-RC3' or an Ivy Range `[2.2.1,)'
meaning 2.2.1 or any greater version).</p>
</li>
<li>
<p><code>classifier:</code> - &lt;String&gt; - The Maven classifier to resolve by.</p>
</li>
<li>
<p><code>conf:</code> - &lt;String&gt;, default <code>default' - The configuration or scope of
the module to download. The default conf is `default:</code> which maps to the
maven <code>runtime</code> and <code>master</code> scopes.</p>
</li>
<li>
<p><code>force:</code>- &lt;boolean&gt;, defaults true - Used to indicate that this
revision must be used in case of conflicts, independently of</p>
</li>
<li>
<p>conflicts manager</p>
</li>
<li>
<p><code>changing:</code> - &lt;boolean&gt;, default false - Whether the artifact can
change without its version designation changing.</p>
</li>
<li>
<p><code>transitive:</code> - &lt;boolean&gt;, default true - Whether to resolve other
dependencies this module has or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two principal variants of <code>grab</code>, one with a single Map and
one with an arguments Map and multiple dependencies map. A call to the
single map grab is the same as calling grab with the same map passed in
twice, so grab arguments and dependencies can be mixed in the same map,
and grab can be called as a single method with named parameters.</p>
</div>
<div class="paragraph">
<p>There are synonyms for these parameters. Submitting more than one is a
runtime exception.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group:</code>, <code>groupId:</code>, <code>organisation:</code>, <code>organization:</code>, <code>org:</code></p>
</li>
<li>
<p><code>module:</code>, <code>artifactId:</code>, <code>artifact:</code></p>
</li>
<li>
<p><code>version:</code>, <code>revision:</code>, <code>rev:</code></p>
</li>
<li>
<p><code>conf:</code>, <code>scope:</code>, <code>configuration:</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="Grape-ArgumentsMaparguments"><a class="link" href="#Grape-ArgumentsMaparguments">5.3.3.2. Arguments Map arguments</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>classLoader:</code> - &lt;GroovyClassLoader&gt; or &lt;RootClassLoader&gt; - The
ClassLoader to add resolved Jars to</p>
</li>
<li>
<p><code>refObject:</code> - &lt;Object&gt; - The closest parent ClassLoader for the
object’s class will be treated as though it were passed in as
<code>classLoader:</code></p>
</li>
<li>
<p><code>validate:</code> - &lt;boolean&gt;, default false - Should poms or ivy files be
validated (true), or should we trust the cache (false).</p>
</li>
<li>
<p><code>noExceptions:</code> - &lt;boolean&gt;, default false - If ClassLoader resolution
or repository querying fails, should we throw an exception (false) or
fail silently (true).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-CommandLineTool"><a class="link" href="#Grape-CommandLineTool">5.3.4. Command Line Tool</a></h4>
<div class="paragraph">
<p>Grape added a command line executable `grape' that allows for the
inspection and management of the local grape cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape install [-hv] &lt;group&gt; &lt;module&gt; [&lt;version&gt;] [&lt;classifier&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>This installs the specified groovy module or maven artifact. If a
version is specified that specific version will be installed, otherwise
the most recent version will be used (as if `*' we passed in).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape list</pre>
</div>
</div>
<div class="paragraph">
<p>Lists locally installed modules (with their full maven name in the case
of groovy modules) and versions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape resolve [-adhisv] (&lt;groupId&gt; &lt;artifactId&gt; &lt;version&gt;)+</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the file locations of the jars representing the artifacts
for the specified module(s) and the respective transitive dependencies.
You may optionally pass in -ant, -dos, or -shell to get the dependencies
expressed in a format applicable for an ant script, windows batch file,
or unix shell script respectively. -ivy may be passed to see the
dependencies expressed in an ivy like format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape uninstall [-hv] &lt;group&gt; &lt;module&gt; &lt;version&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This uninstalls a particular grape: it non-transitively removes the
respective jar file from the grape cache.</p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Advancedconfiguration"><a class="link" href="#Grape-Advancedconfiguration">5.3.5. Advanced configuration</a></h4>
<div class="sect4">
<h5 id="Grape-RepositoryDirectory"><a class="link" href="#Grape-RepositoryDirectory">5.3.5.1. Repository Directory</a></h5>
<div class="paragraph">
<p>If you need to change the directory grape uses for downloading libraries
you can specify the grape.root system property to change the default
(which is ~/.groovy/grapes)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dgrape.root=/repo/grapes yourscript.groovy</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-CustomizeIvysettings"><a class="link" href="#Grape-CustomizeIvysettings">5.3.5.2. Customize Ivy settings</a></h5>
<div class="paragraph">
<p>You can customize the ivy settings that Grape uses by creating a
~/.groovy/grapeConfig.xml file. If no such file exists,
<a href="https://github.com/apache/groovy/blob/master/src/resources/groovy/grape/defaultGrapeConfig.xml">here</a>
are the default settings used by Grape.</p>
</div>
<div class="paragraph">
<p>For more information on how to customize these settings, please refer to
the <a href="https://ant.apache.org/ivy/history/latest-milestone/index.html">Ivy
documentation</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-MoreExamples"><a class="link" href="#Grape-MoreExamples">5.3.6. More Examples</a></h4>
<div class="paragraph">
<p>Using Apache Commons Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// create and use a primitive array list</span>
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">commons-primitives</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">commons-primitives</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.0</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.commons.collections.primitives.ArrayIntList</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">createEmptyInts</span>() { <span style="color:#080;font-weight:bold">new</span> ArrayIntList() }

<span style="color:#080;font-weight:bold">def</span> ints = createEmptyInts()
ints.add(<span style="color:#00D">0</span>, <span style="color:#00D">42</span>)
<span style="color:#080;font-weight:bold">assert</span> ints.size() == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> ints.get(<span style="color:#00D">0</span>) == <span style="color:#00D">42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using TagSoup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// find the PDF links of the Java specifications</span>
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.ccil.cowan.tagsoup</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">tagsoup</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.2.1</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getHtml</span>() {
    <span style="color:#080;font-weight:bold">def</span> parser = <span style="color:#080;font-weight:bold">new</span> XmlParser(<span style="color:#080;font-weight:bold">new</span> org.ccil.cowan.tagsoup.Parser())
    parser.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://docs.oracle.com/javase/specs/</span><span style="color:#710">&quot;</span></span>)
}
html.body.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**</span><span style="color:#710">'</span></span>.a.@href.grep(~<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">.*</span><span style="color:#808">\.</span><span style="color:#808">pdf</span><span style="color:#404">/</span></span>).each{ println <span style="color:#950">it</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Google Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.google.common.collect.HashBiMap</span>
<span style="color:#007">@Grab</span>(group=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.google.code.google-collections</span><span style="color:#710">'</span></span>, module=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">google-collect</span><span style="color:#710">'</span></span>, version=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">snapshot-20080530</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getFruit</span>() { [<span style="color:#606">grape</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">purple</span><span style="color:#710">'</span></span>, <span style="color:#606">lemon</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">yellow</span><span style="color:#710">'</span></span>, <span style="color:#606">orange</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">orange</span><span style="color:#710">'</span></span>] <span style="color:#080;font-weight:bold">as</span> HashBiMap }
<span style="color:#080;font-weight:bold">assert</span> fruit.lemon == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">yellow</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> fruit.inverse().yellow == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">lemon</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Launching a Jetty server to serve Groovy templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.eclipse.jetty.aggregate:jetty-server:8.1.19.v20160209</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.eclipse.jetty.aggregate:jetty-servlet:8.1.19.v20160209</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">javax.servlet:javax.servlet-api:3.0.1</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.eclipse.jetty.server.Server</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.eclipse.jetty.servlet.ServletContextHandler</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.servlet.TemplateServlet</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">runServer</span>(duration) {
    <span style="color:#080;font-weight:bold">def</span> server = <span style="color:#080;font-weight:bold">new</span> Server(<span style="color:#00D">8080</span>)
    <span style="color:#080;font-weight:bold">def</span> context = <span style="color:#080;font-weight:bold">new</span> ServletContextHandler(server, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/</span><span style="color:#710">&quot;</span></span>, ServletContextHandler.SESSIONS)
    context.resourceBase = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">.</span><span style="color:#710">&quot;</span></span>
    context.addServlet(TemplateServlet, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">*.gsp</span><span style="color:#710">&quot;</span></span>)
    server.start()
    sleep duration
    server.stop()
}

runServer(<span style="color:#00D">10000</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grape will download Jetty and its dependencies on first launch of this
script, and cache them. We create a new Jetty Server on port 8080,
then expose Groovy’s TemplateServlet at the root of the context — Groovy
comes with its own powerful template engine mechanism. We start the
server and let it run for a certain duration. Each time someone will hit
http://localhost:8080/somepage.gsp, it will display the somepage.gsp
template to the user — those template pages should be situated in the
same directory as this server script.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_测试指南"><a class="link" href="#_测试指南">6. 测试指南</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_简介"><a class="link" href="#_简介">6.1. 简介</a></h3>
<div class="paragraph">
<p>The Groovy programming language comes with great support for writing tests. In addition to the language
features and test integration with state-of-the-art testing libraries and frameworks, the Groovy ecosystem has born
a rich set of testing libraries and frameworks.</p>
</div>
<div class="paragraph">
<p>This chapter will start with language specific testing features and continue with a closer look at JUnit
integration, Spock for specifications, and Geb for functional tests. Finally, we&#8217;ll do an overview of other testing
libraries known to be working with Groovy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_语音特性"><a class="link" href="#_语音特性">6.2. 语音特性</a></h3>
<div class="paragraph">
<p>Besides integrated support for JUnit, the Groovy programming language comes with features that have proven
to be very valuable for test-driven development. This section gives insight on them.</p>
</div>
<div class="sect3">
<h4 id="_强大的断言"><a class="link" href="#_强大的断言">6.2.1. 强大的断言</a></h4>
<div class="paragraph">
<p>Writing tests means formulating assumptions by using assertions. In Java this can be done by using the <code>assert</code>
keyword that has been added in J2SE 1.4. In Java, <code>assert</code> statements can be enabled via the JVM parameters <code>-ea</code>
(or <code>-enableassertions</code>) and <code>-da</code> (or <code>-disableassertions</code>). Assertion statements in Java are disabled by default.</p>
</div>
<div class="paragraph">
<p>Groovy comes with a rather <em>powerful variant</em> of <code>assert</code> also known as <em>power assertion statement</em>. Groovy&#8217;s power
<code>assert</code> differs from the Java version in its output given the boolean expression validates to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> x = <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> x == <span style="color:#00D">2</span>

<span style="color:#777">// Output:             </span><b class="conum">(1)</b>
<span style="color:#777">//</span>
<span style="color:#777">// Assertion failed:</span>
<span style="color:#777">// assert x == 2</span>
<span style="color:#777">//        | |</span>
<span style="color:#777">//        1 false</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This section shows the std-err output</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>java.lang.AssertionError</code> that is thrown whenever the assertion can not be validated successfully, contains
an extended version of the original exception message. The power assertion output shows evaluation results from
the outer to the inner expression.</p>
</div>
<div class="paragraph">
<p>The power assertion statements true power unleashes in complex Boolean statements, or statements with
collections or other <code>toString</code>-enabled classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> x = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>,<span style="color:#00D">5</span>]
<span style="color:#080;font-weight:bold">assert</span> (x &lt;&lt; <span style="color:#00D">6</span>) == [<span style="color:#00D">6</span>,<span style="color:#00D">7</span>,<span style="color:#00D">8</span>,<span style="color:#00D">9</span>,<span style="color:#00D">10</span>]

<span style="color:#777">// Output:</span>
<span style="color:#777">//</span>
<span style="color:#777">// Assertion failed:</span>
<span style="color:#777">// assert (x &lt;&lt; 6) == [6,7,8,9,10]</span>
<span style="color:#777">//         | |     |</span>
<span style="color:#777">//         | |     false</span>
<span style="color:#777">//         | [1, 2, 3, 4, 5, 6]</span>
<span style="color:#777">//         [1, 2, 3, 4, 5, 6]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important difference from Java is that in Groovy assertions are <em>enabled by default</em>. It has been a language design
decision to remove the possibility to deactivate assertions. Or, as Bertrand Meyer stated, <code>it makes no sense to take
off your swim ring if you put your feet into real water</code>.</p>
</div>
<div class="paragraph">
<p>One thing to be aware of are methods with side effects inside Boolean expressions in power assertion statements. As
the internal error message construction mechanism does only store references to instances under target,
 it happens that the error message text is invalid at rendering time in case of side-effecting methods involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> [[<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>]].first().unique() == [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>]

<span style="color:#777">// Output:</span>
<span style="color:#777">//</span>
<span style="color:#777">// Assertion failed:</span>
<span style="color:#777">// assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]</span>
<span style="color:#777">//                          |       |        |</span>
<span style="color:#777">//                          |       |        false</span>
<span style="color:#777">//                          |       [1, 2, 3, 4]</span>
<span style="color:#777">//                          [1, 2, 3, 4]           </span>// <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The error message shows the actual state of the collection, not the state before the <code>unique</code> method was applied</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you choose to provide a custom assertion error message this can be done by using the Java syntax <code>assert
expression1 : expression2</code> where <code>expression1</code> is the Boolean expression and <code>expression2</code> is the custom error message.
 Be aware though that this will disable the power assert and will fully fall back to custom
 error messages on assertion errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_mocking_and_stubbing"><a class="link" href="#_mocking_and_stubbing">6.2.2. Mocking and Stubbing</a></h4>
<div class="paragraph">
<p>Groovy has excellent built-in support for a range of mocking and stubbing alternatives. When using Java, dynamic mocking
frameworks are very popular. A key reason for this is that it is hard work creating custom hand-crafted mocks using Java.
Such frameworks can be used easily with Groovy if you choose but creating custom mocks is much easier in Groovy. You
can often get away with simple maps or closures to build your custom mocks.</p>
</div>
<div class="paragraph">
<p>The following sections show ways to create mocks and stubs with Groovy language features only.</p>
</div>
<div class="sect4">
<h5 id="_map_coercion"><a class="link" href="#_map_coercion">6.2.2.1. Map Coercion</a></h5>
<div class="paragraph">
<p>By using maps or expandos, we can incorporate desired behaviour of a collaborator very easily as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TranslationService</span> {
    <span style="color:#0a8;font-weight:bold">String</span> convert(<span style="color:#0a8;font-weight:bold">String</span> key) {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> service = [<span style="color:#606">convert</span>: { <span style="color:#0a8;font-weight:bold">String</span> key -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some text</span><span style="color:#710">'</span></span> }] <span style="color:#080;font-weight:bold">as</span> TranslationService
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some text</span><span style="color:#710">'</span></span> == service.convert(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">key.text</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>as</code> operator can be used to coerce a map to a particular class. The given map keys are interpreted as
method names and the values, being <code>groovy.lang.Closure</code> blocks, are interpreted as method code blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be aware that map coercion can get into the way if you deal with custom <code>java.util.Map</code> descendant classes in combination
with the <code>as</code> operator. The map coercion mechanism is targeted directly at certain collection classes, it doesn&#8217;t take
custom classes into account.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_closure_coercion"><a class="link" href="#_closure_coercion">6.2.2.2. Closure Coercion</a></h5>
<div class="paragraph">
<p>The 'as' operator can be used with closures in a neat way which is great for developer testing in simple scenarios.
We haven&#8217;t found this technique to be so powerful that we want to do away with dynamic mocking, but it can be very
useful in simple cases none-the-less.</p>
</div>
<div class="paragraph">
<p>Classes or interfaces holding a single method, including SAM (single abstract method) classes, can be used to coerce
a closure block to be an object of the given type. Be aware that for doing this, Groovy internally create a proxy object
descending for the given class. So the object will not be a direct instance of the given class. This important if, for
example, the generated proxy object&#8217;s metaclass is altered afterwards.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have an example on coercing a closure to be of a specific type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> service = { <span style="color:#0a8;font-weight:bold">String</span> key -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some text</span><span style="color:#710">'</span></span> } <span style="color:#080;font-weight:bold">as</span> TranslationService
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some text</span><span style="color:#710">'</span></span> == service.convert(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">key.text</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports a feature called implicit SAM coercion. This means that the <code>as</code> operator is not necessary in situations
where the runtime can infer the target SAM type. This type of coercion might be useful in tests to mock entire SAM
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BaseService</span> {
    <span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">void</span> doSomething()
}

BaseService service = { -&gt; println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">doing something</span><span style="color:#710">'</span></span> }
service.doSomething()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mockfor_and_stubfor"><a class="link" href="#_mockfor_and_stubfor">6.2.2.3. MockFor and StubFor</a></h5>
<div class="paragraph">
<p>The Groovy mocking and stubbing classes can be found in the <code>groovy.mock.interceptor</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>MockFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>strictly ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more collaborators. In such a scenario it is
often desirable to just test the business logic of the class under test. One strategy for doing that is to replace
the collaborator instances with simplified mock objects to help isolate out the logic in the test target. MockFor
allows such mocks to be created using meta-programming. The desired behavior of collaborators is defined as a behavior
specification. The behavior is enforced and checked automatically.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume our target classes looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> first, last
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Family</span> {
    Person father, mother
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">nameOfMother</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>mother</span><span style="color:#D20">.first </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>mother</span><span style="color:#D20">.last</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>MockFor</code>, a mock expectation is always sequence dependent and its use automatically ends with a call to <code>verify</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> mock = <span style="color:#080;font-weight:bold">new</span> MockFor(Person)      // <b class="conum">(1)</b>
mock.demand.getFirst{ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dummy</span><span style="color:#710">'</span></span> }
mock.demand.getLast{ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span> }
mock.use {                          // <b class="conum">(2)</b>
    <span style="color:#080;font-weight:bold">def</span> mary = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mary</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>)
    <span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> Family(<span style="color:#606">mother</span>:mary)
    <span style="color:#080;font-weight:bold">assert</span> f.nameOfMother() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dummy name</span><span style="color:#710">'</span></span>
}
mock.expect.verify()                // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a new mock is created by a new instance of <code>MockFor</code></p>
</li>
<li>
<p>a <code>Closure</code> is passed to <code>use</code> which enables the mocking functionality</p>
</li>
<li>
<p>a call to <code>verify</code> checks whether the sequence and number of method calls is as expected</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>StubFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>loosely-ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more
collaborators. In such a scenario it is often desirable to just test the business logic of the CUT. One strategy for
doing that is to replace the collaborator instances with simplified stub objects to help isolate out the logic
in the target class. <code>StubFor</code> allows such stubs to be created using meta-programming. The desired behavior of
collaborators is defined as a behavior specification.</p>
</div>
<div class="paragraph">
<p>In contrast to <code>MockFor</code> the stub expectation checked with <code>verify</code> is sequence independent and its use is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> stub = <span style="color:#080;font-weight:bold">new</span> StubFor(Person)      // <b class="conum">(1)</b>
stub.demand.with {                  // <b class="conum">(2)</b>
    getLast{ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span> }
    getFirst{ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dummy</span><span style="color:#710">'</span></span> }
}
stub.use {                          // <b class="conum">(3)</b>
    <span style="color:#080;font-weight:bold">def</span> john = <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">first</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>, <span style="color:#606">last</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>)
    <span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> Family(<span style="color:#606">father</span>:john)
    <span style="color:#080;font-weight:bold">assert</span> f.father.first == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dummy</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">assert</span> f.father.last == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span>
}
stub.expect.verify()                // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a new stub is created by a new instance of <code>StubFor</code></p>
</li>
<li>
<p>the <code>with</code> method is used for delegating all calls inside the closure to the <code>StubFor</code> instance</p>
</li>
<li>
<p>a <code>Closure</code> is passed to <code>use</code> which enables the stubbing functionality</p>
</li>
<li>
<p>a call to <code>verify</code> (optional) checks whether the number of method calls is as expected</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>MockFor</code> and <code>StubFor</code> can not be used to test statically compiled classes e.g. for Java classes or Groovy classes that
make use of <code>@CompileStatic</code>. To stub and/or mock these classes you can use Spock or one of the Java mocking libraries.</p>
</div>
</div>
<div class="sect4">
<h5 id="testing_guide_emc"><a class="link" href="#testing_guide_emc">6.2.2.4. Expando Meta-Class (EMC)</a></h5>
<div class="paragraph">
<p>Groovy includes a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code> (EMC). It allows to dynamically add methods,
constructors, properties and static methods using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied with a special <code>metaClass</code> property that will give a reference to an
<code>ExpandoMetaClass</code> instance. The expando metaclass is not restricted to custom classes, it can be used for
JDK classes like for example <code>java.lang.String</code> as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span>.metaClass.swapCase = {-&gt;
    <span style="color:#080;font-weight:bold">def</span> sb = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringBuffer</span>()
    delegate.each {
        sb &lt;&lt; (<span style="color:#0a8;font-weight:bold">Character</span>.isUpperCase(<span style="color:#950">it</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>) ? <span style="color:#0a8;font-weight:bold">Character</span>.toLowerCase(<span style="color:#950">it</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>) :
            <span style="color:#0a8;font-weight:bold">Character</span>.toUpperCase(<span style="color:#950">it</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>))
    }
    sb.toString()
}

<span style="color:#080;font-weight:bold">def</span> s = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">heLLo, worLD!</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> s.swapCase() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HEllO, WORld!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExpandoMetaClass</code> is a rather good candidate for mocking functionality as it allows for more advanced stuff
like mocking static methods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {
    <span style="color:#0a8;font-weight:bold">String</span> title
}

<span style="color:#0a8;font-weight:bold">Book</span>.metaClass.static.create &lt;&lt; { <span style="color:#0a8;font-weight:bold">String</span> title -&gt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>:title) }

<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#0a8;font-weight:bold">Book</span>.create(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The Stand</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">assert</span> b.title == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The Stand</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or even constructors</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">Book</span>.metaClass.constructor &lt;&lt; { <span style="color:#0a8;font-weight:bold">String</span> title -&gt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>:title) }

<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The Stand</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">assert</span> b.title == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The Stand</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Mocking constructors might seem like a hack that&#8217;s better not even to be considered but even there might be valid
use cases. An example can be found in Grails where domain class constructors are added at run-time with the
help of <code>ExpandoMetaClass</code>. This lets the domain object register itself in the Spring application context and allows
for injection of services or other beans controlled by the dependency-injection container.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to change the <code>metaClass</code> property on a per test method level you need to remove the changes that were
done to the metaclass, otherwise those changes would be persistent across test method calls. Changes are removed by
replacing the metaclass in the <code>GroovyMetaClassRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GroovySystem.metaClassRegistry.removeMetaClass(<span style="color:#0a8;font-weight:bold">String</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative is to register a <code>MetaClassRegistryChangeEventListener</code>, track the changed classes and remove
the changes in the cleanup method of your chosen testing runtime. A good example can be found
<a href="https://github.com/grails/grails-core/blob/master/grails-bootstrap/src/main/groovy/grails/build/support/MetaClassRegistryCleaner.java">in the Grails web
development framework</a>.</p>
</div>
<div class="paragraph">
<p>Besides using the <code>ExpandoMetaClass</code> on a class-level, there is also support for using the metaclass on a per-object
level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Book</span>(<span style="color:#606">title</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The Stand</span><span style="color:#710">&quot;</span></span>)
b.metaClass.getTitle {-&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Title</span><span style="color:#710">'</span></span> }

<span style="color:#080;font-weight:bold">assert</span> b.title == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Title</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the metaclass change is related to the instance only. Depending on the test scenario this might be a better
fit than the global metaclass change.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gdk_methods"><a class="link" href="#_gdk_methods">6.2.3. GDK Methods</a></h4>
<div class="paragraph">
<p>The following section gives a brief overview on GDK methods that can be leveraged in test case scenarios, for example for
test data generation.</p>
</div>
<div class="sect4">
<h5 id="_iterablecombinations"><a class="link" href="#_iterablecombinations">6.2.3.1. Iterable#combinations</a></h5>
<div class="paragraph">
<p>The <code>combinations</code> method that is added on <code>java.lang.Iterable</code> compliant classes can be used to get a list of
combinations from a list containing two or more sub-lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testCombinations() {
    <span style="color:#080;font-weight:bold">def</span> combinations = [[<span style="color:#00D">2</span>, <span style="color:#00D">3</span>],[<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]].combinations()
    <span style="color:#080;font-weight:bold">assert</span> combinations == [[<span style="color:#00D">2</span>, <span style="color:#00D">4</span>], [<span style="color:#00D">3</span>, <span style="color:#00D">4</span>], [<span style="color:#00D">2</span>, <span style="color:#00D">5</span>], [<span style="color:#00D">3</span>, <span style="color:#00D">5</span>], [<span style="color:#00D">2</span>, <span style="color:#00D">6</span>], [<span style="color:#00D">3</span>, <span style="color:#00D">6</span>]]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in test case scenarios to generate all possible argument combinations for a specific method
call.</p>
</div>
</div>
<div class="sect4">
<h5 id="_iterableeachcombination"><a class="link" href="#_iterableeachcombination">6.2.3.2. Iterable#eachCombination</a></h5>
<div class="paragraph">
<p>The <code>eachCombination</code> method that is added on <code>java.lang.Iterable</code> can be used to apply a function (or in this
 case a <code>groovy.lang.Closure</code>) to each if the combinations that has been built by the <code>combinations</code> method:</p>
</div>
<div class="paragraph">
<p><code>eachCombination</code> is a GDK method that is added to all classes conforming to the <code>java.lang.Iterable</code> interface.
It applies a function on each combination of the input lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testEachCombination() {
    [[<span style="color:#00D">2</span>, <span style="color:#00D">3</span>],[<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>]].eachCombination { println <span style="color:#950">it</span>[<span style="color:#00D">0</span>] + <span style="color:#950">it</span>[<span style="color:#00D">1</span>] }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in the testing context to call methods with each of the generated combinations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tool_support"><a class="link" href="#_tool_support">6.2.4. Tool Support</a></h4>
<div class="sect4">
<h5 id="_test_code_coverage"><a class="link" href="#_test_code_coverage">6.2.4.1. Test Code Coverage</a></h5>
<div class="paragraph">
<p>Code coverage is a useful measure of the effectiveness of (unit) tests. A program with high code coverage has a
lower chance to hold critical bugs than a program with no or low coverage. To get code coverage metrics,
the generated byte-code usually needs to be instrumented before the tests are executed. One tool with Groovy support
 for this task is <a href="http://cobertura.github.io/cobertura/">Cobertura</a>.</p>
</div>
<div class="paragraph">
<p>Various frameworks and build tools come with Cobertura integration. For Grails, there is the <a href="http://grails.org/plugin/code-coverage">code coverage plugin</a> based
on Cobertura, for Gradle there is the <a href="https://github.com/eriwen/gradle-cobertura-plugin">gradle-cobertura plugin</a>, to name only two of them.</p>
</div>
<div class="paragraph">
<p>The following code listing shows an example on how to enable Cobertura test coverage reports in a Gradle build script from
a Groovy project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> pluginVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;plugin version&gt;</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> groovyVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;groovy version&gt;</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> junitVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;junit version&gt;</span><span style="color:#710">'</span></span>

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.eriwen:gradle-cobertura-plugin:${pluginVersion}</span><span style="color:#710">'</span></span>
    }
}

apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">groovy</span><span style="color:#710">'</span></span>
apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cobertura</span><span style="color:#710">'</span></span>

repositories {
    mavenCentral()
}

dependencies {
    compile <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.codehaus.groovy:groovy-all:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>groovyVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    testCompile <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">junit:junit:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>junitVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
}

cobertura {
    format = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span>
    includes = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.java</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">**/*.groovy</span><span style="color:#710">'</span></span>]
    excludes = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com/thirdparty/**/*.*</span><span style="color:#710">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several output formats can be chosen for Cobertura coverage reports and test code coverage reports can be added to
continuous integration build tasks.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_with_junit"><a class="link" href="#_testing_with_junit">6.3. Testing with JUnit</a></h3>
<div class="paragraph">
<p>Groovy simplifies JUnit testing in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You use the same overall practices as you would when testing with Java but you
can adopt much of Groovy&#8217;s concise syntax in your tests making them succinct. You can even use
the capabilities for writing testing domain specific languages (DSLs) if you feel so inclined.</p>
</li>
<li>
<p>There are numerous helper classes that simplify many testing activities. The details differ
in some cases depending on the version of JUnit you are using. We&#8217;ll cover those details shortly.</p>
</li>
<li>
<p>Groovy&#8217;s PowerAssert mechanism is wonderful to use in your tests</p>
</li>
<li>
<p>Groovy deems that tests are so important you should be able to run them as easily as scripts or classes.
This is why Groovy includes an automatic test runner when using the <code>groovy</code> command or the GroovyConsole.
This gives you some additional options over and above running your tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following sections we will have a closer look at JUnit 3, 4 and 5 Groovy integration.</p>
</div>
<div class="sect3">
<h4 id="_junit_3"><a class="link" href="#_junit_3">6.3.1. JUnit 3</a></h4>
<div class="paragraph">
<p>Maybe one of the most prominent Groovy classes supporting JUnit 3 tests is the <code>GroovyTestCase</code> class. Being
derived from <code>junit.framework.TestCase</code> it offers a bunch of additional methods that make testing in Groovy a breeze.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although <code>GroovyTestCase</code> inherits from <code>TestCase</code> doesn&#8217;t mean you can&#8217;t use JUnit 4 features in your project. In fact,
the most recent Groovy versions come with a bundled JUnit 4 and that comes with a backwards compatible <code>TestCase</code>
implementation. There have been some discussion on the Groovy mailing-list on whether to use <code>GroovyTestCase</code> or JUnit 4
with the result that it is mostly a matter of taste, but with <code>GroovyTestCase</code> you get a bunch of methods for free that
make certain types of tests easier to write.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this section, we will have a look at some of the methods provided by <code>GroovyTestCase</code>. A full list of these can be
found in the JavaDoc documentation for gapi:groovy.test.GroovyTestCase[] ,
don&#8217;t forget it is inherited from <code>junit.framework.TestCase</code> which inherits all the <code>assert*</code> methods.</p>
</div>
<div class="sect4">
<h5 id="_assertion_methods"><a class="link" href="#_assertion_methods">6.3.1.1. Assertion Methods</a></h5>
<div class="paragraph">
<p><code>GroovyTestCase</code> is inherited from <code>junit.framework.TestCase</code> therefore it inherits a large number of assertion methods
being available to be called in every test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyTestCase</span> <span style="color:#088;font-weight:bold">extends</span> GroovyTestCase {

    <span style="color:#339;font-weight:bold">void</span> testAssertions() {
        assertTrue(<span style="color:#00D">1</span> == <span style="color:#00D">1</span>)
        assertEquals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>)

        <span style="color:#080;font-weight:bold">def</span> x = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">42</span><span style="color:#710">&quot;</span></span>
        assertNotNull <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">x must not be null</span><span style="color:#710">&quot;</span></span>, x
        assertNull <span style="color:#069">null</span>

        assertSame x, x
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen above, in contrast to Java it is possible to leave out the parenthesis in most situations which
leads to even more readability of JUnit assertion method call expressions.</p>
</div>
<div class="paragraph">
<p>An interesting assertion method that is added by <code>GroovyTestCase</code> is <code>assertScript</code>. It ensures that the given Groovy
code string succeeds without any exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testScriptAssertions() {
    assertScript <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        def x = 1
        def y = 2

        assert x + y == 3
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_shouldfail_methods"><a class="link" href="#_shouldfail_methods">6.3.1.2. shouldFail Methods</a></h5>
<div class="paragraph">
<p><code>shouldFail</code> can be used to check whether the given code block fails or not. In case it fails, the assertion does hold,
otherwise the assertion fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testInvalidIndexAccess1() {
    <span style="color:#080;font-weight:bold">def</span> numbers = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>]
    shouldFail {
        numbers.get(<span style="color:#00D">4</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses the basic <code>shouldFail</code> method interface that takes a <code>groovy.lang.Closure</code> as a single argument.
 The <code>Closure</code> instance holds the code that is supposed to be breaking during run-time.</p>
</div>
<div class="paragraph">
<p>If we wanted to assert <code>shouldFail</code> on a specific <code>java.lang.Exception</code> type we could have done so by using the <code>shouldFail</code>
implementation that takes the <code>Exception</code> class as first argument and the <code>Closure</code> as second argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testInvalidIndexAccess2() {
    <span style="color:#080;font-weight:bold">def</span> numbers = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>]
    shouldFail <span style="color:#C00;font-weight:bold">IndexOutOfBoundsException</span>, {
        numbers.get(<span style="color:#00D">4</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything other than <code>IndexOutOfBoundsException</code> (or a descendant class of it) is thrown, the test case will fail.</p>
</div>
<div class="paragraph">
<p>A pretty nice feature of <code>shouldFail</code> hasn&#8217;t been visible so far: it returns the exception message. This is really
useful if you want to assert on the exception error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testInvalidIndexAccess3() {
    <span style="color:#080;font-weight:bold">def</span> numbers = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>]
    <span style="color:#080;font-weight:bold">def</span> msg = shouldFail <span style="color:#C00;font-weight:bold">IndexOutOfBoundsException</span>, {
        numbers.get(<span style="color:#00D">4</span>)
    }
    <span style="color:#080;font-weight:bold">assert</span> msg.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Index: 4, Size: 4</span><span style="color:#710">'</span></span>) ||
        msg.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Index 4 out-of-bounds for length 4</span><span style="color:#710">'</span></span>) ||
        msg.contains(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Index 4 out of bounds for length 4</span><span style="color:#710">'</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_notyetimplemented_method"><a class="link" href="#_notyetimplemented_method">6.3.1.3. notYetImplemented Method</a></h5>
<div class="paragraph">
<p>The <code>notYetImplemented</code> method has been greatly influenced by HtmlUnit. It allows to write a test method but mark it
as not yet implemented. As long as the test method fails and is marked with <code>notYetImplemented</code> the test goes green:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> testNotYetImplemented1() {
    <span style="color:#080;font-weight:bold">if</span> (notYetImplemented()) <span style="color:#080;font-weight:bold">return</span>   // <b class="conum">(1)</b>

    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">1</span> == <span style="color:#00D">2</span>                     // <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a call to <code>notYetImplemented</code> is necessary for <code>GroovyTestCase</code> to get the current method stack.</p>
</li>
<li>
<p>as long as the test evaluates to <code>false</code> the test execution will be successful.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An alternative to the <code>notYetImplemented</code> method is the <code>@NotYetImplemented</code> annotation. It allows for annotating a
method as not yet implemented, with the exact same behavior as <code>GroovyTestCase#notYetImplemented</code> but without the need
for the <code>notYetImplemented</code> method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@NotYetImplemented</span>
<span style="color:#339;font-weight:bold">void</span> testNotYetImplemented2() {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">1</span> == <span style="color:#00D">2</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junit_4"><a class="link" href="#_junit_4">6.3.2. JUnit 4</a></h4>
<div class="paragraph">
<p>Groovy can be used to write JUnit 4 test cases without any restrictions. The <code>groovy.test.GroovyAssert</code> holds
various static methods that can be used as replacement for the <code>GroovyTestCase</code> methods in JUnit 4 tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.junit.Test</span>

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovy.test.GroovyAssert.shouldFail</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JUnit4ExampleTests</span> {

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> indexOutOfBoundsAccess() {
        <span style="color:#080;font-weight:bold">def</span> numbers = [<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>]
        shouldFail {
            numbers.get(<span style="color:#00D">4</span>)
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the example above, the static methods found in <code>GroovyAssert</code> are imported at the beginning of the
 class definition thus <code>shouldFail</code> can be used the same way it can be used in a <code>GroovyTestCase</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>groovy.test.GroovyAssert</code> descends from <code>org.junit.Assert</code> that means it inherits all JUnit assertion methods. However,
with the introduction of the power assertion statement, it turned out to be <em>good practice to rely on assertion statements</em>
instead of using the JUnit assertion methods with the improved message being the main reason.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is worth mentioning that <code>GroovyAssert.shouldFail</code> is not absolutely identical to <code>GroovyTestCase.shouldFail</code>. While
<code>GroovyTestCase.shouldFail</code> returns the exception message, <code>GroovyAssert.shouldFail</code> returns the exception itself. It
takes a few more keystrokes to get the message, but in return you can access other properties and methods of the
exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Test</span>
<span style="color:#339;font-weight:bold">void</span> shouldFailReturn() {
    <span style="color:#080;font-weight:bold">def</span> e = shouldFail {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>,
                                   <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>))
    }
    <span style="color:#080;font-weight:bold">assert</span> e <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>
    <span style="color:#080;font-weight:bold">assert</span> e.message == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">assert</span> e.cause.message == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-testing-guide.adoc - include::../../../subprojects/groovy-test-junit5/src/spec/doc/_testing-with-junit5.adoc[leveloffset=+1]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_with_spock"><a class="link" href="#_testing_with_spock">6.4. Testing with Spock</a></h3>
<div class="paragraph">
<p>Spock is a testing and specification framework for Java and Groovy applications. What makes it stand out from the
crowd is its beautiful and highly expressive specification DSL. In practice, Spock specifications are written as
Groovy classes. Although written in Groovy they can be used to test Java classes. Spock can be used for unit,
integration or BDD (behavior-driven-development) testing, it doesn&#8217;t put itself into a specific category of testing
frameworks or libraries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Beside these awesome features Spock is a good example on how to leverage advanced Groovy programming
language features in third party libraries, for example, by using Groovy AST transformations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Spock, it should rather give an impression what Spock
is about and how it can be leveraged for unit, integration, functional or any other type of testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section we will have a first look at the anatomy of a Spock specification. It should give a
pretty good feeling on what Spock is up to.</p>
</div>
<div class="sect3">
<h4 id="_specifications"><a class="link" href="#_specifications">6.4.1. Specifications</a></h4>
<div class="paragraph">
<p>Spock lets you write specifications that describe features (properties, aspects) exhibited by a system of
interest. The "system" can be anything between a single class and an entire application, a more advanced term for it is
<em>system under specification</em>. The <em>feature description</em> starts from a specific snapshot of the system and its
collaborators, this snapshot is called the <em>feature&#8217;s fixture</em>.</p>
</div>
<div class="paragraph">
<p>Spock specification classes are derived from <code>spock.lang.Specification</code>. A concrete specification class might consist
of fields, fixture methods, features methods and helper methods.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at a simple specification with a single feature method for an imaginary <code>Stack</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">StackSpec</span> <span style="color:#088;font-weight:bold">extends</span> Specification {

    <span style="color:#080;font-weight:bold">def</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">adding an element leads to size increase</span><span style="color:#710">&quot;</span></span>() {  // <b class="conum">(1)</b>
        <span style="color:#606">setup</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a new stack instance is created</span><span style="color:#710">&quot;</span></span>        // <b class="conum">(2)</b>
            <span style="color:#080;font-weight:bold">def</span> stack = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Stack</span>()

        <span style="color:#606">when</span>:                                           // <b class="conum">(3)</b>
            stack.push <span style="color:#00D">42</span>

        <span style="color:#606">then</span>:                                           // <b class="conum">(4)</b>
            stack.size() == <span style="color:#00D">1</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Feature method, is by convention named with a String literal.</p>
</li>
<li>
<p>Setup block, here is where any setup work for this feature needs to be done.</p>
</li>
<li>
<p>When block describes a stimulus, a certain action under target by this feature specification.</p>
</li>
<li>
<p>Then block any expressions that can be used to validate the result of the code that was triggered by the when block.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Spock feature specifications are defined as methods inside a <code>spock.lang.Specification</code> class. They describe the feature
by using a String literal instead of a method name.</p>
</div>
<div class="paragraph">
<p>A feature method holds multiple blocks, in our example we used <code>setup</code>, <code>when</code> and <code>then</code>. The <code>setup</code> block is special
in that it is optional and allows to configure local variables visible inside the feature method. The <code>when</code> block
defines the stimulus and is a companion of the <code>then</code> block which describes the response to the stimulus.</p>
</div>
<div class="paragraph">
<p>Note that the <code>setup</code> method in the <code>StackSpec</code> above additionally
  has a description String. Description Strings are optional and can be added after block labels (like <code>setup</code>, <code>when</code>,
  <code>then</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_spock"><a class="link" href="#_more_spock">6.4.2. More Spock</a></h4>
<div class="paragraph">
<p>Spock provides much more features like data tables or advanced mocking capabilities. Feel free to consult the
<a href="https://github.com/spockframework/spock">Spock GitHub page</a> for more documentation and download information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functional_tests_with_geb"><a class="link" href="#_functional_tests_with_geb">6.5. Functional Tests with Geb</a></h3>
<div class="paragraph">
<p>Geb is a functional web testing and scraper library that integrates with JUnit and Spock. It is based upon the
Selenium web drivers and, like Spock, provides a Groovy DSL to write functional tests for web applications.</p>
</div>
<div class="paragraph">
<p>Geb has great features that make it a good fit for a functional testing library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DOM access via a JQuery-like <code>$</code> function</p>
</li>
<li>
<p>implements the <em>page pattern</em></p>
</li>
<li>
<p>support for modularization of certain web components (e.g. menu-bars, etc.) with <em>modules</em></p>
</li>
<li>
<p>integration with JavaScript via the JS variable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Geb, it should rather give an impression what Geb
is about and how it can be leveraged functional testing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section will give an example on how Geb can be used to write a functional test for a simple
 web page with a single search field.</p>
</div>
<div class="sect3">
<h4 id="_a_geb_script"><a class="link" href="#_a_geb_script">6.5.1. A Geb Script</a></h4>
<div class="paragraph">
<p>Although Geb can be used standalone in a Groovy script, in many scenarios it&#8217;s used in combination with other testing
frameworks. Geb comes with various base classes that can be used in JUnit 3, 4, TestNG or Spock tests. The base classes
are part of additional Geb modules that need to be added as a dependency.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>@Grab</code> dependencies can be used to run Geb with the Selenium Firefox driver in
JUnit4 tests. The module that is needed for JUnit 3/4 support is <code>geb-junit4</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.gebish:geb-core:0.9.2</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.gebish:geb-junit4:0.9.2</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.seleniumhq.selenium:selenium-firefox-driver:2.26.0</span><span style="color:#710">'</span></span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.seleniumhq.selenium:selenium-support:2.26.0</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The central class in Geb is the <code>geb.Browser</code> class. As its name implies it is used
 to browse pages and access DOM elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">geb.Browser</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.openqa.selenium.firefox.FirefoxDriver</span>

<span style="color:#080;font-weight:bold">def</span> browser = <span style="color:#080;font-weight:bold">new</span> Browser(<span style="color:#606">driver</span>: <span style="color:#080;font-weight:bold">new</span> FirefoxDriver(), <span style="color:#606">baseUrl</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://myhost:8080/myapp</span><span style="color:#710">'</span></span>)  // <b class="conum">(1)</b>
browser.drive {
    go <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/login</span><span style="color:#710">&quot;</span></span>                        // <b class="conum">(2)</b>

    <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#username</span><span style="color:#710">&quot;</span></span>).text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>       // <b class="conum">(3)</b>
    <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#password</span><span style="color:#710">&quot;</span></span>).text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Doe</span><span style="color:#710">'</span></span>

    <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#loginButton</span><span style="color:#710">&quot;</span></span>).click()

    <span style="color:#080;font-weight:bold">assert</span> title == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">My Application - Dashboard</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A new <code>Browser</code> instance is created. In this case it uses the Selenium <code>FirefoxDriver</code> and sets the <code>baseUrl</code>.</p>
</li>
<li>
<p><code>go</code> is used to navigate to a URL or relative URI</p>
</li>
<li>
<p><code>$</code> together with CSS selectors is used to access the <code>username</code> and <code>password</code> DOM fields.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Browser</code> class comes with a <code>drive</code> method that delegates all method/property calls to the current
<code>browser</code> instance. The <code>Browser</code> configuration must not be done inline, it can also be externalized in a
<code>GebConfig.groovy</code> configuration file for example. In practice, the usage of the <code>Browser</code> class is mostly hidden
by Geb test base classes. They delegate all missing properties and method calls to the current <code>browser</code> instance
that exists in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SearchTests</span> <span style="color:#088;font-weight:bold">extends</span> geb.junit4.GebTest {

    <span style="color:#007">@Test</span>
    <span style="color:#339;font-weight:bold">void</span> executeSeach() {
        go <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://somehost/mayapp/search</span><span style="color:#710">'</span></span>              // <b class="conum">(1)</b>
        <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#searchField</span><span style="color:#710">'</span></span>).text = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John Doe</span><span style="color:#710">'</span></span>             // <b class="conum">(2)</b>
        <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">#searchButton</span><span style="color:#710">'</span></span>).click()                      // <b class="conum">(3)</b>

        <span style="color:#080;font-weight:bold">assert</span> <span style="color:#F00;background-color:#FAA">$</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">.searchResult a</span><span style="color:#710">'</span></span>).first().text() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mr. John Doe</span><span style="color:#710">'</span></span> // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>Browser#go</code> takes a relative or absolute link and calls the page.</p>
</li>
<li>
<p><code>Browser#$</code> is used to access DOM content. Any CSS selectors supported by the underlying Selenium drivers are allowed</p>
</li>
<li>
<p><code>click</code> is used to click a button.</p>
</li>
<li>
<p><code>$</code> is used to get the first link out of the <code>searchResult</code> block</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example above shows a simple Geb web test with the JUnit 4 base class <code>geb.junit4.GebTest</code>. Note that in this case
the <code>Browser</code> configuration is externalized. <code>GebTest</code> delegates methods like <code>go</code> and <code>$</code> to the underlying <code>browser</code>
 instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_geb"><a class="link" href="#_more_geb">6.5.2. More Geb</a></h4>
<div class="paragraph">
<p>In the previous section we only scratched the surface of the available Geb features. More information on Geb can be found
at the <a href="http://gebish.org">project homepage</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_domain_specific_languages"><a class="link" href="#_domain_specific_languages">7. Domain-Specific Languages</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_command_chains"><a class="link" href="#_command_chains">7.1. Command chains</a></h3>
<div class="paragraph">
<p>Groovy lets you omit parentheses around the arguments of a
method call for top-level statements. "command chain" feature extends this by allowing us to chain such
parentheses-free method calls, requiring neither parentheses around arguments, nor dots between the chained calls.
The general idea is that a call like <code>a b c d</code> will actually be equivalent to <code>a(b).c(d)</code>. This
also works with multiple arguments, closure arguments, and even named arguments. Furthermore, such command chains can
also appear on the right-hand side of assignments. Let’s have a look at some examples
supported by this new syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// equivalent to: turn(left).then(right)</span>
turn left then right

<span style="color:#777">// equivalent to: take(2.pills).of(chloroquinine).after(6.hours)</span>
take <span style="color:#00D">2</span>.pills of chloroquinine after <span style="color:#00D">6</span>.hours

<span style="color:#777">// equivalent to: paint(wall).with(red, green).and(yellow)</span>
paint wall with red, green and yellow

<span style="color:#777">// with named parameters too</span>
<span style="color:#777">// equivalent to: check(that: margarita).tastes(good)</span>
check <span style="color:#606">that</span>: margarita tastes good

<span style="color:#777">// with closures as parameters</span>
<span style="color:#777">// equivalent to: given({}).when({}).then({})</span>
given { } when { } then { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use methods in the chain which take no arguments,
but in that case, the parentheses are needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// equivalent to: select(all).unique().from(names)</span>
select all unique() from names</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your command chain contains an odd number of elements, the chain will
be composed of method / arguments, and will finish by a final property
access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// equivalent to: take(3).cookies</span>
<span style="color:#777">// and also this: take(3).getCookies()</span>
take <span style="color:#00D">3</span> cookies</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command chain approach opens up interesting possibilities in terms of the much wider range of DSLs which
can now be written in Groovy.</p>
</div>
<div class="paragraph">
<p>The above examples illustrate using a command chain based DSL but not how to create one. There are various strategies
that you can use, but to illustrate creating such a DSL, we will show a couple of examples - first using maps and Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">show = { println <span style="color:#950">it</span> }
square_root = { <span style="color:#0a8;font-weight:bold">Math</span>.sqrt(<span style="color:#950">it</span>) }

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">please</span>(action) {
  [<span style="color:#606">the</span>: { what -&gt;
    [<span style="color:#606">of</span>: { n -&gt; action(what(n)) }]
  }]
}

<span style="color:#777">// equivalent to: please(show).the(square_root).of(100)</span>
please show the square_root of <span style="color:#00D">100</span>
<span style="color:#777">// ==&gt; 10.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a second example, consider how you might write a DSL for simplifying
one of your existing APIs. Maybe you need to put this code in front of
customers, business analysts or testers who might be not hard-core Java
developers. We’ll use the <code>Splitter</code> from the Google
<a href="https://github.com/google/guava">Guava libraries</a> project as it
already has a nice Fluent API. Here is how we might use it out of the
box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.google.guava:guava:r09</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.google.common.base.*</span>
<span style="color:#080;font-weight:bold">def</span> result = Splitter.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">,</span><span style="color:#710">'</span></span>).trimResults(CharMatcher.is(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">_</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>)).split(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">_a ,_b_ ,c__</span><span style="color:#710">&quot;</span></span>).iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>It reads fairly well for a Java developer but if that is not your target
audience or you have many such statements to write, it could be
considered a little verbose. Again, there are many options for writing a
DSL. We’ll keep it simple with Maps and Closures. We’ll first write a
helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.google.guava:guava:r09</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.google.common.base.*</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">split</span>(string) {
  [<span style="color:#606">on</span>: { sep -&gt;
    [<span style="color:#606">trimming</span>: { trimChar -&gt;
      Splitter.on(sep).trimResults(CharMatcher.is(trimChar <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>)).split(string).iterator().toList()
    }]
  }]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>now instead of this line from our original example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> result = Splitter.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">,</span><span style="color:#710">'</span></span>).trimResults(CharMatcher.is(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">_</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#339;font-weight:bold">char</span>)).split(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">_a ,_b_ ,c__</span><span style="color:#710">&quot;</span></span>).iterator().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> result = split <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">_a ,_b_ ,c__</span><span style="color:#710">&quot;</span></span> on <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">,</span><span style="color:#710">'</span></span> trimming <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">_</span><span style="color:#b0b">\'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operator_overloading"><a class="link" href="#_operator_overloading">7.2. Operator overloading</a></h3>
<div class="paragraph">
<p>Various operators in Groovy are mapped onto regular method calls on objects.</p>
</div>
<div class="paragraph">
<p>This allows you to provide your own Java or Groovy objects which can take advantage of operator overloading. The following table describes the operators supported in Groovy and the methods they map to.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a + b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a - b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a * b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ** b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a / b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a % b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a | b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &amp; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ^ b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a++</code> or <code>++a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a--</code> or <code>--a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;&lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShiftUnsigned(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>switch(a) { case(b) : }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b.isCase(a)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>if(a)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asBoolean()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a as b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asType(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a == b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a != b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">! a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;=&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt;= 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a \&lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt;= 0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_script_base_classes"><a class="link" href="#_script_base_classes">7.3. Script base classes</a></h3>
<div class="sect3">
<h4 id="_the_script_class"><a class="link" href="#_the_script_class">7.3.1. The Script class</a></h4>
<div class="paragraph">
<p>Groovy scripts are always compiled to classes. For example, a script as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello from Groovy</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is compiled to a class extending the abstract gapi:groovy.lang.Script[] class. This class contains a single abstract
method called <em>run</em>. When a script is compiled, then its body will become the <em>run</em> method, while the other methods
found in the script are found in the implementing class. The <code>Script</code> class provides base support for integration
with your application through the <code>Binding</code> object, as illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> binding = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>()             // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(binding)    // <b class="conum">(2)</b>
binding.setVariable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>,<span style="color:#00D">1</span>)              // <b class="conum">(3)</b>
binding.setVariable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">y</span><span style="color:#710">'</span></span>,<span style="color:#00D">3</span>)
shell.evaluate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z=2*x+y</span><span style="color:#710">'</span></span>                // <b class="conum">(4)</b>
<span style="color:#080;font-weight:bold">assert</span> binding.getVariable(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">z</span><span style="color:#710">'</span></span>) == <span style="color:#00D">5</span>    // <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a binding is used to share data between the script and the calling class</p>
</li>
<li>
<p>a <code>GroovyShell</code> can be used with this binding</p>
</li>
<li>
<p>input variables are set from the calling class inside the binding</p>
</li>
<li>
<p>then the script is evaluated</p>
</li>
<li>
<p>and the <code>z</code> variable has been "exported" into the binding</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is a very practical way to share data between the caller and the script, however it may be insufficient or not
practical in some cases. For that purpose, Groovy allows you to set your own base script class. A base script class
has to extend gapi:groovy.lang.Script[] and be a single abstract method type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBaseClass</span> <span style="color:#088;font-weight:bold">extends</span> Script {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> greet() { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the custom script base class can be declared in the compiler configuration, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()                                // <b class="conum">(1)</b>
config.scriptBaseClass = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MyBaseClass</span><span style="color:#710">'</span></span>                                  // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(<span style="color:#950">this</span>.class.classLoader, config)             // <b class="conum">(3)</b>
shell.evaluate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">
    setName 'Judith'                                                    // <b class="conum">(4)</b>
    greet()
</span><span style="color:#710">&quot;&quot;&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a custom compiler configuration</p>
</li>
<li>
<p>set the base script class to our custom base script class</p>
</li>
<li>
<p>then create a <code>GroovyShell</code> using that configuration</p>
</li>
<li>
<p>the script will then extend the base script class, giving direct access to the <code>name</code> property and <code>greet</code> method</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dsl-basescript"><a class="link" href="#dsl-basescript">7.3.2. The @BaseScript annotation</a></h4>
<div class="paragraph">
<p>As an alternative, it is also possible to use the <code>@BaseScript</code> annotation directly into a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.BaseScript</span>

<span style="color:#007">@BaseScript</span> MyBaseClass baseScript
setName <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Judith</span><span style="color:#710">'</span></span>
greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>@BaseScript</code> should annotate a variable which type is the class of the base script. Alternatively, you can set
the base script class as a member of the <code>@BaseScript</code> annotation itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@BaseScript</span>(MyBaseClass)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.transform.BaseScript</span>

setName <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Judith</span><span style="color:#710">'</span></span>
greet()</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the special no-args <code>run</code> method, you can even annotate
that method as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomScript</span> <span style="color:#088;font-weight:bold">extends</span> Script {
    <span style="color:#339;font-weight:bold">int</span> getTheMeaningOfLife() { <span style="color:#00D">42</span> }
}

<span style="color:#007">@BaseScript</span>(CustomScript)
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">run</span>() {
    <span style="color:#080;font-weight:bold">assert</span> theMeaningOfLife == <span style="color:#00D">42</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_alternate_abstract_method"><a class="link" href="#_alternate_abstract_method">7.3.3. Alternate abstract method</a></h4>
<div class="paragraph">
<p>We have seen that the base script class is a single abstract method type that needs to implement the <code>run</code> method. The
<code>run</code> method is executed by the script engine automatically. In some circumstances it may be interesting to have a base
class which implements the <code>run</code> method, but provides an alternative abstract method to be used for the script body.
For example, the base script <code>run</code> method might perform some initialization before the <code>run</code> method is executed. This
is possible by doing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBaseClass</span> <span style="color:#088;font-weight:bold">extends</span> Script {
    <span style="color:#339;font-weight:bold">int</span> count
    <span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">void</span> scriptBody()                              // <b class="conum">(1)</b>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">run</span>() {
        count++                                             // <b class="conum">(2)</b>
        scriptBody()                                        // <b class="conum">(3)</b>
        count                                               // <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the base script class should define one (and only one) abstract method</p>
</li>
<li>
<p>the <code>run</code> method can be overridden and perform a task before executing the script body</p>
</li>
<li>
<p><code>run</code> calls the abstract <code>scriptBody</code> method which will delegate to the user script</p>
</li>
<li>
<p>then it can return something else than the value from the script</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you execute this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> result = shell.evaluate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">
    println 'Ok'
</span><span style="color:#710">&quot;&quot;&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> result == <span style="color:#00D">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you will see that the script is executed, but the result of the evaluation is <code>1</code> as returned by the <code>run</code>
method of the base class. It is even clearer if you use <code>parse</code> instead of <code>evaluate</code>, because it would allow you to
execute the <code>run</code> method several times on the same script instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> script = shell.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">println 'Ok'</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">assert</span> script.run() == <span style="color:#00D">1</span>
<span style="color:#080;font-weight:bold">assert</span> script.run() == <span style="color:#00D">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_properties_to_numbers"><a class="link" href="#_adding_properties_to_numbers">7.4. Adding properties to numbers</a></h3>
<div class="paragraph">
<p>In Groovy number types are considered equal to any other types. As such, it is possible to enhance numbers by adding
properties or methods to them. This can be very handy when dealing with measurable quantities for example. Details about
how existing classes can be enhanced in Groovy are found in the <a href="core-metaprogramming.html#_extension_modules">extension
modules</a> section or the <a href="core-metaprogramming.html#categories">categories</a> section.</p>
</div>
<div class="paragraph">
<p>An illustration of this can be found in Groovy using the <code>TimeCategory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">use(TimeCategory)  {
    println <span style="color:#00D">1</span>.minute.from.now       // <b class="conum">(1)</b>
    println <span style="color:#00D">10</span>.hours.ago

    <span style="color:#080;font-weight:bold">def</span> someDate = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()       // <b class="conum">(2)</b>
    println someDate - <span style="color:#00D">3</span>.months
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>using the <code>TimeCategory</code>, a property <code>minute</code> is added to the <code>Integer</code> class</p>
</li>
<li>
<p>similarly, the <code>months</code> method returns a <code>groovy.time.DatumDependentDuration</code> which can be used in calculus</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Categories are lexically bound, making them a great fit for internal DSLs.</p>
</div>
</div>
<div class="sect2">
<h3 id="section-delegatesto"><a class="link" href="#section-delegatesto">7.5. @DelegatesTo</a></h3>
<div class="sect3">
<h4 id="TheDelegatesToannotation-DSLsmadeeasy"><a class="link" href="#TheDelegatesToannotation-DSLsmadeeasy">7.5.1. Explaining delegation strategy at compile time</a></h4>
<div class="paragraph">
<p><code>@groovy.lang.DelegatesTo</code> is a documentation and compile-time annotation aimed at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>documenting APIs that use closures as arguments</p>
</li>
<li>
<p>providing type information for the static type checker and compiler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy language is a platform of choice for building DSLs. Using
closures, it’s quite easy to create custom control structures, as well
as it is simple to create builders. Imagine that you have the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">email {
    from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dsl-guru@mycompany.com</span><span style="color:#710">'</span></span>
    to <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john.doe@waitaminute.com</span><span style="color:#710">'</span></span>
    subject <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The pope has resigned!</span><span style="color:#710">'</span></span>
    body {
        p <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Really, the pope has resigned!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One way of implementing this is using the builder strategy, which
implies a method, named <code>email</code> which accepts a closure as an argument.
The method may delegate subsequent calls to an object that implements
the <code>from</code>, <code>to</code>, <code>subject</code> and <code>body</code> methods. Again, <code>body</code> is a
method which accepts a closure as an argument and that uses the builder
strategy.</p>
</div>
<div class="paragraph">
<p>Implementing such a builder is usually done the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">email</span>(Closure cl) {
    <span style="color:#080;font-weight:bold">def</span> email = <span style="color:#080;font-weight:bold">new</span> EmailSpec()
    <span style="color:#080;font-weight:bold">def</span> code = cl.rehydrate(email, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>EmailSpec</code> class implements the <code>from</code>, <code>to</code>, … methods. By
calling <code>rehydrate</code>, we’re creating a copy of the closure for which we
set the <code>delegate</code>, <code>owner</code> and <code>thisObject</code> values. Setting the owner
and the <code>this</code> object is not very important here since we will use the
<code>DELEGATE_ONLY</code> strategy which says that the method calls will be
resolved only against the delegate of the closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">EmailSpec</span> {
    <span style="color:#339;font-weight:bold">void</span> from(<span style="color:#0a8;font-weight:bold">String</span> from) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">From: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>from</span><span style="color:#710">&quot;</span></span>}
    <span style="color:#339;font-weight:bold">void</span> to(<span style="color:#0a8;font-weight:bold">String</span>... to) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">To: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>to</span><span style="color:#710">&quot;</span></span>}
    <span style="color:#339;font-weight:bold">void</span> subject(<span style="color:#0a8;font-weight:bold">String</span> subject) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Subject: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>subject</span><span style="color:#710">&quot;</span></span>}
    <span style="color:#339;font-weight:bold">void</span> body(Closure body) {
        <span style="color:#080;font-weight:bold">def</span> bodySpec = <span style="color:#080;font-weight:bold">new</span> BodySpec()
        <span style="color:#080;font-weight:bold">def</span> code = body.rehydrate(bodySpec, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
        code.resolveStrategy = Closure.DELEGATE_ONLY
        code()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EmailSpec</code> class has itself a <code>body</code> method accepting a closure that is cloned and executed. This is what
we call the builder pattern in Groovy.</p>
</div>
<div class="paragraph">
<p>One of the problems with the code that we’ve shown is that the user of
the <code>email</code> method doesn’t have any information about the methods that
he’s allowed to call inside the closure. The only possible information
is from the method documentation. There are two issues with this: first
of all, documentation is not always written, and if it is, it’s not
always available (javadoc not downloaded, for example). Second, it
doesn’t help IDEs. What would be really interesting, here, is for IDEs
to help the developer by suggesting, once they are in the closure body,
methods that exist on the <code>email</code> class.</p>
</div>
<div class="paragraph">
<p>Moreover, if the user calls a method in the closure which is not defined
by the <code>EmailSpec</code> class, the IDE should at least issue a warning (because
it’s very likely that it will break at runtime).</p>
</div>
<div class="paragraph">
<p>One more problem with the code above is that it is not compatible with static type checking. Type checking would let
the user know if a method call is authorized at compile time instead of runtime, but if you try to perform type
checking on this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">email {
    from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dsl-guru@mycompany.com</span><span style="color:#710">'</span></span>
    to <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john.doe@waitaminute.com</span><span style="color:#710">'</span></span>
    subject <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The pope has resigned!</span><span style="color:#710">'</span></span>
    body {
        p <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Really, the pope has resigned!</span><span style="color:#710">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the type checker will know that there’s an <code>email</code> method accepting
a <code>Closure</code>, but it will complain about every method call <strong>inside</strong> the
closure, because <code>from</code>, for example, is not a method which is defined
in the class. Indeed, it’s defined in the <code>EmailSpec</code> class and it has
absolutely no hint to help it knowing that the closure delegate will, at
runtime, be of type <code>EmailSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.transform.TypeChecked
<span style="color:#339;font-weight:bold">void</span> sendEmail() {
    email {
        from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dsl-guru@mycompany.com</span><span style="color:#710">'</span></span>
        to <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john.doe@waitaminute.com</span><span style="color:#710">'</span></span>
        subject <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The pope has resigned!</span><span style="color:#710">'</span></span>
        body {
            p <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Really, the pope has resigned!</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will fail compilation with errors like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method MyScript#from(java.lang.String). Please check if the declared type is correct and if the method exists.
 @ line 31, column 21.
                       from 'dsl-guru@mycompany.com'</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="TheDelegatesToannotation-DelegatesTo"><a class="link" href="#TheDelegatesToannotation-DelegatesTo">7.5.2. @DelegatesTo</a></h4>
<div class="paragraph">
<p>For those reasons, Groovy 2.1 introduced a new annotation
named <code>@DelegatesTo</code>. The goal of this annotation is to solve both the
documentation issue, that will let your IDE know about the expected
methods in the closure body, and it will also solve the type checking
issue, by giving hints to the compiler about what are the potential
receivers of method calls in the closure body.</p>
</div>
<div class="paragraph">
<p>The idea is to annotate the <code>Closure</code> parameter of the <code>email</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">email</span>(<span style="color:#007">@DelegatesTo</span>(EmailSpec) Closure cl) {
    <span style="color:#080;font-weight:bold">def</span> email = <span style="color:#080;font-weight:bold">new</span> EmailSpec()
    <span style="color:#080;font-weight:bold">def</span> code = cl.rehydrate(email, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we’ve done here is telling the compiler (or the IDE) that when the
method will be called with a closure, the delegate of this closure will
be set to an object of type <code>email</code>. But there is still a problem: the
default delegation strategy is not the one which is used in our method.
So we will give more information and tell the compiler (or the IDE) that
the delegation strategy is also changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">email</span>(<span style="color:#007">@DelegatesTo</span>(strategy=Closure.DELEGATE_ONLY, value=EmailSpec) Closure cl) {
    <span style="color:#080;font-weight:bold">def</span> email = <span style="color:#080;font-weight:bold">new</span> EmailSpec()
    <span style="color:#080;font-weight:bold">def</span> code = cl.rehydrate(email, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
    code.resolveStrategy = Closure.DELEGATE_ONLY
    code()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, both the IDE and the type checker (if you are using <code>@TypeChecked</code>)
will be aware of the delegate and the delegation strategy. This is very
nice because it will both allow the IDE to provide smart completion, but
it will also remove errors at compile time that exist only because the
behaviour of the program is normally only known at runtime!</p>
</div>
<div class="paragraph">
<p>The following code will now pass compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@TypeChecked</span>
<span style="color:#339;font-weight:bold">void</span> doEmail() {
    email {
        from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dsl-guru@mycompany.com</span><span style="color:#710">'</span></span>
        to <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">john.doe@waitaminute.com</span><span style="color:#710">'</span></span>
        subject <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The pope has resigned!</span><span style="color:#710">'</span></span>
        body {
            p <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Really, the pope has resigned!</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="TheDelegatesToannotation-DelegatesTomodes"><a class="link" href="#TheDelegatesToannotation-DelegatesTomodes">7.5.3. DelegatesTo modes</a></h4>
<div class="paragraph">
<p><code>@DelegatesTo</code> supports multiple modes that we will describe with examples
in this section.</p>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-Simpledelegation"><a class="link" href="#TheDelegatesToannotation-Simpledelegation">7.5.3.1. Simple delegation</a></h5>
<div class="paragraph">
<p>In this mode, the only mandatory parameter is the <em>value</em> which says to
which class we delegate calls. Nothing more. We’re telling the compiler
that the type of the delegate will <strong>always</strong> be of the type documented
by <code>@DelegatesTo</code> (note that it can be a subclass, but if it is, the
methods defined by the subclass will not be visible to the type
checker).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> body(<span style="color:#007">@DelegatesTo</span>(BodySpec) Closure cl) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-Delegationstrategy"><a class="link" href="#TheDelegatesToannotation-Delegationstrategy">7.5.3.2. Delegation strategy</a></h5>
<div class="paragraph">
<p>In this mode, you must specify both the delegate class <strong>and</strong> a
delegation strategy. This must be used if the closure will not be called
with the default delegation strategy, which is <code>Closure.OWNER_FIRST</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> body(<span style="color:#007">@DelegatesTo</span>(strategy=Closure.DELEGATE_ONLY, value=BodySpec) Closure cl) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-Delegatetoparameter"><a class="link" href="#TheDelegatesToannotation-Delegatetoparameter">7.5.3.3. Delegate to parameter</a></h5>
<div class="paragraph">
<p>In this variant, we will tell the compiler that we are delegating to
another parameter of the method. Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">exec</span>(<span style="color:#0a8;font-weight:bold">Object</span> target, Closure code) {
   <span style="color:#080;font-weight:bold">def</span> clone = code.rehydrate(target, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the delegate which will be used is <strong>not</strong> created inside the <code>exec</code>
method. In fact, we take an argument of the method and delegate to it.
Usage may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> email = <span style="color:#080;font-weight:bold">new</span> Email()
exec(email) {
   from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">...</span><span style="color:#710">'</span></span>
   to <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">...</span><span style="color:#710">'</span></span>
   send()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the method calls are delegated to the <code>email</code> parameter. This is
a widely used pattern which is also supported by <code>@DelegatesTo</code> using a
companion annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">exec</span>(<span style="color:#007">@DelegatesTo</span>.Target <span style="color:#0a8;font-weight:bold">Object</span> target, <span style="color:#007">@DelegatesTo</span> Closure code) {
   <span style="color:#080;font-weight:bold">def</span> clone = code.rehydrate(target, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
   clone()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A closure is annotated with <code>@DelegatesTo</code>, but this time, without
specifying any class. Instead, we’re annotating another parameter
with <code>@DelegatesTo.Target</code>. The type of the delegate is then determined
at compile time. One could think that we are using the parameter type,
which in this case is <code>Object</code> but this is not true. Take this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
   <span style="color:#339;font-weight:bold">void</span> sayHello() { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span> }
}
<span style="color:#080;font-weight:bold">def</span> greeter = <span style="color:#080;font-weight:bold">new</span> Greeter()
exec(greeter) {
   sayHello()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that this works out of the box <strong>without</strong> having to annotate
with <code>@DelegatesTo</code>. However, to make the IDE aware of the delegate
type, or the <strong>type checker</strong> aware of it, we need to add <code>@DelegatesTo</code>.
And in this case, it will know that the <code>Greeter</code> variable is of
type <code>Greeter</code>, so it will not report errors on the <em>sayHello</em>
method <strong>even if the exec method doesn’t explicitly define the target as
of type Greeter</strong>. This is a very powerful feature, because it prevents
you from writing multiple versions of the same <code>exec</code> method for
different receiver types!</p>
</div>
<div class="paragraph">
<p>In this mode, the <code>@DelegatesTo</code> annotation also supports the <code>strategy</code>
parameter that we’ve described upper.</p>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-Multipleclosures"><a class="link" href="#TheDelegatesToannotation-Multipleclosures">7.5.3.4. Multiple closures</a></h5>
<div class="paragraph">
<p>In the previous example, the <code>exec</code> method accepted only one closure,
but you may have methods that take multiple closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> fooBarBaz(Closure foo, Closure bar, Closure baz) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then nothing prevents you from annotating each closure
with <code>@DelegatesTo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Foo</span> { <span style="color:#339;font-weight:bold">void</span> foo(<span style="color:#0a8;font-weight:bold">String</span> msg) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Foo </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>msg<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> } }
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Bar</span> { <span style="color:#339;font-weight:bold">void</span> bar(<span style="color:#339;font-weight:bold">int</span> x) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Bar </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>x<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> } }
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Baz</span> { <span style="color:#339;font-weight:bold">void</span> baz(<span style="color:#0a8;font-weight:bold">Date</span> d) { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Baz </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>d<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span> } }

<span style="color:#339;font-weight:bold">void</span> fooBarBaz(<span style="color:#007">@DelegatesTo</span>(Foo) Closure foo, <span style="color:#007">@DelegatesTo</span>(Bar) Closure bar, <span style="color:#007">@DelegatesTo</span>(Baz) Closure baz) {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But more importantly, if you have multiple closures <strong>and</strong> multiple
arguments, you can use several targets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> fooBarBaz(
    <span style="color:#007">@DelegatesTo</span>.Target(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>) foo,
    <span style="color:#007">@DelegatesTo</span>.Target(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>) bar,
    <span style="color:#007">@DelegatesTo</span>.Target(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">baz</span><span style="color:#710">'</span></span>) baz,

    <span style="color:#007">@DelegatesTo</span>(target=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>) Closure cl1,
    <span style="color:#007">@DelegatesTo</span>(target=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>) Closure cl2,
    <span style="color:#007">@DelegatesTo</span>(target=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">baz</span><span style="color:#710">'</span></span>) Closure cl3) {
    cl1.rehydrate(foo, <span style="color:#950">this</span>, <span style="color:#950">this</span>).call()
    cl2.rehydrate(bar, <span style="color:#950">this</span>, <span style="color:#950">this</span>).call()
    cl3.rehydrate(baz, <span style="color:#950">this</span>, <span style="color:#950">this</span>).call()
}

<span style="color:#080;font-weight:bold">def</span> a = <span style="color:#080;font-weight:bold">new</span> Foo()
<span style="color:#080;font-weight:bold">def</span> b = <span style="color:#080;font-weight:bold">new</span> Bar()
<span style="color:#080;font-weight:bold">def</span> c = <span style="color:#080;font-weight:bold">new</span> Baz()
fooBarBaz(
    a, b, c,
    { foo(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>) },
    { bar(<span style="color:#00D">123</span>) },
    { baz(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()) }
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
At this point, you may wonder why we don’t use the parameter names as
references. The reason is that the information (the parameter name) is
not always available (it’s a debug-only information), so it’s a
limitation of the JVM.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_delegating_to_a_generic_type"><a class="link" href="#_delegating_to_a_generic_type">7.5.3.5. Delegating to a generic type</a></h5>
<div class="paragraph">
<p>In some situations, it is interesting to instruct the IDE or the compiler that the delegate type will not be a parameter
but a generic type. Imagine a configurator that runs on a list of elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> &lt;T&gt; <span style="color:#339;font-weight:bold">void</span> configure(<span style="color:#0a8;font-weight:bold">List</span>&lt;T&gt; elements, Closure configuration) {
   elements.each { e-&gt;
      <span style="color:#080;font-weight:bold">def</span> clone = configuration.rehydrate(e, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
      clone.resolveStrategy = Closure.DELEGATE_FIRST
      clone.call()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this method can be called with any list like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@groovy</span>.transform.ToString
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Realm</span> {
   <span style="color:#0a8;font-weight:bold">String</span> name
}
<span style="color:#0a8;font-weight:bold">List</span>&lt;Realm&gt; list = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#00D">3</span>.times { list &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Realm() }
configure(list) {
   name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Realm</span><span style="color:#710">'</span></span>
}
<span style="color:#080;font-weight:bold">assert</span> list.every { <span style="color:#950">it</span>.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Realm</span><span style="color:#710">'</span></span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To let the type checker and the IDE know that the <code>configure</code> method calls the closure on each element of the list, you
 need to use <code>@DelegatesTo</code> differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> &lt;T&gt; <span style="color:#339;font-weight:bold">void</span> configure(
    <span style="color:#007">@DelegatesTo</span>.Target <span style="color:#0a8;font-weight:bold">List</span>&lt;T&gt; elements,
    <span style="color:#007">@DelegatesTo</span>(strategy=Closure.DELEGATE_FIRST, genericTypeIndex=<span style="color:#00D">0</span>) Closure configuration) {
   <span style="color:#080;font-weight:bold">def</span> clone = configuration.rehydrate(e, <span style="color:#950">this</span>, <span style="color:#950">this</span>)
   clone.resolveStrategy = Closure.DELEGATE_FIRST
   clone.call()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@DelegatesTo</code> takes an optional <code>genericTypeIndex</code> argument that tells what is the index of the generic type that will
be used as the delegate type. This <strong>must</strong> be used in conjunction with <code>@DelegatesTo.Target</code> and the index starts at 0. In
the example above, that means that the delegate type is resolved against <code>List&lt;T&gt;</code>, and since the generic type at index
0 is <code>T</code> and inferred as a <code>Realm</code>, the type checker infers that the delegate type will be of type <code>Realm</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We&#8217;re using a <code>genericTypeIndex</code> instead of a placeholder (<code>T</code>) because of JVM limitations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_delegating_to_an_arbitrary_type"><a class="link" href="#_delegating_to_an_arbitrary_type">7.5.3.6. Delegating to an arbitrary type</a></h5>
<div class="paragraph">
<p>It is possible that none of the options above can represent the type you want to delegate to. For example, let&#8217;s define
a mapper class which is parametrized with an object and defines a map method which returns an object of another type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span>&lt;T,U&gt; {                             // <b class="conum">(1)</b>
    <span style="color:#088;font-weight:bold">final</span> T value                               // <b class="conum">(2)</b>
    Mapper(T value) { <span style="color:#950">this</span>.value = value }
    U map(Closure&lt;U&gt; producer) {                // <b class="conum">(3)</b>
        producer.delegate = value
        producer()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The mapper class takes two generic type arguments: the source type and the target type</p>
</li>
<li>
<p>The source object is stored in a final field</p>
</li>
<li>
<p>The <code>map</code> method asks to convert the source object to a target object</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you can see, the method signature from <code>map</code> does not give any information about what object will
be manipulated by the closure. Reading the method body, we know that it will be the <code>value</code> which is
of type <code>T</code>, but <code>T</code> is not found in the method signature, so we are facing a case where none of the
available options for <code>@DelegatesTo</code> is suitable. For example, if we try to statically compile this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> mapper = <span style="color:#080;font-weight:bold">new</span> Mapper&lt;<span style="color:#0a8;font-weight:bold">String</span>,<span style="color:#0a8;font-weight:bold">Integer</span>&gt;(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> mapper.map { length() } == <span style="color:#00D">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the compiler will fail with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Static type checking] - Cannot find matching method TestScript0#length()</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, you can use the <code>type</code> member of the <code>@DelegatesTo</code> annotation to reference <code>T</code> as a type token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Mapper</span>&lt;T,U&gt; {
    <span style="color:#088;font-weight:bold">final</span> T value
    Mapper(T value) { <span style="color:#950">this</span>.value = value }
    U map(<span style="color:#007">@DelegatesTo</span>(type=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">T</span><span style="color:#710">&quot;</span></span>) Closure&lt;U&gt; producer) {  // <b class="conum">(1)</b>
        producer.delegate = value
        producer()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>@DelegatesTo</code> annotation references a generic type which is not found in the method signature</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that you are not limited to generic type tokens. The <code>type</code> member can be used to represent complex types, such
as <code>List&lt;T&gt;</code> or <code>Map&lt;T,List&lt;U&gt;&gt;</code>. The reason why you should use that in last resort is that the type is only checked
when the type checker finds usage of <code>@DelegatesTo</code>, not when the annotated method itself is compiled. This means that
type safety is only ensured at the call site. Additionally, compilation will be slower (though probably unnoticeable for
most cases).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compilation-customizers"><a class="link" href="#compilation-customizers">7.6. Compilation customizers</a></h3>
<div class="sect3">
<h4 id="_introduction_2"><a class="link" href="#_introduction_2">7.6.1. Introduction</a></h4>
<div class="paragraph">
<p>Whether you are using <code>groovyc</code> to compile classes or a <code>GroovyShell</code>,
for example, to execute scripts, under the hood, a <em>compiler configuration</em> is used. This configuration holds information
like the source encoding or the classpath but it can also be used to perform more operations like adding imports by
default, applying AST transformations transparently or disabling global AST transformations.</p>
</div>
<div class="paragraph">
<p>The goal of compilation customizers is to make those common tasks easy to implement. For that, the <code>CompilerConfiguration</code>
class is the entry point. The general schema will always be based on the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.CompilerConfiguration</span>
<span style="color:#777">// create a configuration</span>
<span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
<span style="color:#777">// tweak the configuration</span>
config.addCompilationCustomizers(...)
<span style="color:#777">// run your script</span>
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(config)
shell.evaluate(script)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compilation customizers must extend the <em>org.codehaus.groovy.control.customizers.CompilationCustomizer</em> class. A customizer works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on a specific compilation phase</p>
</li>
<li>
<p>on <em>every</em> class node being compiled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can implement your own compilation customizer but Groovy includes some of the most common operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_customizer"><a class="link" href="#_import_customizer">7.6.2. Import customizer</a></h4>
<div class="paragraph">
<p>Using this compilation customizer, your code will have imports added
transparently. This is in particular useful for scripts implementing a
DSL where you want to avoid users from having to write imports. The
import customizer will let you add all the variants of imports the
Groovy language allows, that is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class imports, optionally aliased</p>
</li>
<li>
<p>star imports</p>
</li>
<li>
<p>static imports, optionally aliased</p>
</li>
<li>
<p>static star imports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.ImportCustomizer</span>

<span style="color:#080;font-weight:bold">def</span> icz = <span style="color:#080;font-weight:bold">new</span> ImportCustomizer()
<span style="color:#777">// &quot;normal&quot; import</span>
icz.addImports(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent.atomic.AtomicInteger</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent.ConcurrentHashMap</span><span style="color:#710">'</span></span>)
<span style="color:#777">// &quot;aliases&quot; import</span>
icz.addImport(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CHM</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent.ConcurrentHashMap</span><span style="color:#710">'</span></span>)
<span style="color:#777">// &quot;static&quot; import</span>
icz.addStaticImport(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PI</span><span style="color:#710">'</span></span>) <span style="color:#777">// import static java.lang.Math.PI</span>
<span style="color:#777">// &quot;aliased static&quot; import</span>
icz.addStaticImport(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pi</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PI</span><span style="color:#710">'</span></span>) <span style="color:#777">// import static java.lang.Math.PI as pi</span>
<span style="color:#777">// &quot;star&quot; import</span>
icz.addStarImports <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent</span><span style="color:#710">'</span></span> <span style="color:#777">// import java.util.concurrent.*</span>
<span style="color:#777">// &quot;static star&quot; import</span>
icz.addStaticStars <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span> <span style="color:#777">// import static java.lang.Math.*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A detailed description of all shortcuts can be found in gapi:org.codehaus.groovy.control.customizers.ImportCustomizer[]</p>
</div>
</div>
<div class="sect3">
<h4 id="_ast_transformation_customizer"><a class="link" href="#_ast_transformation_customizer">7.6.3. AST transformation customizer</a></h4>
<div class="paragraph">
<p>The AST transformation customizer is meant to apply AST transformations
transparently. Unlike global AST transformations that apply on every
class being compiled as long as the transform is found on classpath
(which has drawbacks like increasing the compilation time or side
effects due to transformations applied where they should not), the
customizer will allow you to selectively apply a transform only for
specific scripts or classes.</p>
</div>
<div class="paragraph">
<p>As an example, let’s say you want to be able to use <code>@Log</code> in a script.
The problem is that <code>@Log</code> is normally applied on a class node and a
script, by definition, doesn’t require one. But implementation wise,
scripts are classes, it’s just that you cannot annotate this implicit
class node with <code>@Log</code>. Using the AST customizer, you have a workaround
to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.util.logging.Log</span>

<span style="color:#080;font-weight:bold">def</span> acz = <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(Log)
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all! Internally, the <code>@Log</code> AST transformation is applied to
every class node in the compilation unit. This means that it will be
applied to the script, but also to classes defined within the script.</p>
</div>
<div class="paragraph">
<p>If the AST transformation that you are using accepts parameters, you can
use parameters in the constructor too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> acz = <span style="color:#080;font-weight:bold">new</span> ASTTransformationCustomizer(Log, <span style="color:#606">value</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LOGGER</span><span style="color:#710">'</span></span>)
<span style="color:#777">// use name 'LOGGER' instead of the default 'log'</span>
config.addCompilationCustomizers(acz)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the AST transformation customizers works with objects instead of AST
nodes, not all values can be converted to AST transformation parameters.
For example, primitive types are converted to <code>ConstantExpression</code> (that
is <code>LOGGER</code> is converted to <code>new ConstantExpression('LOGGER')</code>, but if
your AST transformation takes a closure as an argument, then you have to
give it a <code>ClosureExpression</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">subprojects</span><span style="color:#404">/</span></span>groovy-astbuilder/src/spec/test/CustomizersTest.groovy[tags=ast_cz_closure,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of options, please refer to gapi:org.codehaus.groovy.control.customizers.ASTTransformationCustomizer[]</p>
</div>
</div>
<div class="sect3">
<h4 id="_secure_ast_customizer"><a class="link" href="#_secure_ast_customizer">7.6.4. Secure AST customizer</a></h4>
<div class="paragraph">
<p>This customizer will allow the developer of a DSL to restrict the
<strong>grammar</strong> of the language, for example, to prevent users from using particular constructs.
It is only ``secure'' in that one aspect, i.e. limiting the allowable constructs within a DSL.
It does <strong>not</strong> replace a security manager which might additionally
be needed as an orthogonal aspect of overall security.
The only reason for it to exist is to limit the expressiveness of the
language. This customizer only works at the AST (abstract syntax tree)
level, not at runtime! It can be strange at first glance, but it makes
much more sense if you think of Groovy as a platform to build DSLs. You
may not want a user to have a complete language at hand. In the example
below, we will demonstrate it using an example of language that only
allows arithmetic operations, but this customizer allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow/disallow creation of closures</p>
</li>
<li>
<p>allow/disallow imports</p>
</li>
<li>
<p>allow/disallow package definition</p>
</li>
<li>
<p>allow/disallow definition of methods</p>
</li>
<li>
<p>restrict the receivers of method calls</p>
</li>
<li>
<p>restrict the kind of AST expressions a user can use</p>
</li>
<li>
<p>restrict the tokens (grammar-wise) a user can use</p>
</li>
<li>
<p>restrict the types of the constants that can be used in code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For all those features, the secure AST customizer works using either an
allowed list (list of elements that are permitted) <strong>or</strong> a disallowed list (list of
elements that are not permitted). For each type of feature (imports,
tokens, …) you have the choice to use either an allowed or disallowed list,
but you can mix dis/allowed lists for distinct features. Typically,
you will choose allowed lists (which permits only the constructs listed and disallows all others).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.SecureASTCustomizer</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.syntax.Types.*</span> <b class="conum">(1)</b>

<span style="color:#080;font-weight:bold">def</span> scz = <span style="color:#080;font-weight:bold">new</span> SecureASTCustomizer()
scz.with {
    closuresAllowed = <span style="color:#069">false</span> <span style="color:#777">// user will not be able to write closures</span>
    methodDefinitionAllowed = <span style="color:#069">false</span> <span style="color:#777">// user will not be able to define methods</span>
    allowedImports = <span style="color:#339;font-weight:bold">[]</span> <span style="color:#777">// empty allowed list means imports are disallowed</span>
    allowedStaticImports = <span style="color:#339;font-weight:bold">[]</span> <span style="color:#777">// same for static imports</span>
    allowedStaticStarImports = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span>] <span style="color:#777">// only java.lang.Math is allowed</span>
    <span style="color:#777">// the list of tokens the user can find</span>
    <span style="color:#777">// constants are defined in org.codehaus.groovy.syntax.Types</span>
    allowedTokens = [ // <b class="conum">(1)</b>
            PLUS,
            MINUS,
            MULTIPLY,
            DIVIDE,
            REMAINDER,
            POWER,
            PLUS_PLUS,
            MINUS_MINUS,
            COMPARE_EQUAL,
            COMPARE_NOT_EQUAL,
            COMPARE_LESS_THAN,
            COMPARE_LESS_THAN_EQUAL,
            COMPARE_GREATER_THAN,
            COMPARE_GREATER_THAN_EQUAL,
    ].asImmutable()
    <span style="color:#777">// limit the types of constants that a user can define to number types only</span>
    allowedConstantTypesClasses = [ // <b class="conum">(2)</b>
            <span style="color:#0a8;font-weight:bold">Integer</span>,
            <span style="color:#0a8;font-weight:bold">Float</span>,
            <span style="color:#0a8;font-weight:bold">Long</span>,
            <span style="color:#0a8;font-weight:bold">Double</span>,
            <span style="color:#0a8;font-weight:bold">BigDecimal</span>,
            <span style="color:#0a8;font-weight:bold">Integer</span>.TYPE,
            <span style="color:#0a8;font-weight:bold">Long</span>.TYPE,
            <span style="color:#0a8;font-weight:bold">Float</span>.TYPE,
            <span style="color:#0a8;font-weight:bold">Double</span>.TYPE
    ].asImmutable()
    <span style="color:#777">// method calls are only allowed if the receiver is of one of those types</span>
    <span style="color:#777">// be careful, it's not a runtime type!</span>
    allowedReceiversClasses = [ // <b class="conum">(2)</b>
            <span style="color:#0a8;font-weight:bold">Math</span>,
            <span style="color:#0a8;font-weight:bold">Integer</span>,
            <span style="color:#0a8;font-weight:bold">Float</span>,
            <span style="color:#0a8;font-weight:bold">Double</span>,
            <span style="color:#0a8;font-weight:bold">Long</span>,
            <span style="color:#0a8;font-weight:bold">BigDecimal</span>
    ].asImmutable()
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>use for token types from gapi:org.codehaus.groovy.syntax.Types[]</p>
</li>
<li>
<p>you can use class literals here</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If what the secure AST customizer provides out of the box isn’t enough
for your needs, before creating your own compilation customizer, you
might be interested in the expression and statement checkers that the
AST customizer supports. Basically, it allows you to add custom checks
on the AST tree, on expressions (expression checkers) or statements
(statement checkers). For this, you must
implement <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</code>
or <code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</code>.</p>
</div>
<div class="paragraph">
<p>Those interfaces define a single method called <code>isAuthorized</code>, returning
a boolean, and taking a <code>Statement</code> (or <code>Expression</code>) as a parameter. It
allows you to perform complex logic over expressions or statements to
tell if a user is allowed to do it or not.</p>
</div>
<div class="paragraph">
<p>For example, there&#8217;s no predefined configuration flag in the customizer which
will let you prevent people from using an attribute expression. Using a custom
checker, it is trivial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> scz = <span style="color:#080;font-weight:bold">new</span> SecureASTCustomizer()
<span style="color:#080;font-weight:bold">def</span> checker = { expr -&gt;
    !(expr <span style="color:#080;font-weight:bold">instanceof</span> AttributeExpression)
} <span style="color:#080;font-weight:bold">as</span> SecureASTCustomizer.ExpressionChecker
scz.addExpressionCheckers(checker)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can make sure that this works by evaluating a simple script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">new</span> GroovyShell(config).evaluate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
    class A {
        int val
    }

    def a = new A(val: 123)
    a.@val // <b class="conum">(1)</b>
</span><span style="color:#710">'''</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>will fail compilation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Statements can be checked using gapi:org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker[]
Expressions can be checked using gapi:org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker[]</p>
</div>
</div>
<div class="sect3">
<h4 id="_source_aware_customizer"><a class="link" href="#_source_aware_customizer">7.6.5. Source aware customizer</a></h4>
<div class="paragraph">
<p>This customizer may be used as a filter on other customizers. The
filter, in that case, is the <code>org.codehaus.groovy.control.SourceUnit</code>.
For this, the source aware customizer takes another customizer as a
delegate, and it will apply customization of that delegate only and only
if predicates on the source unit match.</p>
</div>
<div class="paragraph">
<p><code>SourceUnit</code> gives you access to multiple things but in particular the
file being compiled (if compiling from a file, of course). It gives
you the potential to perform operation based on the file name, for
example. Here is how you would create a source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.SourceAwareCustomizer</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.ImportCustomizer</span>

<span style="color:#080;font-weight:bold">def</span> delegate = <span style="color:#080;font-weight:bold">new</span> ImportCustomizer()
<span style="color:#080;font-weight:bold">def</span> sac = <span style="color:#080;font-weight:bold">new</span> SourceAwareCustomizer(delegate)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use predicates on the source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// the customizer will only be applied to classes contained in a file name ending with 'Bean'</span>
sac.baseNameValidator = { baseName -&gt;
    baseName.endsWith <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bean</span><span style="color:#710">'</span></span>
}

<span style="color:#777">// the customizer will only be applied to files which extension is '.spec'</span>
sac.extensionValidator = { ext -&gt; ext == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">spec</span><span style="color:#710">'</span></span> }

<span style="color:#777">// source unit validation</span>
<span style="color:#777">// allow compilation only if the file contains at most 1 class</span>
sac.sourceUnitValidator = { SourceUnit sourceUnit -&gt; sourceUnit.AST.classes.size() == <span style="color:#00D">1</span> }

<span style="color:#777">// class validation</span>
<span style="color:#777">// the customizer will only be applied to classes ending with 'Bean'</span>
sac.classValidator = { ClassNode cn -&gt; cn.endsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bean</span><span style="color:#710">'</span></span>) }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizer_builder"><a class="link" href="#_customizer_builder">7.6.6. Customizer builder</a></h4>
<div class="paragraph">
<p>If you are using compilation customizers in Groovy code (like the
examples above) then you can use an alternative syntax to customize compilation.
A builder (<code>org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder</code>)
simplifies the creation of customizers using a hierarchical DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.CompilerConfiguration</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder.withConfig</span> <b class="conum">(1)</b>

<span style="color:#080;font-weight:bold">def</span> conf = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()
withConfig(conf) {
    <span style="color:#777">// ... </span><b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>static import of the builder method</p>
</li>
<li>
<p>configuration goes here</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The code sample above shows how to use the builder. A static
method, <em>withConfig</em>, takes a closure corresponding to the builder code,
and automatically registers compilation customizers to the
configuration. Every compilation customizer available in the distribution
can be configured this way:</p>
</div>
<div class="sect4">
<h5 id="_import_customizer_2"><a class="link" href="#_import_customizer_2">7.6.6.1. Import customizer</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(configuration) {
   imports { <span style="color:#777">// imports customizer</span>
      normal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">my.package.MyClass</span><span style="color:#710">'</span></span> <span style="color:#777">// a normal import</span>
      alias <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">AI</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent.atomic.AtomicInteger</span><span style="color:#710">'</span></span> <span style="color:#777">// an aliased import</span>
      star <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.util.concurrent</span><span style="color:#710">'</span></span> <span style="color:#777">// star imports</span>
      staticMember <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PI</span><span style="color:#710">'</span></span> <span style="color:#777">// static import</span>
      staticMember <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pi</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java.lang.Math</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PI</span><span style="color:#710">'</span></span> <span style="color:#777">// aliased static import</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ast_transformation_customizer_2"><a class="link" href="#_ast_transformation_customizer_2">7.6.6.2. AST transformation customizer</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(conf) {
   ast(Log) <b class="conum">(1)</b>
}

withConfig(conf) {
   ast(Log, <span style="color:#606">value</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">LOGGER</span><span style="color:#710">'</span></span>) <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>apply @Log transparently</p>
</li>
<li>
<p>apply @Log with a different name for the logger</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_secure_ast_customizer_2"><a class="link" href="#_secure_ast_customizer_2">7.6.6.3. Secure AST customizer</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(conf) {
   secureAst {
       closuresAllowed = <span style="color:#069">false</span>
       methodDefinitionAllowed = <span style="color:#069">false</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_source_aware_customizer_2"><a class="link" href="#_source_aware_customizer_2">7.6.6.4. Source aware customizer</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(configuration){
    source(<span style="color:#606">extension</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sgroovy</span><span style="color:#710">'</span></span>) {
        ast(CompileStatic) <b class="conum">(1)</b>
    }
}

withConfig(configuration){
    source(<span style="color:#606">extensions</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sgroovy</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sg</span><span style="color:#710">'</span></span>]) {
        ast(CompileStatic) <b class="conum">(2)</b>
    }
}

withConfig(configuration) {
    source(<span style="color:#606">extensionValidator</span>: { <span style="color:#950">it</span>.name <span style="color:#080;font-weight:bold">in</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sgroovy</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sg</span><span style="color:#710">'</span></span>]}) {
        ast(CompileStatic) <b class="conum">(2)</b>
    }
}

withConfig(configuration) {
    source(<span style="color:#606">basename</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>) {
        ast(CompileStatic) <b class="conum">(3)</b>
    }
}

withConfig(configuration) {
    source(<span style="color:#606">basenames</span>: [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>]) {
        ast(CompileStatic) <b class="conum">(4)</b>
    }
}

withConfig(configuration) {
    source(<span style="color:#606">basenameValidator</span>: { <span style="color:#950">it</span> <span style="color:#080;font-weight:bold">in</span> [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>] }) {
        ast(CompileStatic) <b class="conum">(4)</b>
    }
}

withConfig(configuration) {
    source(<span style="color:#606">unitValidator</span>: { unit -&gt; !unit.AST.classes.any { <span style="color:#950">it</span>.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Baz</span><span style="color:#710">'</span></span> } }) {
        ast(CompileStatic) <b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>apply CompileStatic AST annotation on .sgroovy files</p>
</li>
<li>
<p>apply CompileStatic AST annotation on .sgroovy or .sg files</p>
</li>
<li>
<p>apply CompileStatic AST annotation on files whose name is 'foo'</p>
</li>
<li>
<p>apply CompileStatic AST annotation on files whose name is 'foo' or 'bar'</p>
</li>
<li>
<p>apply CompileStatic AST annotation on files that do not contain a class named 'Baz'</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_inlining_a_customizer"><a class="link" href="#_inlining_a_customizer">7.6.6.5. Inlining a customizer</a></h5>
<div class="paragraph">
<p>Inlined customizer allows you to write a compilation customizer
directly, without having to create a class for it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(configuration) {
    inline(<span style="color:#606">phase</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CONVERSION</span><span style="color:#710">'</span></span>) { source, context, classNode -&gt;  <b class="conum">(1)</b>
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">visiting </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>classNode</span><span style="color:#710">&quot;</span></span>                           <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>define an inlined customizer which will execute at the CONVERSION phase</p>
</li>
<li>
<p>prints the name of the class node being compiled</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_customizers"><a class="link" href="#_multiple_customizers">7.6.6.6. Multiple customizers</a></h5>
<div class="paragraph">
<p>Of course, the builder allows you to define multiple customizers at
once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(configuration) {
   ast(ToString)
   ast(EqualsAndHashCode)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_configscript_commandline_parameter"><a class="link" href="#_the_configscript_commandline_parameter">7.6.7. The <code>configscript</code> commandline parameter</a></h4>
<div class="paragraph">
<p>So far, we have described how you can customize compilation using
a <code>CompilationConfiguration</code> class, but this is only possible if you
embed Groovy and that you create your own instances
of <code>CompilerConfiguration</code> (then use it to create a
<code>GroovyShell</code>, <code>GroovyScriptEngine</code>, …).</p>
</div>
<div class="paragraph">
<p>If you want it to be applied on the classes you compile with the normal
Groovy compiler (that is to say with <code>groovyc</code>, <code>ant</code> or <code>gradle</code>,
for example), it is possible to use a commandline parameter named <code>configscript</code>
that takes a Groovy configuration script as argument.</p>
</div>
<div class="paragraph">
<p>This script gives you access to the <code>CompilerConfiguration</code> instance <strong>before</strong>
the files are compiled (exposed into the configuration script as a variable named <code>configuration</code>),
so that you can tweak it.</p>
</div>
<div class="paragraph">
<p>It also transparently integrates the compiler configuration builder above. As an example, let&#8217;s see
how you would activate static compilation by default on all classes.</p>
</div>
<div class="sect4">
<h5 id="_configscript_example_static_compilation_by_default"><a class="link" href="#_configscript_example_static_compilation_by_default">7.6.7.1. Configscript example: Static compilation by default</a></h5>
<div class="paragraph">
<p>Normally, classes in Groovy are compiled with a dynamic runtime. You can activate static compilation
by placing an annotation named <code>@CompileStatic</code> on any class. Some people would like to have this
mode activated by default, that is to say not having to annotate (potentially many) classes.
Using <code>configscript</code>,  makes this possible.
First of all, you need to create a file named <code>config.groovy</code> into say <code>src/conf</code> with
the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withConfig(configuration) { <b class="conum">(1)</b>
   ast(groovy.transform.CompileStatic)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><em>configuration</em> references a <code>CompilerConfiguration</code> instance</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>That is actually all you need. You don’t have to import the builder, it’s automatically
exposed in the script. Then, compile your files using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc -configscript src/conf/config.groovy src/main/groovy/MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>We strongly recommend you to separate configuration files from classes,
hence why we suggest using the <code>src/main</code> and <code>src/conf</code> directories above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_configscript_example_setting_system_properties"><a class="link" href="#_configscript_example_setting_system_properties">7.6.7.2. Configscript example: Setting system properties</a></h5>
<div class="paragraph">
<p>In a configuration script you can also set system properties, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">System</span>.setProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">spock.iKnowWhatImDoing.disableGroovyVersionCheck</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">true</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have numerous system properties to set, then using a configuration file
will reduce the need to set a bunch of system properties with a long command line
or appropriately defined environment variable.
You can also share all the settings by simply sharing the config file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ast_transformations"><a class="link" href="#_ast_transformations">7.6.8. AST transformations</a></h4>
<div class="paragraph">
<p>If:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>runtime metaprogramming doesn&#8217;t allow you to do what you want</p>
</li>
<li>
<p>you need to improve the performance of the execution of your DSLs</p>
</li>
<li>
<p>you want to leverage the same syntax as Groovy but with different semantics</p>
</li>
<li>
<p>you want to improve support for type checking in your DSLs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then AST transformations are the way to go. Unlike the techniques used so far, AST transformations are meant to
change or generate code before it is compiled to bytecode. AST transformations are capable of adding new methods at
compile time for example, or totally changing the body of a method based on your needs. They are a very powerful tool
but also come at the price of not being easy to write. For more information about AST transformations, please take
a look at the <a href="https://docs.groovy-lang.org/latest/html/documentation/index.html#_compile_time_metaprogramming">compile-time
metaprogramming</a> section of this manual.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_type_checking_extensions"><a class="link" href="#_custom_type_checking_extensions">7.7. Custom type checking extensions</a></h3>
<div class="paragraph">
<p>It may be interesting, in some circumstances, to provide feedback about wrong code to the user as soon as possible,
that is to say when the DSL script is compiled, rather than having to wait for the execution of the script. However,
this is not often possible with dynamic code. Groovy actually provides a practical answer to this known as
<a href="type-checking-extensions.html">type checking extensions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_builders"><a class="link" href="#_builders">7.8. Builders</a></h3>
<div class="paragraph">
<p>Many tasks require building things and the builder pattern is one technique
used by developers to make building things easier, especially building
of structures which are hierarchical in nature.
This pattern is so ubiquitous that Groovy has special built-in support.
Firstly, there are many built-in builders. Secondly, there are
classes which make it easier to write your own builders.</p>
</div>
<div class="sect3">
<h4 id="_existing_builders"><a class="link" href="#_existing_builders">7.8.1. Existing builders</a></h4>
<div class="paragraph">
<p>Groovy comes with many built-in builders. Let&#8217;s look at some of them.</p>
</div>
<div class="sect4">
<h5 id="_markupbuilder"><a class="link" href="#_markupbuilder">7.8.1.1. MarkupBuilder</a></h5>
<div class="paragraph">
<p>See <a href="xml-userguide.html#_markupbuilder">Creating Xml - MarkupBuilder</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_streamingmarkupbuilder"><a class="link" href="#_streamingmarkupbuilder">7.8.1.2. StreamingMarkupBuilder</a></h5>
<div class="paragraph">
<p>See <a href="xml-userguide.html#_streamingmarkupbuilder">Creating Xml - StreamingMarkupBuilder</a>.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-xml/src/spec/doc/_sax-builder.adoc[leveloffset=+3]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-xml/src/spec/doc/_stax-builder.adoc[leveloffset=+3]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-xml/src/spec/doc/_dom-builder.adoc[leveloffset=+3]</p>
</div>
</div>
<div class="sect4">
<h5 id="_nodebuilder"><a class="link" href="#_nodebuilder">7.8.1.3. NodeBuilder</a></h5>
<div class="paragraph">
<p><code>NodeBuilder</code> is used for creating nested trees of gapi:groovy.util.Node[Node] objects for handling arbitrary data.
To create a simple user list you use a <code>NodeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> nodeBuilder = <span style="color:#080;font-weight:bold">new</span> NodeBuilder()
<span style="color:#080;font-weight:bold">def</span> userlist = nodeBuilder.userlist {
    user(<span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1</span><span style="color:#710">'</span></span>, <span style="color:#606">firstname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>, <span style="color:#606">lastname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>) {
        address(<span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">home</span><span style="color:#710">'</span></span>, <span style="color:#606">street</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1 Main St.</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Springfield</span><span style="color:#710">'</span></span>, <span style="color:#606">state</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MA</span><span style="color:#710">'</span></span>, <span style="color:#606">zip</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">12345</span><span style="color:#710">'</span></span>)
        address(<span style="color:#606">type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">work</span><span style="color:#710">'</span></span>, <span style="color:#606">street</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2 South St.</span><span style="color:#710">'</span></span>, <span style="color:#606">city</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Boston</span><span style="color:#710">'</span></span>, <span style="color:#606">state</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MA</span><span style="color:#710">'</span></span>, <span style="color:#606">zip</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">98765</span><span style="color:#710">'</span></span>)
    }
    user(<span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2</span><span style="color:#710">'</span></span>, <span style="color:#606">firstname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Alice</span><span style="color:#710">'</span></span>, <span style="color:#606">lastname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Doe</span><span style="color:#710">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can process the data further, e.g. by using <a href="core-semantics.html#gpath_expressions">GPath expressions</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> userlist.user.@firstname.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">, </span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John, Alice</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> userlist.user.find { <span style="color:#950">it</span>.@lastname == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span> }.address.size() == <span style="color:#00D">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-json/src/spec/doc/_json-builder.adoc[leveloffset=+3]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-json/src/spec/doc/_streaming-jason-builder.adoc[leveloffset=+3]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-swing/src/spec/doc/_swing-builder.adoc[leveloffset=+3]</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/core-domain-specific-languages.adoc - include::../../../subprojects/groovy-ant/src/spec/doc/_ant-builder.adoc[leveloffset=+3]</p>
</div>
</div>
<div class="sect4">
<h5 id="_clibuilder"><a class="link" href="#_clibuilder">7.8.1.4. CliBuilder</a></h5>
<div class="paragraph">
<p><code>CliBuilder</code> provides a compact way to specify the available options for a commandline application and then
automatically parse the application&#8217;s commandline parameters according to that specification. By convention,
a distinction is made between <em>option</em> commandline parameters and any remaining parameters which are passed
to an application as its arguments. Typically, several types of options might be supported such as <code>-V</code> or
<code>--tabsize=4</code>. <code>CliBuilder</code> removes the burden of developing lots of code for commandline processing.
Instead, it supports a somewhat declarative approach to declaring your options and then provides a single call
to parse the commandline parameters with a simple mechanism to interrogate the options (you can think of this
as a simple model for your options).</p>
</div>
<div class="paragraph">
<p>Even though the details of each commandline you create could be quite different, the same main steps are
followed each time. First, a <code>CliBuilder</code> instance is created. Then, allowed commandline options are defined.
This can be done using a <em>dynamic api</em> style or an <em>annotation</em> style.
The commandline parameters are then parsed according to the options specification resulting in a
collection of options which are then interrogated.</p>
</div>
<div class="paragraph">
<p>Here is a simple example <code>Greeter.groovy</code> script illustrating usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// import of CliBuilder not shown                          </span><b class="conum">(1)</b>
<span style="color:#777">// specify parameters</span>
<span style="color:#080;font-weight:bold">def</span> cli = <span style="color:#080;font-weight:bold">new</span> CliBuilder(<span style="color:#606">usage</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">groovy Greeter [option]</span><span style="color:#710">'</span></span>) <b class="conum">(2)</b>
cli.a(<span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">audience</span><span style="color:#710">'</span></span>, <span style="color:#606">args</span>: <span style="color:#00D">1</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greeting audience</span><span style="color:#710">'</span></span>)   <b class="conum">(3)</b>
cli.h(<span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">help</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">display usage</span><span style="color:#710">'</span></span>)                    <b class="conum">(4)</b>

<span style="color:#777">// parse and process parameters</span>
<span style="color:#080;font-weight:bold">def</span> options = cli.parse(args)                              <b class="conum">(5)</b>
<span style="color:#080;font-weight:bold">if</span> (options.h) cli.usage()                                 <b class="conum">(6)</b>
<span style="color:#080;font-weight:bold">else</span> println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>options.a ? options.a : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">World</span><span style="color:#710">'</span></span><span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>    <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Earlier versions of Groovy had a CliBuilder in the <code>groovy.util</code> package and no import was necessary.
In Groovy 2.5, this approach became deprecated: applications should instead choose the <code>groovy.cli.picocli</code> or <code>groovy.cli.commons</code> version.
The groovy.util version in Groovy 2.5 points to the commons-cli version for backwards compatibility but has been removed in Groovy 3.0.</p>
</li>
<li>
<p>define a new <code>CliBuilder</code> instance specifying an optional usage string</p>
</li>
<li>
<p>specify a <code>-a</code> option taking a single argument with an optional long variant <code>--audience</code></p>
</li>
<li>
<p>specify a <code>-h</code> option taking no arguments with an optional long variant <code>--help</code></p>
</li>
<li>
<p>parse the commandline parameters supplied to the script</p>
</li>
<li>
<p>if the <code>h</code> option is found display a usage message</p>
</li>
<li>
<p>display a standard greeting or, if the <code>a</code> option is found, a customized greeting</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Running this script with no commandline parameters, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">&gt; groovy Greeter</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello World</pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>-h</code> as the single commandline parameter, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">&gt; groovy Greeter -h</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>usage: groovy Greeter [option]
 -a,--audience &lt;arg&gt;   greeting audience
 -h,--help             display usage</pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>--audience Groovologist</code> as the commandline parameters, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">&gt; groovy Greeter --audience Groovologist</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello Groovologist</pre>
</div>
</div>
<div class="paragraph">
<p>When creating the <code>CliBuilder</code> instance in the above example, we set the optional <code>usage</code> property
within the constructor call. This follows Groovy&#8217;s normal ability to set additional properties
of the instance during construction. There are numerous other properties which can be set
such as <code>header</code> and <code>footer</code>. For the complete set of available properties, see the
available properties for the gapi:groovy.util.CliBuilder[CliBuilder] class.</p>
</div>
<div class="paragraph">
<p>When defining an allowed commandline option, both a short name (e.g. "h" for the <code>help</code> option shown previously)
and a short description (e.g. "display usage" for the <code>help</code> option) must be supplied.
In our example above, we also set some
additional properties such as <code>longOpt</code> and <code>args</code>. The following additional
properties are supported when specifying an allowed commandline option:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">argName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the argument for this option used in output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">longOpt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the long representation or long name of the option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the number of argument values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code> or <code>String</code> &#160; &#160; (1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optionalArg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the argument value is optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the option is mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the type of this option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Class</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueSeparator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the character that is the value separator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char</code> &#160; &#160; (2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a default value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">convert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">converts the incoming String to the required type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Closure</code> &#160; &#160; (1)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(1) More details later<br>
(2) Single character Strings are coerced to chars in special cases in Groovy</p>
</div>
<div class="paragraph">
<p>If you have an option with only a <code>longOpt</code> variant, you can use the special shortname of '_'
to specify the option, e.g. : <code>cli._(longOpt: 'verbose', 'enable verbose logging')</code>.
Some of the remaining named parameters should be fairly self-explanatory while others deserve
a bit more explanation. But before further explanations, let&#8217;s look at ways of using
<code>CliBuilder</code> with annotations.</p>
</div>
<div class="sect5">
<h6 id="_using_annotations_and_an_interface"><a class="link" href="#_using_annotations_and_an_interface">Using Annotations and an interface</a></h6>
<div class="paragraph">
<p>Rather than making a series of method calls (albeit in a very declarative mini-DSL form)
to specify the allowable options, you can provide an interface specification of the allowable options where
annotations are used to indicate and provide details for those options and for how unprocessed
parameters are handled. Two annotations are used: gapi:groovy.cli.Option[] and gapi:groovy.cli.Unparsed[].</p>
</div>
<div class="paragraph">
<p>Here is how such a specification can be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/GreeterI.groovy[tags=annotationInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify a Boolean option set using <code>-h</code> or <code>--help</code></p>
</li>
<li>
<p>Specify a String option set using <code>-a</code> or <code>--audience</code></p>
</li>
<li>
<p>Specify where any remaining parameters will be stored</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note how the long name is automatically determined from the interface method name.
You can use the <code>longName</code> annotation attribute to override that behavior and specify
a custom long name if you wish or use a longName of '_' to indicate that no long name
is to be provided. You will need to specify a shortName in such a case.</p>
</div>
<div class="paragraph">
<p>Here is how you could use the interface specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=annotationInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a <code>CliBuilder</code> instance as before with optional properties</p>
</li>
<li>
<p>Parse parameters using the interface specification</p>
</li>
<li>
<p>Interrogate options using the methods from the interface</p>
</li>
<li>
<p>Parse a different set of parameters</p>
</li>
<li>
<p>Interrogate the remaining parameters</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When <code>parseFromSpec</code> is called, <code>CliBuilder</code> automatically creates an instance implementing the interface
and populates it. You simply call the interface methods to interrogate the option values.</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_annotations_and_an_instance"><a class="link" href="#_using_annotations_and_an_instance">Using Annotations and an instance</a></h6>
<div class="paragraph">
<p>Alternatively, perhaps you already have a domain class containing the option information.
You can simply annotate properties or setters from that class to enable <code>CliBuilder</code> to appropriately
populate your domain object. Each annotation both describes that option&#8217;s properties through the annotation
attributes and indicates the setter the <code>CliBuilder</code> will use to populate that option in your domain object.</p>
</div>
<div class="paragraph">
<p>Here is how such a specification can be defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/GreeterC.groovy[tags=annotationClassSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Indicate that a Boolean property is an option</p>
</li>
<li>
<p>Indicate that a String property (with explicit setter) is an option</p>
</li>
<li>
<p>Specify where any remaining args will be stored</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And here is how you could use the specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=annotationClass,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a <code>CliBuilder</code> instance as before with optional parameters</p>
</li>
<li>
<p>Create an instance for <code>CliBuilder</code> to populate</p>
</li>
<li>
<p>Parse arguments populating the supplied instance</p>
</li>
<li>
<p>Interrogate the String option property</p>
</li>
<li>
<p>Interrogate the remaining arguments property</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When <code>parseFromInstance</code> is called, <code>CliBuilder</code> automatically populates your instance.
You simply interrogate the instance properties (or whatever accessor methods you have provided
in your domain object) to access the option values.</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_annotations_and_a_script"><a class="link" href="#_using_annotations_and_a_script">Using Annotations and a script</a></h6>
<div class="paragraph">
<p>Finally, there are two additional convenience annotation aliases specifically for scripts. They
simply combine the previously mentioned annotations and gapi:groovy.transform.Field[].
The groovydoc for those annotations reveals the details: gapi:groovy.cli.OptionField[] and
gapi:groovy.cli.UnparsedField[].</p>
</div>
<div class="paragraph">
<p>Here is an example using those annotations in a self-contained script that would be called
with the same arguments as shown for the instance example earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=annotationScript,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_options_with_arguments"><a class="link" href="#_options_with_arguments">Options with arguments</a></h6>
<div class="paragraph">
<p>We saw in our initial example that some options act like flags, e.g. <code>Greeter -h</code> but
others take an argument, e.g. <code>Greeter --audience Groovologist</code>. The simplest cases
involve options which act like flags or have a single (potentially optional) argument.
Here is an example involving those cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withArgument,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>An option that is simply a flag - the default; setting args to 0 is allowed but not needed.</p>
</li>
<li>
<p>An option with exactly one argument</p>
</li>
<li>
<p>An option with an optional argument; it acts like a flag if the option is left out</p>
</li>
<li>
<p>An example using this spec where an argument is supplied to the 'c' option</p>
</li>
<li>
<p>An example using this spec where no argument is supplied to the 'c' option; it&#8217;s just a flag</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note: when an option with an optional argument is encountered, it will (somewhat) greedily consume the
next parameter from the supplied commandline parameters. If however, the next parameter matches a known long or short
option (with leading single or double hyphens), that will take precedence, e.g. <code>-b</code> in the above example.</p>
</div>
<div class="paragraph">
<p>Option arguments may also be specified using the annotation style. Here is an interface option specification
illustrating such a definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/WithArgsI.groovy[tags=withArgumentInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how it is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withArgumentInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example makes use of an array-typed option specification. We cover this in more detail shortly when we discuss
multiple arguments.</p>
</div>
</div>
<div class="sect5">
<h6 id="_specifying_a_type"><a class="link" href="#_specifying_a_type">Specifying a type</a></h6>
<div class="paragraph">
<p>Arguments on the commandline are by nature Strings (or arguably can be considered Booleans for flags) but can be
converted to richer types automatically by supplying additional typing information. For the
annotation-based argument definition style, these types are supplied using the field types for annotation
properties or return types of annotated methods (or the setter argument type for setter methods).
For the dynamic method style of argument definition a special 'type' property is supported
which allows you to specify a Class name.</p>
</div>
<div class="paragraph">
<p>When an explicit type is defined, the <code>args</code> named-parameter is assumed to be 1 (except for Boolean-typed
options where it is 0 by default). An explicit <code>args</code> parameter can still be provided if needed.
Here is an example using types with the dynamic api argument definition style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withType,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Primitives, numeric types, files, enums and arrays thereof, are supported (they are converted using
gapi:org.codehaus.groovy.runtime.StringGroovyMethods#asType[StringGroovyMethods#asType(String, Class)]).</p>
</div>
</div>
<div class="sect5">
<h6 id="_custom_parsing_of_the_argument_string"><a class="link" href="#_custom_parsing_of_the_argument_string">Custom parsing of the argument String</a></h6>
<div class="paragraph">
<p>If the supported types aren&#8217;t sufficient, you can supply a closure to handle the String to rich type conversion
for you. Here is a sample using the dynamic api style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withConvert,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the annotation style by supplying the conversion closure as an annotation parameter.
Here is an example specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/WithConvertI.groovy[tags=withConvertInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And an example using that specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withConvertInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_options_with_multiple_arguments"><a class="link" href="#_options_with_multiple_arguments">Options with multiple arguments</a></h6>
<div class="paragraph">
<p>Multiple arguments are also supported using an <code>args</code> value greater than 1. There is a special named parameter,
<code>valueSeparator</code>, which can also be optionally used when processing multiple arguments. It allows some additional
flexibility in the syntax supported when supplying such argument lists on the commandline. For example,
supplying a value separator of ',' allows a comma-delimited list of values to be passed on the commandline.</p>
</div>
<div class="paragraph">
<p>The <code>args</code> value is normally an integer. It can be optionally supplied as a String. There are two special
String symbols: <code>` and `\*`.
The `*` value means 0 or more. The `</code> value means 1 or more.
The <code>*</code> value is the same as using <code>+</code> and also setting the <code>optionalArg</code> value to true.</p>
</div>
<div class="paragraph">
<p>Accessing the multiple arguments follows a special convention. Simply add an 's' to the normal property
you would use to access the argument option and you will retrieve all the supplied arguments as a list.
So, for a short option named 'a', you access the first 'a' argument using <code>options.a</code> and the list of
all arguments using <code>options.as</code>. It&#8217;s fine to have a shortname or longname ending in 's' so long as you
don&#8217;t also have the singular variant without the 's'. So, if <code>name</code> is one of your options with multiple arguments
and <code>guess</code> is another with a single argument, there will be no confusion using <code>options.names</code> and <code>options.guess</code>.</p>
</div>
<div class="paragraph">
<p>Here is an excerpt highlighting the use of multiple arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=multipleArgs,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Args value supplied as a String and comma value separator specified</p>
</li>
<li>
<p>One or more arguments are allowed</p>
</li>
<li>
<p>Two commandline parameters will be supplied as the 'b' option&#8217;s list of arguments</p>
</li>
<li>
<p>Access the 'a' option&#8217;s first argument</p>
</li>
<li>
<p>Access the 'a' option&#8217;s list of arguments</p>
</li>
<li>
<p>An alternative syntax for specifying two arguments for the 'a' option</p>
</li>
<li>
<p>The arguments to the 'b' option supplied as a comma-separated value</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As an alternative to accessing multiple arguments using the <em>plural name</em> approach, you can use an
array-based type for the option. In this case, all options will always be returned via the array
which is accessed via the normal singular name. We&#8217;ll see an example of this next when discussing
types.</p>
</div>
<div class="paragraph">
<p>Multiple arguments are also supported using the annotation style of option definition by using an
array type for the annotated class member (method or property) as this example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/ValSepI.groovy[tags=multipleArgsInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=multipleArgsInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_types_and_multiple_arguments"><a class="link" href="#_types_and_multiple_arguments">Types and multiple arguments</a></h6>
<div class="paragraph">
<p>Here is an example using types and multiple arguments with the dynamic api argument definition style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withTypeMultiple,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>For an array type, the trailing 's' can be used but isn&#8217;t needed</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_setting_a_default_value"><a class="link" href="#_setting_a_default_value">Setting a default value</a></h6>
<div class="paragraph">
<p>Groovy makes it easy using the Elvis operator to provide a default value at the point of usage of some variable,
e.g. <code>String x = someVariable ?: 'some default'</code>. But sometimes you wish to make such a default part of the
options specification to minimise the interrogators work in later stages. <code>CliBuilder</code> supports the <code>defaultValue</code>
property to cater for this scenario.</p>
</div>
<div class="paragraph">
<p>Here is how you could use it using the dynamic api style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withDefaultValue,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you might want such a specification using the annotation style. Here is an example using an interface
specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/WithDefaultValueI.groovy[tags=withDefaultValueInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which would be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withDefaultValueInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>defaultValue</code> annotation attribute when using annotations with an instance,
though it&#8217;s probably just as easy to provide an initial value for the property (or backing field).</p>
</div>
</div>
<div class="sect5">
<h6 id="_use_with_typechecked"><a class="link" href="#_use_with_typechecked">Use with <code>TypeChecked</code></a></h6>
<div class="paragraph">
<p>The dynamic api style of using <code>CliBuilder</code> is inherently dynamic but you have a few options
should you want to make use of Groovy&#8217;s static type checking capabilities. Firstly, consider using the
annotation style, for example, here is an interface option specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/TypeCheckedI.groovy[tags=withTypeCheckedInterfaceSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And it can be used in combination with <code>@TypeChecked</code> as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withTypeCheckedInterface,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, there is a feature of the dynamic api style which offers some support. The definition statements
are inherently dynamic but actually return a value which we have ignored in earlier examples.
The returned value is in fact a <code>TypedOption&lt;Type&gt;</code> and special <code>getAt</code> support allows the options
to be interrogated using the typed option, e.g. <code>options[savedTypeOption]</code>. So, if you have statements
similar to these in a non type checked part of your code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> cli = <span style="color:#080;font-weight:bold">new</span> CliBuilder()
TypedOption&lt;<span style="color:#0a8;font-weight:bold">Integer</span>&gt; age = cli.a(<span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span>, <span style="color:#606">type</span>: <span style="color:#0a8;font-weight:bold">Integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">some age option</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the following statements can be in a separate part of your code which is type checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> args = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">--age 21</span><span style="color:#710">'</span></span>.split()
<span style="color:#080;font-weight:bold">def</span> options = cli.parse(args)
<span style="color:#339;font-weight:bold">int</span> a = options[age]
<span style="color:#080;font-weight:bold">assert</span> a == <span style="color:#00D">21</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, there is one additional convenience method offered by <code>CliBuilder</code> to even allow the
definition part to be type checked. It is a slightly more verbose method call. Instead of using
the short name (the <em>opt</em> name) in the method call, you use a fixed name of <code>option</code> and
supply the <code>opt</code> value as a property. You must also specify the type directly as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>testFixtures/groovy/cli/CliBuilderTestCase.groovy[tags=withTypeChecked,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_cli_usage"><a class="link" href="#_advanced_cli_usage">Advanced CLI Usage</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>NOTE</strong> Advanced CLI features</p>
</div>
<div class="paragraph">
<p><code>CliBuilder</code> can be thought of as a Groovy friendly wrapper on top of either
<a href="https://github.com/remkop/picocli">picocli</a> or <a href="https://commons.apache.org/proper/commons-cli/">Apache Commons CLI</a>.
If there is a feature not provided by <code>CliBuilder</code> that you know is supported in the underlying
library, the current <code>CliBuilder</code> implementation (and various Groovy language features) make it easy for you
to call the underlying library methods directly. Doing so is a pragmatic way to leverage the Groovy-friendly
syntax offered by <code>CliBuilder</code> and yet still access some of the underlying library&#8217;s advanced features.
A word of caution however; future versions of <code>CliBuilder</code> could potentially use another underlying library
and in that event, some porting work may be required for your Groovy classes and/or scripts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="_apache_commons_cli"><a class="link" href="#_apache_commons_cli">Apache Commons CLI</a></h7>
<div class="paragraph">
<p>As an example, here is some code for making use of Apache Commons CLI&#8217;s grouping mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.apache.commons.cli.*</span>

<span style="color:#080;font-weight:bold">def</span> cli = <span style="color:#080;font-weight:bold">new</span> CliBuilder()
cli.f <span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">from</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">f option</span><span style="color:#710">'</span></span>
cli.u <span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">until</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">u option</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> optionGroup = <span style="color:#080;font-weight:bold">new</span> OptionGroup()
optionGroup.with {
  addOption cli.option(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">o</span><span style="color:#710">'</span></span>, [<span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">output</span><span style="color:#710">'</span></span>], <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">o option</span><span style="color:#710">'</span></span>)
  addOption cli.option(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d</span><span style="color:#710">'</span></span>, [<span style="color:#606">longOpt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">directory</span><span style="color:#710">'</span></span>], <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">d option</span><span style="color:#710">'</span></span>)
}
cli.options.addOptionGroup optionGroup
<span style="color:#080;font-weight:bold">assert</span> !cli.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-d -o</span><span style="color:#710">'</span></span>.split()) // <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The parse will fail since only one option from a group can be used at a time.</p>
</li>
</ol>
</div>
</div>
<div class="sect6">
<h7 id="_picocli"><a class="link" href="#_picocli">Picocli</a></h7>
<div class="paragraph">
<p>Below are some features available in the picocli version of <code>CliBuilder</code>.</p>
</div>
<div class="paragraph">
<p><strong>New property: errorWriter</strong></p>
</div>
<div class="paragraph">
<p>When users of your application give invalid command line arguments,
CliBuilder writes an error message and the usage help message to the <code>stderr</code> output stream.
It doesn&#8217;t use the <code>stdout</code> stream to prevent the error message from being parsed when your program&#8217;s
output is used as input for another process.
You can customize the destination by setting the <code>errorWriter</code> to a different value.</p>
</div>
<div class="paragraph">
<p>On the other hand, <code>CliBuilder.usage()</code> prints the usage help message to the <code>stdout</code> stream.
This way, when users request help (e.g. with a <code>--help</code> parameter),
they can pipe the output to a utility like <code>less</code> or <code>grep</code>.</p>
</div>
<div class="paragraph">
<p>You can specify different writers for testing.
<em>Be aware that for backwards compatibility, setting the <code>writer</code> property to a different value
will set <strong>both</strong> the <code>writer</code> and the <code>errorWriter</code> to the specified writer.</em></p>
</div>
<div class="paragraph">
<p><strong>ANSI colors</strong></p>
</div>
<div class="paragraph">
<p>The picocli version of CliBuilder renders the usage help message in ANSI colors on supported platforms automatically.
If desired you can <a href="http://picocli.info/#_usage_help_with_styles_and_colors">customize</a> this.
(An example follows below.)</p>
</div>
<div class="paragraph">
<p><strong>New property: name</strong></p>
</div>
<div class="paragraph">
<p>As before, you can set the synopsis of the usage help message with the <code>usage</code> property.
You may be interested in a small improvement:
if you only set the command <code>name</code>, a synopsis will be generated automatically,
with repeating elements followed by <code>&#8230;&#8203;</code> and optional elements surrounded with <code>[</code> and <code>]</code>.
(An example follows below.)</p>
</div>
<div class="paragraph">
<p><strong>New property: usageMessage</strong></p>
</div>
<div class="paragraph">
<p>This property exposes a <code>UsageMessageSpec</code> object from the underlying picocli library,
which gives fine-grained control over various sections of the usage help message. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">subprojects</span><span style="color:#404">/</span></span>groovy-cli-picocli/src/spec/test/builder/CliBuilderTest.groovy[tags=withUsageMessageSpec,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives this output:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./assets/img/usageMessageSpec.png" alt="usageMessageSpec"></span></p>
</div>
<div class="paragraph">
<p><strong>Property: parser</strong></p>
</div>
<div class="paragraph">
<p>The <code>parser</code> property gives access to the picocli <code>ParserSpec</code> object that can be used to customize the parser behavior.</p>
</div>
<div class="paragraph">
<p>This can be useful when the <code>CliBuilder</code> options to control the parser are not fine-grained enough.
For example, for backward compatibility with the Commons CLI implementation of <code>CliBuilder</code>, by default <code>CliBuilder</code> stops looking for options when an unknown option is encountered, and subsequent command line arguments are treated as positional parameters.
<code>CliBuilder</code> provides a <code>stopAtNonOption</code> property, and by setting this to <code>false</code> you can make the parser more strict, so an unknown option results in <code>error: Unknown option: '-x'</code>.</p>
</div>
<div class="paragraph">
<p>But what if you want to treat unknown options as positional parameters, and still process subsequent command line arguments as options?</p>
</div>
<div class="paragraph">
<p>This can be accomplished with the <code>parser</code> property.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> cli = <span style="color:#080;font-weight:bold">new</span> CliBuilder()
cli.parser.stopAtPositional(<span style="color:#069">false</span>)
cli.parser.unmatchedOptionsArePositionalParams(<span style="color:#069">true</span>)
<span style="color:#777">// ...</span>
<span style="color:#080;font-weight:bold">def</span> opts = cli.parse(args)
<span style="color:#777">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://picocli.info/apidocs/picocli/CommandLine.Model.ParserSpec.html">documentation</a> for details.</p>
</div>
<div class="paragraph">
<p><strong>Map options</strong></p>
</div>
<div class="paragraph">
<p>Finally, if your application has options that are key-value pairs, you may be interested in picocli&#8217;s support for maps. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">subprojects</span><span style="color:#404">/</span></span>groovy-cli-picocli/src/spec/test/builder/CliBuilderTest.groovy[tags=mapOptionImports,indent=<span style="color:#00D">0</span>]

Unresolved directive <span style="color:#080;font-weight:bold">in</span> doc/core-domain-specific-languages.adoc - <span style="color:#606">include</span>::..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">..</span><span style="color:#404">/</span></span>..<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">subprojects</span><span style="color:#404">/</span></span>groovy-cli-picocli/src/spec/test/builder/CliBuilderTest.groovy[tags=mapOption,indent=<span style="color:#00D">0</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Previously, <code>key=value</code> pairs were split up into parts and added to a list</p>
</li>
<li>
<p>Picocli map support: simply specify <code>Map</code> as the type of the option</p>
</li>
<li>
<p>You can even specify the type of the map elements</p>
</li>
<li>
<p>To compare, let&#8217;s specify two key-value pairs for each option</p>
</li>
<li>
<p>Previously, all key-value pairs end up in a list and it is up to the application to work with this list</p>
</li>
<li>
<p>Picocli returns the key-value pairs as a <code>Map</code></p>
</li>
<li>
<p>Both keys and values of the map can be strongly typed</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Controlling the Picocli version</strong></p>
</div>
<div class="paragraph">
<p>To use a specific version of picocli, add a dependency to that version in your build configuration.
If running scripts using a pre-installed version of Groovy, use the <code>@Grab</code> annotation to control the version of picocli to use in <code>CliBuilder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@GrabConfig</span>(systemClassLoader=<span style="color:#069">true</span>)
<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">info.picocli:picocli:4.2.0</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.cli.picocli.CliBuilder</span>

<span style="color:#080;font-weight:bold">def</span> cli = <span style="color:#080;font-weight:bold">new</span> CliBuilder()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_objectgraphbuilder"><a class="link" href="#_objectgraphbuilder">7.8.1.5. ObjectGraphBuilder</a></h5>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> is a builder for an arbitrary graph of beans that
follow the JavaBean convention. It is in particular useful for creating test data.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a list of classes that belong to your domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">package</span> com.acme

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Company</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    Address address
    <span style="color:#0a8;font-weight:bold">List</span> employees = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Address</span> {
    <span style="color:#0a8;font-weight:bold">String</span> line1
    <span style="color:#0a8;font-weight:bold">String</span> line2
    <span style="color:#339;font-weight:bold">int</span> zip
    <span style="color:#0a8;font-weight:bold">String</span> state
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Employee</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> employeeId
    Address address
    Company company
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then using <code>ObjectGraphBuilder</code> building a <code>Company</code> with three employees is as
easy as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> builder = <span style="color:#080;font-weight:bold">new</span> ObjectGraphBuilder()                          // <b class="conum">(1)</b>
builder.classLoader = <span style="color:#950">this</span>.class.classLoader                    // <b class="conum">(2)</b>
builder.classNameResolver = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.acme</span><span style="color:#710">&quot;</span></span>                          // <b class="conum">(3)</b>

<span style="color:#080;font-weight:bold">def</span> acme = builder.company(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ACME</span><span style="color:#710">'</span></span>) {                      // <b class="conum">(4)</b>
    <span style="color:#00D">3</span>.times {
        employee(<span style="color:#606">id</span>: <span style="color:#950">it</span>.toString(), <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Drone </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#950">it</span></span><span style="color:#710">&quot;</span></span>) {        // <b class="conum">(5)</b>
            address(<span style="color:#606">line1</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Post street</span><span style="color:#710">&quot;</span></span>)                        // <b class="conum">(6)</b>
        }
    }
}

<span style="color:#080;font-weight:bold">assert</span> acme != <span style="color:#069">null</span>
<span style="color:#080;font-weight:bold">assert</span> acme <span style="color:#080;font-weight:bold">instanceof</span> Company
<span style="color:#080;font-weight:bold">assert</span> acme.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ACME</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> acme.employees.size() == <span style="color:#00D">3</span>
<span style="color:#080;font-weight:bold">def</span> employee = acme.employees[<span style="color:#00D">0</span>]
<span style="color:#080;font-weight:bold">assert</span> employee <span style="color:#080;font-weight:bold">instanceof</span> Employee
<span style="color:#080;font-weight:bold">assert</span> employee.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Drone 0</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> employee.address <span style="color:#080;font-weight:bold">instanceof</span> Address</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>creates a new object graph builder</p>
</li>
<li>
<p>sets the classloader where the classes will be resolved</p>
</li>
<li>
<p>sets the base package name for classes to be resolved</p>
</li>
<li>
<p>creates a <code>Company</code> instance</p>
</li>
<li>
<p>with 3 <code>Employee</code> instances</p>
</li>
<li>
<p>each of them having a distinct <code>Address</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Behind the scenes, the object graph builder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>will try to match a node name into a <code>Class</code>, using a default <code>ClassNameResolver</code> strategy that requires a package name</p>
</li>
<li>
<p>then will create an instance of the appropriate class using a default <code>NewInstanceResolver</code> strategy that calls a no-arg constructor</p>
</li>
<li>
<p>resolves the parent/child relationship for nested nodes, involving two other strategies:</p>
<div class="ulist">
<ul>
<li>
<p><code>RelationNameResolver</code> will yield the name of the child property in the parent, and the name of the parent property
in the child (if any, in this case, <code>Employee</code> has a parent property aptly named <code>company</code>)</p>
</li>
<li>
<p><code>ChildPropertySetter</code> will insert the child into the parent taking into account if the child belongs to a <code>Collection</code>
or not (in this case <code>employees</code> should be a list of <code>Employee</code> instances in <code>Company</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All 4 strategies have a default implementation that work as expected if
the code follows the usual conventions for writing JavaBeans. In case any of your beans or objects do not follow the convention
you may plug your own implementation of each strategy. For example imagine that you need to build a class which is
immutable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Immutable</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">int</span> age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then if you try to create a <code>Person</code> with the builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> person = builder.person(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jon</span><span style="color:#710">'</span></span>, <span style="color:#606">age</span>:<span style="color:#00D">17</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will fail at runtime with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot set read-only property: name for class: com.acme.Person</pre>
</div>
</div>
<div class="paragraph">
<p>Fixing this can be done by changing the new instance strategy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">builder.newInstanceResolver = { <span style="color:#0a8;font-weight:bold">Class</span> klazz, <span style="color:#0a8;font-weight:bold">Map</span> attributes -&gt;
    <span style="color:#080;font-weight:bold">if</span> (klazz.getConstructor(<span style="color:#0a8;font-weight:bold">Map</span>)) {
        <span style="color:#080;font-weight:bold">def</span> o = klazz.newInstance(attributes)
        attributes.clear()
        <span style="color:#080;font-weight:bold">return</span> o
    }
    klazz.newInstance()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> supports ids per node, meaning
that you can store a reference to a node in the builder. This is
useful when multiple objects reference the same instance. Because a
property named <code>id</code> may be of business meaning in some domain models
<code>ObjectGraphBuilder</code> has a strategy named <code>IdentifierResolver</code> that you
may configure to change the default name value. The same may
happen with the property used for referencing a previously saved
instance, a strategy named <code>ReferenceResolver</code> will yield the
appropriate value (default is `refId'):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> company = builder.company(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ACME</span><span style="color:#710">'</span></span>) {
    address(<span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a1</span><span style="color:#710">'</span></span>, <span style="color:#606">line1</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123 Groovy Rd</span><span style="color:#710">'</span></span>, <span style="color:#606">zip</span>: <span style="color:#00D">12345</span>, <span style="color:#606">state</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">JV</span><span style="color:#710">'</span></span>)          // <b class="conum">(1)</b>
    employee(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Duke</span><span style="color:#710">'</span></span>, <span style="color:#606">employeeId</span>: <span style="color:#00D">1</span>, <span style="color:#606">address</span>: a1)                          // <b class="conum">(2)</b>
    employee(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>, <span style="color:#606">employeeId</span>: <span style="color:#00D">2</span> ){
      address( <span style="color:#606">refId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a1</span><span style="color:#710">'</span></span> )                                                    // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>an address can be created with an <code>id</code></p>
</li>
<li>
<p>an employee can reference the address directly with its id</p>
</li>
<li>
<p>or use the <code>refId</code> attribute corresponding to the <code>id</code> of the corresponding address</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Its worth mentioning that you cannot modify the properties of a
referenced bean.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jmxbuilder"><a class="link" href="#_jmxbuilder">7.8.1.6. JmxBuilder</a></h5>
<div class="paragraph">
<p>See <a href="jmx.html#jmx_jmxbuilder">Working with JMX - JmxBuilder</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_filetreebuilder"><a class="link" href="#_filetreebuilder">7.8.1.7. FileTreeBuilder</a></h5>
<div class="paragraph">
<p>gapi:groovy.util.FileTreeBuilder[FileTreeBuilder] is a builder for generating a file directory structure from a specification. For example, to create the following tree:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> src/
  |--- main
  |     |--- groovy
  |            |--- Foo.groovy
  |--- test
        |--- groovy
               |--- FooTest.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>You can use a <code>FileTreeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tmpDir = <span style="color:#0a8;font-weight:bold">File</span>.createTempDir()
<span style="color:#080;font-weight:bold">def</span> fileTreeBuilder = <span style="color:#080;font-weight:bold">new</span> FileTreeBuilder(tmpDir)
fileTreeBuilder.dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">src</span><span style="color:#710">'</span></span>) {
    dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">main</span><span style="color:#710">'</span></span>) {
       dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">groovy</span><span style="color:#710">'</span></span>) {
          file(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo.groovy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">println &quot;Hello&quot;</span><span style="color:#710">'</span></span>)
       }
    }
    dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test</span><span style="color:#710">'</span></span>) {
       dir(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">groovy</span><span style="color:#710">'</span></span>) {
          file(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FooTest.groovy</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class FooTest extends groovy.test.GroovyTestCase {}</span><span style="color:#710">'</span></span>)
       }
    }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check that everything worked as expected we use the following `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(tmpDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/src/main/groovy/Foo.groovy</span><span style="color:#710">'</span></span>).text == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">println &quot;Hello&quot;</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(tmpDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/src/test/groovy/FooTest.groovy</span><span style="color:#710">'</span></span>).text == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class FooTest extends groovy.test.GroovyTestCase {}</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FileTreeBuilder</code> also supports a shorthand syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">tmpDir = <span style="color:#0a8;font-weight:bold">File</span>.createTempDir()
<span style="color:#080;font-weight:bold">def</span> fileTreeBuilder = <span style="color:#080;font-weight:bold">new</span> FileTreeBuilder(tmpDir)
fileTreeBuilder.src {
    main {
       groovy {
          <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo.groovy</span><span style="color:#710">'</span></span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">println &quot;Hello&quot;</span><span style="color:#710">'</span></span>)
       }
    }
    test {
       groovy {
          <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FooTest.groovy</span><span style="color:#710">'</span></span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class FooTest extends groovy.test.GroovyTestCase {}</span><span style="color:#710">'</span></span>)
       }
    }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces the same directory structure as above, as shown by these `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(tmpDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/src/main/groovy/Foo.groovy</span><span style="color:#710">'</span></span>).text == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">println &quot;Hello&quot;</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(tmpDir, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/src/test/groovy/FooTest.groovy</span><span style="color:#710">'</span></span>).text == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class FooTest extends groovy.test.GroovyTestCase {}</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_builder"><a class="link" href="#_creating_a_builder">7.8.2. Creating a builder</a></h4>
<div class="paragraph">
<p>While Groovy has many built-in builders, the builder pattern is so common,
you will no doubt eventually come across a building requirement that
hasn&#8217;t been catered for by those built-in builders.
The good news is that you can build your own.
You can do everything from scratch by relying on Groovy&#8217;s
metaprogramming capabilities. Alternatively, the <code>BuilderSupport</code>
and <code>FactoryBuilderSupport</code> classes make designing your own
builders much easier.</p>
</div>
<div class="sect4">
<h5 id="_buildersupport"><a class="link" href="#_buildersupport">7.8.2.1. BuilderSupport</a></h5>
<div class="paragraph">
<p>One approach to building a builder is to subclass <code>BuilderSupport</code>.
With this approach, the general idea is to override one or more of a number of
<em>lifecycle</em> methods including <code>setParent</code>, <code>nodeCompleted</code> and some or
all of the <code>createNode</code> methods from the <code>BuilderSupport</code> abstract class.</p>
</div>
<div class="paragraph">
<p>As an example, suppose we want to create a builder of
tracking athletic training programs. Each program is made
up of a number of sets and each set has its own steps.
A step might itself be a set of smaller steps.
For each <code>set</code> or <code>step</code>, we might wish to record
the <code>distance</code> required (or <code>time</code>), whether to <code>repeat</code>
the steps a certain number of times, whether to take a <code>break</code>
between each step and so forth.</p>
</div>
<div class="paragraph">
<p>For the simplicity of this example, we&#8217;ll capture the training
programming using maps and lists. A set has a list of steps.
Information like <code>repeat</code> count or <code>distance</code> will be tracked
in a map of attributes for each step and set.</p>
</div>
<div class="paragraph">
<p>The builder implementation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override a couple of the <code>createNode</code> methods.
We&#8217;ll create a map capturing the set name, an empty list of steps,
and potentially some attributes.</p>
</li>
<li>
<p>Whenever we complete a node we&#8217;ll add the node to the list of steps
for the parent (if any).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TrainingBuilder1</span> <span style="color:#088;font-weight:bold">extends</span> BuilderSupport {
    <span style="color:#088;font-weight:bold">protected</span> createNode(name) {
        [<span style="color:#606">name</span>: name, <span style="color:#606">steps</span>: <span style="color:#339;font-weight:bold">[]</span>]
    }

    <span style="color:#088;font-weight:bold">protected</span> createNode(name, <span style="color:#0a8;font-weight:bold">Map</span> attributes) {
        createNode(name) + attributes
    }

    <span style="color:#339;font-weight:bold">void</span> nodeCompleted(maybeParent, node) {
        <span style="color:#080;font-weight:bold">if</span> (maybeParent) maybeParent.steps &lt;&lt; node
    }

    <span style="color:#777">// unused lifecycle methods</span>
    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#339;font-weight:bold">void</span> setParent(parent, child) { }
    <span style="color:#088;font-weight:bold">protected</span> createNode(name, <span style="color:#0a8;font-weight:bold">Map</span> attributes, value) { }
    <span style="color:#088;font-weight:bold">protected</span> createNode(name, value) { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we&#8217;ll write a little helper method which recursively
adds up the distances of all substeps, accounting for repeated steps
as needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(map) {
    <span style="color:#080;font-weight:bold">if</span> (map.distance) <span style="color:#080;font-weight:bold">return</span> map.distance
    <span style="color:#080;font-weight:bold">def</span> repeat = map.repeat ?: <span style="color:#00D">1</span>
    repeat * map.steps.sum{ total(<span style="color:#950">it</span>) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can now use our builder and helper method to create a
swimming training program and check its total distance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> training = <span style="color:#080;font-weight:bold">new</span> TrainingBuilder1()

<span style="color:#080;font-weight:bold">def</span> monday = training.swimming {
    warmup(<span style="color:#606">repeat</span>: <span style="color:#00D">3</span>) {
        freestyle(<span style="color:#606">distance</span>: <span style="color:#00D">50</span>)
        breaststroke(<span style="color:#606">distance</span>: <span style="color:#00D">50</span>)
    }
    endurance(<span style="color:#606">repeat</span>: <span style="color:#00D">20</span>) {
        freestyle(<span style="color:#606">distance</span>: <span style="color:#00D">50</span>, <span style="color:#080;font-weight:bold">break</span>: <span style="color:#00D">15</span>)
    }
    warmdown {
        kick(<span style="color:#606">distance</span>: <span style="color:#00D">100</span>)
        choice(<span style="color:#606">distance</span>: <span style="color:#00D">100</span>)
    }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">1500</span> == total(monday)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_factorybuildersupport"><a class="link" href="#_factorybuildersupport">7.8.2.2. FactoryBuilderSupport</a></h5>
<div class="paragraph">
<p>A second approach to building a builder is to subclass <code>FactoryBuilderSupport</code>.
This builder has similar goals to <code>BuilderSupport</code> but with extra features
to simplify domain class construction.</p>
</div>
<div class="paragraph">
<p>With this approach, the general idea is to override one or more of a number of
<em>lifecycle</em> methods including <code>resolveFactory</code>, <code>nodeCompleted</code> and <code>postInstantiate</code> methods from the <code>FactoryBuilderSupport</code> abstract class.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll use the same example as for the previous <code>BuilderSupport</code> example;
a builder of tracking athletic training programs.</p>
</div>
<div class="paragraph">
<p>For this example, rather than capturing the training
programming using maps and lists, we&#8217;ll use some simple domain classes.</p>
</div>
<div class="paragraph">
<p>The builder implementation is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Override the <code>resolveFactory</code> method to return a special
factory which returns classes by capitalizing the names used in our mini DSL.</p>
</li>
<li>
<p>Whenever we complete a node we&#8217;ll add the node to the list of steps
for the parent (if any).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code, including the code for the special factory class, looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">org.apache.groovy.util.BeanUtils.capitalize</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TrainingBuilder2</span> <span style="color:#088;font-weight:bold">extends</span> FactoryBuilderSupport {
    <span style="color:#080;font-weight:bold">def</span> factory = <span style="color:#080;font-weight:bold">new</span> TrainingFactory(<span style="color:#606">loader</span>: getClass().classLoader)

    <span style="color:#088;font-weight:bold">protected</span> Factory resolveFactory(name, <span style="color:#0a8;font-weight:bold">Map</span> attrs, value) {
        factory
    }

    <span style="color:#339;font-weight:bold">void</span> nodeCompleted(maybeParent, node) {
        <span style="color:#080;font-weight:bold">if</span> (maybeParent) maybeParent.steps &lt;&lt; node
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TrainingFactory</span> <span style="color:#088;font-weight:bold">extends</span> AbstractFactory {
    <span style="color:#0a8;font-weight:bold">ClassLoader</span> loader
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">newInstance</span>(FactoryBuilderSupport fbs, name, value, <span style="color:#0a8;font-weight:bold">Map</span> attrs) {
        <span style="color:#080;font-weight:bold">def</span> clazz = loader.loadClass(capitalize(name))
        value ? clazz.newInstance(<span style="color:#606">value</span>: value) : clazz.newInstance()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rather than using lists and maps, we&#8217;ll have some simple domain classes
and related traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">trait HasDistance {
    <span style="color:#339;font-weight:bold">int</span> distance
}

trait <span style="color:#0a8;font-weight:bold">Container</span> <span style="color:#088;font-weight:bold">extends</span> HasDistance {
    <span style="color:#0a8;font-weight:bold">List</span> steps = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">int</span> repeat
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Cycling</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Container</span> { }

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Interval</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Container</span> { }

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Sprint</span> <span style="color:#088;font-weight:bold">implements</span> HasDistance {}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Tempo</span> <span style="color:#088;font-weight:bold">implements</span> HasDistance {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like for the <code>BuilderSupport</code> example, it is useful to have a helper method
to calculate the total distance covered during the training session.
The implementation is very similar to our earlier example, but is adjusted
to work well with our newly defined traits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(HasDistance c) {
    c.distance
}

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#0a8;font-weight:bold">Container</span> c) {
    <span style="color:#080;font-weight:bold">if</span> (c.distance) <span style="color:#080;font-weight:bold">return</span> c.distance
    <span style="color:#080;font-weight:bold">def</span> repeat = c.repeat ?: <span style="color:#00D">1</span>
    repeat * c.steps.sum{ total(<span style="color:#950">it</span>) }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can now use our new builder and helper methods to create a
cycling training program and check its total distance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> training = <span style="color:#080;font-weight:bold">new</span> TrainingBuilder2()

<span style="color:#080;font-weight:bold">def</span> tuesday = training.cycling {
    interval(<span style="color:#606">repeat</span>: <span style="color:#00D">5</span>) {
        sprint(<span style="color:#606">distance</span>: <span style="color:#00D">400</span>)
        tempo(<span style="color:#606">distance</span>: <span style="color:#00D">3600</span>)
    }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">20000</span> == total(tuesday)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_集成groovy到java应用中"><a class="link" href="#_集成groovy到java应用中">8. 集成Groovy到Java应用中</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_groovy集成机制"><a class="link" href="#_groovy集成机制">8.1. Groovy集成机制</a></h3>
<div class="paragraph">
<p>The Groovy language proposes several ways to integrate itself into applications (Java or even Groovy) at runtime, from
the most basic, simple code execution to the most complete, integrating caching and compiler customization.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
All the examples written in this section are using Groovy, but the same integration mechanisms can be used from
Java.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="integ-eval"><a class="link" href="#integ-eval">8.1.1. Eval</a></h4>
<div class="paragraph">
<p>The <code>groovy.util.Eval</code> class is the simplest way to execute Groovy dynamically at runtime. This can be done by calling the <code>me</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.util.Eval</span>

<span style="color:#080;font-weight:bold">assert</span> Eval.me(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">33*3</span><span style="color:#710">'</span></span>) == <span style="color:#00D">99</span>
<span style="color:#080;font-weight:bold">assert</span> Eval.me(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&quot;foo&quot;.toUpperCase()</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FOO</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Eval</code> supports multiple variants that accept parameters for simple evaluation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> Eval.x(<span style="color:#00D">4</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2*x</span><span style="color:#710">'</span></span>) == <span style="color:#00D">8</span>                // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">assert</span> Eval.me(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">k</span><span style="color:#710">'</span></span>, <span style="color:#00D">4</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2*k</span><span style="color:#710">'</span></span>) == <span style="color:#00D">8</span>          // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> Eval.xy(<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x*y</span><span style="color:#710">'</span></span>) == <span style="color:#00D">20</span>           // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">assert</span> Eval.xyz(<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x*y+z</span><span style="color:#710">'</span></span>) == <span style="color:#00D">26</span>     // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Simple evaluation with one bound parameter named <code>x</code></p>
</li>
<li>
<p>Same evaluation, with a custom bound parameter named <code>k</code></p>
</li>
<li>
<p>Simple evaluation with two bound parameters named <code>x</code> and <code>y</code></p>
</li>
<li>
<p>Simple evaluation with three bound parameters named <code>x</code>, <code>y</code> and <code>z</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Eval</code> class makes it very easy to evaluate simple scripts, but doesn&#8217;t scale: there is no caching of the script, and
it isn&#8217;t meant to evaluate more than one-liners.</p>
</div>
</div>
<div class="sect3">
<h4 id="integ-groovyshell"><a class="link" href="#integ-groovyshell">8.1.2. GroovyShell</a></h4>
<div class="sect4">
<h5 id="_multiple_sources"><a class="link" href="#_multiple_sources">8.1.2.1. Multiple sources</a></h5>
<div class="paragraph">
<p>The <code>groovy.lang.GroovyShell</code> class is the preferred way to evaluate scripts with the ability to cache the resulting
script instance. Although the <code>Eval</code> class returns the result of the execution of the compiled script, the <code>GroovyShell</code>
class offers more options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell()                           // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> result = shell.evaluate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3*5</span><span style="color:#710">'</span></span>                       // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">def</span> result2 = shell.evaluate(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">StringReader</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3*5</span><span style="color:#710">'</span></span>))   // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">assert</span> result == result2
<span style="color:#080;font-weight:bold">def</span> script = shell.parse <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3*5</span><span style="color:#710">'</span></span>                          // <b class="conum">(4)</b>
<span style="color:#080;font-weight:bold">assert</span> script <span style="color:#080;font-weight:bold">instanceof</span> groovy.lang.Script
<span style="color:#080;font-weight:bold">assert</span> script.run() == <span style="color:#00D">15</span>                               // <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a new <code>GroovyShell</code> instance</p>
</li>
<li>
<p>can be used as <code>Eval</code> with direct execution of the code</p>
</li>
<li>
<p>can read from multiple sources (<code>String</code>, <code>Reader</code>, <code>File</code>, <code>InputStream</code>)</p>
</li>
<li>
<p>can defer execution of the script. <code>parse</code> returns a <code>Script</code> instance</p>
</li>
<li>
<p><code>Script</code> defines a <code>run</code> method</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_sharing_data_between_a_script_and_the_application"><a class="link" href="#_sharing_data_between_a_script_and_the_application">8.1.2.2. Sharing data between a script and the application</a></h5>
<div class="paragraph">
<p>It is possible to share data between the application and the script using a <code>groovy.lang.Binding</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> sharedData = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>()                          // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(sharedData)                 // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">def</span> now = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>()
sharedData.setProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">I am shared data!</span><span style="color:#710">'</span></span>)     // <b class="conum">(3)</b>
sharedData.setProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">date</span><span style="color:#710">'</span></span>, now)                     // <b class="conum">(4)</b>

<span style="color:#0a8;font-weight:bold">String</span> result = shell.evaluate(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&quot;At $date, $text&quot;</span><span style="color:#710">'</span></span>)     // <b class="conum">(5)</b>

<span style="color:#080;font-weight:bold">assert</span> result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">At </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>now</span><span style="color:#D20">, I am shared data!</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a new <code>Binding</code> that will contain shared data</p>
</li>
<li>
<p>create a <code>GroovyShell</code> using this shared data</p>
</li>
<li>
<p>add a string to the binding</p>
</li>
<li>
<p>add a date to the binding (you are not limited to simple types)</p>
</li>
<li>
<p>evaluate the script</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that it is also possible to write from the script into the binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> sharedData = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>()                          // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(sharedData)                 // <b class="conum">(2)</b>

shell.evaluate(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo=123</span><span style="color:#710">'</span></span>)                               // <b class="conum">(3)</b>

<span style="color:#080;font-weight:bold">assert</span> sharedData.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>) == <span style="color:#00D">123</span>             // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a new <code>Binding</code> instance</p>
</li>
<li>
<p>create a new <code>GroovyShell</code> using that shared data</p>
</li>
<li>
<p>use an <strong>undeclared</strong> variable to store the result into the binding</p>
</li>
<li>
<p>read the result from the caller</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is important to understand that you need to use an undeclared variable if you want to write into the binding. Using
<code>def</code> or an <code>explicit</code> type like in the example below would fail because you would then create a <em>local variable</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> sharedData = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>()
<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(sharedData)

shell.evaluate(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">int foo=123</span><span style="color:#710">'</span></span>)

<span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#080;font-weight:bold">assert</span> sharedData.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>)
} <span style="color:#080;font-weight:bold">catch</span> (MissingPropertyException e) {
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo is defined as a local variable</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You must be very careful when using shared data in a multithreaded environment. The <code>Binding</code> instance that
you pass to <code>GroovyShell</code> is <strong>not</strong> thread safe, and shared by all scripts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to work around the shared instance of <code>Binding</code> by leveraging the <code>Script</code> instance which is returned
by <code>parse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell()

<span style="color:#080;font-weight:bold">def</span> b1 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">x</span>:<span style="color:#00D">3</span>)                       // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> b2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">x</span>:<span style="color:#00D">4</span>)                       // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">def</span> script = shell.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x = 2*x</span><span style="color:#710">'</span></span>)
script.binding = b1
script.run()
script.binding = b2
script.run()
<span style="color:#080;font-weight:bold">assert</span> b1.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>) == <span style="color:#00D">6</span>
<span style="color:#080;font-weight:bold">assert</span> b2.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>) == <span style="color:#00D">8</span>
<span style="color:#080;font-weight:bold">assert</span> b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>will store the <code>x</code> variable inside <code>b1</code></p>
</li>
<li>
<p>will store the <code>x</code> variable inside <code>b2</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>However, you must be aware that you are still sharing the <strong>same instance</strong> of a script. So this technique cannot be
used if you have two threads working on the same script. In that case, you must make sure of creating two distinct
script instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell()

<span style="color:#080;font-weight:bold">def</span> b1 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">x</span>:<span style="color:#00D">3</span>)
<span style="color:#080;font-weight:bold">def</span> b2 = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(<span style="color:#606">x</span>:<span style="color:#00D">4</span>)
<span style="color:#080;font-weight:bold">def</span> script1 = shell.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x = 2*x</span><span style="color:#710">'</span></span>)            // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> script2 = shell.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x = 2*x</span><span style="color:#710">'</span></span>)            // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> script1 != script2
script1.binding = b1                            // <b class="conum">(3)</b>
script2.binding = b2                            // <b class="conum">(4)</b>
<span style="color:#080;font-weight:bold">def</span> t1 = <span style="color:#0a8;font-weight:bold">Thread</span>.start { script1.run() }         // <b class="conum">(5)</b>
<span style="color:#080;font-weight:bold">def</span> t2 = <span style="color:#0a8;font-weight:bold">Thread</span>.start { script2.run() }         // <b class="conum">(6)</b>
[t1,t2]*.join()                                 // <b class="conum">(7)</b>
<span style="color:#080;font-weight:bold">assert</span> b1.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>) == <span style="color:#00D">6</span>
<span style="color:#080;font-weight:bold">assert</span> b2.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>) == <span style="color:#00D">8</span>
<span style="color:#080;font-weight:bold">assert</span> b1 != b2</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create an instance of script for thread 1</p>
</li>
<li>
<p>create an instance of script for thread 2</p>
</li>
<li>
<p>assign first binding to script 1</p>
</li>
<li>
<p>assign second binding to script 2</p>
</li>
<li>
<p>start first script in a separate thread</p>
</li>
<li>
<p>start second script in a separate thread</p>
</li>
<li>
<p>wait for completion</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In case you need thread safety like here, it is more advisable to use the <a href="#groovyclassloader">GroovyClassLoader</a>
directly instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_script_class"><a class="link" href="#_custom_script_class">8.1.2.3. Custom script class</a></h5>
<div class="paragraph">
<p>We have seen that the <code>parse</code> method returns an instance of <code>groovy.lang.Script</code>, but it is possible to use a custom
class, given that it extends <code>Script</code> itself. It can be used to provide additional behavior to the script like in
the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyScript</span> <span style="color:#088;font-weight:bold">extends</span> Script {
    <span style="color:#0a8;font-weight:bold">String</span> name

    <span style="color:#0a8;font-weight:bold">String</span> greet() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom class defines a property called <code>name</code> and a new method called <code>greet</code>. This class can be used as the script
base class by using a custom configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.codehaus.groovy.control.CompilerConfiguration</span>

<span style="color:#080;font-weight:bold">def</span> config = <span style="color:#080;font-weight:bold">new</span> CompilerConfiguration()                                    // <b class="conum">(1)</b>
config.scriptBaseClass = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MyScript</span><span style="color:#710">'</span></span>                                         // <b class="conum">(2)</b>

<span style="color:#080;font-weight:bold">def</span> shell = <span style="color:#080;font-weight:bold">new</span> GroovyShell(<span style="color:#950">this</span>.class.classLoader, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>(), config)  // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">def</span> script = shell.parse(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">greet()</span><span style="color:#710">'</span></span>)                                         // <b class="conum">(4)</b>
<span style="color:#080;font-weight:bold">assert</span> script <span style="color:#080;font-weight:bold">instanceof</span> MyScript
script.setName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Michel</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> script.run() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, Michel!</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a <code>CompilerConfiguration</code> instance</p>
</li>
<li>
<p>instruct it to use <code>MyScript</code> as the base class for scripts</p>
</li>
<li>
<p>then use the compiler configuration when you create the shell</p>
</li>
<li>
<p>the script now has access to the new method <code>greet</code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You are not limited to the sole <em>scriptBaseClass</em> configuration. You can use any of the compiler configuration
tweaks, including the <a href="core-domain-specific-languages.html#compilation-customizers">compilation customizers</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="groovyclassloader"><a class="link" href="#groovyclassloader">8.1.3. GroovyClassLoader</a></h4>
<div class="paragraph">
<p>In the <a href="#integ-groovyshell">previous section</a>, we have shown that <code>GroovyShell</code> was an easy tool to execute scripts, but
it makes it complicated to compile anything but scripts. Internally, it makes use of the <code>groovy.lang.GroovyClassLoader</code>,
which is at the heart of the compilation and loading of classes at runtime.</p>
</div>
<div class="paragraph">
<p>By leveraging the <code>GroovyClassLoader</code> instead of <code>GroovyShell</code>, you will be able to load classes, instead of instances
of scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.lang.GroovyClassLoader</span>

<span style="color:#080;font-weight:bold">def</span> gcl = <span style="color:#080;font-weight:bold">new</span> GroovyClassLoader()                                           // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> clazz = gcl.parseClass(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class Foo { void doIt() { println &quot;ok&quot; } }</span><span style="color:#710">'</span></span>)    // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> clazz.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo</span><span style="color:#710">'</span></span>                                                  // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">def</span> o = clazz.newInstance()                                                 // <b class="conum">(4)</b>
o.doIt()                                                                    // <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a new <code>GroovyClassLoader</code></p>
</li>
<li>
<p><code>parseClass</code> will return an instance of <code>Class</code></p>
</li>
<li>
<p>you can check that the class which is returns is really the one defined in the script</p>
</li>
<li>
<p>and you can create a new instance of the class, which is not a script</p>
</li>
<li>
<p>then call any method on it</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A GroovyClassLoader keeps a reference of all the classes it created, so it is easy to create a memory leak. In
particular, if you execute the same script twice, if it is a String, then you obtain two distinct classes!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.lang.GroovyClassLoader</span>

<span style="color:#080;font-weight:bold">def</span> gcl = <span style="color:#080;font-weight:bold">new</span> GroovyClassLoader()
<span style="color:#080;font-weight:bold">def</span> clazz1 = gcl.parseClass(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class Foo { }</span><span style="color:#710">'</span></span>)                                // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> clazz2 = gcl.parseClass(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class Foo { }</span><span style="color:#710">'</span></span>)                                // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> clazz1.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo</span><span style="color:#710">'</span></span>                                                 // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">assert</span> clazz2.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> clazz1 != clazz2                                                     // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>dynamically create a class named "Foo"</p>
</li>
<li>
<p>create an identical looking class, using a separate <code>parseClass</code> call</p>
</li>
<li>
<p>make sure both classes have the same name</p>
</li>
<li>
<p>but they are actually different!</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The reason is that a <code>GroovyClassLoader</code> doesn&#8217;t keep track of the source text. If you want to have the same instance,
then the source <strong>must</strong> be a file, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> gcl = <span style="color:#080;font-weight:bold">new</span> GroovyClassLoader()
<span style="color:#080;font-weight:bold">def</span> clazz1 = gcl.parseClass(file)                                           // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">def</span> clazz2 = gcl.parseClass(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(file.absolutePath))                    // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> clazz1.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo</span><span style="color:#710">'</span></span>                                                 // <b class="conum">(3)</b>
<span style="color:#080;font-weight:bold">assert</span> clazz2.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Foo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">assert</span> clazz1 == clazz2                                                     // <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>parse a class from a <code>File</code></p>
</li>
<li>
<p>parse a class from a distinct file instance, but pointing to the same physical file</p>
</li>
<li>
<p>make sure our classes have the same name</p>
</li>
<li>
<p>but now, they are the same instance</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using a <code>File</code> as input, the <code>GroovyClassLoader</code> is capable of <strong>caching</strong> the generated class file, which avoids
creating multiple classes at runtime for the same source.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovyscriptengine"><a class="link" href="#_groovyscriptengine">8.1.4. GroovyScriptEngine</a></h4>
<div class="paragraph">
<p>The <code>groovy.util.GroovyScriptEngine</code> class provides a flexible foundation for applications which rely on script
reloading and script dependencies. While <code>GroovyShell</code> focuses on standalone <code>Script</code>s and <code>GroovyClassLoader</code> handles
dynamic compilation and loading of any Groovy class, the <code>GroovyScriptEngine</code> will add a layer on top of <code>GroovyClassLoader</code>
to handle both script dependencies and reloading.</p>
</div>
<div class="paragraph">
<p>To illustrate this, we will create a script engine and execute code in an infinite loop. First of all, you need to create
a directory with the following script inside:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#0a8;font-weight:bold">String</span> sayHello() {
        <span style="color:#080;font-weight:bold">def</span> greet = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, world!</span><span style="color:#710">&quot;</span></span>
        greet
    }
}

<span style="color:#080;font-weight:bold">new</span> Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can execute this code using a <code>GroovyScriptEngine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> binding = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Binding</span>()
<span style="color:#080;font-weight:bold">def</span> engine = <span style="color:#080;font-weight:bold">new</span> GroovyScriptEngine([tmpDir.toURI().toURL()] <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">URL</span><span style="color:#339;font-weight:bold">[]</span>)          // <b class="conum">(1)</b>

<span style="color:#080;font-weight:bold">while</span> (<span style="color:#069">true</span>) {
    <span style="color:#080;font-weight:bold">def</span> greeter = engine.run(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ReloadingTest.groovy</span><span style="color:#710">'</span></span>, binding)                   // <b class="conum">(2)</b>
    println greeter.sayHello()                                                  // <b class="conum">(3)</b>
    <span style="color:#0a8;font-weight:bold">Thread</span>.sleep(<span style="color:#00D">1000</span>)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create a script engine which will look for sources into our source directory</p>
</li>
<li>
<p>execute the script, which will return an instance of <code>Greeter</code></p>
</li>
<li>
<p>print the greeting message</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, you should see a message printed every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
Hello, world!
...</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Without</strong> interrupting the script execution, now replace the contents of the <code>ReloadingTest</code> file with:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#0a8;font-weight:bold">String</span> sayHello() {
        <span style="color:#080;font-weight:bold">def</span> greet = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello, Groovy!</span><span style="color:#710">&quot;</span></span>
        greet
    }
}

<span style="color:#080;font-weight:bold">new</span> Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
...
Hello, Groovy!
Hello, Groovy!
...</pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to have a dependency on another script. To illustrate this, create the following file into
the same directory, without interrupting the executing script:</p>
</div>
<div class="listingblock">
<div class="title">Dependency.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Dependency</span> {
    <span style="color:#0a8;font-weight:bold">String</span> message = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, dependency 1</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and update the <code>ReloadingTest</code> script like this:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">Dependency</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Greeter</span> {
    <span style="color:#0a8;font-weight:bold">String</span> sayHello() {
        <span style="color:#080;font-weight:bold">def</span> greet = <span style="color:#080;font-weight:bold">new</span> Dependency().message
        greet
    }
}

<span style="color:#080;font-weight:bold">new</span> Greeter()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this time, the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Groovy!
...
Hello, dependency 1!
Hello, dependency 1!
...</pre>
</div>
</div>
<div class="paragraph">
<p>And as a last test, you can update the <code>Dependency.groovy</code> file without touching the <code>ReloadingTest</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Dependency.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Dependency</span> {
    <span style="color:#0a8;font-weight:bold">String</span> message = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hello, dependency 2</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should observe that the dependent file was reloaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, dependency 1!
...
Hello, dependency 2!
Hello, dependency 2!</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compilationunit"><a class="link" href="#_compilationunit">8.1.5. CompilationUnit</a></h4>
<div class="paragraph">
<p>Ultimately, it is possible to perform more operations during compilation by relying directly on the
<code>org.codehaus.groovy.control.CompilationUnit</code> class. This class is responsible for determining the various steps of
compilation and would let you introduce new steps or even stop compilation at various phases. This is for example how
stub generation is done, for the joint compiler.</p>
</div>
<div class="paragraph">
<p>However, overriding <code>CompilationUnit</code> is not recommended and should only be done if no other standard solution works.</p>
</div>
<div class="paragraph">
<p>Unresolved directive in doc/guide-integrating.adoc - include::../../../subprojects/groovy-jsr223/src/spec/doc/_integrating-jsr223.adoc[leveloffset=+1]</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_patterns_in_groovy"><a class="link" href="#_design_patterns_in_groovy">9. Design patterns in Groovy</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <a href="https://en.wikipedia.org/wiki/Design_pattern_%28computer_science%29">design patterns</a> with Java is a well-established topic.
Design patterns also apply to Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>some patterns carry over directly (and can make use of normal Groovy syntax improvements for greater readability)</p>
</li>
<li>
<p>some patterns are no longer required because they are built right into the language or because Groovy supports a better way of achieving the intent of the pattern</p>
</li>
<li>
<p>some patterns that have to be expressed at the design level in other languages can be implemented directly in Groovy (due to the way Groovy can blur the distinction between design and implementation)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_patterns"><a class="link" href="#_patterns">9.1. Patterns</a></h3>
<div class="sect3">
<h4 id="_abstract_factory_pattern"><a class="link" href="#_abstract_factory_pattern">9.1.1. Abstract Factory Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a> provides a way to encapsulate a group of individual factories that have a common theme. It embodies the intent of a normal factory, i.e. remove the need for code using an interface to know the concrete implementation behind the interface, but applies to a set of interfaces and selects an entire family of concrete classes which implement those interfaces.</p>
</div>
<div class="paragraph">
<p>As an example, I might have interfaces Button, TextField and Scrollbar. I might have WindowsButton, MacButton, FlashButton as concrete classes for Button. I might have WindowsScrollBar, MacScrollBar and FlashScrollBar as concrete implementations for ScrollBar. Using the Abstract Factory Pattern should allow me to select which windowing system (i.e. Windows, Mac, Flash) I want to use once and from then on should be able to write code that references the interfaces but is always using the appropriate concrete classes (all from the one windowing system) under the covers.</p>
</div>
<div class="sect4">
<h5 id="_example"><a class="link" href="#_example">9.1.1.1. Example</a></h5>
<div class="paragraph">
<p>Suppose we want to write a game system. We might note that many games have very similar features and control.</p>
</div>
<div class="paragraph">
<p>We decide to try to split the common and game-specific code into separate classes.</p>
</div>
<div class="paragraph">
<p>First let&#8217;s look at the game-specific code for a <a href="http://en.wikipedia.org/wiki/Two-Up">Two-up</a> game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TwoupMessages</span> {
    <span style="color:#080;font-weight:bold">def</span> welcome = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Welcome to the twoup game, you start with $1000</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> done = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sorry, you have no money left, goodbye</span><span style="color:#710">'</span></span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TwoupInputConverter</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">convert</span>(input) { input.toInteger() }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TwoupControl</span> {
    <span style="color:#088;font-weight:bold">private</span> money = <span style="color:#00D">1000</span>
    <span style="color:#088;font-weight:bold">private</span> random = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Random</span>()
    <span style="color:#088;font-weight:bold">private</span> tossWasHead() {
        <span style="color:#080;font-weight:bold">def</span> next = random.nextInt()
        <span style="color:#080;font-weight:bold">return</span> next % <span style="color:#00D">2</span> == <span style="color:#00D">0</span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">moreTurns</span>() {
        <span style="color:#080;font-weight:bold">if</span> (money &gt; <span style="color:#00D">0</span>) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">You have </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>money</span><span style="color:#D20">, how much would you like to bet?</span><span style="color:#710">&quot;</span></span>
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">true</span>
        }

        <span style="color:#069">false</span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">play</span>(amount) {
        <span style="color:#080;font-weight:bold">def</span> coin1 = tossWasHead()
        <span style="color:#080;font-weight:bold">def</span> coin2 = tossWasHead()
        <span style="color:#080;font-weight:bold">if</span> (coin1 &amp;&amp; coin2) {
            money += amount
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">You win</span><span style="color:#710">'</span></span>
        } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (!coin1 &amp;&amp; !coin2) {
            money -= amount
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">You lose</span><span style="color:#710">'</span></span>
        } <span style="color:#080;font-weight:bold">else</span> {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Draw</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s look at the game-specific code for a number guessing game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GuessGameMessages</span> {
    <span style="color:#080;font-weight:bold">def</span> welcome = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Welcome to the guessing game, my secret number is between 1 and 100</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> done = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Correct</span><span style="color:#710">'</span></span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GuessGameInputConverter</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">convert</span>(input) { input.toInteger() }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GuessGameControl</span> {
    <span style="color:#088;font-weight:bold">private</span> lower = <span style="color:#00D">1</span>
    <span style="color:#088;font-weight:bold">private</span> upper = <span style="color:#00D">100</span>
    <span style="color:#088;font-weight:bold">private</span> guess = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Random</span>().nextInt(upper - lower) + lower
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">moreTurns</span>() {
        <span style="color:#080;font-weight:bold">def</span> done = (lower == guess || upper == guess)
        <span style="color:#080;font-weight:bold">if</span> (!done) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Enter a number between </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>lower</span><span style="color:#D20"> and </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>upper</span><span style="color:#710">&quot;</span></span>
        }

        !done
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">play</span>(nextGuess) {
        <span style="color:#080;font-weight:bold">if</span> (nextGuess &lt;= guess) {
            lower = [lower, nextGuess].max()
        }
        <span style="color:#080;font-weight:bold">if</span> (nextGuess &gt;= guess) {
            upper = [upper, nextGuess].min()
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s write our factory code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> guessFactory = [<span style="color:#606">messages</span>: GuessGameMessages, <span style="color:#606">control</span>: GuessGameControl, <span style="color:#606">converter</span>: GuessGameInputConverter]
<span style="color:#080;font-weight:bold">def</span> twoupFactory = [<span style="color:#606">messages</span>: TwoupMessages, <span style="color:#606">control</span>: TwoupControl, <span style="color:#606">converter</span>: TwoupInputConverter]

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GameFactory</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#088;font-weight:bold">static</span> factory
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#06B;font-weight:bold">getMessages</span>() { <span style="color:#080;font-weight:bold">return</span> factory.messages.newInstance() }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#06B;font-weight:bold">getControl</span>() { <span style="color:#080;font-weight:bold">return</span> factory.control.newInstance() }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#06B;font-weight:bold">getConverter</span>() { <span style="color:#080;font-weight:bold">return</span> factory.converter.newInstance() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The important aspect of this factory is that it allows selection of an entire family of concrete classes.</p>
</div>
<div class="paragraph">
<p>Here is how we would use the factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">GameFactory.factory = twoupFactory
<span style="color:#080;font-weight:bold">def</span> messages = GameFactory.messages
<span style="color:#080;font-weight:bold">def</span> control = GameFactory.control
<span style="color:#080;font-weight:bold">def</span> converter = GameFactory.converter
println messages.welcome
<span style="color:#080;font-weight:bold">def</span> reader = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">BufferedReader</span>(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">InputStreamReader</span>(<span style="color:#0a8;font-weight:bold">System</span>.in))
<span style="color:#080;font-weight:bold">while</span> (control.moreTurns()) {
    <span style="color:#080;font-weight:bold">def</span> input = reader.readLine().trim()
    control.play(converter.convert(input))
}
println messages.done</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first line configures which family of concrete game classes we will use. It&#8217;s not important that we selected which family to use by using the factory property as shown in the first line. Other ways would be equally valid examples of this pattern. For example, we may have asked the user which game they wanted to play or determined which game from an environment setting.</p>
</div>
<div class="paragraph">
<p>With the code as shown, the game might look like this when run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the twoup game, you start with $1000
You have 1000, how much would you like to bet?
300
Draw
You have 1000, how much would you like to bet?
700
You win
You have 1700, how much would you like to bet?
1700
You lose
Sorry, you have no money left, goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>If we change the first line of the script to GameFactory.factory = guessFactory, then the sample run might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the guessing game, my secret number is between 1 and 100
Enter a number between 1 and 100
75
Enter a number between 1 and 75
35
Enter a number between 1 and 35
15
Enter a number between 1 and 15
5
Enter a number between 5 and 15
10
Correct</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adapter_pattern"><a class="link" href="#_adapter_pattern">9.1.2. Adapter Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter Pattern</a> (sometimes called the wrapper pattern) allows objects satisfying one interface to be used where another type of interface is expected. There are two typical flavours of the pattern: the <em>delegation</em> flavour and the <em>inheritance</em> flavour.</p>
</div>
<div class="sect4">
<h5 id="_delegation_example"><a class="link" href="#_delegation_example">9.1.2.1. Delegation Example</a></h5>
<div class="paragraph">
<p>Suppose we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SquarePeg</span> {
    <span style="color:#080;font-weight:bold">def</span> width
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">RoundPeg</span> {
    <span style="color:#080;font-weight:bold">def</span> radius
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">RoundHole</span> {
    <span style="color:#080;font-weight:bold">def</span> radius
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pegFits</span>(peg) {
        peg.radius &lt;= radius
    }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RoundHole with radius </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>radius</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask the <code>RoundHole</code> class if a <code>RoundPeg</code> fits in it, but if we ask the same question for a <code>SquarePeg</code>, then it will fail because the <code>SquarePeg</code> class doesn&#8217;t have a <code>radius</code> property (i.e. doesn&#8217;t satisfy the required interface).</p>
</div>
<div class="paragraph">
<p>To get around this problem, we can create an adapter to make it appear to have the correct interface. It would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SquarePegAdapter</span> {
    <span style="color:#080;font-weight:bold">def</span> peg
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getRadius</span>() {
        <span style="color:#0a8;font-weight:bold">Math</span>.sqrt(((peg.width / <span style="color:#00D">2</span>) ** <span style="color:#00D">2</span>) * <span style="color:#00D">2</span>)
    }
    <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SquarePegAdapter with peg width </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>peg</span><span style="color:#D20">.width (and notional radius </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>radius</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the adapter like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> hole = <span style="color:#080;font-weight:bold">new</span> RoundHole(<span style="color:#606">radius</span>: <span style="color:#60E">4.0</span>)
(<span style="color:#00D">4</span>..<span style="color:#00D">7</span>).each { w -&gt;
    <span style="color:#080;font-weight:bold">def</span> peg = <span style="color:#080;font-weight:bold">new</span> SquarePegAdapter(<span style="color:#606">peg</span>: <span style="color:#080;font-weight:bold">new</span> SquarePeg(<span style="color:#606">width</span>: w))
    <span style="color:#080;font-weight:bold">if</span> (hole.pegFits(peg)) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">peg </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>peg</span><span style="color:#D20"> fits in hole </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>hole</span><span style="color:#710">&quot;</span></span>
    } <span style="color:#080;font-weight:bold">else</span> {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">peg </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>peg</span><span style="color:#D20"> does not fit in hole </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>hole</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with peg width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance_example"><a class="link" href="#_inheritance_example">9.1.2.2. Inheritance Example</a></h5>
<div class="paragraph">
<p>Let&#8217;s consider the same example again using inheritance. First, here are the original classes (unchanged):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SquarePeg</span> {
    <span style="color:#080;font-weight:bold">def</span> width
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">RoundPeg</span> {
    <span style="color:#080;font-weight:bold">def</span> radius
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">RoundHole</span> {
    <span style="color:#080;font-weight:bold">def</span> radius
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pegFits</span>(peg) {
        peg.radius &lt;= radius
    }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RoundHole with radius </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>radius</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An adapter using inheritance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SquarePegAdapter</span> <span style="color:#088;font-weight:bold">extends</span> SquarePeg {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getRadius</span>() {
        <span style="color:#0a8;font-weight:bold">Math</span>.sqrt(((width / <span style="color:#00D">2</span>) ** <span style="color:#00D">2</span>) * <span style="color:#00D">2</span>)
    }
    <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SquarePegAdapter with width </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>width</span><span style="color:#D20"> (and notional radius </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>radius</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> hole = <span style="color:#080;font-weight:bold">new</span> RoundHole(<span style="color:#606">radius</span>: <span style="color:#60E">4.0</span>)
(<span style="color:#00D">4</span>..<span style="color:#00D">7</span>).each { w -&gt;
    <span style="color:#080;font-weight:bold">def</span> peg = <span style="color:#080;font-weight:bold">new</span> SquarePegAdapter(<span style="color:#606">width</span>: w)
    <span style="color:#080;font-weight:bold">if</span> (hole.pegFits(peg)) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">peg </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>peg</span><span style="color:#D20"> fits in hole </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>hole</span><span style="color:#710">&quot;</span></span>
    } <span style="color:#080;font-weight:bold">else</span> {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">peg </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>peg</span><span style="color:#D20"> does not fit in hole </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>hole</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adapting_using_closures"><a class="link" href="#_adapting_using_closures">9.1.2.3. Adapting using Closures</a></h5>
<div class="paragraph">
<p>As a variation of the previous examples, we could instead define the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> RoundThing {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getRadius</span>()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then define an adapter as a closure as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> adapter = {
    p -&gt; [<span style="color:#606">getRadius</span>: { <span style="color:#0a8;font-weight:bold">Math</span>.sqrt(((p.width / <span style="color:#00D">2</span>) ** <span style="color:#00D">2</span>) * <span style="color:#00D">2</span>) }] <span style="color:#080;font-weight:bold">as</span> RoundThing
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> peg = <span style="color:#080;font-weight:bold">new</span> SquarePeg(<span style="color:#606">width</span>: <span style="color:#00D">4</span>)
<span style="color:#080;font-weight:bold">if</span> (hole.pegFits(adapter(peg))) {
    <span style="color:#777">// ... as before</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adapting_using_the_expandometaclass"><a class="link" href="#_adapting_using_the_expandometaclass">9.1.2.4. Adapting using the ExpandoMetaClass</a></h5>
<div class="paragraph">
<p>As of Groovy 1.1, there is a built-in MetaClass which can automatically add properties and methods dynamically.</p>
</div>
<div class="paragraph">
<p>Here is how the example would work using that feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> peg = <span style="color:#080;font-weight:bold">new</span> SquarePeg(<span style="color:#606">width</span>: <span style="color:#00D">4</span>)
peg.metaClass.radius = <span style="color:#0a8;font-weight:bold">Math</span>.sqrt(((peg.width / <span style="color:#00D">2</span>) ** <span style="color:#00D">2</span>) * <span style="color:#00D">2</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you create a peg object, you can simply add a property to it on the fly. No need to change the original class and no need for an adapter class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bouncer_pattern"><a class="link" href="#_bouncer_pattern">9.1.3. Bouncer Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://www.c2.com/cgi/wiki?BouncerPattern">Bouncer Pattern</a> describes usage of a method whose sole purpose is to either throw an exception (when particular conditions hold) or do nothing. Such methods are often used to defensively guard pre-conditions of a method.</p>
</div>
<div class="paragraph">
<p>When writing utility methods, you should always guard against faulty input arguments. When writing internal methods, you may be able to ensure that certain pre-conditions always hold by having sufficient unit tests in place. Under such circumstances, you may reduce the desirability to have guards on your methods.</p>
</div>
<div class="paragraph">
<p>Groovy differs from other languages in that you frequently use the <code>assert</code> method within your methods rather than having a large number of utility checker methods or classes.</p>
</div>
<div class="sect4">
<h5 id="_null_checking_example"><a class="link" href="#_null_checking_example">9.1.3.1. Null Checking Example</a></h5>
<div class="paragraph">
<p>We might have a utility method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NullChecker</span> {
    <span style="color:#088;font-weight:bold">static</span> check(name, arg) {
        <span style="color:#080;font-weight:bold">if</span> (arg == <span style="color:#069">null</span>) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalArgumentException</span>(name + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> is null</span><span style="color:#710">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> doStuff(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> value) {
    NullChecker.check(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name</span><span style="color:#710">'</span></span>, name)
    NullChecker.check(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value</span><span style="color:#710">'</span></span>, value)
    <span style="color:#777">// do stuff</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But a more Groovy way to do this would simply be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> doStuff(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> value) {
    <span style="color:#080;font-weight:bold">assert</span> name != <span style="color:#069">null</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name should not be null</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">assert</span> value != <span style="color:#069">null</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">value should not be null</span><span style="color:#710">'</span></span>
    <span style="color:#777">// do stuff</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_validation_example"><a class="link" href="#_validation_example">9.1.3.2. Validation Example</a></h5>
<div class="paragraph">
<p>As an alternative example, we might have this utility method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NumberChecker</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> NUMBER_PATTERN = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\\</span><span style="color:#b0b">\\</span><span style="color:#D20">d+(</span><span style="color:#b0b">\\</span><span style="color:#b0b">\\</span><span style="color:#D20">.</span><span style="color:#b0b">\\</span><span style="color:#b0b">\\</span><span style="color:#D20">d+(E-?</span><span style="color:#b0b">\\</span><span style="color:#b0b">\\</span><span style="color:#D20">d+)?)?</span><span style="color:#710">&quot;</span></span>
    <span style="color:#088;font-weight:bold">static</span> isNumber(str) {
        <span style="color:#080;font-weight:bold">if</span> (!str ==~ NUMBER_PATTERN) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalArgumentException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Argument '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>str</span><span style="color:#D20">' must be a number</span><span style="color:#710">&quot;</span></span>)
        }
    }
    <span style="color:#088;font-weight:bold">static</span> isNotZero(number) {
        <span style="color:#080;font-weight:bold">if</span> (number == <span style="color:#00D">0</span>) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalArgumentException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Argument must not be 0</span><span style="color:#710">'</span></span>)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">stringDivide</span>(<span style="color:#0a8;font-weight:bold">String</span> dividendStr, <span style="color:#0a8;font-weight:bold">String</span> divisorStr) {
    NumberChecker.isNumber(dividendStr)
    NumberChecker.isNumber(divisorStr)
    <span style="color:#080;font-weight:bold">def</span> dividend = dividendStr.toDouble()
    <span style="color:#080;font-weight:bold">def</span> divisor = divisorStr.toDouble()
    NumberChecker.isNotZero(divisor)
    dividend / divisor
}

println stringDivide(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1.2E2</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3.0</span><span style="color:#710">'</span></span>)
<span style="color:#777">// =&gt; 40.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But with Groovy we could just as easily use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">stringDivide</span>(<span style="color:#0a8;font-weight:bold">String</span> dividendStr, <span style="color:#0a8;font-weight:bold">String</span> divisorStr) {
    <span style="color:#080;font-weight:bold">assert</span> dividendStr =~ NumberChecker.NUMBER_PATTERN
    <span style="color:#080;font-weight:bold">assert</span> divisorStr =~ NumberChecker.NUMBER_PATTERN
    <span style="color:#080;font-weight:bold">def</span> dividend = dividendStr.toDouble()
    <span style="color:#080;font-weight:bold">def</span> divisor = divisorStr.toDouble()
    <span style="color:#080;font-weight:bold">assert</span> divisor != <span style="color:#00D">0</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Divisor must not be 0</span><span style="color:#710">'</span></span>
    dividend / divisor
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_chain_of_responsibility_pattern"><a class="link" href="#_chain_of_responsibility_pattern">9.1.4. Chain of Responsibility Pattern</a></h4>
<div class="paragraph">
<p>In the Chain of Responsibility Pattern, objects using and implementing an interface (one or more methods) are intentionally loosely coupled. A set of objects that <em>implement</em> the interface are organised in a list (or in rare cases a tree). Objects using the interface make requests from the first <em>implementor</em> object. It will decide whether to perform any action itself and whether to pass the request further down the line in the list (or tree). Sometimes a default implementation for some request is also coded into the pattern if none of the implementors respond to the request.</p>
</div>
<div class="sect4">
<h5 id="_example_using_traditional_classes"><a class="link" href="#_example_using_traditional_classes">9.1.4.1. Example using traditional classes</a></h5>
<div class="paragraph">
<p>In this example, the script sends requests to the <code>lister</code> object. The <code>lister</code> points to a <code>UnixLister</code> object. If it can&#8217;t handle the request, it sends the request to the <code>WindowsLister</code>. If it can&#8217;t handle the request, it sends the request to the <code>DefaultLister</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UnixLister</span> {
    <span style="color:#088;font-weight:bold">private</span> nextInLine
    UnixLister(next) { nextInLine = next }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">listFiles</span>(dir) {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Linux</span><span style="color:#710">'</span></span>) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
        } <span style="color:#080;font-weight:bold">else</span> {
            nextInLine.listFiles(dir)
        }
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">WindowsLister</span> {
    <span style="color:#088;font-weight:bold">private</span> nextInLine
    WindowsLister(next) { nextInLine = next }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">listFiles</span>(dir) {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>).startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Windows</span><span style="color:#710">'</span></span>)) {
            println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd.exe /c dir </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
        } <span style="color:#080;font-weight:bold">else</span> {
            nextInLine.listFiles(dir)
        }
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DefaultLister</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">listFiles</span>(dir) {
        <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(dir).eachFile { f -&gt; println f }
    }
}

<span style="color:#080;font-weight:bold">def</span> lister = <span style="color:#080;font-weight:bold">new</span> UnixLister(<span style="color:#080;font-weight:bold">new</span> WindowsLister(<span style="color:#080;font-weight:bold">new</span> DefaultLister()))

lister.listFiles(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Downloads</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be a list of files (with slightly different format depending on the operating system).</p>
</div>
<div class="paragraph">
<p>Here is a UML representation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ChainOfResponsibilityClasses.png" alt="ChainOfResponsibilityClasses" width="478" height="361">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_using_simplifying_strategies"><a class="link" href="#_example_using_simplifying_strategies">9.1.4.2. Example using simplifying strategies</a></h5>
<div class="paragraph">
<p>For simple cases, consider simplifying your code by not requiring the chain of classes.
Instead, use Groovy truth and the elvis operator as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span> unixListFiles(dir) {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Linux</span><span style="color:#710">'</span></span>) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
    }
}

<span style="color:#0a8;font-weight:bold">String</span> windowsListFiles(dir) {
    <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>).startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Windows</span><span style="color:#710">'</span></span>)) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd.exe /c dir </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
    }
}

<span style="color:#0a8;font-weight:bold">String</span> defaultListFiles(dir) {
    <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(dir).listFiles().collect{ f -&gt; f.name }.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">'</span></span>)
}

<span style="color:#080;font-weight:bold">def</span> dir = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Downloads</span><span style="color:#710">'</span></span>
println unixListFiles(dir) ?: windowsListFiles(dir) ?: defaultListFiles(dir)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or Groovy&#8217;s switch as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span> listFiles(dir) {
    <span style="color:#080;font-weight:bold">switch</span>(dir) {
    <span style="color:#080;font-weight:bold">case</span> { <span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Linux</span><span style="color:#710">'</span></span> }:
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
    <span style="color:#080;font-weight:bold">case</span> { <span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>).startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Windows</span><span style="color:#710">'</span></span>) }:
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd.exe /c dir </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>dir</span><span style="color:#710">&quot;</span></span>.execute().text
    <span style="color:#080;font-weight:bold">default</span>:
        <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(dir).listFiles().collect{ f -&gt; f.name }.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">'</span></span>)
    }
}

println listFiles(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Downloads</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, for Groovy 3+, consider using streams of lambdas as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Optional&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; unixListFiles(<span style="color:#0a8;font-weight:bold">String</span> dir) {
    Optional.ofNullable(dir)
        .filter(d -&gt; <span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Linux</span><span style="color:#710">'</span></span>)
        .map(d -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ls </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>d</span><span style="color:#710">&quot;</span></span>.execute().text)
}

Optional&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; windowsListFiles(<span style="color:#0a8;font-weight:bold">String</span> dir) {
    Optional.ofNullable(dir)
        .filter(d -&gt; <span style="color:#0a8;font-weight:bold">System</span>.getProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">os.name</span><span style="color:#710">'</span></span>).startsWith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Windows</span><span style="color:#710">'</span></span>))
        .map(d -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cmd.exe /c dir </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>d</span><span style="color:#710">&quot;</span></span>.execute().text)
}

Optional&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; defaultListFiles(<span style="color:#0a8;font-weight:bold">String</span> dir) {
    Optional.ofNullable(dir)
        .map(d -&gt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(d).listFiles().collect{ f -&gt; f.name }.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">'</span></span>))
}

<span style="color:#080;font-weight:bold">def</span> dir = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Downloads</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">def</span> handlers = [<span style="color:#950">this</span>::unixListFiles, <span style="color:#950">this</span>::windowsListFiles, <span style="color:#950">this</span>::defaultListFiles]
println handlers.stream()
    .map(f -&gt; f(dir))
    .filter(<span style="color:#606">Optional</span>::isPresent)
    .map(<span style="color:#606">Optional</span>::get)
    .findFirst()
    .get()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_when_not_to_use"><a class="link" href="#_when_not_to_use">9.1.4.3. When not to use</a></h5>
<div class="paragraph">
<p>If your use of chain of responsibility involves frequent use of the <code>instanceof</code> operator, like here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">Math.PI</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">π</span>
<span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Shape</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Polygon</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#339;font-weight:bold">double</span> lengthSide
    <span style="color:#339;font-weight:bold">int</span> numSides
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Circle</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#339;font-weight:bold">double</span> radius
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CircleAreaCalculator</span> {
    <span style="color:#080;font-weight:bold">def</span> next
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">area</span>(shape) {
        <span style="color:#080;font-weight:bold">if</span> (shape <span style="color:#080;font-weight:bold">instanceof</span> Circle) {            // <b class="conum">(1)</b>
            <span style="color:#080;font-weight:bold">return</span> shape.radius ** <span style="color:#00D">2</span> * π
        } <span style="color:#080;font-weight:bold">else</span> {
            next.area(shape)
        }
    }
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SquareAreaCalculator</span> {
    <span style="color:#080;font-weight:bold">def</span> next
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">area</span>(shape) {
        <span style="color:#080;font-weight:bold">if</span> (shape <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Polygon</span> &amp;&amp; shape.numSides == <span style="color:#00D">4</span>) {      // <b class="conum">(1)</b>
            <span style="color:#080;font-weight:bold">return</span> shape.lengthSide ** <span style="color:#00D">2</span>
        } <span style="color:#080;font-weight:bold">else</span> {
            next.area(shape)
        }
    }
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DefaultAreaCalculator</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">area</span>(shape) {
        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalArgumentException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Don't know how to calculate area for </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>shape</span><span style="color:#710">&quot;</span></span>)
    }
}

<span style="color:#080;font-weight:bold">def</span> chain = <span style="color:#080;font-weight:bold">new</span> CircleAreaCalculator(<span style="color:#606">next</span>: <span style="color:#080;font-weight:bold">new</span> SquareAreaCalculator(<span style="color:#606">next</span>: <span style="color:#080;font-weight:bold">new</span> DefaultAreaCalculator()))
<span style="color:#080;font-weight:bold">def</span> shapes = [
    <span style="color:#080;font-weight:bold">new</span> Circle(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Circle</span><span style="color:#710">'</span></span>, <span style="color:#606">radius</span>: <span style="color:#60E">5.0</span>),
    <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Polygon</span>(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Square</span><span style="color:#710">'</span></span>, <span style="color:#606">lengthSide</span>: <span style="color:#60E">10.0</span>, <span style="color:#606">numSides</span>: <span style="color:#00D">4</span>)
]
shapes.each { println chain.area(<span style="color:#950">it</span>) }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>instanceof code smell</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It could indicate that instead of using the chain of responsibility pattern, you might consider
using richer types, perhaps in combination with Groovy&#8217;s multimethods. For example, perhaps this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// ...</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Square</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Polygon</span> {
    <span style="color:#777">// ...</span>
}

<span style="color:#339;font-weight:bold">double</span> area(Circle c) {
    c.radius ** <span style="color:#00D">2</span> * π
}

<span style="color:#339;font-weight:bold">double</span> area(Square s) {
    s.lengthSide ** <span style="color:#00D">2</span>
}

<span style="color:#080;font-weight:bold">def</span> shapes = [
    <span style="color:#080;font-weight:bold">new</span> Circle(<span style="color:#606">radius</span>: <span style="color:#60E">5.0</span>),
    <span style="color:#080;font-weight:bold">new</span> Square(<span style="color:#606">lengthSide</span>: <span style="color:#60E">10.0</span>, <span style="color:#606">numSides</span>: <span style="color:#00D">4</span>)
]
shapes.each { println area(<span style="color:#950">it</span>) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using more traditional object-oriented style like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">Math.PI</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">π</span>
<span style="color:#339;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#339;font-weight:bold">double</span> area()
}
<span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Polygon</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#339;font-weight:bold">double</span> lengthSide
    <span style="color:#339;font-weight:bold">int</span> numSides
    <span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">double</span> area()
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Circle</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#339;font-weight:bold">double</span> radius
    <span style="color:#339;font-weight:bold">double</span> area() {
        radius ** <span style="color:#00D">2</span> * π
    }
}
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Square</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Polygon</span> {
    <span style="color:#777">// ...</span>
    <span style="color:#339;font-weight:bold">double</span> area() {
        lengthSide ** <span style="color:#00D">2</span>
    }
}

<span style="color:#080;font-weight:bold">def</span> shapes = [
    <span style="color:#080;font-weight:bold">new</span> Circle(<span style="color:#606">radius</span>: <span style="color:#60E">5.0</span>),
    <span style="color:#080;font-weight:bold">new</span> Square(<span style="color:#606">lengthSide</span>: <span style="color:#60E">10.0</span>, <span style="color:#606">numSides</span>: <span style="color:#00D">4</span>)
]
shapes.each { println <span style="color:#950">it</span>.area() }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_going_further"><a class="link" href="#_going_further">9.1.4.4. Going further</a></h5>
<div class="paragraph">
<p>Other variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we could have an explicit interface in the traditional example, e.g. <code>Lister</code>, to statically type the implementations but because of <em>duck-typing</em> this is optional</p>
</li>
<li>
<p>we could use a chain tree instead of a list, e.g. <code>if (animal.hasBackbone())</code> delegate to <code>VertebrateHandler</code> else delegate to <code>InvertebrateHandler</code></p>
</li>
<li>
<p>we could always pass down the chain even if we processed a request (no early return)</p>
</li>
<li>
<p>we could decide at some point to not respond and not pass down the chain (pre-emptive abort)</p>
</li>
<li>
<p>we could use Groovy’s meta-programming capabilities to pass unknown methods down the chain, e.g. combine
chain of responsibility with the use of <code>methodMissing</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_command_pattern"><a class="link" href="#_command_pattern">9.1.5. Command Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Command_pattern">Command Pattern</a> is a pattern for
loosely coupling a client object which wants to execute a series of commands and
receiver objects which enact those commands.
Instead of talking to receivers directly, clients interact with an intermediary object
which then relays the necessary commands to the receivers.
The pattern is in common use within the JDK, for example the api:javax.swing.Action[] class in Swing
decouples swing code from receivers like buttons, menu items and panels.</p>
</div>
<div class="paragraph">
<p>The class diagram showing the typical classes is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="CommandClasses.png" alt="CommandClasses" width="565" height="190">
</div>
</div>
<div class="paragraph">
<p>The sequence of interactions is as shown below for an arbitrary receiver:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="CommandSequence.png" alt="CommandSequence" width="244" height="157">
</div>
</div>
<div class="sect4">
<h5 id="_example_with_traditional_classes"><a class="link" href="#_example_with_traditional_classes">9.1.5.1. Example with traditional classes</a></h5>
<div class="paragraph">
<p>The relevant classes required for turning a light on and off (see the example in the earlier wikipedia reference)
would be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Command {
    <span style="color:#339;font-weight:bold">void</span> execute()
}

<span style="color:#777">// invoker class</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Switch</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, Command&gt; commandMap = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;&gt;()

    <span style="color:#339;font-weight:bold">void</span> register(<span style="color:#0a8;font-weight:bold">String</span> commandName, Command command) {
        commandMap[commandName] = command
    }

    <span style="color:#339;font-weight:bold">void</span> execute(<span style="color:#0a8;font-weight:bold">String</span> commandName) {
        Command command = commandMap[commandName]
        <span style="color:#080;font-weight:bold">if</span> (!command) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalStateException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">no command registered for </span><span style="color:#710">&quot;</span></span> + commandName)
        }
        command.execute()
    }
}

<span style="color:#777">// receiver class</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Light</span> {
    <span style="color:#339;font-weight:bold">void</span> turnOn() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The light is on</span><span style="color:#710">&quot;</span></span>
    }

    <span style="color:#339;font-weight:bold">void</span> turnOff() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The light is off</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SwitchOnCommand</span> <span style="color:#088;font-weight:bold">implements</span> Command {
    Light light

    <span style="color:#007">@Override</span> <span style="color:#777">// Command</span>
    <span style="color:#339;font-weight:bold">void</span> execute() {
        light.turnOn()
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SwitchOffCommand</span> <span style="color:#088;font-weight:bold">implements</span> Command {
    Light light

    <span style="color:#007">@Override</span> <span style="color:#777">// Command</span>
    <span style="color:#339;font-weight:bold">void</span> execute() {
        light.turnOff()
    }
}

Light lamp = <span style="color:#080;font-weight:bold">new</span> Light()
Command switchOn = <span style="color:#080;font-weight:bold">new</span> SwitchOnCommand(<span style="color:#606">light</span>: lamp)
Command switchOff = <span style="color:#080;font-weight:bold">new</span> SwitchOffCommand(<span style="color:#606">light</span>: lamp)

Switch mySwitch = <span style="color:#080;font-weight:bold">new</span> Switch()
mySwitch.register(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">on</span><span style="color:#710">&quot;</span></span>, switchOn)
mySwitch.register(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">off</span><span style="color:#710">&quot;</span></span>, switchOff)

mySwitch.execute(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">on</span><span style="color:#710">&quot;</span></span>)
mySwitch.execute(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">off</span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our client scripts sends <code>execute</code> commands to an intermediary and knows nothing
about any specific receivers, or any specific action method names and arguments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simplifying_variations"><a class="link" href="#_simplifying_variations">9.1.5.2. Simplifying variations</a></h5>
<div class="paragraph">
<p>Given that Groovy has first-class function support, we can do away with the
actual command classes (like <code>SwitchOnCommand</code>) by instead using closures as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Command {
    <span style="color:#339;font-weight:bold">void</span> execute()
}

<span style="color:#777">// invoker class</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Switch</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, Command&gt; commandMap = [:]

    <span style="color:#339;font-weight:bold">void</span> register(<span style="color:#0a8;font-weight:bold">String</span> commandName, Command command) {
        commandMap[commandName] = command
    }

    <span style="color:#339;font-weight:bold">void</span> execute(<span style="color:#0a8;font-weight:bold">String</span> commandName) {
        Command command = commandMap[commandName]
        <span style="color:#080;font-weight:bold">if</span> (!command) {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">IllegalStateException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">no command registered for </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>commandName</span><span style="color:#710">&quot;</span></span>)
        }
        command.execute()
    }
}

<span style="color:#777">// receiver class</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Light</span> {
    <span style="color:#339;font-weight:bold">void</span> turnOn() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The light is on</span><span style="color:#710">'</span></span>
    }

    <span style="color:#339;font-weight:bold">void</span> turnOff() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The light is off</span><span style="color:#710">'</span></span>
    }
}

Light lamp = <span style="color:#080;font-weight:bold">new</span> Light()

Switch mySwitch = <span style="color:#080;font-weight:bold">new</span> Switch()
mySwitch.register(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">on</span><span style="color:#710">&quot;</span></span>, lamp.&amp;turnOn)       // <b class="conum">(1)</b>
mySwitch.register(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">off</span><span style="color:#710">&quot;</span></span>, lamp.&amp;turnOff)     // <b class="conum">(1)</b>

mySwitch.execute(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">on</span><span style="color:#710">&quot;</span></span>)
mySwitch.execute(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">off</span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Command closures (here method closures) but could be lambdas/method references for Groovy 3+</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can simplify further using the JDK&#8217;s existing <code>Runnable</code> interface
and using a switch map rather than a separate <code>Switch</code> class as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Light</span> {
    <span style="color:#339;font-weight:bold">void</span> turnOn() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The light is on</span><span style="color:#710">'</span></span>
    }

    <span style="color:#339;font-weight:bold">void</span> turnOff() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The light is off</span><span style="color:#710">'</span></span>
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Door</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> unlock() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">The door is unlocked</span><span style="color:#710">'</span></span>
    }
}

Light lamp = <span style="color:#080;font-weight:bold">new</span> Light()
<span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">Runnable</span>&gt; mySwitch = [
    <span style="color:#606">on</span>: <span style="color:#606">lamp</span>::turnOn,
    <span style="color:#606">off</span>: <span style="color:#606">lamp</span>::turnOff,
    <span style="color:#606">unlock</span>: <span style="color:#606">Door</span>::unlock
]

mySwitch.on()
mySwitch.off()
mySwitch.unlock()</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added an additional <code>Door</code> receiver to illustrate how to expand the original example.
Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The light is on
The light is off
The door is unlocked</pre>
</div>
</div>
<div class="paragraph">
<p>As a variation, if the command names aren&#8217;t important to us,
we can forgo using the switch map and just have a list of tasks to invoke as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// ...</span>
<span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">Runnable</span>&gt; tasks = [<span style="color:#606">lamp</span>::turnOn, <span style="color:#606">lamp</span>::turnOff, <span style="color:#606">Door</span>::unlock]
tasks.each{ <span style="color:#950">it</span>.run() }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_composite_pattern"><a class="link" href="#_composite_pattern">9.1.6. Composite Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Composite_pattern">Composite Pattern</a> allows you to treat single instances of an object the same way as a group of objects. The pattern is often used with hierarchies of objects. Typically, one or more methods should be callable in the same way for either <em>leaf</em> or <em>composite</em> nodes within the hierarchy. In such a case, composite nodes typically invoke the same named method for each of their children nodes.</p>
</div>
<div class="sect4">
<h5 id="_example_2"><a class="link" href="#_example_2">9.1.6.1. Example</a></h5>
<div class="paragraph">
<p>Consider this usage of the composite pattern where we want to call <code>toString()</code> on either <code>Leaf</code> or <code>Composite</code> objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="CompositeClasses.png" alt="CompositeClasses" width="338" height="190">
</div>
</div>
<div class="paragraph">
<p>In Java, the <code>Component</code> class is essential as it provides the type used for both leaf and composite nodes. In Groovy, because of duck-typing, we don&#8217;t need it for that purpose, however, it can still serve as a useful place to place common behaviour between the leaf and composite nodes.</p>
</div>
<div class="paragraph">
<p>For our purposes, we will assemble the following hierarchy of components.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="CompositeComponents.png" alt="CompositeComponents" width="244" height="248">
</div>
</div>
<div class="paragraph">
<p>Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Component</span> {
    <span style="color:#080;font-weight:bold">def</span> name
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">toString</span>(indent) {
        (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">-</span><span style="color:#710">&quot;</span></span> * indent) + name
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Composite</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Component</span> {
    <span style="color:#088;font-weight:bold">private</span> children = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">toString</span>(indent) {
        <span style="color:#080;font-weight:bold">def</span> s = <span style="color:#950">super</span>.toString(indent)
        children.each { child -&gt;
            s += <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">&quot;</span></span> + child.toString(indent + <span style="color:#00D">1</span>)
        }
        s
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">leftShift</span>(component) {
        children &lt;&lt; component
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Leaf</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Component</span> { }

<span style="color:#080;font-weight:bold">def</span> root = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Composite</span>(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">root</span><span style="color:#710">&quot;</span></span>)
root &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Leaf(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">leaf A</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">def</span> comp = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Composite</span>(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">comp B</span><span style="color:#710">&quot;</span></span>)
root &lt;&lt; comp
root &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Leaf(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">leaf C</span><span style="color:#710">&quot;</span></span>)
comp &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Leaf(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">leaf B1</span><span style="color:#710">&quot;</span></span>)
comp &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Leaf(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">leaf B2</span><span style="color:#710">&quot;</span></span>)
println root.toString(<span style="color:#00D">0</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root
-leaf A
-comp B
--leaf B1
--leaf B2
-leaf C</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_decorator_pattern"><a class="link" href="#_decorator_pattern">9.1.7. Decorator Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a> provides a mechanism to embellish the behaviour of an object without changing its essential interface. A decorated object should be able to be substituted wherever the original (non-decorated) object was expected. Decoration typically does not involve modifying the source code of the original object and decorators should be able to be combined in flexible ways to produce objects with several embellishments.</p>
</div>
<div class="sect4">
<h5 id="_traditional_example"><a class="link" href="#_traditional_example">9.1.7.1. Traditional Example</a></h5>
<div class="paragraph">
<p>Suppose we have the following <code>Logger</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Logger</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">log</span>(<span style="color:#0a8;font-weight:bold">String</span> message) {
        println message
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There might be times when it is useful to timestamp a log message, or times when we might want to change the case of the message. We could try to build all of this functionality into our <code>Logger</code> class. If we did that, the <code>Logger</code> class would start to be very complex. Also, everyone would obtain all of the features even when they might want only a small subset of the features. Finally, feature interaction would become quite difficult to control.</p>
</div>
<div class="paragraph">
<p>To overcome these drawbacks, we instead define two decorator classes. Uses of the <code>Logger</code> class are free to embellish their base logger with zero or more decorator classes in whatever order they desire. The classes look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TimeStampingLogger</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Logger</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Logger</span> logger
    TimeStampingLogger(logger) {
        <span style="color:#950">this</span>.logger = logger
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">log</span>(<span style="color:#0a8;font-weight:bold">String</span> message) {
        <span style="color:#080;font-weight:bold">def</span> now = <span style="color:#0a8;font-weight:bold">Calendar</span>.instance
        logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>now</span><span style="color:#D20">.time: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>message</span><span style="color:#710">&quot;</span></span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UpperLogger</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Logger</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Logger</span> logger
    UpperLogger(logger) {
        <span style="color:#950">this</span>.logger = logger
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">log</span>(<span style="color:#0a8;font-weight:bold">String</span> message) {
        logger.log(message.toUpperCase())
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the decorators like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> logger = <span style="color:#080;font-weight:bold">new</span> UpperLogger(<span style="color:#080;font-weight:bold">new</span> TimeStampingLogger(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Logger</span>()))
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">G'day Mate</span><span style="color:#710">&quot;</span></span>)
<span style="color:#777">// =&gt; Tue May 22 07:13:50 EST 2007: G'DAY MATE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we embellish the logger behaviour with both decorators. Because of the order we chose to apply the decorators, our log message comes out capitalised and the timestamp is in normal case. If we swap the order around, let&#8217;s see what happens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger = <span style="color:#080;font-weight:bold">new</span> TimeStampingLogger(<span style="color:#080;font-weight:bold">new</span> UpperLogger(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Logger</span>()))
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hi There</span><span style="color:#710">'</span></span>)
<span style="color:#777">// =&gt; TUE MAY 22 07:13:50 EST 2007: HI THERE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the timestamp itself has also been changed to be uppercase.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simplifying_with_closures_or_lambdas"><a class="link" href="#_simplifying_with_closures_or_lambdas">9.1.7.2. Simplifying with closures or lambdas</a></h5>
<div class="paragraph">
<p>Closures make it easy to represent code. We can use that fact to
make a general purpose logger class that accepts the decoration code as a closure.
This saves us defining many decoration classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DecoratingLogger</span> {
    <span style="color:#080;font-weight:bold">def</span> decoration = Closure.IDENTITY

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">log</span>(<span style="color:#0a8;font-weight:bold">String</span> message) {
        println decoration(message)
    }
}

<span style="color:#080;font-weight:bold">def</span> upper = { <span style="color:#950">it</span>.toUpperCase() }
<span style="color:#080;font-weight:bold">def</span> stamp = { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#0a8;font-weight:bold">Calendar</span></span><span style="color:#D20">.instance.time: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#950">it</span></span><span style="color:#710">&quot;</span></span> }
<span style="color:#080;font-weight:bold">def</span> logger = <span style="color:#080;font-weight:bold">new</span> DecoratingLogger(<span style="color:#606">decoration</span>: stamp &lt;&lt; upper)
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">G'day Mate</span><span style="color:#710">&quot;</span></span>)
<span style="color:#777">// Sat Aug 29 15:28:29 AEST 2020: G'DAY MATE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the same approach with lambdas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.function.Function</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DecoratingLogger</span> {
    Function&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; decoration = Function.identity()

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">log</span>(<span style="color:#0a8;font-weight:bold">String</span> message) {
        println decoration.apply(message)
    }
}

Function&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; upper = s -&gt; s.toUpperCase()
Function&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; stamp = s -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span><span style="color:#0a8;font-weight:bold">Calendar</span></span><span style="color:#D20">.instance.time: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>s</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">def</span> logger = <span style="color:#080;font-weight:bold">new</span> DecoratingLogger(<span style="color:#606">decoration</span>: upper.andThen(stamp))
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">G'day Mate</span><span style="color:#710">&quot;</span></span>)
<span style="color:#777">// =&gt; Sat Aug 29 15:38:28 AEST 2020: G'DAY MATE</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_a_touch_of_dynamic_behaviour"><a class="link" href="#_a_touch_of_dynamic_behaviour">9.1.7.3. A touch of dynamic behaviour</a></h5>
<div class="paragraph">
<p>Our previous decorators were specific to <code>Logger</code> objects. We can use Groovy&#8217;s Meta-Object Programming capabilities to create a decorator which is far more general purpose in nature. Consider this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">GenericLowerDecorator</span> {
    <span style="color:#088;font-weight:bold">private</span> delegate
    GenericLowerDecorator(delegate) {
        <span style="color:#950">this</span>.delegate = delegate
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMethod</span>(<span style="color:#0a8;font-weight:bold">String</span> name, args) {
        <span style="color:#080;font-weight:bold">def</span> newargs = args.collect { arg -&gt;
            <span style="color:#080;font-weight:bold">if</span> (arg <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">String</span>) {
                <span style="color:#080;font-weight:bold">return</span> arg.toLowerCase()
            } <span style="color:#080;font-weight:bold">else</span> {
                <span style="color:#080;font-weight:bold">return</span> arg
            }
        }
        delegate.invokeMethod(name, newargs)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes any class and decorates it so that any <code>String</code> method parameter will automatically be changed to lower case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger = <span style="color:#080;font-weight:bold">new</span> GenericLowerDecorator(<span style="color:#080;font-weight:bold">new</span> TimeStampingLogger(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Logger</span>()))
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">IMPORTANT Message</span><span style="color:#710">'</span></span>)
<span style="color:#777">// =&gt; Tue May 22 07:27:18 EST 2007: important message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just be careful with ordering here. The original decorators were restricted to decorating <code>Logger</code> objects. This decorator works with any object type, so we can&#8217;t swap the ordering around, i.e. this won&#8217;t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Can't mix and match Interface-Oriented and Generic decorators
// logger = new TimeStampingLogger(new GenericLowerDecorator(new Logger()))</pre>
</div>
</div>
<div class="paragraph">
<p>We could overcome this limitation be generating an appropriate Proxy type at runtime but we won&#8217;t complicate the example here.</p>
</div>
</div>
<div class="sect4">
<h5 id="_runtime_behaviour_embellishment"><a class="link" href="#_runtime_behaviour_embellishment">9.1.7.4. Runtime behaviour embellishment</a></h5>
<div class="paragraph">
<p>You can also consider using the <code>ExpandoMetaClass</code> from Groovy 1.1 to dynamically embellish a class with behaviour. This isn&#8217;t the normal style of usage of the decorator pattern (it certainly isn&#8217;t nearly as flexible) but may help you to achieve similar results in some cases without creating a new class.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what the code looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#777">// current mechanism to enable ExpandoMetaClass</span>
GroovySystem.metaClassRegistry.metaClassCreationHandle = <span style="color:#080;font-weight:bold">new</span> ExpandoMetaClassCreationHandle()

<span style="color:#080;font-weight:bold">def</span> logger = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Logger</span>()
logger.metaClass.log = { <span style="color:#0a8;font-weight:bold">String</span> m -&gt; println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">message: </span><span style="color:#710">'</span></span> + m.toUpperCase() }
logger.log(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">x</span><span style="color:#710">'</span></span>)
<span style="color:#777">// =&gt; message: X</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This achieves a similar result to applying a single decorator but we have no way to easily apply and remove embellishments on the fly.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_dynamic_decorating"><a class="link" href="#_more_dynamic_decorating">9.1.7.5. More dynamic decorating</a></h5>
<div class="paragraph">
<p>Suppose we have a calculator class (Actually any class would do).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Calc</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We might be interested in observing usage of the class over time. If it is buried deep within our codebase, it might be hard to determine when it is being called and with what parameters. Also, it might be hard to know if it is performing well. We can easily make a generic tracing decorator that prints out tracing information whenever any method on the <code>Calc</code> class is called and also provide timing information about how long it took to execute. Here is the code for the tracing decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TracingDecorator</span> {
    <span style="color:#088;font-weight:bold">private</span> delegate
    TracingDecorator(delegate) {
        <span style="color:#950">this</span>.delegate = delegate
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMethod</span>(<span style="color:#0a8;font-weight:bold">String</span> name, args) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Calling </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>name</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>args</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">def</span> before = <span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis()
        <span style="color:#080;font-weight:bold">def</span> result = delegate.invokeMethod(name, args)
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Got </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>result</span><span style="color:#D20"> in </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span><span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis()-before<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> ms</span><span style="color:#710">&quot;</span></span>
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how to use the class in a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> tracedCalc = <span style="color:#080;font-weight:bold">new</span> TracingDecorator(<span style="color:#080;font-weight:bold">new</span> Calc())
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">15</span> == tracedCalc.add(<span style="color:#00D">3</span>, <span style="color:#00D">12</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is what you would see after running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Calling add{3, 12}
Got 15 in 31 ms</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decorating_with_an_interceptor"><a class="link" href="#_decorating_with_an_interceptor">9.1.7.6. Decorating with an Interceptor</a></h5>
<div class="paragraph">
<p>The above timing example hooks into the lifecycle of Groovy objects (via <code>invokeMethod</code>). This is such an important style performing meta-programming that Groovy has special support for this style of decorating using <em>interceptors</em>.</p>
</div>
<div class="paragraph">
<p>Groovy even comes with a built-in <code>TracingInterceptor</code>. We can extend the built-in class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TimingInterceptor</span> <span style="color:#088;font-weight:bold">extends</span> TracingInterceptor {
    <span style="color:#088;font-weight:bold">private</span> beforeTime
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">beforeInvoke</span>(object, <span style="color:#0a8;font-weight:bold">String</span> methodName, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> arguments) {
        <span style="color:#950">super</span>.beforeInvoke(object, methodName, arguments)
        beforeTime = <span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis()
    }
    <span style="color:#0a8;font-weight:bold">Object</span> afterInvoke(<span style="color:#0a8;font-weight:bold">Object</span> object, <span style="color:#0a8;font-weight:bold">String</span> methodName, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> arguments, <span style="color:#0a8;font-weight:bold">Object</span> result) {
        <span style="color:#950">super</span>.afterInvoke(object, methodName, arguments, result)
        <span style="color:#080;font-weight:bold">def</span> duration = <span style="color:#0a8;font-weight:bold">System</span>.currentTimeMillis() - beforeTime
        writer.write(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Duration: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>duration</span><span style="color:#D20"> ms</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">&quot;</span></span>)
        writer.flush()
        result
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of using this new class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> proxy = ProxyMetaClass.getInstance(Calc)
proxy.interceptor = <span style="color:#080;font-weight:bold">new</span> TimingInterceptor()
proxy.use {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">7</span> == <span style="color:#080;font-weight:bold">new</span> Calc().add(<span style="color:#00D">1</span>, <span style="color:#00D">6</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>before Calc.ctor()
after  Calc.ctor()
Duration: 0 ms
before Calc.add(java.lang.Integer, java.lang.Integer)
after  Calc.add(java.lang.Integer, java.lang.Integer)
Duration: 2 ms</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decorating_with_java_lang_reflect_proxy"><a class="link" href="#_decorating_with_java_lang_reflect_proxy">9.1.7.7. Decorating with java.lang.reflect.Proxy</a></h5>
<div class="paragraph">
<p>If you are trying to decorate an object (i.e. just a particular instance of the class, not the class generally), then you can use Java&#8217;s <code>java.lang.reflect.Proxy</code>. Groovy makes working with this easier than just Java. Below is a code sample taken out of a grails project that wraps a <code>java.sql.Connection</code> so that it&#8217;s close method is a no-op:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">protected</span> Sql getGroovySql() {
    <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Connection</span> con = session.connection()
    <span style="color:#080;font-weight:bold">def</span> invoker = { object, method, args -&gt;
        <span style="color:#080;font-weight:bold">if</span> (method.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">close</span><span style="color:#710">&quot;</span></span>) {
            log.debug(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ignoring call to Connection.close() for use by groovy.sql.Sql</span><span style="color:#710">&quot;</span></span>)
        } <span style="color:#080;font-weight:bold">else</span> {
            log.trace(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delegating </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>method</span><span style="color:#710">&quot;</span></span>)
            <span style="color:#080;font-weight:bold">return</span> con.invokeMethod(method.name, args)
        }
    } <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">InvocationHandler</span>;
    <span style="color:#080;font-weight:bold">def</span> proxy = <span style="color:#0a8;font-weight:bold">Proxy</span>.newProxyInstance( getClass().getClassLoader(), [<span style="color:#0a8;font-weight:bold">Connection</span>] <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">Class</span><span style="color:#339;font-weight:bold">[]</span>, invoker )
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> Sql(proxy)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there were many methods to intercept, then this approach could be modified to look up closure in a map by method name and invoke it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_decorating_with_spring"><a class="link" href="#_decorating_with_spring">9.1.7.8. Decorating with Spring</a></h5>
<div class="paragraph">
<p>The <a href="https://spring.io/">Spring Framework</a> allows decorators to be applied with <em>interceptors</em> (you may have heard the terms <em>advice</em> or <em>aspect</em>). You can leverage this mechanism from Groovy as well.</p>
</div>
<div class="paragraph">
<p>First define a class that you want to decorate (we&#8217;ll also use an interface as is normal Spring practice):</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalcImpl</span> <span style="color:#088;font-weight:bold">implements</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b) { a + b }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we define our wiring in a file called <code>beans.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;beans</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.springframework.org/schema/beans</span><span style="color:#710">&quot;</span></span>
        <span style="color:#b48">xmlns:xsi</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.w3.org/2001/XMLSchema-instance</span><span style="color:#710">&quot;</span></span>
        <span style="color:#b48">xmlns:lang</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.springframework.org/schema/lang</span><span style="color:#710">&quot;</span></span>
        <span style="color:#b48">xsi:schemaLocation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span>
                <span style="color:#D20">http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span>
                <span style="color:#D20">http://www.springframework.org/schema/lang https://www.springframework.org/schema/lang/spring-lang.xsd</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>

    <span style="color:#070;font-weight:bold">&lt;bean</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">performanceInterceptor</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">autowire</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">no</span><span style="color:#710">&quot;</span></span>
          <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.springframework.aop.interceptor.PerformanceMonitorInterceptor</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">loggerName</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">performance</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/bean&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;bean</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">calc</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">util.CalcImpl</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;bean</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">beanNames</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">calc</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">interceptorNames</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">performanceInterceptor</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/bean&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our script looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework:spring-context:5.2.8.RELEASE</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.support.ClassPathXmlApplicationContext</span>

<span style="color:#080;font-weight:bold">def</span> ctx = <span style="color:#080;font-weight:bold">new</span> ClassPathXmlApplicationContext(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">beans.xml</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">def</span> calc = ctx.getBean(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">calc</span><span style="color:#710">'</span></span>)
println calc.add(<span style="color:#00D">3</span>, <span style="color:#00D">25</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And when we run it, we see the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>21/05/2007 23:02:35 org.springframework.aop.interceptor.PerformanceMonitorInterceptor invokeUnderTrace
FINEST: StopWatch 'util.Calc.add': running time (millis) = 16</pre>
</div>
</div>
<div class="paragraph">
<p>You may have to adjust your <code>logging.properties</code> file for messages at log level <code>FINEST</code> to be displayed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_asynchronous_decorators_using_gpars"><a class="link" href="#_asynchronous_decorators_using_gpars">9.1.7.9. Asynchronous Decorators using GPars</a></h5>
<div class="paragraph">
<p>The following example is inspired by some of the early example code for the
<a href="http://design.cs.iastate.edu/~panini/">Panini</a> programming language.
These days, you&#8217;ll see this style used with async functions in JavaScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.codehaus.gpars:gpars:0.10</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">groovyx.gpars.GParsPool.withPool</span>

<span style="color:#339;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">Document</span> {
    <span style="color:#339;font-weight:bold">void</span> print()
    <span style="color:#0a8;font-weight:bold">String</span> getText()
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DocumentImpl</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Document</span> {
    <span style="color:#080;font-weight:bold">def</span> document
    <span style="color:#339;font-weight:bold">void</span> print() { println document }
    <span style="color:#0a8;font-weight:bold">String</span> getText() { document }
}

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">words</span>(<span style="color:#0a8;font-weight:bold">String</span> text) {
    text.replaceAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">[^a-zA-Z]</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>).trim().split(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\\</span><span style="color:#b0b">\\</span><span style="color:#D20">s+</span><span style="color:#710">&quot;</span></span>)*.toLowerCase()
}

<span style="color:#080;font-weight:bold">def</span> avgWordLength = {
    <span style="color:#080;font-weight:bold">def</span> words = words(<span style="color:#950">it</span>.text)
    sprintf <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Avg Word Length: %4.2f</span><span style="color:#710">&quot;</span></span>, words*.size().sum() / words.size()
}
<span style="color:#080;font-weight:bold">def</span> modeWord = {
    <span style="color:#080;font-weight:bold">def</span> wordGroups = words(<span style="color:#950">it</span>.text).groupBy {<span style="color:#950">it</span>}.collectEntries { k, v -&gt; [k, v.size()] }
    <span style="color:#080;font-weight:bold">def</span> maxSize = wordGroups*.value.max()
    <span style="color:#080;font-weight:bold">def</span> maxWords = wordGroups.findAll { <span style="color:#950">it</span>.value == maxSize }
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Mode Word(s): </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>maxWords*.key.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">, </span><span style="color:#710">'</span></span>)<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> (</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>maxSize</span><span style="color:#D20"> occurrences)</span><span style="color:#710">&quot;</span></span>
}
<span style="color:#080;font-weight:bold">def</span> wordCount = { d -&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Word Count: </span><span style="color:#710">&quot;</span></span> + words(d.text).size() }

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">asyncDecorator</span>(<span style="color:#0a8;font-weight:bold">Document</span> d, Closure c) {
    ProxyGenerator.INSTANCE.instantiateDelegate([<span style="color:#606">print</span>: {
        withPool {
            <span style="color:#080;font-weight:bold">def</span> result = c.callAsync(d)
            d.print()
            println result.get()
        }
    }], [<span style="color:#0a8;font-weight:bold">Document</span>], d)
}

<span style="color:#0a8;font-weight:bold">Document</span> d = asyncDecorator(asyncDecorator(asyncDecorator(
        <span style="color:#080;font-weight:bold">new</span> DocumentImpl(<span style="color:#606">document</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">This is the file with the words in it</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#b0b">\\</span><span style="color:#D20">t</span><span style="color:#b0b">\\</span><span style="color:#D20">nDo you see the words?</span><span style="color:#b0b">\\</span><span style="color:#D20">n</span><span style="color:#710">&quot;</span></span>),
<span style="color:#777">//        new DocumentImpl(document: new File('AsyncDecorator.groovy').text),</span>
        wordCount), modeWord), avgWordLength)
d.print()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delegation_pattern"><a class="link" href="#_delegation_pattern">9.1.8. Delegation Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Delegation_pattern">Delegation Pattern</a> is a technique where an object&#8217;s behavior (public methods) is implemented by delegating responsibility to one or more associated objects.</p>
</div>
<div class="paragraph">
<p>Groovy allows the traditional style of applying the delegation pattern, e.g. see <a href="https://refactoring.com/catalog/replaceSuperclassWithDelegate.html">Replace Inheritance with Delegation</a>.</p>
</div>
<div class="sect4">
<h5 id="_implement_delegation_pattern_using_expandometaclass"><a class="link" href="#_implement_delegation_pattern_using_expandometaclass">9.1.8.1. Implement Delegation Pattern using ExpandoMetaClass</a></h5>
<div class="paragraph">
<p>The gapi:groovy.lang.ExpandoMetaClass[] allows usage of this pattern to be encapsulated in a library. This allows Groovy to emulate similar libraries available for the Ruby language.</p>
</div>
<div class="paragraph">
<p>Consider the following library class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Delegator</span> {
    <span style="color:#088;font-weight:bold">private</span> targetClass
    <span style="color:#088;font-weight:bold">private</span> delegate
    Delegator(targetClass, delegate) {
        <span style="color:#950">this</span>.targetClass = targetClass
        <span style="color:#950">this</span>.delegate = delegate
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">delegate</span>(<span style="color:#0a8;font-weight:bold">String</span> methodName) {
        delegate(methodName, methodName)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">delegate</span>(<span style="color:#0a8;font-weight:bold">String</span> methodName, <span style="color:#0a8;font-weight:bold">String</span> asMethodName) {
        targetClass.metaClass.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>asMethodName</span><span style="color:#710">&quot;</span></span> = delegate.&amp;<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>methodName</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">delegateAll</span>(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> names) {
        names.each { delegate(<span style="color:#950">it</span>) }
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">delegateAll</span>(<span style="color:#0a8;font-weight:bold">Map</span> names) {
        names.each { k, v -&gt; delegate(k, v) }
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">delegateAll</span>() {
        delegate.class.methods*.name.each { delegate(<span style="color:#950">it</span>) }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in your classpath, you can now apply the delegation pattern dynamically as shown in the following examples. First, consider we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MortgageLender</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">borrowAmount</span>(amount) {
       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">borrow </span><span style="color:#b0b">\\</span><span style="color:#D20">$</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>amount</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">borrowFor</span>(thing) {
       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">buy </span><span style="color:#b0b">\\</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>thing</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> lender = <span style="color:#080;font-weight:bold">new</span> MortgageLender()

<span style="color:#080;font-weight:bold">def</span> delegator = <span style="color:#080;font-weight:bold">new</span> Delegator(Person, lender)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the <em>delegator</em> to automatically borrow methods from the <em>lender</em> object to extend the <em>Person</em> class. We can borrow the methods as is or with a rename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">delegator.delegate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">borrowFor</span><span style="color:#710">'</span></span>
delegator.delegate <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">borrowAmount</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getMoney</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()

println p.borrowFor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">present</span><span style="color:#710">'</span></span>)   <span style="color:#777">// =&gt; buy present</span>
println p.getMoney(<span style="color:#00D">50</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line above, adds the <em>borrowFor</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object. The second line adds a <em>getMoney</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object&#8217;s <em>borrowAmount</em> method.</p>
</div>
<div class="paragraph">
<p>Alternatively, we could borrow multiple methods like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">delegator.delegateAll <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">borrowFor</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">borrowAmount</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which adds these two methods to the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Or if we want all the methods, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">delegator.delegateAll()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will make all the methods in the delegate object available in the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can use a map notation to rename multiple methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">delegator.delegateAll <span style="color:#606">borrowAmount</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getMoney</span><span style="color:#710">'</span></span>, <span style="color:#606">borrowFor</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">getThing</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_implement_delegation_pattern_using_delegate_annotation"><a class="link" href="#_implement_delegation_pattern_using_delegate_annotation">9.1.8.2. Implement Delegation Pattern using @Delegate annotation</a></h5>
<div class="paragraph">
<p>Since version 1.6 you can use the built-in delegation mechanism which is based on AST transformation.</p>
</div>
<div class="paragraph">
<p>This make delegation even easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#080;font-weight:bold">def</span> name
    <span style="color:#007">@Delegate</span> MortgageLender mortgageLender = <span style="color:#080;font-weight:bold">new</span> MortgageLender()
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MortgageLender</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">borrowAmount</span>(amount) {
       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">borrow </span><span style="color:#b0b">\\</span><span style="color:#D20">$</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>amount</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">borrowFor</span>(thing) {
       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">buy </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>thing</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> p = <span style="color:#080;font-weight:bold">new</span> Person()

<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">buy present</span><span style="color:#710">&quot;</span></span> == p.borrowFor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">present</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">borrow </span><span style="color:#b0b">\\</span><span style="color:#D20">$</span><span style="color:#D20">50</span><span style="color:#710">&quot;</span></span> == p.borrowAmount(<span style="color:#00D">50</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_flyweight_pattern"><a class="link" href="#_flyweight_pattern">9.1.9. Flyweight Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight Pattern</a> is a pattern for greatly reducing memory requirements by not requiring that heavy-weight objects be created in large numbers when dealing with systems that contain many things that are mostly the same. If for instance, a document was modelled using a complex character class that knew about unicode, fonts, positioning, etc., then the memory requirements could be quite large for large documents if each physical character in the document required its own character class instance. Instead, characters themselves might be kept within Strings and we might have one character class (or a small number such as one character class for each font type) that knew the specifics of how to deal with characters.</p>
</div>
<div class="paragraph">
<p>In such circumstances, we call the state that is shared with many other things (e.g. the character type) <em>intrinsic</em> state. It is captured within the heavy-weight class. The state which distinguishes the physical character (maybe just its ASCII code or Unicode) is called its <em>extrinsic</em> state.</p>
</div>
<div class="sect4">
<h5 id="_example_3"><a class="link" href="#_example_3">9.1.9.1. Example</a></h5>
<div class="paragraph">
<p>First we are going to model some complex aircraft (the first being a hoax competitor of the second - though that is not relevant to the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Boeing797</span> {
    <span style="color:#080;font-weight:bold">def</span> wingspan = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">80.8 m</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> capacity = <span style="color:#00D">1000</span>
    <span style="color:#080;font-weight:bold">def</span> speed = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1046 km/h</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> range = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">14400 km</span><span style="color:#710">'</span></span>
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./assets/img/b797-hoax.jpg" alt="b797 hoax">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Airbus380</span> {
    <span style="color:#080;font-weight:bold">def</span> wingspan = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">79.8 m</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> capacity = <span style="color:#00D">555</span>
    <span style="color:#080;font-weight:bold">def</span> speed = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">912 km/h</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">def</span> range = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">10370 km</span><span style="color:#710">'</span></span>
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./assets/img/a380.jpg" alt="a380">
</div>
</div>
<div class="paragraph">
<p>If we want to model our fleet, our first attempt might involve using many instances of these heavy-weight objects. It turns out though that only a few small pieces of state (our extrinsic state) change for each aircraft, so we will have singletons for the heavy-weight objects and capture the extrinsic state (bought date and asset number in the code below) separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FlyweightFactory</span> {
    <span style="color:#088;font-weight:bold">static</span> instances = [<span style="color:#00D">797</span>: <span style="color:#080;font-weight:bold">new</span> Boeing797(), <span style="color:#00D">380</span>: <span style="color:#080;font-weight:bold">new</span> Airbus380()]
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Aircraft</span> {
    <span style="color:#088;font-weight:bold">private</span> type         <span style="color:#777">// intrinsic state</span>
    <span style="color:#088;font-weight:bold">private</span> assetNumber  <span style="color:#777">// extrinsic state</span>
    <span style="color:#088;font-weight:bold">private</span> bought       <span style="color:#777">// extrinsic state</span>
    Aircraft(typeCode, assetNumber, bought) {
        type = FlyweightFactory.instances[typeCode]
        <span style="color:#950">this</span>.assetNumber = assetNumber
        <span style="color:#950">this</span>.bought = bought
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">describe</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">
        Asset Number: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>assetNumber</span><span style="color:#D20">
        Capacity: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>type</span><span style="color:#D20">.capacity people
        Speed: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>type</span><span style="color:#D20">.speed
        Range: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>type</span><span style="color:#D20">.range
        Bought: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>bought</span><span style="color:#D20">
        </span><span style="color:#710">&quot;&quot;&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">def</span> fleet = [
    <span style="color:#080;font-weight:bold">new</span> Aircraft(<span style="color:#00D">380</span>, <span style="color:#00D">1001</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">10-May-2007</span><span style="color:#710">'</span></span>),
    <span style="color:#080;font-weight:bold">new</span> Aircraft(<span style="color:#00D">380</span>, <span style="color:#00D">1002</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">10-Nov-2007</span><span style="color:#710">'</span></span>),
    <span style="color:#080;font-weight:bold">new</span> Aircraft(<span style="color:#00D">797</span>, <span style="color:#00D">1003</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">10-May-2008</span><span style="color:#710">'</span></span>),
    <span style="color:#080;font-weight:bold">new</span> Aircraft(<span style="color:#00D">797</span>, <span style="color:#00D">1004</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">10-Nov-2008</span><span style="color:#710">'</span></span>)
]

fleet.each { p -&gt; p.describe() }</code></pre>
</div>
</div>
<div class="paragraph">
<p>So here, even if our fleet contained hundreds of planes, we would only have one heavy-weight object for each type of aircraft.</p>
</div>
<div class="paragraph">
<p>As a further efficiency measure, we might use lazy creation of the flyweight objects rather than create the initial map up front as in the above example.</p>
</div>
<div class="paragraph">
<p>Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Asset Number: 1001
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-May-2007

Asset Number: 1002
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-Nov-2007

Asset Number: 1003
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-May-2008

Asset Number: 1004
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-Nov-2008</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iterator_pattern"><a class="link" href="#_iterator_pattern">9.1.10. Iterator Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Iterator_pattern">Iterator Pattern</a> allows sequential access to the elements of an aggregate object without exposing its underlying representation.</p>
</div>
<div class="paragraph">
<p>Groovy has the iterator pattern built right in to many of its closure operators, e.g. <code>each</code> and <code>eachWithIndex</code> as well as the <code>for .. in</code> loop.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">printAll</span>(container) {
    <span style="color:#080;font-weight:bold">for</span> (item <span style="color:#080;font-weight:bold">in</span> container) { println item }
}

<span style="color:#080;font-weight:bold">def</span> numbers = [ <span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span> ]
<span style="color:#080;font-weight:bold">def</span> months = [ <span style="color:#606">Mar</span>:<span style="color:#00D">31</span>, <span style="color:#606">Apr</span>:<span style="color:#00D">30</span>, <span style="color:#606">May</span>:<span style="color:#00D">31</span> ]
<span style="color:#080;font-weight:bold">def</span> colors = [ java.awt.Color.BLACK, java.awt.Color.WHITE ]
printAll numbers
printAll months
printAll colors</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1
2
3
4
May=31
Mar=31
Apr=30
java.awt.Color[r=0,g=0,b=0]
java.awt.Color[r=255,g=255,b=255]</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">colors.eachWithIndex { item, pos -&gt;
    println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Position </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>pos</span><span style="color:#D20"> contains '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>item</span><span style="color:#D20">'</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Position 0 contains 'java.awt.Color[r=0,g=0,b=0]'
Position 1 contains 'java.awt.Color[r=255,g=255,b=255]'</pre>
</div>
</div>
<div class="paragraph">
<p>The iterator pattern is also built in to other special operators such as the <code>eachByte</code>, <code>eachFile</code>, <code>eachDir</code>, <code>eachLine</code>, <code>eachObject</code>, <code>eachMatch</code> operators for working with streams, URLs, files, directories and regular expressions matches.</p>
</div>
</div>
<div class="sect3">
<h4 id="_loan_my_resource_pattern"><a class="link" href="#_loan_my_resource_pattern">9.1.11. Loan my Resource Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://wiki.scala-lang.org/display/SYGN/Loan">Loan my Resource</a> pattern ensures that a resource is deterministically disposed of once it goes out of scope.</p>
</div>
<div class="paragraph">
<p>This pattern is built in to many Groovy helper methods. You should consider using it yourself if you need to work with resources in ways beyond what Groovy supports.</p>
</div>
<div class="sect4">
<h5 id="_example_4"><a class="link" href="#_example_4">9.1.11.1. Example</a></h5>
<div class="paragraph">
<p>Consider the following code which works with a file. First we might write some line to the file and then print its size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> f = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">junk.txt</span><span style="color:#710">'</span></span>)
f.withPrintWriter { pw -&gt;
    pw.println(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Date</span>())
    pw.println(<span style="color:#950">this</span>.class.name)
}
println f.size()
<span style="color:#777">// =&gt; 42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also read back the contents of the file a line at a time and print each line out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">f.eachLine { line -&gt;
    println line
}
<span style="color:#777">// =&gt;</span>
<span style="color:#777">// Mon Jun 18 22:38:17 EST 2007</span>
<span style="color:#777">// RunPattern</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that normal Java <code>Reader</code> and <code>PrintWriter</code> objects were used under the covers by Groovy but the code writer did not have to worry about explicitly creating or closing those resources. The built-in Groovy methods loan the respective reader or writer to the closure code and then tidy up after themselves. So, you are using this pattern without having to do any work.</p>
</div>
<div class="paragraph">
<p>Sometimes however, you wish to do things slightly differently to what you can get for free using Groovy&#8217;s built-in mechanisms. You should consider utilising this pattern within your own resource-handling operations.</p>
</div>
<div class="paragraph">
<p>Consider how you might process the list of words on each line within the file. We could actually do this one too using Groovy&#8217;s built-in functions, but bear with us and assume we have to do some resource handling ourselves. Here is how we might write the code without using this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> reader = f.newReader()
reader.splitEachLine(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>) { wordList -&gt;
    println wordList
}
reader.close()
<span style="color:#777">// =&gt;</span>
<span style="color:#777">// [ &quot;Mon&quot;, &quot;Jun&quot;, &quot;18&quot;, &quot;22:38:17&quot;, &quot;EST&quot;, &quot;2007&quot; ]</span>
<span style="color:#777">// [ &quot;RunPattern&quot; ]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we now have an explicit call to <code>close()</code> in our code. If we didn&#8217;t code it just right (here we didn&#8217;t surround the code in a <code>try &#8230;&#8203; finally</code> block, we run the risk of leaving the file handle open.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now apply the loan pattern. First, we&#8217;ll write a helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">withListOfWordsForEachLine</span>(<span style="color:#0a8;font-weight:bold">File</span> f, Closure c) {
    <span style="color:#080;font-weight:bold">def</span> r = f.newReader()
    <span style="color:#080;font-weight:bold">try</span> {
        r.splitEachLine(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>, c)
    } <span style="color:#080;font-weight:bold">finally</span> {
        r?.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can re-write our code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withListOfWordsForEachLine(f) { wordList -&gt;
    println wordList
}
<span style="color:#777">// =&gt;</span>
<span style="color:#777">// [ &quot;Mon&quot;, &quot;Jun&quot;, &quot;18&quot;, &quot;22:38:17&quot;, &quot;EST&quot;, &quot;2007&quot; ]</span>
<span style="color:#777">// [ &quot;RunPattern&quot; ]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is much simpler and has removed the explicit <code>close()</code>. This is now catered for in one spot so we can apply the appropriate level of testing or reviewing in just one spot to be sure we have no problems.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_monoids"><a class="link" href="#_using_monoids">9.1.12. Using Monoids</a></h4>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Monoid#Monoids_in_computer_science">Monoids</a> allow
the mechanics of an aggregation algorithm to be separated from the algorithm-specific logic associated with that aggregation.
It is often thought to be a functional design pattern.</p>
</div>
<div class="paragraph">
<p>Perhaps, it is easiest seen with an example. Consider the code for integer sum, integer product and string concatenation.
We might note various similarities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> nums = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>]

<span style="color:#080;font-weight:bold">def</span> sum = <span style="color:#00D">0</span>    // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">for</span> (num <span style="color:#080;font-weight:bold">in</span> nums) { sum += num }    // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> sum == <span style="color:#00D">10</span>

<span style="color:#080;font-weight:bold">def</span> product = <span style="color:#00D">1</span>    // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">for</span> (num <span style="color:#080;font-weight:bold">in</span> nums) { product *= num }    // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> product == <span style="color:#00D">24</span>

<span style="color:#080;font-weight:bold">def</span> letters = [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">c</span><span style="color:#710">'</span></span>]

<span style="color:#080;font-weight:bold">def</span> concat = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>    // <b class="conum">(1)</b>
<span style="color:#080;font-weight:bold">for</span> (letter <span style="color:#080;font-weight:bold">in</span> letters) { concat += letter }    // <b class="conum">(2)</b>
<span style="color:#080;font-weight:bold">assert</span> concat == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Initialize an aggregate counter</p>
</li>
<li>
<p>Loop throw elements with for/while/iteration adjusting counter</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can remove the duplicate aggregation coding and the tease out the important differences for each algorithm.
We might instead use Groovy&#8217;s <code>inject</code> method. This is a <em>fold</em> operation in functional programming jargon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> nums.inject(<span style="color:#00D">0</span>){ total, next -&gt; total + next } == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">assert</span> nums.inject(<span style="color:#00D">1</span>){ total, next -&gt; total * next } == <span style="color:#00D">24</span>
<span style="color:#080;font-weight:bold">assert</span> letters.inject(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>){ total, next -&gt; total + next } == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the first parameter is the initial value, and the supplied closure contains the algorithm-specific logic.</p>
</div>
<div class="paragraph">
<p>Similarly, for Groovy 3+, we can use the JDK stream API and lambda syntax as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> nums.stream().reduce(<span style="color:#00D">0</span>, (total, next) -&gt; total + next) == <span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">assert</span> nums.stream().reduce(<span style="color:#00D">1</span>, (total, next) -&gt; total * next) == <span style="color:#00D">24</span>
<span style="color:#080;font-weight:bold">assert</span> letters.stream().reduce(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>, (total, next) -&gt; total + next) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">abc</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_a_touch_of_formalism"><a class="link" href="#_a_touch_of_formalism">9.1.12.1. A touch of formalism</a></h5>
<div class="paragraph">
<p>Looking at these examples, we might think all aggregation can be supported this way.
In fact, we look for certain characteristics to ensure that this aggregation pattern will apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Closure: performing the aggregation step should produce a result of the same type as the elements being aggregated.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>1L + 3L</code> produces a <code>Long</code>, and <code>'foo' + 'bar'</code> produces a <code>String</code>.<br>
Non-monoid examples: <code>'foo'.size() + 'bar'.size()</code> (takes strings, returns an integer),
the type <em>odd numbers</em> with respect to addition, algorithms which don&#8217;t handle null arguments if such arguments are possible.</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using the term <em>closure</em> here, we simply mean closed under the operation, not the Groovy <code>Closure</code> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Associativity: the order in which we apply the aggregation step should not matter.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>(1 + 3) + 5</code> is the same as <code>1 + (3 + 5)</code>, and <code>('a' + 'b') + 'c'</code> is the same as <code>'a' + ('b' + 'c')</code>.<br>
Non-monoid example: <code>(10 - 5) - 3</code> is not equal to <code>10 - (5 - 3)</code> therefore integers are not a monoid with respect to subtraction.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Identity element (sometimes also called a 'zero' element):
there should be an element which aggregated with any element returns the original element.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Examples: <code>0 + 42 == 42</code>, <code>42 + 0 == 42</code>, <code>1 * 42 == 42</code>, and <code>'' + 'foo' == 'foo'</code>.<br>
Non-monoid example: the type <em>non-empty strings</em> is not a monoid with respect to concatenation.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If your algorithm doesn&#8217;t satisfy all the monoid properties, that doesn&#8217;t mean aggregation isn&#8217;t possible.
It just means that you won&#8217;t get all the benefits from monoids, which we&#8217;ll cover shortly, or you might have
a little more work to do.
Also, you might be able to convert your data structures slightly to turn your problem into one involving monoids.
We&#8217;ll cover that topic a little later in this section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_benefits_of_monoids"><a class="link" href="#_benefits_of_monoids">9.1.12.2. Benefits of monoids</a></h5>
<div class="paragraph">
<p>Consider adding the integers 10 through 16.
Because the operation of addition for integers is a monoid, we already know that we can save writing code
and instead use the approach we saw in the earlier <code>inject</code> examples.
There are some other nice properties.</p>
</div>
<div class="paragraph">
<p>Because of the <em>closure</em> property,
if we have a pairwise method like <code>sum(Integer a, Integer b)</code>, then for a monoid, we can always
extend that method to work with a list, e.g. <code>sum(List&lt;Integer&gt; nums)</code> or <code>sum(Integer first, Integer&#8230;&#8203; rest)</code>.</p>
</div>
<div class="paragraph">
<p>Because of <em>associativity</em>,
we can employ some interesting ways to solve the aggregation including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Divide and conquer algorithms which break the problem into smaller pieces</p>
</li>
<li>
<p>Various incremental algorithms for example memoization would allow summing from 1..5
to potentially start part way through be reusing a cached value of summing 1..4 if that had been calculated earlier</p>
</li>
<li>
<p>Inherent parallelization can make use of multiple cores</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s just look at the first of these in more detail. With a multicore
processor, one core could add <code>10</code> plus <code>11</code>, another core <code>12</code> plus <code>13</code>, and so on.
We&#8217;d use the <em>identity</em> element if needed (shown being added to <code>16</code> in our example).
Then the intermediate results could also be added together concurrently and so on until the result was reached.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="MonoidAddition.png" alt="MonoidAddition" width="592" height="343">
</div>
</div>
<div class="paragraph">
<p>We have reduced the amount of code we need to write, and we also have potential performance gains.</p>
</div>
<div class="paragraph">
<p>Here is how we might code the previous example using the <a href="http://gpars.org/">GPars</a>
concurrency and parallelism framework (two alternatives shown):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> nums = <span style="color:#00D">10</span>..<span style="color:#00D">16</span>
GParsPool.withPool {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">91</span> == nums.injectParallel(<span style="color:#00D">0</span>){ total, next -&gt; total + next }
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">91</span> == nums.parallel.reduce(<span style="color:#00D">0</span>, (total, next) -&gt; total + next)
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_working_with_non_monoids"><a class="link" href="#_working_with_non_monoids">9.1.12.3. Working with Non-monoids</a></h5>
<div class="paragraph">
<p>Suppose we want to find the average of the numbers 1..10. Groovy has a built-in method for this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> (<span style="color:#00D">1</span>..<span style="color:#00D">10</span>).average() == <span style="color:#60E">5.5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, suppose we want to build our own monoid solution instead of using the built-in version.
It might seem difficult to find the <em>identity</em> element. After all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> (<span style="color:#00D">0</span>..<span style="color:#00D">10</span>).average() == <span style="color:#00D">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we are tempted to write the pairwise aggregation closure it might be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> avg = { a, b -&gt; (a + b) / <span style="color:#00D">2</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>What <code>b</code> can we use for the <em>identity</em> element here so that our equation returns the original?
We need to use <code>a</code>, but that isn&#8217;t a fixed value, so there is no <em>identity</em>.</p>
</div>
<div class="paragraph">
<p>Also, associativity doesn&#8217;t hold for this initial attempt at defining <code>avg</code> as these examples show:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">6</span> == avg(avg(<span style="color:#00D">10</span>, <span style="color:#00D">2</span>), <span style="color:#00D">6</span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">7</span> == avg(<span style="color:#00D">10</span>, avg(<span style="color:#00D">2</span>, <span style="color:#00D">6</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, what about our <em>closure</em> property? Our original numbers were integers, but our average (<code>5.5</code>)
is not. We can solve this by making our average work for any <code>Number</code> instances, but it might not always be this easy.</p>
</div>
<div class="paragraph">
<p>It might appear that this problem is not amenable to a monoidal solution.
However, there are numerous ways to bring monoids into the solution.</p>
</div>
<div class="paragraph">
<p>We can split it into two parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> nums = <span style="color:#00D">1</span>..<span style="color:#00D">10</span>
<span style="color:#080;font-weight:bold">def</span> total = nums.sum()
<span style="color:#080;font-weight:bold">def</span> avg = total / nums.size()
<span style="color:#080;font-weight:bold">assert</span> avg == <span style="color:#60E">5.5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The calculation of <code>sum()</code> can follow monoid rules and then our last step can calculate the average.
We can even do a concurrent version with GPars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withPool {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#60E">5.5</span> == nums.sumParallel() / nums.size()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we were using the built-in <code>sum()</code> method (and <code>sumParallel()</code> for the GPars example),
but if you were doing it by hand, the monoid nature of that part of your calculation would
make it easier to write your own code for that step.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can introduce a helper data structure that reworks the problem to be a monoid.
Instead of just keeping the total, let&#8217;s keep a list containing the total and count of numbers.
The code could look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> holder = nums
    .collect{ [<span style="color:#950">it</span>, <span style="color:#00D">1</span>] }
    .inject{ a, b -&gt; [a[<span style="color:#00D">0</span>] + b[<span style="color:#00D">0</span>], a[<span style="color:#00D">1</span>] + b[<span style="color:#00D">1</span>]] }
<span style="color:#080;font-weight:bold">def</span> avg = holder[<span style="color:#00D">0</span>] / holder[<span style="color:#00D">1</span>]
<span style="color:#080;font-weight:bold">assert</span> avg == <span style="color:#60E">5.5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, to be a little fancier, we could introduce a class for our data structure and even calculate
concurrently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AverageHolder</span> {
    <span style="color:#339;font-weight:bold">int</span> total
    <span style="color:#339;font-weight:bold">int</span> count
    AverageHolder plus(AverageHolder other) {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> AverageHolder(<span style="color:#606">total</span>: total + other.total,
                                 <span style="color:#606">count</span>: count + other.count)
    }
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> AverageHolder ZERO =
        <span style="color:#080;font-weight:bold">new</span> AverageHolder(<span style="color:#606">total</span>: <span style="color:#00D">0</span>, <span style="color:#606">count</span>: <span style="color:#00D">0</span>)
}

<span style="color:#080;font-weight:bold">def</span> asHolder = {
    <span style="color:#950">it</span> <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Integer</span> ? <span style="color:#080;font-weight:bold">new</span> AverageHolder(<span style="color:#606">total</span>: <span style="color:#950">it</span>, count : <span style="color:#00D">1</span>) : <span style="color:#950">it</span>
}
<span style="color:#080;font-weight:bold">def</span> pairwiseAggregate = { aggregate, next -&gt;
    asHolder(aggregate) + asHolder(next)
}
withPool {
    <span style="color:#080;font-weight:bold">def</span> holder = nums.injectParallel(AverageHolder.ZERO, pairwiseAggregate)
    <span style="color:#080;font-weight:bold">def</span> avg = holder.with{ total / count }
    <span style="color:#080;font-weight:bold">assert</span> avg == <span style="color:#60E">5.5</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_null_object_pattern"><a class="link" href="#_null_object_pattern">9.1.13. Null Object Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Null_object_pattern">Null Object Pattern</a> involves using a special object place-marker object representing null. Typically, if you have a reference to null, you can&#8217;t invoke <code>reference.field</code> or <code>reference.method()</code> You receive the dreaded <code>NullPointerException</code>. The null object pattern uses a special object representing null, instead of using an actual <code>null</code>. This allows you to invoke field and method references on the null object. The result of using the null object should semantically be equivalent to <em>doing nothing</em>.</p>
</div>
<div class="sect4">
<h5 id="_simple_example"><a class="link" href="#_simple_example">9.1.13.1. Simple Example</a></h5>
<div class="paragraph">
<p>Suppose we have the following system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Job</span> {
    <span style="color:#080;font-weight:bold">def</span> salary
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#080;font-weight:bold">def</span> name
    <span style="color:#080;font-weight:bold">def</span> Job job
}

<span style="color:#080;font-weight:bold">def</span> people = [
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Tom</span><span style="color:#710">'</span></span>, <span style="color:#606">job</span>: <span style="color:#080;font-weight:bold">new</span> Job(<span style="color:#606">salary</span>: <span style="color:#00D">1000</span>)),
    <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Dick</span><span style="color:#710">'</span></span>, <span style="color:#606">job</span>: <span style="color:#080;font-weight:bold">new</span> Job(<span style="color:#606">salary</span>: <span style="color:#00D">1200</span>)),
]

<span style="color:#080;font-weight:bold">def</span> biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this prints out <code>1200</code>. Suppose now that we now invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">people &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Harry</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now try to calculate <code>biggestSalary</code> again, we receive a null pointer exception.</p>
</div>
<div class="paragraph">
<p>To overcome this problem, we can introduce a <code>NullJob</code> class and change the above statement to become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NullJob</span> <span style="color:#088;font-weight:bold">extends</span> Job { <span style="color:#080;font-weight:bold">def</span> salary = <span style="color:#00D">0</span> }

people &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Harry</span><span style="color:#710">'</span></span>, <span style="color:#606">job</span>: <span style="color:#080;font-weight:bold">new</span> NullJob())
biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works as we require but it&#8217;s not always the best way to do this with Groovy. Groovy&#8217;s safe-dereference operator (<code>?.</code>) operator and null aware closures often allow Groovy to avoid the need to create a special null object or null class. This is illustrated by examining a groovier way to write the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">people &lt;&lt; <span style="color:#080;font-weight:bold">new</span> Person(<span style="color:#606">name</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Harry</span><span style="color:#710">'</span></span>)
biggestSalary = people.collect { p -&gt; p.job?.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two things are going on here to allow this to work. First of all, <code>max()</code> is <em>'null aware'</em> so that [300, null, 400].max() == 400. Secondly, with the <code>?.</code> operator, an expression like <code>p?.job?.salary</code> will be equal to null if <code>salary</code> is equal to null, or if <code>job</code> is equal ` null or if <code>p</code> is equal to null. You don&#8217;t need to code a complex nested if ... then ... else to avoid a <code>NullPointerException</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tree_example"><a class="link" href="#_tree_example">9.1.13.2. Tree Example</a></h5>
<div class="paragraph">
<p>Consider the following example where we want to calculate size, cumulative sum and cumulative product of all the values in a tree structure.</p>
</div>
<div class="paragraph">
<p>Our first attempt has special logic within the calculation methods to handle null values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NullHandlingTree</span> {
    <span style="color:#080;font-weight:bold">def</span> left, right, value

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">size</span>() {
        <span style="color:#00D">1</span> + (left ? left.size() : <span style="color:#00D">0</span>) + (right ? right.size() : <span style="color:#00D">0</span>)
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">sum</span>() {
       value + (left ? left.sum() : <span style="color:#00D">0</span>) + (right ? right.sum() : <span style="color:#00D">0</span>)
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">product</span>() {
       value * (left ? left.product() : <span style="color:#00D">1</span>) * (right ? right.product() : <span style="color:#00D">1</span>)
    }
}

<span style="color:#080;font-weight:bold">def</span> root = <span style="color:#080;font-weight:bold">new</span> NullHandlingTree(
    <span style="color:#606">value</span>: <span style="color:#00D">2</span>,
    <span style="color:#606">left</span>: <span style="color:#080;font-weight:bold">new</span> NullHandlingTree(
        <span style="color:#606">value</span>: <span style="color:#00D">3</span>,
        <span style="color:#606">right</span>: <span style="color:#080;font-weight:bold">new</span> NullHandlingTree(<span style="color:#606">value</span>: <span style="color:#00D">4</span>),
        <span style="color:#606">left</span>: <span style="color:#080;font-weight:bold">new</span> NullHandlingTree(<span style="color:#606">value</span>: <span style="color:#00D">5</span>)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we introduce the null object pattern (here by defining the <code>NullTree</code> class), we can now simplify the logic in the <code>size()</code>, <code>sum()</code> and`product()` methods. These methods now much more clearly represent the logic for the normal (and now universal) case. Each of the methods within <code>NullTree</code> returns a value which represents doing nothing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Tree</span> {
    <span style="color:#080;font-weight:bold">def</span> left = <span style="color:#080;font-weight:bold">new</span> NullTree(), right = <span style="color:#080;font-weight:bold">new</span> NullTree(), value

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">size</span>() {
        <span style="color:#00D">1</span> + left.size() + right.size()
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">sum</span>() {
       value + left.sum() + right.sum()
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">product</span>() {
       value * left.product() * right.product()
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NullTree</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">size</span>() { <span style="color:#00D">0</span> }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">sum</span>() { <span style="color:#00D">0</span> }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">product</span>() { <span style="color:#00D">1</span> }
}

<span style="color:#080;font-weight:bold">def</span> root = <span style="color:#080;font-weight:bold">new</span> Tree(
    <span style="color:#606">value</span>: <span style="color:#00D">2</span>,
    <span style="color:#606">left</span>: <span style="color:#080;font-weight:bold">new</span> Tree(
        <span style="color:#606">value</span>: <span style="color:#00D">3</span>,
        <span style="color:#606">right</span>: <span style="color:#080;font-weight:bold">new</span> Tree(<span style="color:#606">value</span>: <span style="color:#00D">4</span>),
        <span style="color:#606">left</span>: <span style="color:#080;font-weight:bold">new</span> Tree(<span style="color:#606">value</span>: <span style="color:#00D">5</span>)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of running either of these examples is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4
14
120</pre>
</div>
</div>
<div class="paragraph">
<p>Note: a slight variation with the null object pattern is to combine it with the singleton pattern. So, we wouldn&#8217;t write new NullTree() wherever we needed a null object as shown above. Instead we would have a single null object instance which we would place within our data structures as needed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observer_pattern"><a class="link" href="#_observer_pattern">9.1.14. Observer Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a> allows one or more <em>observers</em> to be notified
about changes or events from a <em>subject</em> object.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="ObserverClasses.png" alt="ObserverClasses" width="529" height="268">
</div>
</div>
<div class="sect4">
<h5 id="_example_5"><a class="link" href="#_example_5">9.1.14.1. Example</a></h5>
<div class="paragraph">
<p>Here is a typical implementation of the classic pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">Observer</span> {
    <span style="color:#339;font-weight:bold">void</span> update(message)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Subject</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span> observers = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">void</span> register(observer) {
        observers &lt;&lt; observer
    }
    <span style="color:#339;font-weight:bold">void</span> unregister(observer) {
        observers -= observer
    }
    <span style="color:#339;font-weight:bold">void</span> notifyAll(message) {
        observers.each{ <span style="color:#950">it</span>.update(message) }
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ConcreteObserver1</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Observer</span> {
    <span style="color:#080;font-weight:bold">def</span> messages = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">void</span> update(message) {
        messages &lt;&lt; message
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ConcreteObserver2</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Observer</span> {
    <span style="color:#080;font-weight:bold">def</span> messages = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">void</span> update(message) {
        messages &lt;&lt; message.toUpperCase()
    }
}

<span style="color:#080;font-weight:bold">def</span> o1a = <span style="color:#080;font-weight:bold">new</span> ConcreteObserver1()
<span style="color:#080;font-weight:bold">def</span> o1b = <span style="color:#080;font-weight:bold">new</span> ConcreteObserver1()
<span style="color:#080;font-weight:bold">def</span> o2 = <span style="color:#080;font-weight:bold">new</span> ConcreteObserver2()
<span style="color:#080;font-weight:bold">def</span> observers = [o1a, o1b, o2]
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register(o1a)
    register(o2)
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register(o1b)
    register(o2)
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">def</span> expected = [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ONE</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">TWO</span><span style="color:#710">'</span></span>]]
<span style="color:#080;font-weight:bold">assert</span> observers*.messages == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Closures, we can avoid creating the concrete observer classes as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> <span style="color:#0a8;font-weight:bold">Observer</span> {
    <span style="color:#339;font-weight:bold">void</span> update(message)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Subject</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span> observers = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">void</span> register(<span style="color:#0a8;font-weight:bold">Observer</span> observer) {
        observers &lt;&lt; observer
    }
    <span style="color:#339;font-weight:bold">void</span> unregister(observer) {
        observers -= observer
    }
    <span style="color:#339;font-weight:bold">void</span> notifyAll(message) {
        observers.each{ <span style="color:#950">it</span>.update(message) }
    }
}

<span style="color:#080;font-weight:bold">def</span> messages1a = <span style="color:#339;font-weight:bold">[]</span>, messages1b = <span style="color:#339;font-weight:bold">[]</span>, messages2 = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#080;font-weight:bold">def</span> o2 = { messages2 &lt;&lt; <span style="color:#950">it</span>.toUpperCase() }
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register{ messages1a &lt;&lt; <span style="color:#950">it</span> }
    register(o2)
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register{ messages1b &lt;&lt; <span style="color:#950">it</span> }
    register(o2)
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">def</span> expected = [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ONE</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">TWO</span><span style="color:#710">'</span></span>]]
<span style="color:#080;font-weight:bold">assert</span> [messages1a, messages1b, messages2] == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a variation for Groovy 3+, let&#8217;s consider dropping the <code>Observer</code> interface and using lambdas as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.function.Consumer</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Subject</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;Consumer&gt; observers = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#339;font-weight:bold">void</span> register(Consumer observer) {
        observers &lt;&lt; observer
    }
    <span style="color:#339;font-weight:bold">void</span> unregister(observer) {
        observers -= observer
    }
    <span style="color:#339;font-weight:bold">void</span> notifyAll(message) {
        observers.each{ <span style="color:#950">it</span>.accept(message) }
    }
}

<span style="color:#080;font-weight:bold">def</span> messages1a = <span style="color:#339;font-weight:bold">[]</span>, messages1b = <span style="color:#339;font-weight:bold">[]</span>, messages2 = <span style="color:#339;font-weight:bold">[]</span>
<span style="color:#080;font-weight:bold">def</span> o2 = { messages2 &lt;&lt; <span style="color:#950">it</span>.toUpperCase() }
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register(s -&gt; messages1a &lt;&lt; s)
    register(s -&gt; messages2 &lt;&lt; s.toUpperCase())
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Subject</span>().with {
    register(s -&gt; messages1b &lt;&lt; s)
    register(s -&gt; messages2 &lt;&lt; s.toUpperCase())
    notifyAll(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>)
}
<span style="color:#080;font-weight:bold">def</span> expected = [[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>], [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ONE</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">TWO</span><span style="color:#710">'</span></span>]]
<span style="color:#080;font-weight:bold">assert</span> [messages1a, messages1b, messages2] == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are now calling the <code>accept</code> method from <code>Consumer</code> rather
than the <code>update</code> method from <code>Observer</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bindable_and_vetoable"><a class="link" href="#_bindable_and_vetoable">9.1.14.2. @Bindable and @Vetoable</a></h5>
<div class="paragraph">
<p>The JDK has some built-in classes which follow the observer pattern.
The <code>java.util.Observer</code> and <code>java.util.Observable</code> classes are deprecated from JDK 9 due to various limitations.
Instead, you are recommended to use various more powerful classes in the <code>java.beans</code> package such as <code>java.beans.PropertyChangeListener</code>.
Luckily, Groovy has some built-in transforms (gapi:groovy.beans.Bindable[] and gapi:groovy.beans.Vetoable[])
which support for some key classes from that package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.beans.*</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.beans.*</span>

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PersonBean</span> {
    <span style="color:#007">@Bindable</span> <span style="color:#0a8;font-weight:bold">String</span> first
    <span style="color:#007">@Bindable</span> <span style="color:#0a8;font-weight:bold">String</span> last
    <span style="color:#007">@Vetoable</span> <span style="color:#0a8;font-weight:bold">Integer</span> age
}

<span style="color:#080;font-weight:bold">def</span> messages = [:].withDefault{<span style="color:#339;font-weight:bold">[]</span>}
<span style="color:#080;font-weight:bold">new</span> PersonBean().with {
    addPropertyChangeListener{ <span style="color:#0a8;font-weight:bold">PropertyChangeEvent</span> ev -&gt;
        messages[ev.propertyName] &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">prop: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>ev</span><span style="color:#D20">.newValue</span><span style="color:#710">&quot;</span></span>
    }
    addVetoableChangeListener{ <span style="color:#0a8;font-weight:bold">PropertyChangeEvent</span> ev -&gt;
        <span style="color:#080;font-weight:bold">def</span> name = ev.propertyName
        <span style="color:#080;font-weight:bold">if</span> (name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">age</span><span style="color:#710">'</span></span> &amp;&amp; ev.newValue &gt; <span style="color:#00D">40</span>)
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">PropertyVetoException</span>()
        messages[name] &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">veto: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>ev</span><span style="color:#D20">.newValue</span><span style="color:#710">&quot;</span></span>
    }
    first = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">John</span><span style="color:#710">'</span></span>
    age = <span style="color:#00D">35</span>
    last = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Smith</span><span style="color:#710">'</span></span>
    first = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Jane</span><span style="color:#710">'</span></span>
    age = <span style="color:#00D">42</span>
}

<span style="color:#080;font-weight:bold">def</span> expected = [
    <span style="color:#606">first</span>:[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">prop: John</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">prop: Jane</span><span style="color:#710">'</span></span>],
    <span style="color:#606">age</span>:[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">veto: 35</span><span style="color:#710">'</span></span>],
    <span style="color:#606">last</span>:[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">prop: Smith</span><span style="color:#710">'</span></span>]
]
<span style="color:#080;font-weight:bold">assert</span> messages == expected</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, methods like <code>addPropertyChangeListener</code> perform the same role as <code>registerObserver</code> in previous examples.
There is a <code>firePropertyChange</code> method corresponding to <code>notifyAll</code>/<code>notifyObservers</code> in previous examples but Groovy adds that
automatically here, so it isn&#8217;t visible in the source code. There is also a <code>propertyChange</code> method that corresponds
to the <code>update</code> method in previous examples, though again, that isn&#8217;t visible here.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pimp_my_library_pattern"><a class="link" href="#_pimp_my_library_pattern">9.1.15. Pimp my Library Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=179766">Pimp my Library</a> Pattern suggests an approach for extending a library that nearly does everything that you need but just needs a little more. It assumes that you do not have source code for the library of interest.</p>
</div>
<div class="sect4">
<h5 id="_example_6"><a class="link" href="#_example_6">9.1.15.1. Example</a></h5>
<div class="paragraph">
<p>Suppose we want to make use of the built-in Integer facilities in Groovy (which build upon the features already in Java). Those libraries have nearly all of the features we want but not quite everything. We may not have all of the source code to the Groovy and Java libraries so we can&#8217;t just change the library. Instead we augment the library. Groovy has a number of ways to do this. One way is to use a Category.</p>
</div>
<div class="paragraph">
<p>First, we&#8217;ll define a suitable category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">EnhancedInteger</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">boolean</span> greaterThanAll(<span style="color:#0a8;font-weight:bold">Integer</span> self, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> others) {
        greaterThanAll(self, others)
    }
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">boolean</span> greaterThanAll(<span style="color:#0a8;font-weight:bold">Integer</span> self, others) {
        others.every { self &gt; <span style="color:#950">it</span> }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added two methods which augment the Integer methods by providing the <code>greaterThanAll</code> method. Categories follow conventions where they are defined as static methods with a special first parameter representing the class we wish to extend. The greaterThanAll(Integer self, others) static method becomes the <code>greaterThanAll(other)</code> instance method.</p>
</div>
<div class="paragraph">
<p>We defined two versions of <code>greaterThanAll</code>. One which works for collections, ranges etc. The other which works with a variable number of <code>Integer</code> arguments.</p>
</div>
<div class="paragraph">
<p>Here is how you would use the category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">use(EnhancedInteger) {
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span>.greaterThanAll(<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>)
    <span style="color:#080;font-weight:bold">assert</span> !<span style="color:#00D">5</span>.greaterThanAll(<span style="color:#00D">2</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>)
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">5</span>.greaterThanAll(-<span style="color:#00D">4</span>..<span style="color:#00D">4</span>)
    <span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">5</span>.greaterThanAll(<span style="color:#339;font-weight:bold">[]</span>)
    <span style="color:#080;font-weight:bold">assert</span> !<span style="color:#00D">5</span>.greaterThanAll([<span style="color:#00D">4</span>, <span style="color:#00D">5</span>])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, using this technique you can effectively enrich an original class without having access to its source code. Moreover, you can apply different enrichments in different parts of the system as well as work with un-enriched objects if we need to.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_pattern"><a class="link" href="#_proxy_pattern">9.1.16. Proxy Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Proxy_pattern">Proxy Pattern</a> allows one object to act as a pretend replacement for some other object. In general, whoever is using the proxy, doesn&#8217;t realise that they are not using the real thing. The pattern is useful when the real object is hard to create or use: it may exist over a network connection, or be a large object in memory, or be a file, database or some other resource that is expensive or impossible to duplicate.</p>
</div>
<div class="sect4">
<h5 id="_example_7"><a class="link" href="#_example_7">9.1.16.1. Example</a></h5>
<div class="paragraph">
<p>One common use of the proxy pattern is when talking to remote objects in a different JVM. Here is the client code for creating a proxy that talks via sockets to a server object as well as an example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AccumulatorProxy</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accumulate</span>(args) {
        <span style="color:#080;font-weight:bold">def</span> result
        <span style="color:#080;font-weight:bold">def</span> s = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Socket</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">localhost</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">54321</span>)
        s.withObjectStreams { ois, oos -&gt;
            oos &lt;&lt; args
            result = ois.readObject()
        }
        s.close()
        <span style="color:#080;font-weight:bold">return</span> result
    }
}

println <span style="color:#080;font-weight:bold">new</span> AccumulatorProxy().accumulate([<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="color:#00D">7</span>, <span style="color:#00D">8</span>, <span style="color:#00D">9</span>, <span style="color:#00D">10</span>])
<span style="color:#777">// =&gt; 55</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what your server code might look like (start this first):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Accumulator</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accumulate</span>(args) {
        args.inject(<span style="color:#00D">0</span>) { total, arg -&gt; total += arg }
    }
}

<span style="color:#080;font-weight:bold">def</span> port = <span style="color:#00D">54321</span>
<span style="color:#080;font-weight:bold">def</span> accumulator = <span style="color:#080;font-weight:bold">new</span> Accumulator()
<span style="color:#080;font-weight:bold">def</span> server = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ServerSocket</span>(port)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Starting server on port </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>port</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">while</span>(<span style="color:#069">true</span>) {
    server.accept() { socket -&gt;
        socket.withObjectStreams { ois, oos -&gt;
            <span style="color:#080;font-weight:bold">def</span> args = ois.readObject()
            oos &lt;&lt; accumulator.accumulate(args)
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_singleton_pattern"><a class="link" href="#_singleton_pattern">9.1.17. Singleton Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Pattern</a> is used to make sure only one object of a particular class is ever created. This can be useful when exactly one object is needed to coordinate actions across a system; perhaps for efficiency where creating lots of identical objects would be wasteful, perhaps because a particular algorithm needing a single point of control is required or perhaps when an object is used to interact with a non-shareable resource.</p>
</div>
<div class="paragraph">
<p>Weaknesses of the Singleton pattern include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can reduce reuse. For instance, there are issues if you want to use inheritance with Singletons. If <code>SingletonB</code> extends <code>SingletonA</code>, should there be exactly (at most) one instance of each or should the creation of an object from one of the classes prohibit creation from the other. Also, if you decide both classes can have an instance, how do you override the <code>getInstance()</code> method which is static?</p>
</li>
<li>
<p>It is also hard to test singletons in general because of the static methods but Groovy can support that if required.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_example_the_classic_java_singleton"><a class="link" href="#_example_the_classic_java_singleton">9.1.17.1. Example: The Classic Java Singleton</a></h5>
<div class="paragraph">
<p>Suppose we wish to create a class for collecting votes. Because getting the right number of votes may be very important, we decide to use the singleton pattern. There will only ever be one <code>VoteCollector</code> object, so it makes it easier for us to reason about that objects creation and use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">VoteCollector</span> {
    <span style="color:#080;font-weight:bold">def</span> votes = <span style="color:#00D">0</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> INSTANCE = <span style="color:#080;font-weight:bold">new</span> VoteCollector()
    <span style="color:#088;font-weight:bold">static</span> getInstance() { <span style="color:#080;font-weight:bold">return</span> INSTANCE }
    <span style="color:#088;font-weight:bold">private</span> VoteCollector() { }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">display</span>() { println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Collector:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>hashCode()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">, Votes:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>votes</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some points of interest in this code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it has a private constructor, so no <code>VoteCollector</code> objects can be created in our system (except for the <code>INSTANCE</code> we create)</p>
</li>
<li>
<p>the <code>INSTANCE</code> is also private, so it can&#8217;t be changed once set</p>
</li>
<li>
<p>we haven&#8217;t made the updating of votes thread-safe at this point (it doesn&#8217;t add to this example)</p>
</li>
<li>
<p>the vote collector instance is not lazily created (if we never reference the class, the instance won&#8217;t be created; however, as soon as we reference the class, the instance will be created even if not needed initially)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use this singleton class in some script code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> collector = VoteCollector.instance
collector.display()
collector.votes++
collector = <span style="color:#069">null</span>

<span style="color:#0a8;font-weight:bold">Thread</span>.start{
    <span style="color:#080;font-weight:bold">def</span> collector2 = VoteCollector.instance
    collector2.display()
    collector2.votes++
    collector2 = <span style="color:#069">null</span>
}.join()

<span style="color:#080;font-weight:bold">def</span> collector3 = VoteCollector.instance
collector3.display()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we used the instance 3 times. The second usage was even in a different thread (but don&#8217;t try this in a scenario with a new class loader).</p>
</div>
<div class="paragraph">
<p>Running this script yields (your hashcode value will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Collector:15959960, Votes:0
Collector:15959960, Votes:1
Collector:15959960, Votes:2</pre>
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To support lazy-loading and multi-threading, we could just use the <code>synchronized</code> keyword with the <code>getInstance()</code> method. This has a performance hit but will work.</p>
</li>
<li>
<p>We can consider variations involving double-checked locking and the <code>volatile</code> keyword, but see the limitations of this approach <a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_example_singleton_via_metaprogramming"><a class="link" href="#_example_singleton_via_metaprogramming">9.1.17.2. Example: Singleton via MetaProgramming</a></h5>
<div class="paragraph">
<p>Groovy&#8217;s meta-programming capabilities allow concepts like the singleton pattern to be enacted in a far more fundamental way. This example illustrates a simple way to use Groovy&#8217;s meta-programming capabilities to achieve the singleton pattern but not necessarily the most efficient way.</p>
</div>
<div class="paragraph">
<p>Suppose we want to keep track of the total number of calculations that a calculator performs. One way to do that is to use a singleton for the calculator class and keep a variable in the class with the count.</p>
</div>
<div class="paragraph">
<p>First we define some base classes. A <code>Calculator</code> class which performs calculations and records how many such calculations it performs and a <code>Client</code> class which acts as a facade to the calculator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Calculator</span> {
    <span style="color:#088;font-weight:bold">private</span> total = <span style="color:#00D">0</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b) { total++; a + b }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getTotalCalculations</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Total Calculations: </span><span style="color:#710">'</span></span> + total }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Calc: </span><span style="color:#710">'</span></span> + hashCode() }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> {
    <span style="color:#080;font-weight:bold">def</span> calc = <span style="color:#080;font-weight:bold">new</span> Calculator()
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">executeCalc</span>(a, b) { calc.add(a, b) }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Client: </span><span style="color:#710">'</span></span> + hashCode() }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and register a <em>MetaClass</em> which intercepts all attempts to create a <code>Calculator</code> object and always provides a pre-created instance instead. We also register this MetaClass with the Groovy system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalculatorMetaClass</span> <span style="color:#088;font-weight:bold">extends</span> MetaClassImpl {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> INSTANCE = <span style="color:#080;font-weight:bold">new</span> Calculator()
    CalculatorMetaClass() { <span style="color:#950">super</span>(Calculator) }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeConstructor</span>(<span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> arguments) { <span style="color:#080;font-weight:bold">return</span> INSTANCE }
}

<span style="color:#080;font-weight:bold">def</span> registry = GroovySystem.metaClassRegistry
registry.setMetaClass(Calculator, <span style="color:#080;font-weight:bold">new</span> CalculatorMetaClass())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we use instances of our <code>Client</code> class from within a script. The client class will attempt to create new instances of the calculator but will always get the singleton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> client = <span style="color:#080;font-weight:bold">new</span> Client()
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">3</span> == client.executeCalc(<span style="color:#00D">1</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span>

client = <span style="color:#080;font-weight:bold">new</span> Client()
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span> == client.executeCalc(<span style="color:#00D">2</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script (your hashcode values may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 7306473, Calc: 24230857, Total Calculations: 1
Client: 31436753, Calc: 24230857, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_guice_example"><a class="link" href="#_guice_example">9.1.17.3. Guice Example</a></h5>
<div class="paragraph">
<p>We can also implement the Singleton Pattern using <a href="https://github.com/google/guice">Guice</a>.</p>
</div>
<div class="paragraph">
<p>Consider the Calculator example again.</p>
</div>
<div class="paragraph">
<p>Guice is a Java-oriented framework that supports Interface-Oriented design. Hence we create a <code>Calculator</code> interface first. We can then create our <code>CalculatorImpl</code> implementation and a <code>Client</code> object which our script will interact with. The <code>Client</code> class isn&#8217;t strictly needed for this example but allows us to show that non-singleton instances are the default. Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grapes</span>([<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">aopalliance:aopalliance:1.0</span><span style="color:#710">'</span></span>), <span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.google.code.guice:guice:1.0</span><span style="color:#710">'</span></span>)])
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.google.inject.*</span>

<span style="color:#339;font-weight:bold">interface</span> Calculator {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalculatorImpl</span> <span style="color:#088;font-weight:bold">implements</span> Calculator {
    <span style="color:#088;font-weight:bold">private</span> total = <span style="color:#00D">0</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b) { total++; a + b }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getTotalCalculations</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Total Calculations: </span><span style="color:#710">'</span></span> + total }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Calc: </span><span style="color:#710">'</span></span> + hashCode() }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> {
    <span style="color:#007">@Inject</span> Calculator calc
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">executeCalc</span>(a, b) { calc.add(a, b) }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Client: </span><span style="color:#710">'</span></span> + hashCode() }
}

<span style="color:#080;font-weight:bold">def</span> injector = Guice.createInjector (
    [<span style="color:#606">configure</span>: { binding -&gt;
        binding.bind(Calculator)
               .to(CalculatorImpl)
               .asEagerSingleton() } ] <span style="color:#080;font-weight:bold">as</span> Module
)

<span style="color:#080;font-weight:bold">def</span> client = injector.getInstance(Client)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">3</span> == client.executeCalc(<span style="color:#00D">1</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span>

client = injector.getInstance(Client)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span> == client.executeCalc(<span style="color:#00D">2</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Inject</code> annotation in the <code>Client</code> class. We can always tell right in the source code which fields will be injected.</p>
</div>
<div class="paragraph">
<p>In this example we chose to use an <em>explicit</em> binding. All of our dependencies (ok, only one in this example at the moment) are configured in the binding. The Guide injector knows about the binding and injects the dependencies as required when we create objects. For the singleton pattern to hold, you must always use Guice to create your instances. Nothing shown so far would stop you creating another instance of the calculator manually using new CalculatorImpl() which would of course violate the desired singleton behaviour.</p>
</div>
<div class="paragraph">
<p>In other scenarios (though probably not in large systems), we could choose to express dependencies using annotations, such as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grapes</span>([<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">aopalliance:aopalliance:1.0</span><span style="color:#710">'</span></span>), <span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">com.google.code.guice:guice:1.0</span><span style="color:#710">'</span></span>)])
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">com.google.inject.*</span>

<span style="color:#007">@ImplementedBy</span>(CalculatorImpl)
<span style="color:#339;font-weight:bold">interface</span> Calculator {
    <span style="color:#777">// as before ...</span>
}

<span style="color:#007">@Singleton</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalculatorImpl</span> <span style="color:#088;font-weight:bold">implements</span> Calculator {
    <span style="color:#777">// as before ...</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> {
    <span style="color:#777">// as before ...</span>
}

<span style="color:#080;font-weight:bold">def</span> injector = Guice.createInjector()

<span style="color:#777">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Singleton</code> annotation on the <code>CalculatorImpl</code> class and the <code>@ImplementedBy</code> annotation in the <code>Calculator</code> interface.</p>
</div>
<div class="paragraph">
<p>When run, the above example (using either approach) yields (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 8897128, Calc: 17431955, Total Calculations: 1
Client: 21145613, Calc: 17431955, Total Calculations: 2</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we obtained a new client object whenever we asked for an instance but it was injected with the same calculator object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spring_example"><a class="link" href="#_spring_example">9.1.17.4. Spring Example</a></h5>
<div class="paragraph">
<p>We can do the Calculator example again using Spring as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#007">@Grapes</span>([<span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework:spring-core:5.2.8.RELEASE</span><span style="color:#710">'</span></span>), <span style="color:#007">@Grab</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.springframework:spring-beans:5.2.8.RELEASE</span><span style="color:#710">'</span></span>)])
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.beans.factory.support.*</span>

<span style="color:#339;font-weight:bold">interface</span> Calculator {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalculatorImpl</span> <span style="color:#088;font-weight:bold">implements</span> Calculator {
    <span style="color:#088;font-weight:bold">private</span> total = <span style="color:#00D">0</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(a, b) { total++; a + b }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">getTotalCalculations</span>() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Total Calculations: </span><span style="color:#710">'</span></span> + total }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Calc: </span><span style="color:#710">'</span></span> + hashCode() }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> {
    Client(Calculator calc) { <span style="color:#950">this</span>.calc = calc }
    <span style="color:#080;font-weight:bold">def</span> calc
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">executeCalc</span>(a, b) { calc.add(a, b) }
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Client: </span><span style="color:#710">'</span></span> + hashCode() }
}

<span style="color:#777">// Here we 'wire' up our dependencies through the API. Alternatively,</span>
<span style="color:#777">// we could use XML-based configuration or the Grails Bean Builder DSL.</span>
<span style="color:#080;font-weight:bold">def</span> factory = <span style="color:#080;font-weight:bold">new</span> DefaultListableBeanFactory()
factory.registerBeanDefinition(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">calc</span><span style="color:#710">'</span></span>, <span style="color:#080;font-weight:bold">new</span> RootBeanDefinition(CalculatorImpl))
<span style="color:#080;font-weight:bold">def</span> beanDef = <span style="color:#080;font-weight:bold">new</span> RootBeanDefinition(Client, <span style="color:#069">false</span>)
beanDef.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_AUTODETECT)
factory.registerBeanDefinition(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">client</span><span style="color:#710">'</span></span>, beanDef)

<span style="color:#080;font-weight:bold">def</span> client = factory.getBean(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">client</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">3</span> == client.executeCalc(<span style="color:#00D">1</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span>

client = factory.getBean(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">client</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span> == client.executeCalc(<span style="color:#00D">2</span>, <span style="color:#00D">2</span>)
println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>client</span><span style="color:#D20">.calc.totalCalculations</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the result (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 29418586, Calc: 10580099, Total Calculations: 1
Client: 14800362, Calc: 10580099, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_further_information"><a class="link" href="#_further_information">9.1.17.5. Further information</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.javaworld.com/javaworld/jw-04-2003/jw-0425-designpatterns.html?page=1">Simply Singleton</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/webservices/library/co-single/index.html">Use your singletons wisely</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">Double-checked locking and the Singleton pattern</a></p>
</li>
<li>
<p><a href="https://web.archive.org/web/20160807234810/http://blog.crazybob.org/2007/01/lazy-loading-singletons.html">Lazy Loading Singletons</a></p>
</li>
<li>
<p><a href="https://csharpindepth.com/Articles/Singleton">Implementing the Singleton Pattern in C#</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_state_pattern"><a class="link" href="#_state_pattern">9.1.18. State Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/State_pattern">State Pattern</a> provides a structured approach to partitioning the behaviour within complex systems. The overall behaviour of a system is partitioned into well-defined states. Typically, each state is implemented by a class. The overall system behaviour can be determined firstly by knowing the <em>current state</em> of the system; secondly, by understanding the behaviour possible while in that state (as embodied in the methods of the class corresponding to that state).</p>
</div>
<div class="sect4">
<h5 id="_example_8"><a class="link" href="#_example_8">9.1.18.1. Example</a></h5>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> {
    <span style="color:#080;font-weight:bold">def</span> context = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Context</span>()
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>() {
        context.state.connect()
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>() {
        context.state.disconnect()
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message) {
        context.state.send_message(message)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>() {
        context.state.receive_message()
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Context</span> {
    <span style="color:#080;font-weight:bold">def</span> state = <span style="color:#080;font-weight:bold">new</span> Offline(<span style="color:#950">this</span>)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ClientState</span> {
    <span style="color:#080;font-weight:bold">def</span> context
    ClientState(context) {
        <span style="color:#950">this</span>.context = context
        inform()
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Offline</span> <span style="color:#088;font-weight:bold">extends</span> ClientState {
    Offline(context) {
        <span style="color:#950">super</span>(context)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">inform</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">offline</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>() {
        context.state = <span style="color:#080;font-weight:bold">new</span> Online(context)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Online</span> <span style="color:#088;font-weight:bold">extends</span> ClientState {
    Online(context) {
        <span style="color:#950">super</span>(context)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">inform</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: already connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>() {
        context.state = <span style="color:#080;font-weight:bold">new</span> Offline(context)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>message</span><span style="color:#b0b">\&quot;</span><span style="color:#D20"> sent</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">message received</span><span style="color:#710">&quot;</span></span>
    }
}

client = <span style="color:#080;font-weight:bold">new</span> Client()
client.send_message(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
client.connect()
client.send_message(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>offline
error: not connected
connected
"Hello" sent
error: already connected
message received
offline</pre>
</div>
</div>
<div class="paragraph">
<p>One of the great things about a dynamic language like Groovy though is that we can take this example and express it in many different ways depending on our particular needs. Some potential variations for this example are shown below.</p>
</div>
</div>
<div class="sect4">
<h5 id="_variation_1_leveraging_interface_oriented_design"><a class="link" href="#_variation_1_leveraging_interface_oriented_design">9.1.18.2. Variation 1: Leveraging Interface-Oriented Design</a></h5>
<div class="paragraph">
<p>One approach we could take is to leverage <a href="http://www.pragmaticprogrammer.com/titles/kpiod/index.html">Interface-Oriented Design</a>. To do this, we could introduce the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> State {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>()
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>()
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message)
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then our <code>Client</code>, <code>Online</code> and 'Offline` classes could be modified to implement that interface, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> <span style="color:#088;font-weight:bold">implements</span> State {
  <span style="color:#777">// ... as before ...</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Online</span> <span style="color:#088;font-weight:bold">implements</span> State {
  <span style="color:#777">// ... as before ...</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Offline</span> <span style="color:#088;font-weight:bold">implements</span> State {
  <span style="color:#777">// ... as before ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might ask: Haven&#8217;t we just introduced additional boilerplate code? Can&#8217;t we rely on duck-typing for this? The answer is 'yes' and 'no'. We can get away with duck-typing but one of the key intentions of the state pattern is to partition complexity. If we know that the <em>client</em> class and each <em>state</em> class all satisfy one interface, then we have placed some key boundaries around the complexity. We can look at any state class in isolation and know the bounds of behaviour possible for that state.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t have to use interfaces for this, but it helps express the intent of this particular style of partitioning and it helps reduce the size of our unit tests (we would have to have additional tests in place to express this intent in languages which have less support for interface-oriented design).</p>
</div>
</div>
<div class="sect4">
<h5 id="_variation_2_extract_state_pattern_logic"><a class="link" href="#_variation_2_extract_state_pattern_logic">9.1.18.3. Variation 2: Extract State Pattern Logic</a></h5>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to extract some of our State Pattern logic into helper classes. For example, we could define the following classes in a state pattern package/jar/script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">InstanceProvider</span> {
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> registry = GroovySystem.metaClassRegistry
    <span style="color:#088;font-weight:bold">static</span> <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">create</span>(objectClass, param) {
        registry.getMetaClass(objectClass).invokeConstructor([param] <span style="color:#080;font-weight:bold">as</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>)
    }
}

<span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Context</span> {
    <span style="color:#088;font-weight:bold">private</span> context
    <span style="color:#088;font-weight:bold">protected</span> setContext(context) {
        <span style="color:#950">this</span>.context = context
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">invokeMethod</span>(<span style="color:#0a8;font-weight:bold">String</span> name, <span style="color:#0a8;font-weight:bold">Object</span> arg) {
        context.invokeMethod(name, arg)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">startFrom</span>(initialState) {
        setContext(InstanceProvider.create(initialState, <span style="color:#950">this</span>))
    }
}

<span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">State</span> {
    <span style="color:#088;font-weight:bold">private</span> client

    State(client) { <span style="color:#950">this</span>.client = client }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">transitionTo</span>(nextState) {
        client.setContext(InstanceProvider.create(nextState, client))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all quite generic and can be used wherever we want to introduce the state pattern. Here is what our code would look like now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Client</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Context</span> {
    Client() {
        startFrom(Offline)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Offline</span> <span style="color:#088;font-weight:bold">extends</span> State {
    Offline(client) {
        <span style="color:#950">super</span>(client)
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">offline</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>() {
        transitionTo(Online)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: not connected</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Online</span> <span style="color:#088;font-weight:bold">extends</span> State {
    Online(client) {
        <span style="color:#950">super</span>(client)
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">connect</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">error: already connected</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">disconnect</span>() {
        transitionTo(Offline)
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">send_message</span>(message) {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>message</span><span style="color:#b0b">\&quot;</span><span style="color:#D20"> sent</span><span style="color:#710">&quot;</span></span>
    }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">receive_message</span>() {
        println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">message received</span><span style="color:#710">&quot;</span></span>
    }
}

client = <span style="color:#080;font-weight:bold">new</span> Client()
client.send_message(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
client.connect()
client.send_message(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
client.connect()
client.receive_message()
client.disconnect()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the <code>startFrom</code> and <code>transitionTo</code> methods begin to give our example code a DSL feel.</p>
</div>
</div>
<div class="sect4">
<h5 id="_variation_3_bring_on_the_dsl"><a class="link" href="#_variation_3_bring_on_the_dsl">9.1.18.4. Variation 3: Bring on the DSL</a></h5>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might decide to fully embrace a Domain Specific Language (DSL) approach to this example.</p>
</div>
<div class="paragraph">
<p>We can define the following generic helper functions (first discussed <a href="https://web.archive.org/web/20170624004445/http://www.bytemycode.com:80/snippets/snippet/640/">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Grammar</span> {
    <span style="color:#080;font-weight:bold">def</span> fsm

    <span style="color:#080;font-weight:bold">def</span> event
    <span style="color:#080;font-weight:bold">def</span> fromState
    <span style="color:#080;font-weight:bold">def</span> toState

    Grammar(a_fsm) {
        fsm = a_fsm
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">on</span>(a_event) {
        event = a_event
        <span style="color:#950">this</span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">on</span>(a_event, a_transitioner) {
        on(a_event)
        a_transitioner.delegate = <span style="color:#950">this</span>
        a_transitioner.call()
        <span style="color:#950">this</span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">from</span>(a_fromState) {
        fromState = a_fromState
        <span style="color:#950">this</span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">to</span>(a_toState) {
        <span style="color:#080;font-weight:bold">assert</span> a_toState, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invalid toState: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>a_toState</span><span style="color:#710">&quot;</span></span>
        toState = a_toState
        fsm.registerTransition(<span style="color:#950">this</span>)
        <span style="color:#950">this</span>
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">isValid</span>() {
        event &amp;&amp; fromState &amp;&amp; toState
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>event</span><span style="color:#D20">: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>fromState</span><span style="color:#D20">=&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>toState</span><span style="color:#710">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FiniteStateMachine</span> {
    <span style="color:#080;font-weight:bold">def</span> transitions = [:]

    <span style="color:#080;font-weight:bold">def</span> initialState
    <span style="color:#080;font-weight:bold">def</span> currentState

    FiniteStateMachine(a_initialState) {
        <span style="color:#080;font-weight:bold">assert</span> a_initialState, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">You need to provide an initial state</span><span style="color:#710">&quot;</span></span>
        initialState = a_initialState
        currentState = a_initialState
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">record</span>() {
        Grammar.newInstance(<span style="color:#950">this</span>)
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">reset</span>() {
        currentState = initialState
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">isState</span>(a_state) {
        currentState == a_state
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">registerTransition</span>(a_grammar) {
        <span style="color:#080;font-weight:bold">assert</span> a_grammar.isValid(), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invalid transition (</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>a_grammar</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">def</span> transition
        <span style="color:#080;font-weight:bold">def</span> event = a_grammar.event
        <span style="color:#080;font-weight:bold">def</span> fromState = a_grammar.fromState
        <span style="color:#080;font-weight:bold">def</span> toState = a_grammar.toState

        <span style="color:#080;font-weight:bold">if</span> (!transitions[event]) {
            transitions[event] = [:]
        }

        transition = transitions[event]
        <span style="color:#080;font-weight:bold">assert</span> !transition[fromState], <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Duplicate fromState </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>fromState</span><span style="color:#D20"> for transition </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>a_grammar</span><span style="color:#710">&quot;</span></span>
        transition[fromState] = toState
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fire</span>(a_event) {
        <span style="color:#080;font-weight:bold">assert</span> currentState, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invalid current state '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>currentState</span><span style="color:#D20">': passed into constructor</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">assert</span> transitions.containsKey(a_event), <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invalid event '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>a_event</span><span style="color:#D20">', should be one of </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>transitions.keySet()<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">def</span> transition = transitions[a_event]
        <span style="color:#080;font-weight:bold">def</span> nextState = transition[currentState]
        <span style="color:#080;font-weight:bold">assert</span> nextState, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">There is no transition from '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>currentState</span><span style="color:#D20">' to any other state</span><span style="color:#710">&quot;</span></span>
        currentState = nextState
        currentState
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and test our state machine like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">StatePatternDslTest</span> <span style="color:#088;font-weight:bold">extends</span> GroovyTestCase {
    <span style="color:#088;font-weight:bold">private</span> fsm

    <span style="color:#088;font-weight:bold">protected</span> <span style="color:#339;font-weight:bold">void</span> setUp() {
        fsm = FiniteStateMachine.newInstance(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">offline</span><span style="color:#710">'</span></span>)
        <span style="color:#080;font-weight:bold">def</span> recorder = fsm.record()
        recorder.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">connect</span><span style="color:#710">'</span></span>).from(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">offline</span><span style="color:#710">'</span></span>).to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>)
        recorder.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">disconnect</span><span style="color:#710">'</span></span>).from(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>).to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">offline</span><span style="color:#710">'</span></span>)
        recorder.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">send_message</span><span style="color:#710">'</span></span>).from(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>).to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>)
        recorder.on(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">receive_message</span><span style="color:#710">'</span></span>).from(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>).to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span>)
    }

    <span style="color:#339;font-weight:bold">void</span> testInitialState() {
        <span style="color:#080;font-weight:bold">assert</span> fsm.isState(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">offline</span><span style="color:#710">'</span></span>)
    }

    <span style="color:#339;font-weight:bold">void</span> testOfflineState() {
        shouldFail{
            fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">send_message</span><span style="color:#710">'</span></span>)
        }
        shouldFail{
            fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">receive_message</span><span style="color:#710">'</span></span>)
        }
        shouldFail{
            fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">disconnect</span><span style="color:#710">'</span></span>)
        }
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">online</span><span style="color:#710">'</span></span> == fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">connect</span><span style="color:#710">'</span></span>)
    }

    <span style="color:#339;font-weight:bold">void</span> testOnlineState() {
        fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">connect</span><span style="color:#710">'</span></span>)
        fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">send_message</span><span style="color:#710">'</span></span>)
        fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">receive_message</span><span style="color:#710">'</span></span>)
        shouldFail{
            fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">connect</span><span style="color:#710">'</span></span>)
        }
        <span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">offline</span><span style="color:#710">'</span></span> == fsm.fire(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">disconnect</span><span style="color:#710">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example isn&#8217;t an exact equivalent of the others. It doesn&#8217;t use predefined <code>Online</code> and <code>Offline</code> classes.
Instead, it defines the entire state machine on the fly as needed.
See the <a href="https://web.archive.org/web/20170624004445/http://www.bytemycode.com:80/snippets/snippet/640/">previous reference</a> for more elaborate examples of this style.</p>
</div>
<div class="paragraph">
<p>See also: <a href="https://web.archive.org/web/20150102211229/http://groovy.codehaus.org/Model-based+testing+using+ModelJUnit">Model-based testing using ModelJUnit</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_strategy_pattern"><a class="link" href="#_strategy_pattern">9.1.19. Strategy Pattern</a></h4>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a> allows you to abstract away particular algorithms from their usage. This allows you to easily swap the algorithm being used without having to change the calling code. The general form of the pattern is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="StrategyClasses.png" alt="StrategyClasses" width="628" height="197">
</div>
</div>
<div class="paragraph">
<p>In Groovy, because of its ability to treat code as a first class object using anonymous methods (which we loosely call <em>Closures</em>), the need for the strategy pattern is greatly reduced. You can simply place algorithms inside Closures.</p>
</div>
<div class="sect4">
<h5 id="_example_using_traditional_class_hierarchy"><a class="link" href="#_example_using_traditional_class_hierarchy">9.1.19.1. Example using traditional class hierarchy</a></h5>
<div class="paragraph">
<p>First let&#8217;s look at the traditional way of encapsulating the Strategy Pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">execute</span>(n, m)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalcByMult</span> <span style="color:#088;font-weight:bold">implements</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">execute</span>(n, m) { n * m }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CalcByManyAdds</span> <span style="color:#088;font-weight:bold">implements</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">execute</span>(n, m) {
        <span style="color:#080;font-weight:bold">def</span> result = <span style="color:#00D">0</span>
        n.times{
            result += m
        }

        result
    }
}

<span style="color:#080;font-weight:bold">def</span> sampleData = [
    [<span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">12</span>],
    [<span style="color:#00D">5</span>, -<span style="color:#00D">5</span>, -<span style="color:#00D">25</span>]
]

Calc<span style="color:#339;font-weight:bold">[]</span> multiplicationStrategies = [
    <span style="color:#080;font-weight:bold">new</span> CalcByMult(),
    <span style="color:#080;font-weight:bold">new</span> CalcByManyAdds()
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        <span style="color:#080;font-weight:bold">assert</span> data[<span style="color:#00D">2</span>] == calc.execute(data[<span style="color:#00D">0</span>], data[<span style="color:#00D">1</span>])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have defined an interface <code>Calc</code> which our concrete strategy classes will implement (we could also have used an abstract class).
We then defined two algorithms for doing simple multiplication: <code>CalcByMult</code> the normal way, and CalcByManyAdds using only addition (don&#8217;t try this one using negative numbers - yes we could fix this but it would just make the example longer).
We then use normal <a href="http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming">polymorphism</a> to invoke the algorithms.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example_using_closures"><a class="link" href="#_example_using_closures">9.1.19.2. Example using closures</a></h5>
<div class="paragraph">
<p>Here is the Groovier way to achieve the same thing using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> multiplicationStrategies = [
    { n, m -&gt; n * m },
    { n, m -&gt; <span style="color:#080;font-weight:bold">def</span> result = <span style="color:#00D">0</span>; n.times{ result += m }; result }
]

<span style="color:#080;font-weight:bold">def</span> sampleData = [
    [<span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">12</span>],
    [<span style="color:#00D">5</span>, -<span style="color:#00D">5</span>, -<span style="color:#00D">25</span>]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        <span style="color:#080;font-weight:bold">assert</span> data[<span style="color:#00D">2</span>] == calc(data[<span style="color:#00D">0</span>], data[<span style="color:#00D">1</span>])
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_using_lambdas"><a class="link" href="#_example_using_lambdas">9.1.19.3. Example using lambdas</a></h5>
<div class="paragraph">
<p>For Groovy 3+, we can leverage lambda syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Calc {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">execute</span>(n, m)
}

<span style="color:#0a8;font-weight:bold">List</span>&lt;Calc&gt; multiplicationStrategies = [
    (n, m) -&gt; n * m,
    (n, m) -&gt; { <span style="color:#080;font-weight:bold">def</span> result = <span style="color:#00D">0</span>; n.times{ result += m }; result }
]

<span style="color:#080;font-weight:bold">def</span> sampleData = [
    [<span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">12</span>],
    [<span style="color:#00D">5</span>, -<span style="color:#00D">5</span>, -<span style="color:#00D">25</span>]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        <span style="color:#080;font-weight:bold">assert</span> data[<span style="color:#00D">2</span>] == calc(data[<span style="color:#00D">0</span>], data[<span style="color:#00D">1</span>])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can use the built-in JDK <code>BiFunction</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.function.BiFunction</span>

<span style="color:#0a8;font-weight:bold">List</span>&lt;BiFunction&lt;<span style="color:#0a8;font-weight:bold">Integer</span>, <span style="color:#0a8;font-weight:bold">Integer</span>, <span style="color:#0a8;font-weight:bold">Integer</span>&gt;&gt; multiplicationStrategies = [
    (n, m) -&gt; n * m,
    (n, m) -&gt; { <span style="color:#080;font-weight:bold">def</span> result = <span style="color:#00D">0</span>; n.times{ result += m }; result }
]

<span style="color:#080;font-weight:bold">def</span> sampleData = [
    [<span style="color:#00D">3</span>, <span style="color:#00D">4</span>, <span style="color:#00D">12</span>],
    [<span style="color:#00D">5</span>, -<span style="color:#00D">5</span>, -<span style="color:#00D">25</span>]
]

sampleData.each{ data -&gt;
    multiplicationStrategies.each { calc -&gt;
        <span style="color:#080;font-weight:bold">assert</span> data[<span style="color:#00D">2</span>] == calc(data[<span style="color:#00D">0</span>], data[<span style="color:#00D">1</span>])
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_template_method_pattern"><a class="link" href="#_template_method_pattern">9.1.20. Template Method Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Template_method_pattern">Template Method Pattern</a> abstracts
away the details of several algorithms.
The generic part of an algorithm is contained within a base class.
Particular implementation details are captured within child classes.
The generic pattern of classes involved looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="TemplateMethodClasses.png" alt="TemplateMethodClasses" width="547" height="264">
</div>
</div>
<div class="sect4">
<h5 id="_example_with_traditional_classes_2"><a class="link" href="#_example_with_traditional_classes_2">9.1.20.1. Example with traditional classes</a></h5>
<div class="paragraph">
<p>In this example, the base <code>Accumulator</code> class captures the essence of the accumulation algorithm.
The child classes <code>Sum</code> and <code>Product</code> provide particular customised ways to use the generic accumulation algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Accumulator</span> {
    <span style="color:#088;font-weight:bold">protected</span> initial
    <span style="color:#088;font-weight:bold">abstract</span> doAccumulate(total, v)
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accumulate</span>(values) {
        <span style="color:#080;font-weight:bold">def</span> total = initial
        values.each { v -&gt; total = doAccumulate(total, v) }
        total
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Sum</span> <span style="color:#088;font-weight:bold">extends</span> Accumulator {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">Sum</span>() { initial = <span style="color:#00D">0</span> }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">doAccumulate</span>(total, v) { total + v }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Product</span> <span style="color:#088;font-weight:bold">extends</span> Accumulator {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">Product</span>() { initial = <span style="color:#00D">1</span> }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">doAccumulate</span>(total, v) { total * v }
}

<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">10</span> == <span style="color:#080;font-weight:bold">new</span> Sum().accumulate([<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>])
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">24</span> == <span style="color:#080;font-weight:bold">new</span> Product().accumulate([<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>,<span style="color:#00D">4</span>])</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_with_simplifying_strategies"><a class="link" href="#_example_with_simplifying_strategies">9.1.20.2. Example with simplifying strategies</a></h5>
<div class="paragraph">
<p>In this particular case, you could use Groovy&#8217;s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Closure addAll = { total, item -&gt; total += item }
<span style="color:#080;font-weight:bold">def</span> accumulated = [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>].inject(<span style="color:#00D">0</span>, addAll)
<span style="color:#080;font-weight:bold">assert</span> accumulated == <span style="color:#00D">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to duck-typing, this would also work with other objects which support an add (<code>plus()</code> in Groovy) method, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">accumulated = [ <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">3</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span> ].inject(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>, addAll)
<span style="color:#080;font-weight:bold">assert</span> accumulated == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1234</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also do the multiplication case as follows (re-writing as a one-liner):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">24</span> == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>].inject(<span style="color:#00D">1</span>) { total, item -&gt; total *= item }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using closures this way looks like the <a href="#_strategy_pattern">Strategy Pattern</a>, but if we realise
that Groovy&#8217;s <code>inject</code> method is the generic part of the algorithm for our template method,
then the Closures become the customised parts of the template method pattern.</p>
</div>
<div class="paragraph">
<p>For Groovy 3+, we can use lambda syntax as an alternative to the closure syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">10</span> == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>].stream().reduce(<span style="color:#00D">0</span>, (l, r) -&gt; l + r)
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">24</span> == [<span style="color:#00D">1</span>, <span style="color:#00D">2</span>, <span style="color:#00D">3</span>, <span style="color:#00D">4</span>].stream().reduce(<span style="color:#00D">1</span>, (l, r) -&gt; l * r)
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1234</span><span style="color:#710">'</span></span> == [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">2</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">3</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">4</span><span style="color:#710">'</span></span>].stream().reduce(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>, (l, r) -&gt; l + r)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the stream api&#8217;s <code>reduce</code> method is the generic part of the algorithm for our template method,
and the lambdas are the customised parts of the template method pattern.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_visitor_pattern"><a class="link" href="#_visitor_pattern">9.1.21. Visitor Pattern</a></h4>
<div class="paragraph">
<p>The <a href="https://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> is one of those well-known but not
often used patterns. Perhaps this is because it seems a little complex at first.
But once you become familiar with it, it becomes a powerful way to evolve your code
and as we&#8217;ll see, Groovy provides ways to reduce some to the complexity, so there is
no reason not to consider using this pattern.</p>
</div>
<div class="paragraph">
<p>The goal of the pattern is to separate an algorithm from an object structure.
A practical result of this separation is the ability to add new operations to existing
object structures without modifying those structures.</p>
</div>
<div class="sect4">
<h5 id="_simple_example_2"><a class="link" href="#_simple_example_2">9.1.21.1. Simple Example</a></h5>
<div class="paragraph">
<p>This example considers how to calculate the bounds of shapes (or collections of shapes).
Our first attempt uses the traditional visitor pattern.
We will see a more Groovy way to do this shortly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Shape</span> { }

<span style="color:#007">@ToString</span>(includeNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Rectangle</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> x, y, w, h

    <span style="color:#0a8;font-weight:bold">Rectangle</span>(x, y, w, h) {
        <span style="color:#950">this</span>.x = x; <span style="color:#950">this</span>.y = y; <span style="color:#950">this</span>.w = w; <span style="color:#950">this</span>.h = h
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">union</span>(rect) {
        <span style="color:#080;font-weight:bold">if</span> (!rect) <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>
        <span style="color:#080;font-weight:bold">def</span> minx = [rect.x, x].min()
        <span style="color:#080;font-weight:bold">def</span> maxx = [rect.x + rect.w, x + w].max()
        <span style="color:#080;font-weight:bold">def</span> miny = [rect.y, y].min()
        <span style="color:#080;font-weight:bold">def</span> maxy = [rect.y + rect.h, y + h].max()
        <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(minx, miny, maxx - minx, maxy - miny)
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(visitor) {
        visitor.visit_rectangle(<span style="color:#950">this</span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Line</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> x1, y1, x2, y2

    <span style="color:#0a8;font-weight:bold">Line</span>(x1, y1, x2, y2) {
        <span style="color:#950">this</span>.x1 = x1; <span style="color:#950">this</span>.y1 = y1; <span style="color:#950">this</span>.x2 = x2; <span style="color:#950">this</span>.y2 = y2
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(visitor){
        visitor.visit_line(<span style="color:#950">this</span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Group</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> shapes = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">add</span>(shape) { shapes += shape }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">remove</span>(shape) { shapes -= shape }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(visitor) {
        visitor.visit_group(<span style="color:#950">this</span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BoundingRectangleVisitor</span> {
    <span style="color:#080;font-weight:bold">def</span> bounds

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">visit_rectangle</span>(rectangle) {
        <span style="color:#080;font-weight:bold">if</span> (bounds)
            bounds = bounds.union(rectangle)
        <span style="color:#080;font-weight:bold">else</span>
            bounds = rectangle
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">visit_line</span>(line) {
        <span style="color:#080;font-weight:bold">def</span> line_bounds = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>([line.x1, line.x2].min(),
                                        [line.y1, line.y2].min(),
                                        line.x2 - line.y1,
                                        line.x2 - line.y2)
        <span style="color:#080;font-weight:bold">if</span> (bounds)
            bounds = bounds.union(line_bounds)
        <span style="color:#080;font-weight:bold">else</span>
            bounds = line_bounds
    }

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">visit_group</span>(group) {
        group.shapes.each { shape -&gt; shape.accept(<span style="color:#950">this</span>) }
    }
}

<span style="color:#080;font-weight:bold">def</span> group = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Group</span>()
group.add(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#00D">100</span>, <span style="color:#00D">40</span>, <span style="color:#00D">10</span>, <span style="color:#00D">5</span>))
group.add(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#00D">100</span>, <span style="color:#00D">70</span>, <span style="color:#00D">10</span>, <span style="color:#00D">5</span>))
group.add(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Line</span>(<span style="color:#00D">90</span>, <span style="color:#00D">30</span>, <span style="color:#00D">60</span>, <span style="color:#00D">5</span>))
<span style="color:#080;font-weight:bold">def</span> visitor = <span style="color:#080;font-weight:bold">new</span> BoundingRectangleVisitor()
group.accept(visitor)
bounding_box = visitor.bounds
<span style="color:#080;font-weight:bold">assert</span> bounding_box.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rectangle(x:60, y:5, w:50, h:70)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That took quite a bit of code, but the idea now is that we could add
further algorithms just by adding new visitors with our shape classes remaining
unchanged, e.g. we could add a total area visitor or a collision detection visitor.</p>
</div>
<div class="paragraph">
<p>We can improve the clarity of our code (and shrink it to about half the size) by
making use of Groovy Closures as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(Closure yield) { yield(<span style="color:#950">this</span>) }
}

<span style="color:#007">@ToString</span>(includeNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Rectangle</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> x, y, w, h
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bounds</span>() { <span style="color:#950">this</span> }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">union</span>(rect) {
        <span style="color:#080;font-weight:bold">if</span> (!rect) <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>
        <span style="color:#080;font-weight:bold">def</span> minx = [ rect.x, x ].min()
        <span style="color:#080;font-weight:bold">def</span> maxx = [ rect.x + rect.w, x + w ].max()
        <span style="color:#080;font-weight:bold">def</span> miny = [ rect.y, y ].min()
        <span style="color:#080;font-weight:bold">def</span> maxy = [ rect.y + rect.h, y + h ].max()
        <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:minx, <span style="color:#606">y</span>:miny, <span style="color:#606">w</span>:maxx - minx, <span style="color:#606">h</span>:maxy - miny)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Line</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> x1, y1, x2, y2
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bounds</span>() {
        <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:[x1, x2].min(), <span style="color:#606">y</span>:[y1, y2].min(),
                      <span style="color:#606">w</span>:(x2 - x1).abs(), <span style="color:#606">h</span>:(y2 - y1).abs())
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Group</span> {
    <span style="color:#080;font-weight:bold">def</span> shapes = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">leftShift</span>(shape) { shapes += shape }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(Closure yield) { shapes.each{<span style="color:#950">it</span>.accept(yield)} }
}

<span style="color:#080;font-weight:bold">def</span> group = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Group</span>()
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:<span style="color:#00D">100</span>, <span style="color:#606">y</span>:<span style="color:#00D">40</span>, <span style="color:#606">w</span>:<span style="color:#00D">10</span>, <span style="color:#606">h</span>:<span style="color:#00D">5</span>)
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:<span style="color:#00D">100</span>, <span style="color:#606">y</span>:<span style="color:#00D">70</span>, <span style="color:#606">w</span>:<span style="color:#00D">10</span>, <span style="color:#606">h</span>:<span style="color:#00D">5</span>)
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Line</span>(<span style="color:#606">x1</span>:<span style="color:#00D">90</span>, <span style="color:#606">y1</span>:<span style="color:#00D">30</span>, <span style="color:#606">x2</span>:<span style="color:#00D">60</span>, <span style="color:#606">y2</span>:<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">def</span> bounds
group.accept{ bounds = <span style="color:#950">it</span>.bounds().union(bounds) }
<span style="color:#080;font-weight:bold">assert</span> bounds.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rectangle(x:60, y:5, w:50, h:70)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, using lambdas as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">abstract</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Shape</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(Function&lt;<span style="color:#0a8;font-weight:bold">Shape</span>, <span style="color:#0a8;font-weight:bold">Shape</span>&gt; yield) { yield.apply(<span style="color:#950">this</span>) }
}

<span style="color:#007">@ToString</span>(includeNames=<span style="color:#069">true</span>)
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Rectangle</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#777">/* ... same as with Closures ... */</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Line</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#0a8;font-weight:bold">Shape</span> {
    <span style="color:#777">/* ... same as with Closures ... */</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Group</span> {
    <span style="color:#080;font-weight:bold">def</span> shapes = <span style="color:#339;font-weight:bold">[]</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">leftShift</span>(shape) { shapes += shape }
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">accept</span>(Function&lt;<span style="color:#0a8;font-weight:bold">Shape</span>, <span style="color:#0a8;font-weight:bold">Shape</span>&gt; yield) {
        shapes.stream().forEach(s -&gt; s.accept(yield))
    }
}

<span style="color:#080;font-weight:bold">def</span> group = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Group</span>()
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:<span style="color:#00D">100</span>, <span style="color:#606">y</span>:<span style="color:#00D">40</span>, <span style="color:#606">w</span>:<span style="color:#00D">10</span>, <span style="color:#606">h</span>:<span style="color:#00D">5</span>)
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Rectangle</span>(<span style="color:#606">x</span>:<span style="color:#00D">100</span>, <span style="color:#606">y</span>:<span style="color:#00D">70</span>, <span style="color:#606">w</span>:<span style="color:#00D">10</span>, <span style="color:#606">h</span>:<span style="color:#00D">5</span>)
group &lt;&lt; <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Line</span>(<span style="color:#606">x1</span>:<span style="color:#00D">90</span>, <span style="color:#606">y1</span>:<span style="color:#00D">30</span>, <span style="color:#606">x2</span>:<span style="color:#00D">60</span>, <span style="color:#606">y2</span>:<span style="color:#00D">5</span>)
<span style="color:#080;font-weight:bold">def</span> bounds
group.accept(s -&gt; { bounds = s.bounds().union(bounds) })
<span style="color:#080;font-weight:bold">assert</span> bounds.toString() == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Rectangle(x:60, y:5, w:50, h:70)</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_example"><a class="link" href="#_advanced_example">9.1.21.2. Advanced Example</a></h5>
<div class="paragraph">
<p>Let&#8217;s consider another example to illustrate some more points about this pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Visitor {
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1)
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType2 n2)
}

<span style="color:#339;font-weight:bold">interface</span> Visitable {
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#080;font-weight:bold">new</span> Visitable[<span style="color:#00D">0</span>]
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor) {
        visitor.visit(<span style="color:#950">this</span>)
        <span style="color:#080;font-weight:bold">for</span>(<span style="color:#339;font-weight:bold">int</span> i = <span style="color:#00D">0</span>; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType2</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#080;font-weight:bold">new</span> Visitable[<span style="color:#00D">0</span>]
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor) {
        visitor.visit(<span style="color:#950">this</span>)
        <span style="color:#080;font-weight:bold">for</span>(<span style="color:#339;font-weight:bold">int</span> i = <span style="color:#00D">0</span>; i &lt; children.length; ++i) {
            children[i].accept(visitor)
        }
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1Counter</span> <span style="color:#088;font-weight:bold">implements</span> Visitor {
    <span style="color:#339;font-weight:bold">int</span> count = <span style="color:#00D">0</span>
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        count++
    }
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType2 n2){}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now use <code>NodeType1Counter</code> on a tree like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">NodeType1 root = <span style="color:#080;font-weight:bold">new</span> NodeType1()
root.children = <span style="color:#080;font-weight:bold">new</span> Visitable<span style="color:#339;font-weight:bold">[]</span>{<span style="color:#080;font-weight:bold">new</span> NodeType1(), <span style="color:#080;font-weight:bold">new</span> NodeType2()}

<span style="color:#080;font-weight:bold">def</span> counter = <span style="color:#080;font-weight:bold">new</span> NodeType1Counter()
root.accept(counter)
<span style="color:#080;font-weight:bold">assert</span> counter.count == <span style="color:#00D">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we have one <code>NodeType1</code> object as root and one of the children is also a <code>NodeType1</code> instance.
The other child is a <code>NodeType2</code> instance.
That means using <code>NodeType1Counter</code> here should count 2 <code>NodeType1</code> objects as the last statement verifies.</p>
</div>
<div class="sect5">
<h6 id="_when_to_use_this"><a class="link" href="#_when_to_use_this">When to use this</a></h6>
<div class="paragraph">
<p>This example illustrates some of the advantages of the visitor pattern.
For example, while our visitor has state (the count of <code>NodeType1</code> objects), the tree of objects itself is not changed.
Similarly, if we wanted to have a visitor counting all node types,
or one that counts how many different types are used, or one that gathers information
using methods special to the node types, again, the visitor alone is all that would need to be written.</p>
</div>
</div>
<div class="sect5">
<h6 id="_what_happens_if_we_add_a_new_type"><a class="link" href="#_what_happens_if_we_add_a_new_type">What happens if we add a new type?</a></h6>
<div class="paragraph">
<p>In this case we might have a fair bit of work to do. We probably have to change the <code>Visitor</code> interface to accept the new type,
and change potentially most existing visitors based on that interface change,
and we have to write the new type itself.
A better approach is to write a default implementation of the visitor which all concrete visitors will extend.
We&#8217;ll see this approach in use shortly.</p>
</div>
</div>
<div class="sect5">
<h6 id="_what_if_we_want_to_have_different_iteration_patterns"><a class="link" href="#_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</a></h6>
<div class="paragraph">
<p>Then you have a problem.
Since the node describes how to iterate, you have no influence and stop iteration at a point or change the order.
So maybe we should change this a little to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">interface</span> Visitor {
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1)
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType2 n2)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DefaultVisitor</span> <span style="color:#088;font-weight:bold">implements</span> Visitor{
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        <span style="color:#080;font-weight:bold">for</span>(<span style="color:#339;font-weight:bold">int</span> i = <span style="color:#00D">0</span>; i &lt; n1.children.length; ++i) {
            n1.children[i].accept(<span style="color:#950">this</span>)
        }
    }
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType2 n2) {
        <span style="color:#080;font-weight:bold">for</span>(<span style="color:#339;font-weight:bold">int</span> i = <span style="color:#00D">0</span>; i &lt; n2.children.length; ++i) {
            n2.children[i].accept(<span style="color:#950">this</span>)
        }
    }
}

<span style="color:#339;font-weight:bold">interface</span> Visitable {
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor)
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#080;font-weight:bold">new</span> Visitable[<span style="color:#00D">0</span>]
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor) {
        visitor.visit(<span style="color:#950">this</span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType2</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#080;font-weight:bold">new</span> Visitable[<span style="color:#00D">0</span>];
    <span style="color:#339;font-weight:bold">void</span> accept(Visitor visitor) {
        visitor.visit(<span style="color:#950">this</span>)
    }
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1Counter</span> <span style="color:#088;font-weight:bold">extends</span> DefaultVisitor {
    <span style="color:#339;font-weight:bold">int</span> count = <span style="color:#00D">0</span>
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        count++
        <span style="color:#950">super</span>.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some small changes but with big effect.
The visitor is now recursive and tells me how to iterate.
The implementation in the Nodes is minimized to <code>visitor.visit(this)</code>, <code>DefaultVisitor</code> is now able to catch the new types, we can stop iteration by not delegating to super.
Of course the big disadvantage now is that it is no longer iterative, but you can&#8217;t get all the benefits.</p>
</div>
</div>
<div class="sect5">
<h6 id="_make_it_groovy"><a class="link" href="#_make_it_groovy">Make it Groovy</a></h6>
<div class="paragraph">
<p>The question now is how to make that a bit more Groovy.
Didn&#8217;t you find this <code>visitor.visit(this)</code> strange? Why is it there?
The answer is to simulate double dispatch.
In Java, the compile time type is used, so for <code>visitor.visit(children[i])</code> the compiler won&#8217;t be
able to find the correct method, because <code>Visitor</code> does not contain a method <code>visit(Visitable)</code>.
And even if it would, we would like to visit the more special methods with <code>NodeType1</code> or <code>NodeType2</code>.</p>
</div>
<div class="paragraph">
<p>Now Groovy is not using the static type, Groovy uses the runtime type.
This means we can use <code>visitor.visit(children[i])</code> without any problem.
Since we minimized the accept method to just do the double dispatch part and
since the runtime type system of Groovy will already cover that, do we need the accept method?
Not really, but we can do even more.
We had the disadvantage of not knowing how to handle unknown tree elements.
We had to <em>extend</em> the interface <code>Visitor</code> for that, resulting in changes to <code>DefaultVisitor</code> and
then we have the task to provide a useful default like iterating the node or not doing anything at all.
Now with Groovy we can catch that case by adding a <code>visit(Visitable)</code> method that does nothing.
That would be the same in Java btw.</p>
</div>
<div class="paragraph">
<p>But don&#8217;t let us stop here. Do we need the <code>Visitor</code> interface?
If we don&#8217;t have the accept method, then we don&#8217;t need the <code>Visitor</code> interface at all.
So the new code would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DefaultVisitor</span> {
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        n1.children.each { visit(<span style="color:#950">it</span>) }
    }
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType2 n2) {
        n2.children.each { visit(<span style="color:#950">it</span>) }
    }
    <span style="color:#339;font-weight:bold">void</span> visit(Visitable v) { }
}

<span style="color:#339;font-weight:bold">interface</span> Visitable { }

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType2</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1Counter</span> <span style="color:#088;font-weight:bold">extends</span> DefaultVisitor {
    <span style="color:#339;font-weight:bold">int</span> count = <span style="color:#00D">0</span>
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        count++
        <span style="color:#950">super</span>.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looks like we saved a few lines of code here, but we made more.
The <code>Visitable</code> nodes now do not refer to any <code>Visitor</code> class or interface.
This is about the best level of separation you might expect here, but we can go further.
Let&#8217;s change the <code>Visitable</code> interface a little and let it return the children we want to visit next.
This allows us a general iteration method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DefaultVisitor</span> {
    <span style="color:#339;font-weight:bold">void</span> visit(Visitable v) {
        doIteration(v)
    }
    <span style="color:#339;font-weight:bold">void</span> doIteration(Visitable v) {
        v.children.each {
            visit(<span style="color:#950">it</span>)
        }
    }
}

<span style="color:#339;font-weight:bold">interface</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> getChildren()
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType2</span> <span style="color:#088;font-weight:bold">implements</span> Visitable {
    Visitable<span style="color:#339;font-weight:bold">[]</span> children = <span style="color:#339;font-weight:bold">[]</span>
}

<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">NodeType1Counter</span> <span style="color:#088;font-weight:bold">extends</span> DefaultVisitor {
    <span style="color:#339;font-weight:bold">int</span> count = <span style="color:#00D">0</span>
    <span style="color:#339;font-weight:bold">void</span> visit(NodeType1 n1) {
        count++
        <span style="color:#950">super</span>.visit(n1)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DefaultVisitor</code> now looks a bit different.
It has a <code>doIteration</code> method that will get the children it should iterate over and then call visit on each element.
Per default this will call <code>visit(Visitable)</code> which then iterates over the children of this child.
<code>Visitable</code> has also changed to ensure that any node will be able to return children (even if empty).
We didn&#8217;t have to change the <code>NodeType1</code> and <code>NodeType2</code> class, because the way the children field was
defined already made them a property, which means Groovy is so nice to generate a get method for us.
Now the really interesting part is <code>NodeType1Counter</code>, it is interesting because we have not changed it.
<code>super.visit(n1)</code> will now call <code>visit(Visitable)</code> which will call <code>doIteration</code> which will start the next level of iteration.
So no change. But <code>visit(it)</code> will call <code>visit(NodeType1)</code> if it is of type <code>NodeType1</code>.
In fact, we don&#8217;t need the <code>doIteration</code> method, we could do that in <code>visit(Visitable)</code> too,
but this variant has some benefits. It allows us to write a new <code>Visitor</code> that overwrites visit(<code>Visitable</code>)
for error cases which of course means we must not do <code>super.visit(n1)</code> but <code>doIteration(n1)</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_summary"><a class="link" href="#_summary">Summary</a></h6>
<div class="paragraph">
<p>In the end we got ~40% less code, a robust and stable architecture,
and we completely removed the Visitor from the Visitable.
To achieve the same in Java, you would probably need to resort to reflection.</p>
</div>
<div class="paragraph">
<p>The visitor pattern has sometimes been described as a poor fit for extreme programming
techniques because you need to make changes to so many classes all the time.
With our design, if we add new types we don&#8217;t need to change anything.
So, the pattern is a good fit for agile approaches when using Groovy.</p>
</div>
<div class="paragraph">
<p>There are variants of the Visitor pattern, like the <a href="https://java-design-patterns.com/patterns/acyclic-visitor/">acyclic visitor pattern</a>,
that try to solve the problem of adding new node types with special visitors.
The implementations of these visitors have their own code smells, like using casts, overuse of <code>instanceof</code>, and other tricks.
What&#8217;s more the problems such approaches are trying to solve don&#8217;t occur within the Groovy version. We recommend avoiding that variant of this pattern.</p>
</div>
<div class="paragraph">
<p>Finally, in case it isn&#8217;t obvious, <code>NodeType1Counter</code> could be implemented in Java as well.
Groovy will recognize the visit methods and call them as needed because <code>DefaultVisitor</code> is still Groovy and does all the magic.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_further_information_2"><a class="link" href="#_further_information_2">9.1.21.3. Further Information</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://se.ethz.ch/~meyer/publications/computer/visitor.pdf">Componentization: the Visitor example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_references"><a class="link" href="#_references">9.2. References</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides (1995). <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>. Addison-Wesley. ISBN 0-201-63361-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>The canonical reference of design patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Martin Fowler (1999). <em>Refactoring: Improving the Design of Existing Code</em>. Addison-Wesley. ISBN 0-201-48567-2.</p>
</li>
<li>
<p>Joshua Kerievsky (2004). <em>Refactoring To Patterns</em>. Addison-Wesley. ISBN 0-321-21335-1.</p>
</li>
<li>
<p>Eric Freeman, Elisabeth Freeman, Kathy Sierra, Bert Bates (2004). <em>Head First Design Patterns</em>. O’Reilly. ISBN 0-596-00712-4.
*<em>A great book to read, informative as well as amusing.</em></p>
</li>
<li>
<p>Dierk Koenig with Andrew Glover, Paul King, Guillaume Laforge and Jon Skeet (2007). <em>Groovy in Action</em>. Manning. ISBN 1-932394-84-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>Discusses Visitor, Builder and other Patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Brad Appleton (1999). <a href="http://www.bradapp.com/docs/pizza-inv.html">Pizza Inversion - a Pattern for Efficient Resource Consumption</a>.</p>
<div class="ulist">
<ul>
<li>
<p><em>One of the most frequently used patterns by many software engineers!</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Design Patterns in Dynamic Languages</em> by Neil Ford. Houston Java User’s Group. Examples in Groovy and Ruby. <a href="http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf" class="bare">http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_针对java开发者的groovy风格和语言特性指南"><a class="link" href="#_针对java开发者的groovy风格和语言特性指南">10. 针对Java开发者的Groovy风格和语言特性指南</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Java developer embarking on a Groovy adventure will always have Java in mind, and will progressively learn Groovy,
one feature at a time, becoming more productive and writing more idiomatic Groovy code.
This document&#8217;s purpose is to guide such a developer along the way, teaching some common Groovy syntax style,
new operators, and new features like closures, etc.
This guide is not complete and only serves as a quick intro and a base for further guideline sections
should you feel like contributing to the document and enhancing it.</p>
</div>
<div class="sect2">
<h3 id="_可省略分号"><a class="link" href="#_可省略分号">10.1. 可省略分号</a></h3>
<div class="paragraph">
<p>When coming from a C / C++ / C# / Java background, we&#8217;re so used to semicolons, that we put them everywhere.
Even worse, Groovy supports 99% of Java&#8217;s syntax, and sometimes,
it&#8217;s so easy to paste some Java code into your Groovy programs, that you end up with tons of semicolons everywhere.
But&#8230;&#8203; semicolons are optional in Groovy, you can omit them, and it&#8217;s more idiomatic to remove them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_return关键字可选"><a class="link" href="#_return关键字可选">10.2. Return关键字可选</a></h3>
<div class="paragraph">
<p>In Groovy, the last expression evaluated in the body of a method can be returned without necessitating the <code>return</code> keyword.
Especially for short methods and for closures, it&#8217;s nicer to omit it for brevity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a server</span><span style="color:#710">&quot;</span></span> }
<span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a server</span><span style="color:#710">&quot;</span></span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>But sometimes, this doesn&#8217;t look too good when you&#8217;re using a variable, and see it visually twice on two rows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">props</span>() {
    <span style="color:#080;font-weight:bold">def</span> m1 = [<span style="color:#606">a</span>: <span style="color:#00D">1</span>, <span style="color:#606">b</span>: <span style="color:#00D">2</span>]
    m2 = m1.findAll { k, v -&gt; v % <span style="color:#00D">2</span> == <span style="color:#00D">0</span> }
    m2.c = <span style="color:#00D">3</span>
    m2
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such case, either putting a newline before the last expression, or explicitly using <code>return</code> may yield better readability.</p>
</div>
<div class="paragraph">
<p>I, for myself, sometimes use the <code>return</code> keyword, sometimes not, it&#8217;s often a matter of taste.
But often, inside of closure, we omit it more often than not, for example. So even if the keyword is optional,
this is by no means mandatory to not use it if you think it halters the readability of your code.</p>
</div>
<div class="paragraph">
<p>A word of caution, however. When using methods which are defined with the <code>def</code> keyword instead of a specific concrete type,
you may be surprised to see the last expression being returned sometimes. So usually prefer using a specific return type like void or a type.
In our example above, imagine we forgot to put m2 as last statement to be returned,
the last expression would be <code>m2.c = 3</code>, which would return&#8230;&#8203; <code>3</code>, and not the map you expect.</p>
</div>
<div class="paragraph">
<p>Statements like <code>if</code>/<code>else</code>, <code>try</code>/<code>catch</code> can thus return a value as well, as there&#8217;s a "last expression" evaluated in those statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">foo</span>(n) {
    <span style="color:#080;font-weight:bold">if</span>(n == <span style="color:#00D">1</span>) {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Roshan</span><span style="color:#710">&quot;</span></span>
    } <span style="color:#080;font-weight:bold">else</span> {
        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Dawrani</span><span style="color:#710">&quot;</span></span>
    }
}

<span style="color:#080;font-weight:bold">assert</span> foo(<span style="color:#00D">1</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Roshan</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">assert</span> foo(<span style="color:#00D">2</span>) == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Dawrani</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_def_and_type"><a class="link" href="#_def_and_type">10.3. Def and type</a></h3>
<div class="paragraph">
<p>As we&#8217;re talking about <code>def</code> and types, I often see developers using both <code>def</code> and a type. But <code>def</code> is redundant here.
So make a choice, either use <code>def</code> or a type.</p>
</div>
<div class="paragraph">
<p>So don&#8217;t write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#0a8;font-weight:bold">String</span> name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Guillaume</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#0a8;font-weight:bold">String</span> name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Guillaume</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>def</code> in Groovy, the actual type holder is <code>Object</code> (so you can assign any object to variables defined with <code>def</code>,
and return any kind of object if a method is declared returning <code>def</code>).</p>
</div>
<div class="paragraph">
<p>When defining a method with untyped parameters, you can use <code>def</code> but it&#8217;s not needed, so we tend to omit them.
So instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> doSomething(<span style="color:#080;font-weight:bold">def</span> param1, <span style="color:#080;font-weight:bold">def</span> param2) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prefer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">void</span> doSomething(param1, param2) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>But as we mention in the last section of the document, it&#8217;s usually better to type your method parameters,
so as to help with documenting your code, and also help IDEs for code-completion,
or for leveraging the static type checking or static compilation capabilities of Groovy.</p>
</div>
<div class="paragraph">
<p>Another place where <code>def</code> is redundant and should be avoided is when defining constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyClass</span> {
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">MyClass</span>() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, just remove the <code>def</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyClass</span> {
    MyClass() {}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_默认public"><a class="link" href="#_默认public">10.4. 默认public</a></h3>
<div class="paragraph">
<p>By default, Groovy considers classes and methods <code>public</code>.
So you don&#8217;t have to use the <code>public</code> modifier everywhere something is public.
Only if it&#8217;s not public, you should put a visibility modifier.</p>
</div>
<div class="paragraph">
<p>So instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Server</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a server</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prefer the more concise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Server</span> {
    <span style="color:#0a8;font-weight:bold">String</span> toString() { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a server</span><span style="color:#710">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may wonder about the 'package-scope' visibility,
and the fact Groovy allows one to omit 'public' means that this scope is not supported by default,
but there&#8217;s actually a special Groovy annotation which allows you to use that visibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Server</span> {
    <span style="color:#007">@PackageScope</span> Cluster cluster
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_省略括号"><a class="link" href="#_省略括号">10.5. 省略括号</a></h3>
<div class="paragraph">
<p>Groovy allows you to omit the parentheses for top-level expressions, like with the <code>println</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>
method a, b</code></pre>
</div>
</div>
<div class="paragraph">
<p>vs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello</span><span style="color:#710">&quot;</span></span>)
method(a, b)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a closure is the last parameter of a method call, like when using Groovy&#8217;s <code>each{}</code> iteration mechanism,
you can put the closure outside the closing parentheses, and even omit the parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">list.each( { println <span style="color:#950">it</span> } )
list.each(){ println <span style="color:#950">it</span> }
list.each  { println <span style="color:#950">it</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Always prefer the third form, which is more natural, as an empty pair of parentheses is just useless syntactical noise!</p>
</div>
<div class="paragraph">
<p>In some cases parentheses are required, such as when making nested method calls or when calling a method without parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">foo</span>(n) { n }
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>() { <span style="color:#00D">1</span> }

println foo <span style="color:#00D">1</span> <span style="color:#777">// won't work</span>
<span style="color:#080;font-weight:bold">def</span> m = bar   <span style="color:#777">// won't work</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_classes_as_first_class_citizens"><a class="link" href="#_classes_as_first_class_citizens">10.6. Classes as first-class citizens</a></h3>
<div class="paragraph">
<p>The <code>.class</code> suffix is not needed in Groovy, a bit like in Java&#8217;s <code>instanceof</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">connection.doPost(BASE_URI + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/modify.hqu</span><span style="color:#710">&quot;</span></span>, params, ResourcesResponse.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using GStrings we&#8217;re going to cover below, and using first class citizens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">connection.doPost(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>BASE_URI<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/modify.hqu</span><span style="color:#710">&quot;</span></span>, params, ResourcesResponse)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getters_和_setters"><a class="link" href="#_getters_和_setters">10.7. Getters 和 Setters</a></h3>
<div class="paragraph">
<p>In Groovy, a getters and setters form what we call a "property",
and offers a shortcut notation for accessing and setting such properties.
So instead of the Java-way of calling getters / setters, you can use a field-like access notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">resourceGroup.getResourcePrototype().getName() == SERVER_TYPE_NAME
resourceGroup.resourcePrototype.name == SERVER_TYPE_NAME

resourcePrototype.setName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">something</span><span style="color:#710">&quot;</span></span>)
resourcePrototype.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">something</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When writing your beans in Groovy, often called POGOs (Plain Old Groovy Objects),
you don&#8217;t have to create the field and getter / setter yourself, but let the Groovy compiler do it for you.</p>
</div>
<div class="paragraph">
<p>So instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> name
    <span style="color:#0a8;font-weight:bold">String</span> getName() { <span style="color:#080;font-weight:bold">return</span> name }
    <span style="color:#339;font-weight:bold">void</span> setName(<span style="color:#0a8;font-weight:bold">String</span> name) { <span style="color:#950">this</span>.name = name }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, a freestanding 'field' without modifier visibility actually
makes the Groovy compiler to generate a private field and a getter and setter for you.</p>
</div>
<div class="paragraph">
<p>When using such POGOs from Java, the getter and setter are indeed there, and can be used as usual, of course.</p>
</div>
<div class="paragraph">
<p>Although the compiler creates the usual getter/setter logic,
if you wish to do anything additional or different in those getters/setters,
you&#8217;re free to still provide them, and the compiler will use your logic, instead of the default generated one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_使用默认构造函数和命名参数初始化bean"><a class="link" href="#_使用默认构造函数和命名参数初始化bean">10.8. 使用默认构造函数和命名参数初始化bean</a></h3>
<div class="paragraph">
<p>With a bean like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Server</span> {
    <span style="color:#0a8;font-weight:bold">String</span> name
    Cluster cluster
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of setting each setter in subsequent statements as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> server = <span style="color:#080;font-weight:bold">new</span> Server()
server.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Obelix</span><span style="color:#710">&quot;</span></span>
server.cluster = aCluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use named parameters with the default constructor (first the constructor is called, then the setters are called in the sequence in which they are specified in the map):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> server = <span style="color:#080;font-weight:bold">new</span> Server(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Obelix</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">cluster</span>: aCluster)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_with_and_tap_for_repeated_operations_on_the_same_bean"><a class="link" href="#_using_with_and_tap_for_repeated_operations_on_the_same_bean">10.9. Using <code>with()</code> and <code>tap()</code> for repeated operations on the same bean</a></h3>
<div class="paragraph">
<p>Named-parameters with the default constructor is interesting when creating new instances,
but what if you are updating an instance that was given to you, do you have to repeat the 'server' prefix again and again?
No, thanks to the <code>with()</code> and <code>tap()</code> methods that Groovy adds on all objects of any kind:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">server.name = application.name
server.status = status
server.sessionCount = <span style="color:#00D">3</span>
server.start()
server.stop()</code></pre>
</div>
</div>
<div class="paragraph">
<p>vs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">server.with {
    name = application.name
    status = status
    sessionCount = <span style="color:#00D">3</span>
    start()
    stop()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with any closure in Groovy, the last statement is considered the return value.  In the example above this is the result of <code>stop()</code>.  To use this as a builder, that just returns the incoming object, there is also <code>tap()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> person = <span style="color:#080;font-weight:bold">new</span> Person().with {
    name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Ada Lovelace</span><span style="color:#710">&quot;</span></span>
    <span style="color:#950">it</span> <span style="color:#777">// Note the explicit mention of it as the return value</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>vs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> person = <span style="color:#080;font-weight:bold">new</span> Person().tap {
    name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Ada Lovelace</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: you can also use <code>with(true)</code> instead of <code>tap()</code> and <code>with(false)</code> instead of <code>with()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_equals_和"><a class="link" href="#_equals_和">10.10. Equals 和 <code>==</code></a></h3>
<div class="paragraph">
<p>Java&#8217;s <code>==</code> is actually Groovy&#8217;s <code>is()</code> method, and Groovy&#8217;s <code>==</code> is a clever <code>equals()</code>!</p>
</div>
<div class="paragraph">
<p>To compare the references of objects, instead of <code>==</code>, you should use <code>a.is(b)</code>.</p>
</div>
<div class="paragraph">
<p>But to do the usual <code>equals()</code> comparison, you should prefer Groovy&#8217;s <code>==</code>,
as it also takes care of avoiding <code>NullPointerException</code>, independently of whether the left or right is <code>null</code> or not.</p>
</div>
<div class="paragraph">
<p>Instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">status != <span style="color:#069">null</span> &amp;&amp; status.equals(ControlConstants.STATUS_COMPLETED)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">status == ControlConstants.STATUS_COMPLETED</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gstrings_插值_多行"><a class="link" href="#_gstrings_插值_多行">10.11. GStrings (插值, 多行)</a></h3>
<div class="paragraph">
<p>We often use string and variable concatenation in Java, with many opening <code>/</code> closing of double quotes, plus signs,
and <code>\n</code> characters for newlines.
 With interpolated strings (called GStrings), such strings look better and are less painful to type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">Exception</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unable to convert resource: </span><span style="color:#710">&quot;</span></span> + resource)</code></pre>
</div>
</div>
<div class="paragraph">
<p>vs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">Exception</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unable to convert resource: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>resource<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the curly braces, you can put any kind of expression, not just variables.
For simple variables, or <code>variable.property</code>, you can even drop the curly braces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">Exception</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unable to convert resource: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">$</span>resource</span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can even lazily evaluate those expressions using a closure notation with <code>${-&gt; resource }</code>.
When the GString will be coerced to a String, it&#8217;ll evaluate the closure and get the <code>toString()</code> representation of the return value.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#339;font-weight:bold">int</span> i = <span style="color:#00D">3</span>

<span style="color:#080;font-weight:bold">def</span> s1 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">i's value is: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">def</span> s2 = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">i's value is: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>-&gt; i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>

i++

<span style="color:#080;font-weight:bold">assert</span> s1 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">i's value is: 3</span><span style="color:#710">&quot;</span></span> <span style="color:#777">// eagerly evaluated, takes the value on creation</span>
<span style="color:#080;font-weight:bold">assert</span> s2 == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">i's value is: 4</span><span style="color:#710">&quot;</span></span> <span style="color:#777">// lazily evaluated, takes the new value into account</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When strings and their concatenated expression are long in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> PluginException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Failed to execute command list-applications:</span><span style="color:#710">&quot;</span></span> +
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20"> The group with name </span><span style="color:#710">&quot;</span></span> +
    parameterMap.groupname[<span style="color:#00D">0</span>] +
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20"> is not compatible group of type </span><span style="color:#710">&quot;</span></span> +
    SERVER_TYPE_NAME)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>\</code> continuation character (this is not a multiline string):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> PluginException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Failed to execute command list-applications: </span><span style="color:#b0b">\
</span><span style="color:#D20">The group with name </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>parameterMap.groupname[<span style="color:#00D">0</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> </span><span style="color:#b0b">\
</span><span style="color:#D20">is not compatible group of type </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>SERVER_TYPE_NAME<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using multiline strings with triple quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> PluginException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;&quot;&quot;</span><span style="color:#D20">Failed to execute command list-applications:
    The group with name </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>parameterMap.groupname[<span style="color:#00D">0</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">
    is not compatible group of type </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>SERVER_TYPE_NAME)<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;&quot;&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also strip the indentation appearing on the left side of the multiline strings by calling <code>.stripIndent()</code> on that string.</p>
</div>
<div class="paragraph">
<p>Also note the difference between single quotes and double quotes in Groovy: single quotes always create Java Strings,
without interpolation of variables, whereas double quotes either create Java Strings or GStrings when interpolated variables are present.</p>
</div>
<div class="paragraph">
<p>For multiline strings, you can triple the quotes: i.e. triple double quotes for GStrings and triple single quotes for mere Strings.</p>
</div>
<div class="paragraph">
<p>If you need to write regular expression patterns, you should use the "slashy" string notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foooo/baaaaar</span><span style="color:#710">&quot;</span></span> ==~ <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">fo+</span><span style="color:#D20">\/</span><span style="color:#808">ba+r</span><span style="color:#404">/</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of the "slashy" notation is that you don&#8217;t need to double escape backslashes, making working with regex a bit simpler.</p>
</div>
<div class="paragraph">
<p>Last but not least, prefer using single quoted strings when you need string constants,
and use double-quoted strings when you are explicitly relying on string interpolation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_数据结构的groovy语法"><a class="link" href="#_数据结构的groovy语法">10.12. 数据结构的groovy语法</a></h3>
<div class="paragraph">
<p>Groovy provides native syntax constructs for data structures like lists, maps, regex, or ranges of values.
Make sure to leverage them in your Groovy programs.</p>
</div>
<div class="paragraph">
<p>Here are some examples of those native constructs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> list = [<span style="color:#00D">1</span>, <span style="color:#00D">4</span>, <span style="color:#00D">6</span>, <span style="color:#00D">9</span>]

<span style="color:#777">// by default, keys are Strings, no need to quote them</span>
<span style="color:#777">// you can wrap keys with () like [(variableStateAcronym): stateName] to insert a variable or object as a key.</span>
<span style="color:#080;font-weight:bold">def</span> map = [<span style="color:#606">CA</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">California</span><span style="color:#710">'</span></span>, <span style="color:#606">MI</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Michigan</span><span style="color:#710">'</span></span>]

<span style="color:#777">// ranges can be inclusive and exclusive</span>
<span style="color:#080;font-weight:bold">def</span> range = <span style="color:#00D">10</span>..<span style="color:#00D">20</span> <span style="color:#777">// inclusive</span>
<span style="color:#080;font-weight:bold">assert</span> range.size() == <span style="color:#00D">11</span>
<span style="color:#777">// use brackets if you need to call a method on a range definition</span>
<span style="color:#080;font-weight:bold">assert</span> (<span style="color:#00D">10</span>..&lt;<span style="color:#00D">20</span>).size() == <span style="color:#00D">10</span> <span style="color:#777">// exclusive</span>

<span style="color:#080;font-weight:bold">def</span> pattern = ~<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">fo*</span><span style="color:#404">/</span></span>

<span style="color:#777">// equivalent to add()</span>
list &lt;&lt; <span style="color:#00D">5</span>

<span style="color:#777">// call contains()</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">4</span> <span style="color:#080;font-weight:bold">in</span> list
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">5</span> <span style="color:#080;font-weight:bold">in</span> list
<span style="color:#080;font-weight:bold">assert</span> <span style="color:#00D">15</span> <span style="color:#080;font-weight:bold">in</span> range

<span style="color:#777">// subscript notation</span>
<span style="color:#080;font-weight:bold">assert</span> list[<span style="color:#00D">1</span>] == <span style="color:#00D">4</span>

<span style="color:#777">// add a new key value pair</span>
map &lt;&lt; [<span style="color:#606">WA</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Washington</span><span style="color:#710">'</span></span>]
<span style="color:#777">// subscript notation</span>
<span style="color:#080;font-weight:bold">assert</span> map[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CA</span><span style="color:#710">'</span></span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">California</span><span style="color:#710">'</span></span>
<span style="color:#777">// property notation</span>
<span style="color:#080;font-weight:bold">assert</span> map.WA == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Washington</span><span style="color:#710">'</span></span>

<span style="color:#777">// matches() strings against patterns</span>
<span style="color:#080;font-weight:bold">assert</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span> ==~ pattern</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_groovy_development_kit"><a class="link" href="#_the_groovy_development_kit">10.13. The Groovy Development Kit</a></h3>
<div class="paragraph">
<p>Continuing on the data structures, when you need to iterate over collections,
Groovy provides various additional methods, decorating Java&#8217;s core data structures,
like <code>each{}</code>, <code>find{}</code>, <code>findAll{}</code>, <code>every{}</code>, <code>collect{}</code>, <code>inject{}</code>.
These methods add a functional flavor to the programming language and help working with complex algorithms more easily.
Lots of new methods are applied to various types, through decoration, thanks to the dynamic nature of the language.
You can find lots of very useful methods on String, Files, Streams, Collections, and much more:</p>
</div>
<div class="paragraph">
<p><a href="http://groovy-lang.org/gdk.html" class="bare">http://groovy-lang.org/gdk.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_强大的switch"><a class="link" href="#_强大的switch">10.14. 强大的Switch</a></h3>
<div class="paragraph">
<p>Groovy&#8217;s <code>switch</code> is much more powerful than in C-ish languages which usually only accept primitives and assimilated.
Groovy&#8217;s <code>switch</code> accepts pretty much any kind of type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> x = <span style="color:#60E">1.23</span>
<span style="color:#080;font-weight:bold">def</span> result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">switch</span> (x) {
    <span style="color:#080;font-weight:bold">case</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">foo</span><span style="color:#710">&quot;</span></span>: result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">found foo</span><span style="color:#710">&quot;</span></span>
    <span style="color:#777">// lets fall through</span>
    <span style="color:#080;font-weight:bold">case</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>: result += <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">bar</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">case</span> [<span style="color:#00D">4</span>, <span style="color:#00D">5</span>, <span style="color:#00D">6</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">inList</span><span style="color:#710">'</span></span>]:
        result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">list</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">break</span>
    <span style="color:#080;font-weight:bold">case</span> <span style="color:#00D">12</span>..<span style="color:#00D">30</span>:
        result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">range</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">break</span>
    <span style="color:#080;font-weight:bold">case</span> <span style="color:#0a8;font-weight:bold">Integer</span>:
        result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">integer</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">break</span>
    <span style="color:#080;font-weight:bold">case</span> <span style="color:#0a8;font-weight:bold">Number</span>:
        result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">number</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">break</span>
    <span style="color:#080;font-weight:bold">case</span> { <span style="color:#950">it</span> &gt; <span style="color:#00D">3</span> }:
        result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">number &gt; 3</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">break</span>
    <span style="color:#080;font-weight:bold">default</span>: result = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">default</span><span style="color:#710">&quot;</span></span>
}
<span style="color:#080;font-weight:bold">assert</span> result == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">number</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And more generally, types with an <code>isCase()</code> method can also decide whether a value corresponds with a case</p>
</div>
</div>
<div class="sect2">
<h3 id="_import别名"><a class="link" href="#_import别名">10.15. Import别名</a></h3>
<div class="paragraph">
<p>In Java, when using two classes of the same name but from different packages, like <code>java.util.List</code>
and <code>java.awt.List</code>, you can import one class, but have to use a fully-qualified name for the other.</p>
</div>
<div class="paragraph">
<p>Also sometimes, in your code, multiple usages of a long class name, can increase verbosity and
reduce clarity of the code.</p>
</div>
<div class="paragraph">
<p>To improve such situations, Groovy features import aliasing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.List</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">UtilList</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.awt.List</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">AwtList</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.swing.WindowConstants</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">WC</span>

UtilList list1 = [WC.EXIT_ON_CLOSE]
<span style="color:#080;font-weight:bold">assert</span> list1.size() <span style="color:#080;font-weight:bold">instanceof</span> <span style="color:#0a8;font-weight:bold">Integer</span>
<span style="color:#080;font-weight:bold">def</span> list2 = <span style="color:#080;font-weight:bold">new</span> AwtList()
<span style="color:#080;font-weight:bold">assert</span> list2.size() <span style="color:#080;font-weight:bold">instanceof</span> java.awt.Dimension</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use aliasing when importing methods statically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">static</span> <span style="color:#B44;font-weight:bold">java.lang.Math.abs</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#B06;font-weight:bold">mabs</span>
<span style="color:#080;font-weight:bold">assert</span> mabs(-<span style="color:#00D">4</span>) == <span style="color:#00D">4</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_真假"><a class="link" href="#_groovy_真假">10.16. Groovy 真假</a></h3>
<div class="paragraph">
<p>All objects can be 'coerced' to a boolean value: everything that&#8217;s <code>null</code>, <code>void</code>, equal to zero,
or empty evaluates to <code>false</code>, and if not, evaluates to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>So instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">if</span> (name != <span style="color:#069">null</span> &amp;&amp; name.length &gt; <span style="color:#00D">0</span>) {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can just do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">if</span> (name) {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Same thing for collections, etc.</p>
</div>
<div class="paragraph">
<p>Thus, you can use some shortcuts in things like <code>while()</code>, <code>if()</code>, the ternary operator, the Elvis operator (see below), etc.</p>
</div>
<div class="paragraph">
<p>It&#8217;s even possible to customize the Groovy Truth, by adding a boolean <code>asBoolean()</code> method to your classes!</p>
</div>
</div>
<div class="sect2">
<h3 id="_安全的对象导航"><a class="link" href="#_安全的对象导航">10.17. 安全的对象导航</a></h3>
<div class="paragraph">
<p>Groovy supports a variant of the <code>.</code> operator to safely navigate an object graph.</p>
</div>
<div class="paragraph">
<p>In Java, when you&#8217;re interested in a node deep in the graph and need to check for <code>null</code>,
you often end up writing complex <code>if</code>, or nested <code>if</code> statements like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">if</span> (order != <span style="color:#069">null</span>) {
    <span style="color:#080;font-weight:bold">if</span> (order.getCustomer() != <span style="color:#069">null</span>) {
        <span style="color:#080;font-weight:bold">if</span> (order.getCustomer().getAddress() != <span style="color:#069">null</span>) {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(order.getCustomer().getAddress());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>?.</code> safe dereference operator, you can simplify such code with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">println order?.customer?.address</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nulls are checked throughout the call chain and no <code>NullPointerException</code> will be thrown if any element is <code>null</code>,
and the resulting value will be null if something&#8217;s <code>null</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_断言"><a class="link" href="#_断言">10.18. 断言</a></h3>
<div class="paragraph">
<p>To check your parameters, your return values, and more, you can use the <code>assert</code> statement.</p>
</div>
<div class="paragraph">
<p>Contrary to Java&#8217;s <code>assert</code>, `assert`s don&#8217;t need to be activated to be working, so `assert`s are always checked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">check</span>(<span style="color:#0a8;font-weight:bold">String</span> name) {
    <span style="color:#777">// name non-null and non-empty according to Groovy Truth</span>
    <span style="color:#080;font-weight:bold">assert</span> name
    <span style="color:#777">// safe navigation + Groovy Truth to check</span>
    <span style="color:#080;font-weight:bold">assert</span> name?.size() &gt; <span style="color:#00D">3</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll also notice the nice output that Groovy&#8217;s "Power Assert" statement provides,
with a graph view of the various values of each sub-expressions being asserted.</p>
</div>
</div>
<div class="sect2">
<h3 id="_elvis_operator_for_default_values"><a class="link" href="#_elvis_operator_for_default_values">10.19. Elvis operator for default values</a></h3>
<div class="paragraph">
<p>The Elvis operator is a special ternary operator shortcut which is handy to use for default values.</p>
</div>
<div class="paragraph">
<p>We often have to write code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> result = name != <span style="color:#069">null</span> ? name : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to Groovy Truth, the <code>null</code> check can be simplified to just 'name'.</p>
</div>
<div class="paragraph">
<p>And to go even further, since you return 'name' anyway, instead of repeating name twice in this ternary expression,
we can somehow remove what&#8217;s in between the question mark and colon, by using the Elvis operator, so that the above becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">def</span> result = name ?: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_捕获所有异常"><a class="link" href="#_捕获所有异常">10.20. 捕获所有异常</a></h3>
<div class="paragraph">
<p>If you don&#8217;t really care about the type of the exception which is thrown inside your <code>try</code> block,
you can simply catch any of them and simply omit the type of the caught exception.
So instead of catching the exceptions like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#777">// ...</span>
} <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">Exception</span> t) {
    <span style="color:#777">// something bad happens</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then catch anything ('any' or 'all', or whatever makes you think it&#8217;s anything):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span style="color:#080;font-weight:bold">try</span> {
    <span style="color:#777">// ...</span>
} <span style="color:#080;font-weight:bold">catch</span> (any) {
    <span style="color:#777">// something bad happens</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Note that it&#8217;s catching all Exceptions, not `Throwable`s. If you need to really catch "everything",
you&#8217;ll have to be explicit and say you want to catch `Throwable`s.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_optional_typing_advice"><a class="link" href="#_optional_typing_advice">10.21. Optional typing advice</a></h3>
<div class="paragraph">
<p>I&#8217;ll finish on some words on when and how to use optional typing.
Groovy lets you decide whether you use explicit strong typing, or when you use <code>def</code>.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve got a rather simple rule of thumb: whenever the code you&#8217;re writing is going to be used by others as a public API,
you should always favor the use of strong typing, it helps making the contract stronger,
avoids possible passed arguments type mistakes, gives better documentation, and also helps the IDE with code completion.
Whenever the code is for your use only, like private methods,
or when the IDE can easily infer the type, then you&#8217;re more free to decide when to type or not.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-01-31 16:37:11 +0800
</div>
</div>
</body>
</html>