# ==========================
# ğŸ§± ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µï¼ˆä½¿ç”¨ Maven æ„å»º jar åŒ…ï¼‰
# ==========================
FROM maven:3.9.9-eclipse-temurin-17 AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å…ˆæ‹·è´ pom.xml å¹¶ä¸‹è½½ä¾èµ–ï¼ŒåŠ å¿«åç»­æ„å»ºé€Ÿåº¦ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
COPY pom.xml .
RUN mvn -B dependency:go-offline

# æ‹·è´æºç å¹¶æ„å»ºå¯æ‰§è¡Œ jar
COPY src ./src
RUN mvn -B clean package -DskipTests

# ==========================
# ğŸš€ ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µï¼ˆåªåŒ…å«è¿è¡Œç¯å¢ƒï¼‰
# ==========================
FROM eclipse-temurin:17-jdk-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ jar åŒ…åˆ°è¿è¡Œç¯å¢ƒ
COPY --from=builder /app/target/*.jar app.jar

# æš´éœ²åº”ç”¨ç«¯å£
EXPOSE 8088

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "app.jar"]
